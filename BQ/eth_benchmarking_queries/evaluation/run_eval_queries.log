+ echo -e 'Query_Name\tJob_ID\tDuration_ms\tBytes_Processed\tSlot_Milliseconds'
++ date
+ echo 'Script started at Fri Nov  7 02:36:35 PM UTC 2025. Logging output to run_eval_queries.log'
Script started at Fri Nov  7 02:36:35 PM UTC 2025. Logging output to run_eval_queries.log
+ echo 'Summary will be written to execution_summary.tsv'
Summary will be written to execution_summary.tsv
+ echo ===========================================================
===========================================================
+ echo 'Checking for prerequisites...'
Checking for prerequisites...
+ command -v bq
+ command -v jq
+ echo 'Prerequisites '\''bq'\'' and '\''jq'\'' found.'
Prerequisites 'bq' and 'jq' found.
+ echo --------------------------------------------------
--------------------------------------------------
++ cat
+ QUERY_DAILY_AVG_UNOPTIMIZED='SELECT
    -- Calculating averages
    AVG(CAST(t.gas_price AS NUMERIC)) AS avg_gas_price_wei,
    AVG(t.value) AS avg_transaction_value_wei
FROM
    -- Scan the entire transactions table first
    `bigquery-public-data.crypto_ethereum_classic.transactions` AS t
WHERE
    -- 1. Find the latest date by re-calculating the MAX date for every row,
    -- or by joining the max_date CTE without an explicit ON clause,
    -- leading to a non-sargable predicate against the entire table.
    DATE(t.block_timestamp) = (
        SELECT MAX(DATE(block_timestamp))
        FROM `bigquery-public-data.crypto_ethereum_classic.transactions`
    )'
++ cat
+ QUERY_DAILY_AVG_OPTIMIZED='WITH max_date AS (
    -- 1. Determine the latest date once in an efficient, independent step.
    -- This operation is fast because it'\''s a single aggregation over the table.
    SELECT MAX(DATE(block_timestamp)) AS max_dt
    FROM `bigquery-public-data.crypto_ethereum_classic.transactions`
)
SELECT
    -- 2. Calculate the average gas price (casting INTEGER to NUMERIC for precision)
    AVG(CAST(t.gas_price AS NUMERIC)) AS avg_gas_price_wei,
    -- 3. Calculate the average transaction value (using the existing NUMERIC value column)
    AVG(t.value) AS avg_transaction_value_wei
FROM
    `bigquery-public-data.crypto_ethereum_classic.transactions` AS t
INNER JOIN
    -- 4. Join the main table to the single-row CTE, ensuring the filter is pushed down
    -- and the table is only scanned for the single target date.
    max_date AS m ON DATE(t.block_timestamp) = m.max_dt'
++ cat
+ QUERY_ERC20_UNOPTIMIZED='WITH ERC20_Contracts AS (
    -- CTE 1: Filters the small '\''contracts'\'' dimension table once to identify ERC20s.
    SELECT address 
    FROM `bigquery-public-data.crypto_ethereum_classic.contracts` 
    WHERE is_erc20 = TRUE
),
MonthlyLogCounts AS (
    -- CTE 2: Filters early and aggregates the massive '\''logs'\'' table to find high-activity contracts (> 1,000 logs/month).
    SELECT
        t1.address,
        FORMAT_DATE('\''%Y-%m'\'', t1.block_timestamp) AS transaction_month, 
        COUNT(t1.log_index) AS log_event_count 
    FROM
        `bigquery-public-data.crypto_ethereum_classic.logs` AS t1
    INNER JOIN
        ERC20_Contracts AS t2 ON t1.address = t2.address
    GROUP BY
        1, 2
    HAVING
        log_event_count > 1000
),
FrequentTopics AS (
    -- CTE 3: Joins the already filtered, small result from CTE 2 back to the '\''logs'\'' table
    -- only for the relevant contracts/months to find the topic frequency (event signature).
    SELECT
        t1.address,
        t1.transaction_month,
        topic,
        -- Applies a rank over the small, relevant subset of data.
        ROW_NUMBER() OVER (PARTITION BY t1.address, t1.transaction_month ORDER BY COUNT(topic) DESC) AS topic_rank
    FROM
        MonthlyLogCounts AS t1
    INNER JOIN
        `bigquery-public-data.crypto_ethereum_classic.logs` AS t2 
        ON t1.address = t2.address AND FORMAT_DATE('\''%Y-%m'\'', t2.block_timestamp) = t1.transaction_month
    CROSS JOIN
        UNNEST(t2.topics) AS topic WITH OFFSET AS topic_index
    WHERE
        topic_index = 0 -- Isolates the event signature hash (topics[0])
    GROUP BY
        1, 2, 3
)
-- Final Query: Selects the result ranked 1 (the most frequent event hash) for each contract/month.
SELECT
    COUNT(DISTINCT address) AS unique_erc20_contracts_exceeding_1k,
    ARRAY_AGG(
        STRUCT(t1.address, t1.transaction_month, t1.topic AS most_frequent_signature_hash) 
        ORDER BY t1.address, t1.transaction_month
    ) AS details_by_contract_and_month
FROM FrequentTopics AS t1
WHERE t1.topic_rank = 1'
++ cat
+ QUERY_ERC20_OPTIMIZED='WITH ERC20_Contracts AS (
    SELECT address FROM `bigquery-public-data.crypto_ethereum_classic.contracts` WHERE is_erc20 = TRUE
),
MonthlyLogCounts AS (
    SELECT
        t1.address,
        FORMAT_DATE('\''%Y-%m'\'', t1.block_timestamp) AS transaction_month, 
        COUNT(t1.log_index) AS log_event_count 
    FROM
        `bigquery-public-data.crypto_ethereum_classic.logs` AS t1
    INNER JOIN
        ERC20_Contracts AS t2 ON t1.address = t2.address
    GROUP BY
        1, 2
    HAVING
        log_event_count > 1000
),
FrequentTopics AS (
    SELECT
        t1.address,
        t1.transaction_month,
        topic,
        ROW_NUMBER() OVER (PARTITION BY t1.address, t1.transaction_month ORDER BY COUNT(topic) DESC) AS topic_rank
    FROM
        MonthlyLogCounts AS t1 -- Joins the already filtered and aggregated small list
    INNER JOIN
        `bigquery-public-data.crypto_ethereum_classic.logs` AS t2 
        ON t1.address = t2.address AND FORMAT_DATE('\''%Y-%m'\'', t2.block_timestamp) = t1.transaction_month
    CROSS JOIN
        UNNEST(t2.topics) AS topic WITH OFFSET AS topic_index
    WHERE
        topic_index = 0
    GROUP BY
        1, 2, 3
)
SELECT
    COUNT(DISTINCT address) AS unique_erc20_contracts_exceeding_1k,
    ARRAY_AGG(
        STRUCT(t1.address, t1.transaction_month, t1.topic AS most_frequent_signature_hash) 
        ORDER BY t1.address, t1.transaction_month
    ) AS details_by_contract_and_month
FROM FrequentTopics AS t1
WHERE t1.topic_rank = 1'
++ cat
+ QUERY_PEAK_SECURITY_UNOPTIMIZED='SELECT
    t1.miner,
    t1.gas_limit
FROM
    `bigquery-public-data.crypto_ethereum_classic.blocks` AS t1
WHERE
    t1.total_difficulty = (
        -- This forces a scan of the blocks table
        SELECT
            MAX(total_difficulty)
        FROM
            `bigquery-public-data.crypto_ethereum_classic.blocks`
    )
LIMIT 1'
++ cat
+ QUERY_PEAK_SECURITY_OPTIMIZED='SELECT
    t1.miner,
    t1.gas_limit
FROM
    (
        SELECT
            miner,
            gas_limit,
            ROW_NUMBER() OVER (ORDER BY total_difficulty DESC) AS rank_by_difficulty
        FROM
            `bigquery-public-data.crypto_ethereum_classic.blocks`
    ) AS t1
WHERE
    t1.rank_by_difficulty = 1
LIMIT 1'
++ cat
+ QUERY_TOP_INTERNAL_UNOPTIMIZED='SELECT
    t.to_address,
    SUM(t.value) AS total_value_received_wei
FROM
    `bigquery-public-data.crypto_ethereum_classic.traces` AS t
WHERE
    t.trace_type = '\''call'\''
    AND t.status = 1
    AND (t.call_type NOT IN ('\''delegatecall'\'', '\''callcode'\'', '\''staticcall'\'') OR t.call_type IS NULL)
    AND t.block_timestamp >= '\''2020-01-01 00:00:00 UTC'\''
    AND t.block_timestamp < '\''2020-01-08 00:00:00 UTC'\''
    AND t.to_address IS NOT NULL
GROUP BY
    t.to_address
ORDER BY
    total_value_received_wei DESC
LIMIT 10'
++ cat
+ QUERY_TOP_INTERNAL_OPTIMIZED='SELECT
    to_address,
    SUM(value) AS total_value_received_wei
FROM
    `bigquery-public-data.crypto_ethereum_classic.traces`
WHERE
    trace_type = '\''call'\''
    AND status = 1
    AND (call_type NOT IN ('\''delegatecall'\'', '\''callcode'\'', '\''staticcall'\'') OR call_type IS NULL)
    AND block_timestamp >= '\''2020-01-01 00:00:00 UTC'\''
    AND block_timestamp < '\''2020-01-08 00:00:00 UTC'\''
    AND to_address IS NOT NULL
GROUP BY
    to_address
QUALIFY
    ROW_NUMBER() OVER (ORDER BY total_value_received_wei DESC) <= 10'
++ cat
+ QUERY_TOP_SENDER_UNOPTIMIZED='WITH TopSenders AS (
    -- CTE 1: Identify the top 5 addresses based on the count of successful transactions
    SELECT
        t.from_address AS address,
        COUNT(t.hash) AS transaction_count
    FROM
        `bigquery-public-data.crypto_ethereum_classic.transactions` AS t
    WHERE
        t.receipt_status = 1 
        AND t.block_timestamp >= '\''2020-01-01 00:00:00 UTC'\'' 
        AND t.block_timestamp < '\''2020-04-01 00:00:00 UTC'\''  
    GROUP BY
        1
    ORDER BY
        transaction_count DESC
    LIMIT 5
),

TotalFees AS (
    -- CTE 2: Requires a second scan of the '\''transactions'\'' table unnecessarily
    SELECT
        t.from_address AS address,
        SUM(CAST(t.gas_price AS NUMERIC) * CAST(t.receipt_gas_used AS NUMERIC)) AS total_fees_paid
    FROM
        `bigquery-public-data.crypto_ethereum_classic.transactions` AS t
    INNER JOIN
        TopSenders AS s ON t.from_address = s.address
    WHERE
        t.block_timestamp >= '\''2020-01-01 00:00:00 UTC'\''
        AND t.block_timestamp < '\''2020-04-01 00:00:00 UTC'\''
        AND t.receipt_status = 1
    GROUP BY
        1
),

TotalValueSent AS (
    -- CTE 3: Scans the '\''traces'\'' table
    SELECT
        tr.from_address AS address,
        SUM(tr.value) AS total_value_sent
    FROM
        `bigquery-public-data.crypto_ethereum_classic.traces` AS tr
    INNER JOIN
        TopSenders AS s ON tr.from_address = s.address
    WHERE
        tr.block_timestamp >= '\''2020-01-01 00:00:00 UTC'\''  
        AND tr.block_timestamp < '\''2020-04-01 00:00:00 UTC'\'' 
    GROUP BY
        1
)

-- Final SELECT: Joins the calculated fees and values to find the net ether flow
SELECT
    f.address,
    v.total_value_sent,
    f.total_fees_paid,
    v.total_value_sent - f.total_fees_paid AS net_ether_flow_wei
FROM
    TotalFees AS f
INNER JOIN
    TotalValueSent AS v ON f.address = v.address
ORDER BY
    net_ether_flow_wei DESC
LIMIT 100'
++ cat
+ QUERY_TOP_SENDER_OPTIMIZED='WITH TransactionSummary AS (
    -- CTE 1 (Optimized): Single scan of the transactions table to calculate fees and rank all relevant senders.
    SELECT
        t.from_address,
        SUM(CAST(t.gas_price AS NUMERIC) * CAST(t.receipt_gas_used AS NUMERIC)) AS total_fees_paid,
        ROW_NUMBER() OVER (
            ORDER BY COUNT(t.hash) DESC
        ) AS rn_transaction_count
    FROM
        `bigquery-public-data.crypto_ethereum_classic.transactions` AS t
    WHERE
        t.receipt_status = 1 
        AND t.block_timestamp >= '\''2020-01-01 00:00:00 UTC'\''
        AND t.block_timestamp < '\''2020-04-01 00:00:00 UTC'\''
    GROUP BY
        1
),

TraceSummary AS (
    -- CTE 2 (Optimized): Single scan of the traces table to calculate the total value sent
    SELECT
        tr.from_address,
        SUM(tr.value) AS total_value_sent
    FROM
        `bigquery-public-data.crypto_ethereum_classic.traces` AS tr
    WHERE
        tr.block_timestamp >= '\''2020-01-01 00:00:00 UTC'\''  
        AND tr.block_timestamp < '\''2020-04-01 00:00:00 UTC'\''
    GROUP BY
        1
)

-- Final SELECT: Filter to the top 5 addresses (using the rank) and join the two pre-aggregated summaries.
SELECT
    ts.from_address,
    ts.total_fees_paid,
    vs.total_value_sent,
    vs.total_value_sent - ts.total_fees_paid AS net_ether_flow_wei
FROM
    TransactionSummary AS ts
INNER JOIN
    TraceSummary AS vs ON ts.from_address = vs.from_address
WHERE
    ts.rn_transaction_count <= 5 -- Filter down to the top 5 addresses
ORDER BY
    net_ether_flow_wei DESC
LIMIT 100'
+ echo '--- Running queries from daily_avg_value_and_fees_eval.sql ---'
--- Running queries from daily_avg_value_and_fees_eval.sql ---
+ run_query 'Daily Avg Unoptimized' 'SELECT
    -- Calculating averages
    AVG(CAST(t.gas_price AS NUMERIC)) AS avg_gas_price_wei,
    AVG(t.value) AS avg_transaction_value_wei
FROM
    -- Scan the entire transactions table first
    `bigquery-public-data.crypto_ethereum_classic.transactions` AS t
WHERE
    -- 1. Find the latest date by re-calculating the MAX date for every row,
    -- or by joining the max_date CTE without an explicit ON clause,
    -- leading to a non-sargable predicate against the entire table.
    DATE(t.block_timestamp) = (
        SELECT MAX(DATE(block_timestamp))
        FROM `bigquery-public-data.crypto_ethereum_classic.transactions`
    )'
+ local 'query_name=Daily Avg Unoptimized'
+ local 'query=SELECT
    -- Calculating averages
    AVG(CAST(t.gas_price AS NUMERIC)) AS avg_gas_price_wei,
    AVG(t.value) AS avg_transaction_value_wei
FROM
    -- Scan the entire transactions table first
    `bigquery-public-data.crypto_ethereum_classic.transactions` AS t
WHERE
    -- 1. Find the latest date by re-calculating the MAX date for every row,
    -- or by joining the max_date CTE without an explicit ON clause,
    -- leading to a non-sargable predicate against the entire table.
    DATE(t.block_timestamp) = (
        SELECT MAX(DATE(block_timestamp))
        FROM `bigquery-public-data.crypto_ethereum_classic.transactions`
    )'
+ echo ==================================================
==================================================
+ echo 'Executing Daily Avg Unoptimized'
Executing Daily Avg Unoptimized
+ echo ==================================================
==================================================
+ echo Query:
Query:
+ echo 'SELECT
    -- Calculating averages
    AVG(CAST(t.gas_price AS NUMERIC)) AS avg_gas_price_wei,
    AVG(t.value) AS avg_transaction_value_wei
FROM
    -- Scan the entire transactions table first
    `bigquery-public-data.crypto_ethereum_classic.transactions` AS t
WHERE
    -- 1. Find the latest date by re-calculating the MAX date for every row,
    -- or by joining the max_date CTE without an explicit ON clause,
    -- leading to a non-sargable predicate against the entire table.
    DATE(t.block_timestamp) = (
        SELECT MAX(DATE(block_timestamp))
        FROM `bigquery-public-data.crypto_ethereum_classic.transactions`
    )'
SELECT
    -- Calculating averages
    AVG(CAST(t.gas_price AS NUMERIC)) AS avg_gas_price_wei,
    AVG(t.value) AS avg_transaction_value_wei
FROM
    -- Scan the entire transactions table first
    `bigquery-public-data.crypto_ethereum_classic.transactions` AS t
WHERE
    -- 1. Find the latest date by re-calculating the MAX date for every row,
    -- or by joining the max_date CTE without an explicit ON clause,
    -- leading to a non-sargable predicate against the entire table.
    DATE(t.block_timestamp) = (
        SELECT MAX(DATE(block_timestamp))
        FROM `bigquery-public-data.crypto_ethereum_classic.transactions`
    )
+ echo --------------------------------------------------
--------------------------------------------------
++ bq query --nouse_cache --nosync --use_legacy_sql=false --format=json --location=US 'SELECT
    -- Calculating averages
    AVG(CAST(t.gas_price AS NUMERIC)) AS avg_gas_price_wei,
    AVG(t.value) AS avg_transaction_value_wei
FROM
    -- Scan the entire transactions table first
    `bigquery-public-data.crypto_ethereum_classic.transactions` AS t
WHERE
    -- 1. Find the latest date by re-calculating the MAX date for every row,
    -- or by joining the max_date CTE without an explicit ON clause,
    -- leading to a non-sargable predicate against the entire table.
    DATE(t.block_timestamp) = (
        SELECT MAX(DATE(block_timestamp))
        FROM `bigquery-public-data.crypto_ethereum_classic.transactions`
    )'
+ job_submission_output='{"kind":"bigquery#job","etag":"8hFaE8Fs43QVyGFA1DOenQ==","id":"tony-allen:US.bqjob_r45471123753c0bea_0000019a5ebf77ad_1","selfLink":"https://bigquery.googleapis.com/bigquery/v2/projects/tony-allen/jobs/bqjob_r45471123753c0bea_0000019a5ebf77ad_1?location=US","user_email":"admin@bentrollope.altostrat.com","configuration":{"query":{"query":"SELECT\n    -- Calculating averages\n    AVG(CAST(t.gas_price AS NUMERIC)) AS avg_gas_price_wei,\n    AVG(t.value) AS avg_transaction_value_wei\nFROM\n    -- Scan the entire transactions table first\n    `bigquery-public-data.crypto_ethereum_classic.transactions` AS t\nWHERE\n    -- 1. Find the latest date by re-calculating the MAX date for every row,\n    -- or by joining the max_date CTE without an explicit ON clause,\n    -- leading to a non-sargable predicate against the entire table.\n    DATE(t.block_timestamp) = (\n        SELECT MAX(DATE(block_timestamp))\n        FROM `bigquery-public-data.crypto_ethereum_classic.transactions`\n    )","destinationTable":{"projectId":"tony-allen","datasetId":"_e34c49c766e4fd3f5d404c3949b9e19fa7acb372","tableId":"anon6c3322b3_81ae_4241_98c6_942b8fc35528"},"writeDisposition":"WRITE_TRUNCATE","priority":"INTERACTIVE","useQueryCache":false,"useLegacySql":false},"jobType":"QUERY"},"jobReference":{"projectId":"tony-allen","jobId":"bqjob_r45471123753c0bea_0000019a5ebf77ad_1","location":"US"},"statistics":{"creationTime":"1762526198013","startTime":"1762526198171","query":{"statementType":"SELECT"}},"status":{"state":"RUNNING"},"principal_subject":"user:admin@bentrollope.altostrat.com","jobCreationReason":{"code":"REQUESTED"}}'
++ echo '{"kind":"bigquery#job","etag":"8hFaE8Fs43QVyGFA1DOenQ==","id":"tony-allen:US.bqjob_r45471123753c0bea_0000019a5ebf77ad_1","selfLink":"https://bigquery.googleapis.com/bigquery/v2/projects/tony-allen/jobs/bqjob_r45471123753c0bea_0000019a5ebf77ad_1?location=US","user_email":"admin@bentrollope.altostrat.com","configuration":{"query":{"query":"SELECT\n    -- Calculating averages\n    AVG(CAST(t.gas_price AS NUMERIC)) AS avg_gas_price_wei,\n    AVG(t.value) AS avg_transaction_value_wei\nFROM\n    -- Scan the entire transactions table first\n    `bigquery-public-data.crypto_ethereum_classic.transactions` AS t\nWHERE\n    -- 1. Find the latest date by re-calculating the MAX date for every row,\n    -- or by joining the max_date CTE without an explicit ON clause,\n    -- leading to a non-sargable predicate against the entire table.\n    DATE(t.block_timestamp) = (\n        SELECT MAX(DATE(block_timestamp))\n        FROM `bigquery-public-data.crypto_ethereum_classic.transactions`\n    )","destinationTable":{"projectId":"tony-allen","datasetId":"_e34c49c766e4fd3f5d404c3949b9e19fa7acb372","tableId":"anon6c3322b3_81ae_4241_98c6_942b8fc35528"},"writeDisposition":"WRITE_TRUNCATE","priority":"INTERACTIVE","useQueryCache":false,"useLegacySql":false},"jobType":"QUERY"},"jobReference":{"projectId":"tony-allen","jobId":"bqjob_r45471123753c0bea_0000019a5ebf77ad_1","location":"US"},"statistics":{"creationTime":"1762526198013","startTime":"1762526198171","query":{"statementType":"SELECT"}},"status":{"state":"RUNNING"},"principal_subject":"user:admin@bentrollope.altostrat.com","jobCreationReason":{"code":"REQUESTED"}}'
++ jq -r .jobReference.jobId
+ job_id=bqjob_r45471123753c0bea_0000019a5ebf77ad_1
+ '[' -n bqjob_r45471123753c0bea_0000019a5ebf77ad_1 ']'
+ echo '  [SUCCESS] Query submitted.'
  [SUCCESS] Query submitted.
+ echo '  *** JOB ID FOR Daily Avg Unoptimized: bqjob_r45471123753c0bea_0000019a5ebf77ad_1 ***'
  *** JOB ID FOR Daily Avg Unoptimized: bqjob_r45471123753c0bea_0000019a5ebf77ad_1 ***
+ echo '  Waiting for job to complete...'
  Waiting for job to complete...
++ bq wait bqjob_r45471123753c0bea_0000019a5ebf77ad_1
+ wait_output='Waiting on bqjob_r45471123753c0bea_0000019a5ebf77ad_1 ... (0s) Current status: DONE   
Job tony-allen:bqjob_r45471123753c0bea_0000019a5ebf77ad_1

  Job Type    State      Start Time         Duration                User Email              Bytes Processed   Bytes Billed   Billing Tier   Labels  
 ---------- --------- ----------------- ---------------- --------------------------------- ----------------- -------------- -------------- -------- 
  query      SUCCESS   07 Nov 14:36:38   0:00:02.458000   admin@bentrollope.altostrat.com   2033938624        2034237440     1                      '
+ '[' 0 -ne 0 ']'
+ echo '  Job completed. Fetching statistics...'
  Job completed. Fetching statistics...
++ bq show --format=json -j bqjob_r45471123753c0bea_0000019a5ebf77ad_1
+ job_stats_json='{"kind":"bigquery#job","etag":"dNaJA8kK44SOr05/2Zdbiw==","id":"tony-allen:US.bqjob_r45471123753c0bea_0000019a5ebf77ad_1","selfLink":"https://bigquery.googleapis.com/bigquery/v2/projects/tony-allen/jobs/bqjob_r45471123753c0bea_0000019a5ebf77ad_1?location=US","user_email":"admin@bentrollope.altostrat.com","configuration":{"query":{"query":"SELECT\n    -- Calculating averages\n    AVG(CAST(t.gas_price AS NUMERIC)) AS avg_gas_price_wei,\n    AVG(t.value) AS avg_transaction_value_wei\nFROM\n    -- Scan the entire transactions table first\n    `bigquery-public-data.crypto_ethereum_classic.transactions` AS t\nWHERE\n    -- 1. Find the latest date by re-calculating the MAX date for every row,\n    -- or by joining the max_date CTE without an explicit ON clause,\n    -- leading to a non-sargable predicate against the entire table.\n    DATE(t.block_timestamp) = (\n        SELECT MAX(DATE(block_timestamp))\n        FROM `bigquery-public-data.crypto_ethereum_classic.transactions`\n    )","destinationTable":{"projectId":"tony-allen","datasetId":"_e34c49c766e4fd3f5d404c3949b9e19fa7acb372","tableId":"anon6c3322b3_81ae_4241_98c6_942b8fc35528"},"writeDisposition":"WRITE_TRUNCATE","priority":"INTERACTIVE","useQueryCache":false,"useLegacySql":false},"jobType":"QUERY"},"jobReference":{"projectId":"tony-allen","jobId":"bqjob_r45471123753c0bea_0000019a5ebf77ad_1","location":"US"},"statistics":{"creationTime":"1762526198013","startTime":"1762526198171","endTime":"1762526200629","totalBytesProcessed":"2033938624","query":{"queryPlan":[{"name":"S00: Input","id":"0","startMs":"1762526199686","endMs":"1762526200125","waitRatioAvg":0.10846560846560846,"waitMsAvg":"41","waitRatioMax":0.2698412698412698,"waitMsMax":"102","readRatioAvg":0.11904761904761904,"readMsAvg":"45","readRatioMax":1,"readMsMax":"378","computeRatioAvg":0.026455026455026454,"computeMsAvg":"10","computeRatioMax":0.06349206349206349,"computeMsMax":"24","writeRatioAvg":0.0026455026455026454,"writeMsAvg":"1","writeRatioMax":0.03439153439153439,"writeMsMax":"13","shuffleOutputBytes":"9675","shuffleOutputBytesSpilled":"0","recordsRead":"63560582","recordsWritten":"1935","parallelInputs":"1935","completedParallelInputs":"1935","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$10:block_timestamp","FROM bigquery-public-data.crypto_ethereum_classic.transactions"]},{"kind":"AGGREGATE","substeps":["$60 := MAX($70)"]},{"kind":"COMPUTE","substeps":["$70 := date($10)"]},{"kind":"WRITE","substeps":["$60","TO __stage00_output"]}],"slotMs":"165570","computeMode":"BIGQUERY"},{"name":"S01: Aggregate","id":"1","startMs":"1762526199797","endMs":"1762526200130","inputStages":["0"],"waitRatioAvg":0.5026455026455027,"waitMsAvg":"190","waitRatioMax":0.5026455026455027,"waitMsMax":"190","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.07671957671957672,"computeMsAvg":"29","computeRatioMax":0.07671957671957672,"computeMsMax":"29","writeRatioAvg":0.0026455026455026454,"writeMsAvg":"1","writeRatioMax":0.0026455026455026454,"writeMsMax":"1","shuffleOutputBytes":"5","shuffleOutputBytesSpilled":"0","recordsRead":"1935","recordsWritten":"1","parallelInputs":"1","completedParallelInputs":"1","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$60","FROM __stage00_output"]},{"kind":"AGGREGATE","substeps":["$50 := MAX($60)"]},{"kind":"WRITE","substeps":["$50","TO __stage01_output"]}],"slotMs":"189","computeMode":"BIGQUERY"},{"name":"S02: Aggregate+","id":"2","startMs":"1762526200159","endMs":"1762526200395","inputStages":["1"],"waitRatioAvg":0.005291005291005291,"waitMsAvg":"2","waitRatioMax":0.007936507936507936,"waitMsMax":"3","readRatioAvg":0.023809523809523808,"readMsAvg":"9","readRatioMax":0.5978835978835979,"readMsMax":"226","computeRatioAvg":0.031746031746031744,"computeMsAvg":"12","computeRatioMax":0.06349206349206349,"computeMsMax":"24","writeRatioAvg":0.0026455026455026454,"writeMsAvg":"1","writeRatioMax":0.026455026455026454,"writeMsMax":"10","shuffleOutputBytes":"514","shuffleOutputBytesSpilled":"0","recordsRead":"22864","recordsWritten":"235","parallelInputs":"1935","completedParallelInputs":"1935","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$50","FROM __stage01_output"]},{"kind":"READ","substeps":["$1:value, $2:gas_price, $3:block_timestamp","FROM bigquery-public-data.crypto_ethereum_classic.transactions","WHERE equal(date($3), 18588)"]},{"kind":"AGGREGATE","substeps":["$30 := SHARD_AVG($40)","$31 := SHARD_AVG($1)"]},{"kind":"COMPUTE","substeps":["$40 := CAST($2 AS NUMERIC)"]},{"kind":"WRITE","substeps":["$30, $31","TO __stage02_output"]}],"slotMs":"7541","computeMode":"BIGQUERY"},{"name":"S03: Output","id":"3","startMs":"1762526200178","endMs":"1762526200416","inputStages":["2"],"waitRatioAvg":0.15873015873015872,"waitMsAvg":"60","waitRatioMax":0.15873015873015872,"waitMsMax":"60","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.037037037037037035,"computeMsAvg":"14","computeRatioMax":0.037037037037037035,"computeMsMax":"14","writeRatioAvg":0.007936507936507936,"writeMsAvg":"3","writeRatioMax":0.007936507936507936,"writeMsMax":"3","shuffleOutputBytes":"33","shuffleOutputBytesSpilled":"0","recordsRead":"235","recordsWritten":"1","parallelInputs":"1","completedParallelInputs":"1","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$30, $31","FROM __stage02_output"]},{"kind":"AGGREGATE","substeps":["$20 := ROOT_AVG($30)","$21 := ROOT_AVG($31)"]},{"kind":"WRITE","substeps":["$20, $21","TO __stage03_output"]}],"slotMs":"163","computeMode":"BIGQUERY"}],"estimatedBytesProcessed":"2033938624","timeline":[{"elapsedMs":"829","totalSlotMs":"173547","pendingUnits":"0","completedUnits":"0","activeUnits":"0"},{"elapsedMs":"2252","totalSlotMs":"173547","pendingUnits":"0","completedUnits":"3872","activeUnits":"63","estimatedRunnableUnits":"0"}],"totalPartitionsProcessed":"1935","totalBytesProcessed":"2033938624","totalBytesBilled":"2034237440","billingTier":1,"totalSlotMs":"173547","cacheHit":false,"referencedTables":[{"projectId":"bigquery-public-data","datasetId":"crypto_ethereum_classic","tableId":"transactions"}],"statementType":"SELECT","performanceInsights":{"avgPreviousExecutionMs":"645"},"transferredBytes":"0","metadataCacheStatistics":{"tableMetadataCacheUsage":[{"tableReference":{"projectId":"bigquery-public-data","datasetId":"crypto_ethereum_classic","tableId":"transactions"},"unusedReason":"OTHER_REASON"}]}},"totalSlotMs":"173547","finalExecutionDurationMs":"750"},"status":{"state":"DONE"},"principal_subject":"user:admin@bentrollope.altostrat.com","jobCreationReason":{"code":"REQUESTED"}}'
++ echo '{"kind":"bigquery#job","etag":"dNaJA8kK44SOr05/2Zdbiw==","id":"tony-allen:US.bqjob_r45471123753c0bea_0000019a5ebf77ad_1","selfLink":"https://bigquery.googleapis.com/bigquery/v2/projects/tony-allen/jobs/bqjob_r45471123753c0bea_0000019a5ebf77ad_1?location=US","user_email":"admin@bentrollope.altostrat.com","configuration":{"query":{"query":"SELECT\n    -- Calculating averages\n    AVG(CAST(t.gas_price AS NUMERIC)) AS avg_gas_price_wei,\n    AVG(t.value) AS avg_transaction_value_wei\nFROM\n    -- Scan the entire transactions table first\n    `bigquery-public-data.crypto_ethereum_classic.transactions` AS t\nWHERE\n    -- 1. Find the latest date by re-calculating the MAX date for every row,\n    -- or by joining the max_date CTE without an explicit ON clause,\n    -- leading to a non-sargable predicate against the entire table.\n    DATE(t.block_timestamp) = (\n        SELECT MAX(DATE(block_timestamp))\n        FROM `bigquery-public-data.crypto_ethereum_classic.transactions`\n    )","destinationTable":{"projectId":"tony-allen","datasetId":"_e34c49c766e4fd3f5d404c3949b9e19fa7acb372","tableId":"anon6c3322b3_81ae_4241_98c6_942b8fc35528"},"writeDisposition":"WRITE_TRUNCATE","priority":"INTERACTIVE","useQueryCache":false,"useLegacySql":false},"jobType":"QUERY"},"jobReference":{"projectId":"tony-allen","jobId":"bqjob_r45471123753c0bea_0000019a5ebf77ad_1","location":"US"},"statistics":{"creationTime":"1762526198013","startTime":"1762526198171","endTime":"1762526200629","totalBytesProcessed":"2033938624","query":{"queryPlan":[{"name":"S00: Input","id":"0","startMs":"1762526199686","endMs":"1762526200125","waitRatioAvg":0.10846560846560846,"waitMsAvg":"41","waitRatioMax":0.2698412698412698,"waitMsMax":"102","readRatioAvg":0.11904761904761904,"readMsAvg":"45","readRatioMax":1,"readMsMax":"378","computeRatioAvg":0.026455026455026454,"computeMsAvg":"10","computeRatioMax":0.06349206349206349,"computeMsMax":"24","writeRatioAvg":0.0026455026455026454,"writeMsAvg":"1","writeRatioMax":0.03439153439153439,"writeMsMax":"13","shuffleOutputBytes":"9675","shuffleOutputBytesSpilled":"0","recordsRead":"63560582","recordsWritten":"1935","parallelInputs":"1935","completedParallelInputs":"1935","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$10:block_timestamp","FROM bigquery-public-data.crypto_ethereum_classic.transactions"]},{"kind":"AGGREGATE","substeps":["$60 := MAX($70)"]},{"kind":"COMPUTE","substeps":["$70 := date($10)"]},{"kind":"WRITE","substeps":["$60","TO __stage00_output"]}],"slotMs":"165570","computeMode":"BIGQUERY"},{"name":"S01: Aggregate","id":"1","startMs":"1762526199797","endMs":"1762526200130","inputStages":["0"],"waitRatioAvg":0.5026455026455027,"waitMsAvg":"190","waitRatioMax":0.5026455026455027,"waitMsMax":"190","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.07671957671957672,"computeMsAvg":"29","computeRatioMax":0.07671957671957672,"computeMsMax":"29","writeRatioAvg":0.0026455026455026454,"writeMsAvg":"1","writeRatioMax":0.0026455026455026454,"writeMsMax":"1","shuffleOutputBytes":"5","shuffleOutputBytesSpilled":"0","recordsRead":"1935","recordsWritten":"1","parallelInputs":"1","completedParallelInputs":"1","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$60","FROM __stage00_output"]},{"kind":"AGGREGATE","substeps":["$50 := MAX($60)"]},{"kind":"WRITE","substeps":["$50","TO __stage01_output"]}],"slotMs":"189","computeMode":"BIGQUERY"},{"name":"S02: Aggregate+","id":"2","startMs":"1762526200159","endMs":"1762526200395","inputStages":["1"],"waitRatioAvg":0.005291005291005291,"waitMsAvg":"2","waitRatioMax":0.007936507936507936,"waitMsMax":"3","readRatioAvg":0.023809523809523808,"readMsAvg":"9","readRatioMax":0.5978835978835979,"readMsMax":"226","computeRatioAvg":0.031746031746031744,"computeMsAvg":"12","computeRatioMax":0.06349206349206349,"computeMsMax":"24","writeRatioAvg":0.0026455026455026454,"writeMsAvg":"1","writeRatioMax":0.026455026455026454,"writeMsMax":"10","shuffleOutputBytes":"514","shuffleOutputBytesSpilled":"0","recordsRead":"22864","recordsWritten":"235","parallelInputs":"1935","completedParallelInputs":"1935","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$50","FROM __stage01_output"]},{"kind":"READ","substeps":["$1:value, $2:gas_price, $3:block_timestamp","FROM bigquery-public-data.crypto_ethereum_classic.transactions","WHERE equal(date($3), 18588)"]},{"kind":"AGGREGATE","substeps":["$30 := SHARD_AVG($40)","$31 := SHARD_AVG($1)"]},{"kind":"COMPUTE","substeps":["$40 := CAST($2 AS NUMERIC)"]},{"kind":"WRITE","substeps":["$30, $31","TO __stage02_output"]}],"slotMs":"7541","computeMode":"BIGQUERY"},{"name":"S03: Output","id":"3","startMs":"1762526200178","endMs":"1762526200416","inputStages":["2"],"waitRatioAvg":0.15873015873015872,"waitMsAvg":"60","waitRatioMax":0.15873015873015872,"waitMsMax":"60","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.037037037037037035,"computeMsAvg":"14","computeRatioMax":0.037037037037037035,"computeMsMax":"14","writeRatioAvg":0.007936507936507936,"writeMsAvg":"3","writeRatioMax":0.007936507936507936,"writeMsMax":"3","shuffleOutputBytes":"33","shuffleOutputBytesSpilled":"0","recordsRead":"235","recordsWritten":"1","parallelInputs":"1","completedParallelInputs":"1","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$30, $31","FROM __stage02_output"]},{"kind":"AGGREGATE","substeps":["$20 := ROOT_AVG($30)","$21 := ROOT_AVG($31)"]},{"kind":"WRITE","substeps":["$20, $21","TO __stage03_output"]}],"slotMs":"163","computeMode":"BIGQUERY"}],"estimatedBytesProcessed":"2033938624","timeline":[{"elapsedMs":"829","totalSlotMs":"173547","pendingUnits":"0","completedUnits":"0","activeUnits":"0"},{"elapsedMs":"2252","totalSlotMs":"173547","pendingUnits":"0","completedUnits":"3872","activeUnits":"63","estimatedRunnableUnits":"0"}],"totalPartitionsProcessed":"1935","totalBytesProcessed":"2033938624","totalBytesBilled":"2034237440","billingTier":1,"totalSlotMs":"173547","cacheHit":false,"referencedTables":[{"projectId":"bigquery-public-data","datasetId":"crypto_ethereum_classic","tableId":"transactions"}],"statementType":"SELECT","performanceInsights":{"avgPreviousExecutionMs":"645"},"transferredBytes":"0","metadataCacheStatistics":{"tableMetadataCacheUsage":[{"tableReference":{"projectId":"bigquery-public-data","datasetId":"crypto_ethereum_classic","tableId":"transactions"},"unusedReason":"OTHER_REASON"}]}},"totalSlotMs":"173547","finalExecutionDurationMs":"750"},"status":{"state":"DONE"},"principal_subject":"user:admin@bentrollope.altostrat.com","jobCreationReason":{"code":"REQUESTED"}}'
++ jq -r .statistics.totalBytesProcessed
+ total_bytes_processed=2033938624
++ jq -r .statistics.totalSlotMs
++ echo '{"kind":"bigquery#job","etag":"dNaJA8kK44SOr05/2Zdbiw==","id":"tony-allen:US.bqjob_r45471123753c0bea_0000019a5ebf77ad_1","selfLink":"https://bigquery.googleapis.com/bigquery/v2/projects/tony-allen/jobs/bqjob_r45471123753c0bea_0000019a5ebf77ad_1?location=US","user_email":"admin@bentrollope.altostrat.com","configuration":{"query":{"query":"SELECT\n    -- Calculating averages\n    AVG(CAST(t.gas_price AS NUMERIC)) AS avg_gas_price_wei,\n    AVG(t.value) AS avg_transaction_value_wei\nFROM\n    -- Scan the entire transactions table first\n    `bigquery-public-data.crypto_ethereum_classic.transactions` AS t\nWHERE\n    -- 1. Find the latest date by re-calculating the MAX date for every row,\n    -- or by joining the max_date CTE without an explicit ON clause,\n    -- leading to a non-sargable predicate against the entire table.\n    DATE(t.block_timestamp) = (\n        SELECT MAX(DATE(block_timestamp))\n        FROM `bigquery-public-data.crypto_ethereum_classic.transactions`\n    )","destinationTable":{"projectId":"tony-allen","datasetId":"_e34c49c766e4fd3f5d404c3949b9e19fa7acb372","tableId":"anon6c3322b3_81ae_4241_98c6_942b8fc35528"},"writeDisposition":"WRITE_TRUNCATE","priority":"INTERACTIVE","useQueryCache":false,"useLegacySql":false},"jobType":"QUERY"},"jobReference":{"projectId":"tony-allen","jobId":"bqjob_r45471123753c0bea_0000019a5ebf77ad_1","location":"US"},"statistics":{"creationTime":"1762526198013","startTime":"1762526198171","endTime":"1762526200629","totalBytesProcessed":"2033938624","query":{"queryPlan":[{"name":"S00: Input","id":"0","startMs":"1762526199686","endMs":"1762526200125","waitRatioAvg":0.10846560846560846,"waitMsAvg":"41","waitRatioMax":0.2698412698412698,"waitMsMax":"102","readRatioAvg":0.11904761904761904,"readMsAvg":"45","readRatioMax":1,"readMsMax":"378","computeRatioAvg":0.026455026455026454,"computeMsAvg":"10","computeRatioMax":0.06349206349206349,"computeMsMax":"24","writeRatioAvg":0.0026455026455026454,"writeMsAvg":"1","writeRatioMax":0.03439153439153439,"writeMsMax":"13","shuffleOutputBytes":"9675","shuffleOutputBytesSpilled":"0","recordsRead":"63560582","recordsWritten":"1935","parallelInputs":"1935","completedParallelInputs":"1935","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$10:block_timestamp","FROM bigquery-public-data.crypto_ethereum_classic.transactions"]},{"kind":"AGGREGATE","substeps":["$60 := MAX($70)"]},{"kind":"COMPUTE","substeps":["$70 := date($10)"]},{"kind":"WRITE","substeps":["$60","TO __stage00_output"]}],"slotMs":"165570","computeMode":"BIGQUERY"},{"name":"S01: Aggregate","id":"1","startMs":"1762526199797","endMs":"1762526200130","inputStages":["0"],"waitRatioAvg":0.5026455026455027,"waitMsAvg":"190","waitRatioMax":0.5026455026455027,"waitMsMax":"190","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.07671957671957672,"computeMsAvg":"29","computeRatioMax":0.07671957671957672,"computeMsMax":"29","writeRatioAvg":0.0026455026455026454,"writeMsAvg":"1","writeRatioMax":0.0026455026455026454,"writeMsMax":"1","shuffleOutputBytes":"5","shuffleOutputBytesSpilled":"0","recordsRead":"1935","recordsWritten":"1","parallelInputs":"1","completedParallelInputs":"1","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$60","FROM __stage00_output"]},{"kind":"AGGREGATE","substeps":["$50 := MAX($60)"]},{"kind":"WRITE","substeps":["$50","TO __stage01_output"]}],"slotMs":"189","computeMode":"BIGQUERY"},{"name":"S02: Aggregate+","id":"2","startMs":"1762526200159","endMs":"1762526200395","inputStages":["1"],"waitRatioAvg":0.005291005291005291,"waitMsAvg":"2","waitRatioMax":0.007936507936507936,"waitMsMax":"3","readRatioAvg":0.023809523809523808,"readMsAvg":"9","readRatioMax":0.5978835978835979,"readMsMax":"226","computeRatioAvg":0.031746031746031744,"computeMsAvg":"12","computeRatioMax":0.06349206349206349,"computeMsMax":"24","writeRatioAvg":0.0026455026455026454,"writeMsAvg":"1","writeRatioMax":0.026455026455026454,"writeMsMax":"10","shuffleOutputBytes":"514","shuffleOutputBytesSpilled":"0","recordsRead":"22864","recordsWritten":"235","parallelInputs":"1935","completedParallelInputs":"1935","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$50","FROM __stage01_output"]},{"kind":"READ","substeps":["$1:value, $2:gas_price, $3:block_timestamp","FROM bigquery-public-data.crypto_ethereum_classic.transactions","WHERE equal(date($3), 18588)"]},{"kind":"AGGREGATE","substeps":["$30 := SHARD_AVG($40)","$31 := SHARD_AVG($1)"]},{"kind":"COMPUTE","substeps":["$40 := CAST($2 AS NUMERIC)"]},{"kind":"WRITE","substeps":["$30, $31","TO __stage02_output"]}],"slotMs":"7541","computeMode":"BIGQUERY"},{"name":"S03: Output","id":"3","startMs":"1762526200178","endMs":"1762526200416","inputStages":["2"],"waitRatioAvg":0.15873015873015872,"waitMsAvg":"60","waitRatioMax":0.15873015873015872,"waitMsMax":"60","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.037037037037037035,"computeMsAvg":"14","computeRatioMax":0.037037037037037035,"computeMsMax":"14","writeRatioAvg":0.007936507936507936,"writeMsAvg":"3","writeRatioMax":0.007936507936507936,"writeMsMax":"3","shuffleOutputBytes":"33","shuffleOutputBytesSpilled":"0","recordsRead":"235","recordsWritten":"1","parallelInputs":"1","completedParallelInputs":"1","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$30, $31","FROM __stage02_output"]},{"kind":"AGGREGATE","substeps":["$20 := ROOT_AVG($30)","$21 := ROOT_AVG($31)"]},{"kind":"WRITE","substeps":["$20, $21","TO __stage03_output"]}],"slotMs":"163","computeMode":"BIGQUERY"}],"estimatedBytesProcessed":"2033938624","timeline":[{"elapsedMs":"829","totalSlotMs":"173547","pendingUnits":"0","completedUnits":"0","activeUnits":"0"},{"elapsedMs":"2252","totalSlotMs":"173547","pendingUnits":"0","completedUnits":"3872","activeUnits":"63","estimatedRunnableUnits":"0"}],"totalPartitionsProcessed":"1935","totalBytesProcessed":"2033938624","totalBytesBilled":"2034237440","billingTier":1,"totalSlotMs":"173547","cacheHit":false,"referencedTables":[{"projectId":"bigquery-public-data","datasetId":"crypto_ethereum_classic","tableId":"transactions"}],"statementType":"SELECT","performanceInsights":{"avgPreviousExecutionMs":"645"},"transferredBytes":"0","metadataCacheStatistics":{"tableMetadataCacheUsage":[{"tableReference":{"projectId":"bigquery-public-data","datasetId":"crypto_ethereum_classic","tableId":"transactions"},"unusedReason":"OTHER_REASON"}]}},"totalSlotMs":"173547","finalExecutionDurationMs":"750"},"status":{"state":"DONE"},"principal_subject":"user:admin@bentrollope.altostrat.com","jobCreationReason":{"code":"REQUESTED"}}'
+ total_slot_ms=173547
++ echo '{"kind":"bigquery#job","etag":"dNaJA8kK44SOr05/2Zdbiw==","id":"tony-allen:US.bqjob_r45471123753c0bea_0000019a5ebf77ad_1","selfLink":"https://bigquery.googleapis.com/bigquery/v2/projects/tony-allen/jobs/bqjob_r45471123753c0bea_0000019a5ebf77ad_1?location=US","user_email":"admin@bentrollope.altostrat.com","configuration":{"query":{"query":"SELECT\n    -- Calculating averages\n    AVG(CAST(t.gas_price AS NUMERIC)) AS avg_gas_price_wei,\n    AVG(t.value) AS avg_transaction_value_wei\nFROM\n    -- Scan the entire transactions table first\n    `bigquery-public-data.crypto_ethereum_classic.transactions` AS t\nWHERE\n    -- 1. Find the latest date by re-calculating the MAX date for every row,\n    -- or by joining the max_date CTE without an explicit ON clause,\n    -- leading to a non-sargable predicate against the entire table.\n    DATE(t.block_timestamp) = (\n        SELECT MAX(DATE(block_timestamp))\n        FROM `bigquery-public-data.crypto_ethereum_classic.transactions`\n    )","destinationTable":{"projectId":"tony-allen","datasetId":"_e34c49c766e4fd3f5d404c3949b9e19fa7acb372","tableId":"anon6c3322b3_81ae_4241_98c6_942b8fc35528"},"writeDisposition":"WRITE_TRUNCATE","priority":"INTERACTIVE","useQueryCache":false,"useLegacySql":false},"jobType":"QUERY"},"jobReference":{"projectId":"tony-allen","jobId":"bqjob_r45471123753c0bea_0000019a5ebf77ad_1","location":"US"},"statistics":{"creationTime":"1762526198013","startTime":"1762526198171","endTime":"1762526200629","totalBytesProcessed":"2033938624","query":{"queryPlan":[{"name":"S00: Input","id":"0","startMs":"1762526199686","endMs":"1762526200125","waitRatioAvg":0.10846560846560846,"waitMsAvg":"41","waitRatioMax":0.2698412698412698,"waitMsMax":"102","readRatioAvg":0.11904761904761904,"readMsAvg":"45","readRatioMax":1,"readMsMax":"378","computeRatioAvg":0.026455026455026454,"computeMsAvg":"10","computeRatioMax":0.06349206349206349,"computeMsMax":"24","writeRatioAvg":0.0026455026455026454,"writeMsAvg":"1","writeRatioMax":0.03439153439153439,"writeMsMax":"13","shuffleOutputBytes":"9675","shuffleOutputBytesSpilled":"0","recordsRead":"63560582","recordsWritten":"1935","parallelInputs":"1935","completedParallelInputs":"1935","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$10:block_timestamp","FROM bigquery-public-data.crypto_ethereum_classic.transactions"]},{"kind":"AGGREGATE","substeps":["$60 := MAX($70)"]},{"kind":"COMPUTE","substeps":["$70 := date($10)"]},{"kind":"WRITE","substeps":["$60","TO __stage00_output"]}],"slotMs":"165570","computeMode":"BIGQUERY"},{"name":"S01: Aggregate","id":"1","startMs":"1762526199797","endMs":"1762526200130","inputStages":["0"],"waitRatioAvg":0.5026455026455027,"waitMsAvg":"190","waitRatioMax":0.5026455026455027,"waitMsMax":"190","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.07671957671957672,"computeMsAvg":"29","computeRatioMax":0.07671957671957672,"computeMsMax":"29","writeRatioAvg":0.0026455026455026454,"writeMsAvg":"1","writeRatioMax":0.0026455026455026454,"writeMsMax":"1","shuffleOutputBytes":"5","shuffleOutputBytesSpilled":"0","recordsRead":"1935","recordsWritten":"1","parallelInputs":"1","completedParallelInputs":"1","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$60","FROM __stage00_output"]},{"kind":"AGGREGATE","substeps":["$50 := MAX($60)"]},{"kind":"WRITE","substeps":["$50","TO __stage01_output"]}],"slotMs":"189","computeMode":"BIGQUERY"},{"name":"S02: Aggregate+","id":"2","startMs":"1762526200159","endMs":"1762526200395","inputStages":["1"],"waitRatioAvg":0.005291005291005291,"waitMsAvg":"2","waitRatioMax":0.007936507936507936,"waitMsMax":"3","readRatioAvg":0.023809523809523808,"readMsAvg":"9","readRatioMax":0.5978835978835979,"readMsMax":"226","computeRatioAvg":0.031746031746031744,"computeMsAvg":"12","computeRatioMax":0.06349206349206349,"computeMsMax":"24","writeRatioAvg":0.0026455026455026454,"writeMsAvg":"1","writeRatioMax":0.026455026455026454,"writeMsMax":"10","shuffleOutputBytes":"514","shuffleOutputBytesSpilled":"0","recordsRead":"22864","recordsWritten":"235","parallelInputs":"1935","completedParallelInputs":"1935","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$50","FROM __stage01_output"]},{"kind":"READ","substeps":["$1:value, $2:gas_price, $3:block_timestamp","FROM bigquery-public-data.crypto_ethereum_classic.transactions","WHERE equal(date($3), 18588)"]},{"kind":"AGGREGATE","substeps":["$30 := SHARD_AVG($40)","$31 := SHARD_AVG($1)"]},{"kind":"COMPUTE","substeps":["$40 := CAST($2 AS NUMERIC)"]},{"kind":"WRITE","substeps":["$30, $31","TO __stage02_output"]}],"slotMs":"7541","computeMode":"BIGQUERY"},{"name":"S03: Output","id":"3","startMs":"1762526200178","endMs":"1762526200416","inputStages":["2"],"waitRatioAvg":0.15873015873015872,"waitMsAvg":"60","waitRatioMax":0.15873015873015872,"waitMsMax":"60","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.037037037037037035,"computeMsAvg":"14","computeRatioMax":0.037037037037037035,"computeMsMax":"14","writeRatioAvg":0.007936507936507936,"writeMsAvg":"3","writeRatioMax":0.007936507936507936,"writeMsMax":"3","shuffleOutputBytes":"33","shuffleOutputBytesSpilled":"0","recordsRead":"235","recordsWritten":"1","parallelInputs":"1","completedParallelInputs":"1","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$30, $31","FROM __stage02_output"]},{"kind":"AGGREGATE","substeps":["$20 := ROOT_AVG($30)","$21 := ROOT_AVG($31)"]},{"kind":"WRITE","substeps":["$20, $21","TO __stage03_output"]}],"slotMs":"163","computeMode":"BIGQUERY"}],"estimatedBytesProcessed":"2033938624","timeline":[{"elapsedMs":"829","totalSlotMs":"173547","pendingUnits":"0","completedUnits":"0","activeUnits":"0"},{"elapsedMs":"2252","totalSlotMs":"173547","pendingUnits":"0","completedUnits":"3872","activeUnits":"63","estimatedRunnableUnits":"0"}],"totalPartitionsProcessed":"1935","totalBytesProcessed":"2033938624","totalBytesBilled":"2034237440","billingTier":1,"totalSlotMs":"173547","cacheHit":false,"referencedTables":[{"projectId":"bigquery-public-data","datasetId":"crypto_ethereum_classic","tableId":"transactions"}],"statementType":"SELECT","performanceInsights":{"avgPreviousExecutionMs":"645"},"transferredBytes":"0","metadataCacheStatistics":{"tableMetadataCacheUsage":[{"tableReference":{"projectId":"bigquery-public-data","datasetId":"crypto_ethereum_classic","tableId":"transactions"},"unusedReason":"OTHER_REASON"}]}},"totalSlotMs":"173547","finalExecutionDurationMs":"750"},"status":{"state":"DONE"},"principal_subject":"user:admin@bentrollope.altostrat.com","jobCreationReason":{"code":"REQUESTED"}}'
++ jq -r .statistics.startTime
+ start_time=1762526198171
++ jq -r .statistics.endTime
++ echo '{"kind":"bigquery#job","etag":"dNaJA8kK44SOr05/2Zdbiw==","id":"tony-allen:US.bqjob_r45471123753c0bea_0000019a5ebf77ad_1","selfLink":"https://bigquery.googleapis.com/bigquery/v2/projects/tony-allen/jobs/bqjob_r45471123753c0bea_0000019a5ebf77ad_1?location=US","user_email":"admin@bentrollope.altostrat.com","configuration":{"query":{"query":"SELECT\n    -- Calculating averages\n    AVG(CAST(t.gas_price AS NUMERIC)) AS avg_gas_price_wei,\n    AVG(t.value) AS avg_transaction_value_wei\nFROM\n    -- Scan the entire transactions table first\n    `bigquery-public-data.crypto_ethereum_classic.transactions` AS t\nWHERE\n    -- 1. Find the latest date by re-calculating the MAX date for every row,\n    -- or by joining the max_date CTE without an explicit ON clause,\n    -- leading to a non-sargable predicate against the entire table.\n    DATE(t.block_timestamp) = (\n        SELECT MAX(DATE(block_timestamp))\n        FROM `bigquery-public-data.crypto_ethereum_classic.transactions`\n    )","destinationTable":{"projectId":"tony-allen","datasetId":"_e34c49c766e4fd3f5d404c3949b9e19fa7acb372","tableId":"anon6c3322b3_81ae_4241_98c6_942b8fc35528"},"writeDisposition":"WRITE_TRUNCATE","priority":"INTERACTIVE","useQueryCache":false,"useLegacySql":false},"jobType":"QUERY"},"jobReference":{"projectId":"tony-allen","jobId":"bqjob_r45471123753c0bea_0000019a5ebf77ad_1","location":"US"},"statistics":{"creationTime":"1762526198013","startTime":"1762526198171","endTime":"1762526200629","totalBytesProcessed":"2033938624","query":{"queryPlan":[{"name":"S00: Input","id":"0","startMs":"1762526199686","endMs":"1762526200125","waitRatioAvg":0.10846560846560846,"waitMsAvg":"41","waitRatioMax":0.2698412698412698,"waitMsMax":"102","readRatioAvg":0.11904761904761904,"readMsAvg":"45","readRatioMax":1,"readMsMax":"378","computeRatioAvg":0.026455026455026454,"computeMsAvg":"10","computeRatioMax":0.06349206349206349,"computeMsMax":"24","writeRatioAvg":0.0026455026455026454,"writeMsAvg":"1","writeRatioMax":0.03439153439153439,"writeMsMax":"13","shuffleOutputBytes":"9675","shuffleOutputBytesSpilled":"0","recordsRead":"63560582","recordsWritten":"1935","parallelInputs":"1935","completedParallelInputs":"1935","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$10:block_timestamp","FROM bigquery-public-data.crypto_ethereum_classic.transactions"]},{"kind":"AGGREGATE","substeps":["$60 := MAX($70)"]},{"kind":"COMPUTE","substeps":["$70 := date($10)"]},{"kind":"WRITE","substeps":["$60","TO __stage00_output"]}],"slotMs":"165570","computeMode":"BIGQUERY"},{"name":"S01: Aggregate","id":"1","startMs":"1762526199797","endMs":"1762526200130","inputStages":["0"],"waitRatioAvg":0.5026455026455027,"waitMsAvg":"190","waitRatioMax":0.5026455026455027,"waitMsMax":"190","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.07671957671957672,"computeMsAvg":"29","computeRatioMax":0.07671957671957672,"computeMsMax":"29","writeRatioAvg":0.0026455026455026454,"writeMsAvg":"1","writeRatioMax":0.0026455026455026454,"writeMsMax":"1","shuffleOutputBytes":"5","shuffleOutputBytesSpilled":"0","recordsRead":"1935","recordsWritten":"1","parallelInputs":"1","completedParallelInputs":"1","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$60","FROM __stage00_output"]},{"kind":"AGGREGATE","substeps":["$50 := MAX($60)"]},{"kind":"WRITE","substeps":["$50","TO __stage01_output"]}],"slotMs":"189","computeMode":"BIGQUERY"},{"name":"S02: Aggregate+","id":"2","startMs":"1762526200159","endMs":"1762526200395","inputStages":["1"],"waitRatioAvg":0.005291005291005291,"waitMsAvg":"2","waitRatioMax":0.007936507936507936,"waitMsMax":"3","readRatioAvg":0.023809523809523808,"readMsAvg":"9","readRatioMax":0.5978835978835979,"readMsMax":"226","computeRatioAvg":0.031746031746031744,"computeMsAvg":"12","computeRatioMax":0.06349206349206349,"computeMsMax":"24","writeRatioAvg":0.0026455026455026454,"writeMsAvg":"1","writeRatioMax":0.026455026455026454,"writeMsMax":"10","shuffleOutputBytes":"514","shuffleOutputBytesSpilled":"0","recordsRead":"22864","recordsWritten":"235","parallelInputs":"1935","completedParallelInputs":"1935","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$50","FROM __stage01_output"]},{"kind":"READ","substeps":["$1:value, $2:gas_price, $3:block_timestamp","FROM bigquery-public-data.crypto_ethereum_classic.transactions","WHERE equal(date($3), 18588)"]},{"kind":"AGGREGATE","substeps":["$30 := SHARD_AVG($40)","$31 := SHARD_AVG($1)"]},{"kind":"COMPUTE","substeps":["$40 := CAST($2 AS NUMERIC)"]},{"kind":"WRITE","substeps":["$30, $31","TO __stage02_output"]}],"slotMs":"7541","computeMode":"BIGQUERY"},{"name":"S03: Output","id":"3","startMs":"1762526200178","endMs":"1762526200416","inputStages":["2"],"waitRatioAvg":0.15873015873015872,"waitMsAvg":"60","waitRatioMax":0.15873015873015872,"waitMsMax":"60","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.037037037037037035,"computeMsAvg":"14","computeRatioMax":0.037037037037037035,"computeMsMax":"14","writeRatioAvg":0.007936507936507936,"writeMsAvg":"3","writeRatioMax":0.007936507936507936,"writeMsMax":"3","shuffleOutputBytes":"33","shuffleOutputBytesSpilled":"0","recordsRead":"235","recordsWritten":"1","parallelInputs":"1","completedParallelInputs":"1","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$30, $31","FROM __stage02_output"]},{"kind":"AGGREGATE","substeps":["$20 := ROOT_AVG($30)","$21 := ROOT_AVG($31)"]},{"kind":"WRITE","substeps":["$20, $21","TO __stage03_output"]}],"slotMs":"163","computeMode":"BIGQUERY"}],"estimatedBytesProcessed":"2033938624","timeline":[{"elapsedMs":"829","totalSlotMs":"173547","pendingUnits":"0","completedUnits":"0","activeUnits":"0"},{"elapsedMs":"2252","totalSlotMs":"173547","pendingUnits":"0","completedUnits":"3872","activeUnits":"63","estimatedRunnableUnits":"0"}],"totalPartitionsProcessed":"1935","totalBytesProcessed":"2033938624","totalBytesBilled":"2034237440","billingTier":1,"totalSlotMs":"173547","cacheHit":false,"referencedTables":[{"projectId":"bigquery-public-data","datasetId":"crypto_ethereum_classic","tableId":"transactions"}],"statementType":"SELECT","performanceInsights":{"avgPreviousExecutionMs":"645"},"transferredBytes":"0","metadataCacheStatistics":{"tableMetadataCacheUsage":[{"tableReference":{"projectId":"bigquery-public-data","datasetId":"crypto_ethereum_classic","tableId":"transactions"},"unusedReason":"OTHER_REASON"}]}},"totalSlotMs":"173547","finalExecutionDurationMs":"750"},"status":{"state":"DONE"},"principal_subject":"user:admin@bentrollope.altostrat.com","jobCreationReason":{"code":"REQUESTED"}}'
+ end_time=1762526200629
++ echo 1762526198171
++ awk '{print int($1)}'
+ start_ms=1762526198171
++ echo 1762526200629
++ awk '{print int($1)}'
+ end_ms=1762526200629
+ duration_ms=2458
+ echo '  --- Execution Statistics ---'
  --- Execution Statistics ---
+ echo '  Duration: 2458 ms'
  Duration: 2458 ms
+ echo '  Bytes Processed: 2033938624 bytes'
  Bytes Processed: 2033938624 bytes
+ echo '  Slot Milliseconds: 173547'
  Slot Milliseconds: 173547
+ echo '  ----------------------------'
  ----------------------------
+ echo -e 'Daily Avg Unoptimized\tbqjob_r45471123753c0bea_0000019a5ebf77ad_1\t2458\t2033938624\t173547'
+ echo ''

+ run_query 'Daily Avg Optimized' 'WITH max_date AS (
    -- 1. Determine the latest date once in an efficient, independent step.
    -- This operation is fast because it'\''s a single aggregation over the table.
    SELECT MAX(DATE(block_timestamp)) AS max_dt
    FROM `bigquery-public-data.crypto_ethereum_classic.transactions`
)
SELECT
    -- 2. Calculate the average gas price (casting INTEGER to NUMERIC for precision)
    AVG(CAST(t.gas_price AS NUMERIC)) AS avg_gas_price_wei,
    -- 3. Calculate the average transaction value (using the existing NUMERIC value column)
    AVG(t.value) AS avg_transaction_value_wei
FROM
    `bigquery-public-data.crypto_ethereum_classic.transactions` AS t
INNER JOIN
    -- 4. Join the main table to the single-row CTE, ensuring the filter is pushed down
    -- and the table is only scanned for the single target date.
    max_date AS m ON DATE(t.block_timestamp) = m.max_dt'
+ local 'query_name=Daily Avg Optimized'
+ local 'query=WITH max_date AS (
    -- 1. Determine the latest date once in an efficient, independent step.
    -- This operation is fast because it'\''s a single aggregation over the table.
    SELECT MAX(DATE(block_timestamp)) AS max_dt
    FROM `bigquery-public-data.crypto_ethereum_classic.transactions`
)
SELECT
    -- 2. Calculate the average gas price (casting INTEGER to NUMERIC for precision)
    AVG(CAST(t.gas_price AS NUMERIC)) AS avg_gas_price_wei,
    -- 3. Calculate the average transaction value (using the existing NUMERIC value column)
    AVG(t.value) AS avg_transaction_value_wei
FROM
    `bigquery-public-data.crypto_ethereum_classic.transactions` AS t
INNER JOIN
    -- 4. Join the main table to the single-row CTE, ensuring the filter is pushed down
    -- and the table is only scanned for the single target date.
    max_date AS m ON DATE(t.block_timestamp) = m.max_dt'
+ echo ==================================================
==================================================
+ echo 'Executing Daily Avg Optimized'
Executing Daily Avg Optimized
+ echo ==================================================
==================================================
+ echo Query:
Query:
+ echo 'WITH max_date AS (
    -- 1. Determine the latest date once in an efficient, independent step.
    -- This operation is fast because it'\''s a single aggregation over the table.
    SELECT MAX(DATE(block_timestamp)) AS max_dt
    FROM `bigquery-public-data.crypto_ethereum_classic.transactions`
)
SELECT
    -- 2. Calculate the average gas price (casting INTEGER to NUMERIC for precision)
    AVG(CAST(t.gas_price AS NUMERIC)) AS avg_gas_price_wei,
    -- 3. Calculate the average transaction value (using the existing NUMERIC value column)
    AVG(t.value) AS avg_transaction_value_wei
FROM
    `bigquery-public-data.crypto_ethereum_classic.transactions` AS t
INNER JOIN
    -- 4. Join the main table to the single-row CTE, ensuring the filter is pushed down
    -- and the table is only scanned for the single target date.
    max_date AS m ON DATE(t.block_timestamp) = m.max_dt'
WITH max_date AS (
    -- 1. Determine the latest date once in an efficient, independent step.
    -- This operation is fast because it's a single aggregation over the table.
    SELECT MAX(DATE(block_timestamp)) AS max_dt
    FROM `bigquery-public-data.crypto_ethereum_classic.transactions`
)
SELECT
    -- 2. Calculate the average gas price (casting INTEGER to NUMERIC for precision)
    AVG(CAST(t.gas_price AS NUMERIC)) AS avg_gas_price_wei,
    -- 3. Calculate the average transaction value (using the existing NUMERIC value column)
    AVG(t.value) AS avg_transaction_value_wei
FROM
    `bigquery-public-data.crypto_ethereum_classic.transactions` AS t
INNER JOIN
    -- 4. Join the main table to the single-row CTE, ensuring the filter is pushed down
    -- and the table is only scanned for the single target date.
    max_date AS m ON DATE(t.block_timestamp) = m.max_dt
+ echo --------------------------------------------------
--------------------------------------------------
++ bq query --nouse_cache --nosync --use_legacy_sql=false --format=json --location=US 'WITH max_date AS (
    -- 1. Determine the latest date once in an efficient, independent step.
    -- This operation is fast because it'\''s a single aggregation over the table.
    SELECT MAX(DATE(block_timestamp)) AS max_dt
    FROM `bigquery-public-data.crypto_ethereum_classic.transactions`
)
SELECT
    -- 2. Calculate the average gas price (casting INTEGER to NUMERIC for precision)
    AVG(CAST(t.gas_price AS NUMERIC)) AS avg_gas_price_wei,
    -- 3. Calculate the average transaction value (using the existing NUMERIC value column)
    AVG(t.value) AS avg_transaction_value_wei
FROM
    `bigquery-public-data.crypto_ethereum_classic.transactions` AS t
INNER JOIN
    -- 4. Join the main table to the single-row CTE, ensuring the filter is pushed down
    -- and the table is only scanned for the single target date.
    max_date AS m ON DATE(t.block_timestamp) = m.max_dt'
+ job_submission_output='{"kind":"bigquery#job","etag":"4IzqQ3MyChdcE7ZIUNeHWg==","id":"tony-allen:US.bqjob_r2ad4ed23ab491507_0000019a5ebf9bbf_1","selfLink":"https://bigquery.googleapis.com/bigquery/v2/projects/tony-allen/jobs/bqjob_r2ad4ed23ab491507_0000019a5ebf9bbf_1?location=US","user_email":"admin@bentrollope.altostrat.com","configuration":{"query":{"query":"WITH max_date AS (\n    -- 1. Determine the latest date once in an efficient, independent step.\n    -- This operation is fast because it'\''s a single aggregation over the table.\n    SELECT MAX(DATE(block_timestamp)) AS max_dt\n    FROM `bigquery-public-data.crypto_ethereum_classic.transactions`\n)\nSELECT\n    -- 2. Calculate the average gas price (casting INTEGER to NUMERIC for precision)\n    AVG(CAST(t.gas_price AS NUMERIC)) AS avg_gas_price_wei,\n    -- 3. Calculate the average transaction value (using the existing NUMERIC value column)\n    AVG(t.value) AS avg_transaction_value_wei\nFROM\n    `bigquery-public-data.crypto_ethereum_classic.transactions` AS t\nINNER JOIN\n    -- 4. Join the main table to the single-row CTE, ensuring the filter is pushed down\n    -- and the table is only scanned for the single target date.\n    max_date AS m ON DATE(t.block_timestamp) = m.max_dt","destinationTable":{"projectId":"tony-allen","datasetId":"_e34c49c766e4fd3f5d404c3949b9e19fa7acb372","tableId":"anon51beefe1_b4ff_4771_9f80_2ac3a35b63b1"},"writeDisposition":"WRITE_TRUNCATE","priority":"INTERACTIVE","useQueryCache":false,"useLegacySql":false},"jobType":"QUERY"},"jobReference":{"projectId":"tony-allen","jobId":"bqjob_r2ad4ed23ab491507_0000019a5ebf9bbf_1","location":"US"},"statistics":{"creationTime":"1762526207213","startTime":"1762526207346","query":{"statementType":"SELECT"}},"status":{"state":"RUNNING"},"principal_subject":"user:admin@bentrollope.altostrat.com","jobCreationReason":{"code":"REQUESTED"}}'
++ jq -r .jobReference.jobId
++ echo '{"kind":"bigquery#job","etag":"4IzqQ3MyChdcE7ZIUNeHWg==","id":"tony-allen:US.bqjob_r2ad4ed23ab491507_0000019a5ebf9bbf_1","selfLink":"https://bigquery.googleapis.com/bigquery/v2/projects/tony-allen/jobs/bqjob_r2ad4ed23ab491507_0000019a5ebf9bbf_1?location=US","user_email":"admin@bentrollope.altostrat.com","configuration":{"query":{"query":"WITH max_date AS (\n    -- 1. Determine the latest date once in an efficient, independent step.\n    -- This operation is fast because it'\''s a single aggregation over the table.\n    SELECT MAX(DATE(block_timestamp)) AS max_dt\n    FROM `bigquery-public-data.crypto_ethereum_classic.transactions`\n)\nSELECT\n    -- 2. Calculate the average gas price (casting INTEGER to NUMERIC for precision)\n    AVG(CAST(t.gas_price AS NUMERIC)) AS avg_gas_price_wei,\n    -- 3. Calculate the average transaction value (using the existing NUMERIC value column)\n    AVG(t.value) AS avg_transaction_value_wei\nFROM\n    `bigquery-public-data.crypto_ethereum_classic.transactions` AS t\nINNER JOIN\n    -- 4. Join the main table to the single-row CTE, ensuring the filter is pushed down\n    -- and the table is only scanned for the single target date.\n    max_date AS m ON DATE(t.block_timestamp) = m.max_dt","destinationTable":{"projectId":"tony-allen","datasetId":"_e34c49c766e4fd3f5d404c3949b9e19fa7acb372","tableId":"anon51beefe1_b4ff_4771_9f80_2ac3a35b63b1"},"writeDisposition":"WRITE_TRUNCATE","priority":"INTERACTIVE","useQueryCache":false,"useLegacySql":false},"jobType":"QUERY"},"jobReference":{"projectId":"tony-allen","jobId":"bqjob_r2ad4ed23ab491507_0000019a5ebf9bbf_1","location":"US"},"statistics":{"creationTime":"1762526207213","startTime":"1762526207346","query":{"statementType":"SELECT"}},"status":{"state":"RUNNING"},"principal_subject":"user:admin@bentrollope.altostrat.com","jobCreationReason":{"code":"REQUESTED"}}'
+ job_id=bqjob_r2ad4ed23ab491507_0000019a5ebf9bbf_1
+ '[' -n bqjob_r2ad4ed23ab491507_0000019a5ebf9bbf_1 ']'
+ echo '  [SUCCESS] Query submitted.'
  [SUCCESS] Query submitted.
+ echo '  *** JOB ID FOR Daily Avg Optimized: bqjob_r2ad4ed23ab491507_0000019a5ebf9bbf_1 ***'
  *** JOB ID FOR Daily Avg Optimized: bqjob_r2ad4ed23ab491507_0000019a5ebf9bbf_1 ***
+ echo '  Waiting for job to complete...'
  Waiting for job to complete...
++ bq wait bqjob_r2ad4ed23ab491507_0000019a5ebf9bbf_1
+ wait_output='Waiting on bqjob_r2ad4ed23ab491507_0000019a5ebf9bbf_1 ... (0s) Current status: DONE   
Job tony-allen:bqjob_r2ad4ed23ab491507_0000019a5ebf9bbf_1

  Job Type    State      Start Time         Duration                User Email              Bytes Processed   Bytes Billed   Billing Tier   Labels  
 ---------- --------- ----------------- ---------------- --------------------------------- ----------------- -------------- -------------- -------- 
  query      SUCCESS   07 Nov 14:36:47   0:00:02.588000   admin@bentrollope.altostrat.com   2033938624        2034237440     1                      '
+ '[' 0 -ne 0 ']'
+ echo '  Job completed. Fetching statistics...'
  Job completed. Fetching statistics...
++ bq show --format=json -j bqjob_r2ad4ed23ab491507_0000019a5ebf9bbf_1
+ job_stats_json='{"kind":"bigquery#job","etag":"IrluFPAYQApB3Obs7hi+nw==","id":"tony-allen:US.bqjob_r2ad4ed23ab491507_0000019a5ebf9bbf_1","selfLink":"https://bigquery.googleapis.com/bigquery/v2/projects/tony-allen/jobs/bqjob_r2ad4ed23ab491507_0000019a5ebf9bbf_1?location=US","user_email":"admin@bentrollope.altostrat.com","configuration":{"query":{"query":"WITH max_date AS (\n    -- 1. Determine the latest date once in an efficient, independent step.\n    -- This operation is fast because it'\''s a single aggregation over the table.\n    SELECT MAX(DATE(block_timestamp)) AS max_dt\n    FROM `bigquery-public-data.crypto_ethereum_classic.transactions`\n)\nSELECT\n    -- 2. Calculate the average gas price (casting INTEGER to NUMERIC for precision)\n    AVG(CAST(t.gas_price AS NUMERIC)) AS avg_gas_price_wei,\n    -- 3. Calculate the average transaction value (using the existing NUMERIC value column)\n    AVG(t.value) AS avg_transaction_value_wei\nFROM\n    `bigquery-public-data.crypto_ethereum_classic.transactions` AS t\nINNER JOIN\n    -- 4. Join the main table to the single-row CTE, ensuring the filter is pushed down\n    -- and the table is only scanned for the single target date.\n    max_date AS m ON DATE(t.block_timestamp) = m.max_dt","destinationTable":{"projectId":"tony-allen","datasetId":"_e34c49c766e4fd3f5d404c3949b9e19fa7acb372","tableId":"anon51beefe1_b4ff_4771_9f80_2ac3a35b63b1"},"writeDisposition":"WRITE_TRUNCATE","priority":"INTERACTIVE","useQueryCache":false,"useLegacySql":false},"jobType":"QUERY"},"jobReference":{"projectId":"tony-allen","jobId":"bqjob_r2ad4ed23ab491507_0000019a5ebf9bbf_1","location":"US"},"statistics":{"creationTime":"1762526207213","startTime":"1762526207346","endTime":"1762526209934","totalBytesProcessed":"2033938624","query":{"queryPlan":[{"name":"S00: Input","id":"0","startMs":"1762526208787","endMs":"1762526209255","waitRatioAvg":0.2757352941176471,"waitMsAvg":"75","waitRatioMax":0.8161764705882353,"waitMsMax":"222","readRatioAvg":0.051470588235294115,"readMsAvg":"14","readRatioMax":1,"readMsMax":"272","computeRatioAvg":0.03308823529411765,"computeMsAvg":"9","computeRatioMax":0.13602941176470587,"computeMsMax":"37","writeRatioAvg":0.003676470588235294,"writeMsAvg":"1","writeRatioMax":0.09926470588235294,"writeMsMax":"27","shuffleOutputBytes":"9675","shuffleOutputBytesSpilled":"0","recordsRead":"63560582","recordsWritten":"1935","parallelInputs":"1935","completedParallelInputs":"1935","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$10:block_timestamp","FROM bigquery-public-data.crypto_ethereum_classic.transactions"]},{"kind":"AGGREGATE","substeps":["$70 := MAX($80)"]},{"kind":"COMPUTE","substeps":["$80 := date($10)"]},{"kind":"WRITE","substeps":["$70","TO __stage00_output"]}],"slotMs":"130755","computeMode":"BIGQUERY"},{"name":"S01: Aggregate","id":"1","startMs":"1762526209069","endMs":"1762526209302","inputStages":["0"],"waitRatioAvg":0.7977941176470589,"waitMsAvg":"217","waitRatioMax":0.7977941176470589,"waitMsMax":"217","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.08455882352941177,"computeMsAvg":"23","computeRatioMax":0.08455882352941177,"computeMsMax":"23","writeRatioAvg":0.011029411764705883,"writeMsAvg":"3","writeRatioMax":0.011029411764705883,"writeMsMax":"3","shuffleOutputBytes":"5","shuffleOutputBytesSpilled":"0","recordsRead":"1935","recordsWritten":"1","parallelInputs":"1","completedParallelInputs":"1","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$70","FROM __stage00_output"]},{"kind":"AGGREGATE","substeps":["$60 := MAX($70)"]},{"kind":"WRITE","substeps":["$60","TO __stage01_output"]}],"slotMs":"200","computeMode":"BIGQUERY"},{"name":"S03: Coalesce","id":"3","startMs":"1762526209384","endMs":"1762526209450","inputStages":["1"],"waitRatioAvg":0.29411764705882354,"waitMsAvg":"80","waitRatioMax":0.3014705882352941,"waitMsMax":"82","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.03308823529411765,"computeMsAvg":"9","computeRatioMax":0.051470588235294115,"computeMsMax":"14","writeRatioAvg":0.04411764705882353,"writeMsAvg":"12","writeRatioMax":0.11397058823529412,"writeMsMax":"31","shuffleOutputBytes":"5","shuffleOutputBytesSpilled":"0","recordsRead":"1","recordsWritten":"1","parallelInputs":"100","completedParallelInputs":"100","status":"COMPLETE","steps":[{"kind":"READ","substeps":["FROM __stage01_output"]}],"slotMs":"6051","computeMode":"BIGQUERY"},{"name":"S04: Join+","id":"4","startMs":"1762526209387","endMs":"1762526209659","inputStages":["3"],"waitRatioAvg":0.5073529411764706,"waitMsAvg":"138","waitRatioMax":0.8897058823529411,"waitMsMax":"242","readRatioAvg":0.03676470588235294,"readMsAvg":"10","readRatioMax":0.2426470588235294,"readMsMax":"66","computeRatioAvg":0.051470588235294115,"computeMsAvg":"14","computeRatioMax":0.13602941176470587,"computeMsMax":"37","writeRatioAvg":0.003676470588235294,"writeMsAvg":"1","writeRatioMax":0.04044117647058824,"writeMsMax":"11","shuffleOutputBytes":"3914","shuffleOutputBytesSpilled":"0","recordsRead":"63562517","recordsWritten":"1935","parallelInputs":"1935","completedParallelInputs":"1935","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$1:value, $2:gas_price, $3:block_timestamp","FROM bigquery-public-data.crypto_ethereum_classic.transactions"]},{"kind":"READ","substeps":["$60","FROM __stage03_output"]},{"kind":"AGGREGATE","substeps":["$30 := SHARD_AVG($40)","$31 := SHARD_AVG($90)"]},{"kind":"COMPUTE","substeps":["$40 := CAST($91 AS NUMERIC)"]},{"kind":"JOIN","substeps":["$90 := $1, $91 := $2","INNER HASH JOIN EACH  WITH ALL  ON $50 = $60"]},{"kind":"COMPUTE","substeps":["$50 := date($3)"]},{"kind":"WRITE","substeps":["$30, $31","TO __stage04_output"]}],"slotMs":"191876","computeMode":"BIGQUERY"},{"name":"S05: Output","id":"5","startMs":"1762526209575","endMs":"1762526209671","inputStages":["4"],"waitRatioAvg":0.8713235294117647,"waitMsAvg":"237","waitRatioMax":0.8713235294117647,"waitMsMax":"237","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.09926470588235294,"computeMsAvg":"27","computeRatioMax":0.09926470588235294,"computeMsMax":"27","writeRatioAvg":0.014705882352941176,"writeMsAvg":"4","writeRatioMax":0.014705882352941176,"writeMsMax":"4","shuffleOutputBytes":"33","shuffleOutputBytesSpilled":"0","recordsRead":"1935","recordsWritten":"1","parallelInputs":"1","completedParallelInputs":"1","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$30, $31","FROM __stage04_output"]},{"kind":"AGGREGATE","substeps":["$20 := ROOT_AVG($30)","$21 := ROOT_AVG($31)"]},{"kind":"WRITE","substeps":["$20, $21","TO __stage05_output"]}],"slotMs":"57","computeMode":"BIGQUERY"}],"estimatedBytesProcessed":"2033938624","timeline":[{"elapsedMs":"654","totalSlotMs":"662656","pendingUnits":"0","completedUnits":"0","activeUnits":"0"},{"elapsedMs":"2346","totalSlotMs":"662656","pendingUnits":"0","completedUnits":"3972","activeUnits":"1649","estimatedRunnableUnits":"1000"}],"totalPartitionsProcessed":"1935","totalBytesProcessed":"2033938624","totalBytesBilled":"2034237440","billingTier":1,"totalSlotMs":"662656","cacheHit":false,"referencedTables":[{"projectId":"bigquery-public-data","datasetId":"crypto_ethereum_classic","tableId":"transactions"}],"statementType":"SELECT","performanceInsights":{"avgPreviousExecutionMs":"743"},"transferredBytes":"0","metadataCacheStatistics":{"tableMetadataCacheUsage":[{"tableReference":{"projectId":"bigquery-public-data","datasetId":"crypto_ethereum_classic","tableId":"transactions"},"unusedReason":"OTHER_REASON"}]}},"totalSlotMs":"662656","finalExecutionDurationMs":"924"},"status":{"state":"DONE"},"principal_subject":"user:admin@bentrollope.altostrat.com","jobCreationReason":{"code":"REQUESTED"}}'
++ echo '{"kind":"bigquery#job","etag":"IrluFPAYQApB3Obs7hi+nw==","id":"tony-allen:US.bqjob_r2ad4ed23ab491507_0000019a5ebf9bbf_1","selfLink":"https://bigquery.googleapis.com/bigquery/v2/projects/tony-allen/jobs/bqjob_r2ad4ed23ab491507_0000019a5ebf9bbf_1?location=US","user_email":"admin@bentrollope.altostrat.com","configuration":{"query":{"query":"WITH max_date AS (\n    -- 1. Determine the latest date once in an efficient, independent step.\n    -- This operation is fast because it'\''s a single aggregation over the table.\n    SELECT MAX(DATE(block_timestamp)) AS max_dt\n    FROM `bigquery-public-data.crypto_ethereum_classic.transactions`\n)\nSELECT\n    -- 2. Calculate the average gas price (casting INTEGER to NUMERIC for precision)\n    AVG(CAST(t.gas_price AS NUMERIC)) AS avg_gas_price_wei,\n    -- 3. Calculate the average transaction value (using the existing NUMERIC value column)\n    AVG(t.value) AS avg_transaction_value_wei\nFROM\n    `bigquery-public-data.crypto_ethereum_classic.transactions` AS t\nINNER JOIN\n    -- 4. Join the main table to the single-row CTE, ensuring the filter is pushed down\n    -- and the table is only scanned for the single target date.\n    max_date AS m ON DATE(t.block_timestamp) = m.max_dt","destinationTable":{"projectId":"tony-allen","datasetId":"_e34c49c766e4fd3f5d404c3949b9e19fa7acb372","tableId":"anon51beefe1_b4ff_4771_9f80_2ac3a35b63b1"},"writeDisposition":"WRITE_TRUNCATE","priority":"INTERACTIVE","useQueryCache":false,"useLegacySql":false},"jobType":"QUERY"},"jobReference":{"projectId":"tony-allen","jobId":"bqjob_r2ad4ed23ab491507_0000019a5ebf9bbf_1","location":"US"},"statistics":{"creationTime":"1762526207213","startTime":"1762526207346","endTime":"1762526209934","totalBytesProcessed":"2033938624","query":{"queryPlan":[{"name":"S00: Input","id":"0","startMs":"1762526208787","endMs":"1762526209255","waitRatioAvg":0.2757352941176471,"waitMsAvg":"75","waitRatioMax":0.8161764705882353,"waitMsMax":"222","readRatioAvg":0.051470588235294115,"readMsAvg":"14","readRatioMax":1,"readMsMax":"272","computeRatioAvg":0.03308823529411765,"computeMsAvg":"9","computeRatioMax":0.13602941176470587,"computeMsMax":"37","writeRatioAvg":0.003676470588235294,"writeMsAvg":"1","writeRatioMax":0.09926470588235294,"writeMsMax":"27","shuffleOutputBytes":"9675","shuffleOutputBytesSpilled":"0","recordsRead":"63560582","recordsWritten":"1935","parallelInputs":"1935","completedParallelInputs":"1935","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$10:block_timestamp","FROM bigquery-public-data.crypto_ethereum_classic.transactions"]},{"kind":"AGGREGATE","substeps":["$70 := MAX($80)"]},{"kind":"COMPUTE","substeps":["$80 := date($10)"]},{"kind":"WRITE","substeps":["$70","TO __stage00_output"]}],"slotMs":"130755","computeMode":"BIGQUERY"},{"name":"S01: Aggregate","id":"1","startMs":"1762526209069","endMs":"1762526209302","inputStages":["0"],"waitRatioAvg":0.7977941176470589,"waitMsAvg":"217","waitRatioMax":0.7977941176470589,"waitMsMax":"217","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.08455882352941177,"computeMsAvg":"23","computeRatioMax":0.08455882352941177,"computeMsMax":"23","writeRatioAvg":0.011029411764705883,"writeMsAvg":"3","writeRatioMax":0.011029411764705883,"writeMsMax":"3","shuffleOutputBytes":"5","shuffleOutputBytesSpilled":"0","recordsRead":"1935","recordsWritten":"1","parallelInputs":"1","completedParallelInputs":"1","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$70","FROM __stage00_output"]},{"kind":"AGGREGATE","substeps":["$60 := MAX($70)"]},{"kind":"WRITE","substeps":["$60","TO __stage01_output"]}],"slotMs":"200","computeMode":"BIGQUERY"},{"name":"S03: Coalesce","id":"3","startMs":"1762526209384","endMs":"1762526209450","inputStages":["1"],"waitRatioAvg":0.29411764705882354,"waitMsAvg":"80","waitRatioMax":0.3014705882352941,"waitMsMax":"82","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.03308823529411765,"computeMsAvg":"9","computeRatioMax":0.051470588235294115,"computeMsMax":"14","writeRatioAvg":0.04411764705882353,"writeMsAvg":"12","writeRatioMax":0.11397058823529412,"writeMsMax":"31","shuffleOutputBytes":"5","shuffleOutputBytesSpilled":"0","recordsRead":"1","recordsWritten":"1","parallelInputs":"100","completedParallelInputs":"100","status":"COMPLETE","steps":[{"kind":"READ","substeps":["FROM __stage01_output"]}],"slotMs":"6051","computeMode":"BIGQUERY"},{"name":"S04: Join+","id":"4","startMs":"1762526209387","endMs":"1762526209659","inputStages":["3"],"waitRatioAvg":0.5073529411764706,"waitMsAvg":"138","waitRatioMax":0.8897058823529411,"waitMsMax":"242","readRatioAvg":0.03676470588235294,"readMsAvg":"10","readRatioMax":0.2426470588235294,"readMsMax":"66","computeRatioAvg":0.051470588235294115,"computeMsAvg":"14","computeRatioMax":0.13602941176470587,"computeMsMax":"37","writeRatioAvg":0.003676470588235294,"writeMsAvg":"1","writeRatioMax":0.04044117647058824,"writeMsMax":"11","shuffleOutputBytes":"3914","shuffleOutputBytesSpilled":"0","recordsRead":"63562517","recordsWritten":"1935","parallelInputs":"1935","completedParallelInputs":"1935","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$1:value, $2:gas_price, $3:block_timestamp","FROM bigquery-public-data.crypto_ethereum_classic.transactions"]},{"kind":"READ","substeps":["$60","FROM __stage03_output"]},{"kind":"AGGREGATE","substeps":["$30 := SHARD_AVG($40)","$31 := SHARD_AVG($90)"]},{"kind":"COMPUTE","substeps":["$40 := CAST($91 AS NUMERIC)"]},{"kind":"JOIN","substeps":["$90 := $1, $91 := $2","INNER HASH JOIN EACH  WITH ALL  ON $50 = $60"]},{"kind":"COMPUTE","substeps":["$50 := date($3)"]},{"kind":"WRITE","substeps":["$30, $31","TO __stage04_output"]}],"slotMs":"191876","computeMode":"BIGQUERY"},{"name":"S05: Output","id":"5","startMs":"1762526209575","endMs":"1762526209671","inputStages":["4"],"waitRatioAvg":0.8713235294117647,"waitMsAvg":"237","waitRatioMax":0.8713235294117647,"waitMsMax":"237","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.09926470588235294,"computeMsAvg":"27","computeRatioMax":0.09926470588235294,"computeMsMax":"27","writeRatioAvg":0.014705882352941176,"writeMsAvg":"4","writeRatioMax":0.014705882352941176,"writeMsMax":"4","shuffleOutputBytes":"33","shuffleOutputBytesSpilled":"0","recordsRead":"1935","recordsWritten":"1","parallelInputs":"1","completedParallelInputs":"1","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$30, $31","FROM __stage04_output"]},{"kind":"AGGREGATE","substeps":["$20 := ROOT_AVG($30)","$21 := ROOT_AVG($31)"]},{"kind":"WRITE","substeps":["$20, $21","TO __stage05_output"]}],"slotMs":"57","computeMode":"BIGQUERY"}],"estimatedBytesProcessed":"2033938624","timeline":[{"elapsedMs":"654","totalSlotMs":"662656","pendingUnits":"0","completedUnits":"0","activeUnits":"0"},{"elapsedMs":"2346","totalSlotMs":"662656","pendingUnits":"0","completedUnits":"3972","activeUnits":"1649","estimatedRunnableUnits":"1000"}],"totalPartitionsProcessed":"1935","totalBytesProcessed":"2033938624","totalBytesBilled":"2034237440","billingTier":1,"totalSlotMs":"662656","cacheHit":false,"referencedTables":[{"projectId":"bigquery-public-data","datasetId":"crypto_ethereum_classic","tableId":"transactions"}],"statementType":"SELECT","performanceInsights":{"avgPreviousExecutionMs":"743"},"transferredBytes":"0","metadataCacheStatistics":{"tableMetadataCacheUsage":[{"tableReference":{"projectId":"bigquery-public-data","datasetId":"crypto_ethereum_classic","tableId":"transactions"},"unusedReason":"OTHER_REASON"}]}},"totalSlotMs":"662656","finalExecutionDurationMs":"924"},"status":{"state":"DONE"},"principal_subject":"user:admin@bentrollope.altostrat.com","jobCreationReason":{"code":"REQUESTED"}}'
++ jq -r .statistics.totalBytesProcessed
+ total_bytes_processed=2033938624
++ echo '{"kind":"bigquery#job","etag":"IrluFPAYQApB3Obs7hi+nw==","id":"tony-allen:US.bqjob_r2ad4ed23ab491507_0000019a5ebf9bbf_1","selfLink":"https://bigquery.googleapis.com/bigquery/v2/projects/tony-allen/jobs/bqjob_r2ad4ed23ab491507_0000019a5ebf9bbf_1?location=US","user_email":"admin@bentrollope.altostrat.com","configuration":{"query":{"query":"WITH max_date AS (\n    -- 1. Determine the latest date once in an efficient, independent step.\n    -- This operation is fast because it'\''s a single aggregation over the table.\n    SELECT MAX(DATE(block_timestamp)) AS max_dt\n    FROM `bigquery-public-data.crypto_ethereum_classic.transactions`\n)\nSELECT\n    -- 2. Calculate the average gas price (casting INTEGER to NUMERIC for precision)\n    AVG(CAST(t.gas_price AS NUMERIC)) AS avg_gas_price_wei,\n    -- 3. Calculate the average transaction value (using the existing NUMERIC value column)\n    AVG(t.value) AS avg_transaction_value_wei\nFROM\n    `bigquery-public-data.crypto_ethereum_classic.transactions` AS t\nINNER JOIN\n    -- 4. Join the main table to the single-row CTE, ensuring the filter is pushed down\n    -- and the table is only scanned for the single target date.\n    max_date AS m ON DATE(t.block_timestamp) = m.max_dt","destinationTable":{"projectId":"tony-allen","datasetId":"_e34c49c766e4fd3f5d404c3949b9e19fa7acb372","tableId":"anon51beefe1_b4ff_4771_9f80_2ac3a35b63b1"},"writeDisposition":"WRITE_TRUNCATE","priority":"INTERACTIVE","useQueryCache":false,"useLegacySql":false},"jobType":"QUERY"},"jobReference":{"projectId":"tony-allen","jobId":"bqjob_r2ad4ed23ab491507_0000019a5ebf9bbf_1","location":"US"},"statistics":{"creationTime":"1762526207213","startTime":"1762526207346","endTime":"1762526209934","totalBytesProcessed":"2033938624","query":{"queryPlan":[{"name":"S00: Input","id":"0","startMs":"1762526208787","endMs":"1762526209255","waitRatioAvg":0.2757352941176471,"waitMsAvg":"75","waitRatioMax":0.8161764705882353,"waitMsMax":"222","readRatioAvg":0.051470588235294115,"readMsAvg":"14","readRatioMax":1,"readMsMax":"272","computeRatioAvg":0.03308823529411765,"computeMsAvg":"9","computeRatioMax":0.13602941176470587,"computeMsMax":"37","writeRatioAvg":0.003676470588235294,"writeMsAvg":"1","writeRatioMax":0.09926470588235294,"writeMsMax":"27","shuffleOutputBytes":"9675","shuffleOutputBytesSpilled":"0","recordsRead":"63560582","recordsWritten":"1935","parallelInputs":"1935","completedParallelInputs":"1935","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$10:block_timestamp","FROM bigquery-public-data.crypto_ethereum_classic.transactions"]},{"kind":"AGGREGATE","substeps":["$70 := MAX($80)"]},{"kind":"COMPUTE","substeps":["$80 := date($10)"]},{"kind":"WRITE","substeps":["$70","TO __stage00_output"]}],"slotMs":"130755","computeMode":"BIGQUERY"},{"name":"S01: Aggregate","id":"1","startMs":"1762526209069","endMs":"1762526209302","inputStages":["0"],"waitRatioAvg":0.7977941176470589,"waitMsAvg":"217","waitRatioMax":0.7977941176470589,"waitMsMax":"217","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.08455882352941177,"computeMsAvg":"23","computeRatioMax":0.08455882352941177,"computeMsMax":"23","writeRatioAvg":0.011029411764705883,"writeMsAvg":"3","writeRatioMax":0.011029411764705883,"writeMsMax":"3","shuffleOutputBytes":"5","shuffleOutputBytesSpilled":"0","recordsRead":"1935","recordsWritten":"1","parallelInputs":"1","completedParallelInputs":"1","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$70","FROM __stage00_output"]},{"kind":"AGGREGATE","substeps":["$60 := MAX($70)"]},{"kind":"WRITE","substeps":["$60","TO __stage01_output"]}],"slotMs":"200","computeMode":"BIGQUERY"},{"name":"S03: Coalesce","id":"3","startMs":"1762526209384","endMs":"1762526209450","inputStages":["1"],"waitRatioAvg":0.29411764705882354,"waitMsAvg":"80","waitRatioMax":0.3014705882352941,"waitMsMax":"82","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.03308823529411765,"computeMsAvg":"9","computeRatioMax":0.051470588235294115,"computeMsMax":"14","writeRatioAvg":0.04411764705882353,"writeMsAvg":"12","writeRatioMax":0.11397058823529412,"writeMsMax":"31","shuffleOutputBytes":"5","shuffleOutputBytesSpilled":"0","recordsRead":"1","recordsWritten":"1","parallelInputs":"100","completedParallelInputs":"100","status":"COMPLETE","steps":[{"kind":"READ","substeps":["FROM __stage01_output"]}],"slotMs":"6051","computeMode":"BIGQUERY"},{"name":"S04: Join+","id":"4","startMs":"1762526209387","endMs":"1762526209659","inputStages":["3"],"waitRatioAvg":0.5073529411764706,"waitMsAvg":"138","waitRatioMax":0.8897058823529411,"waitMsMax":"242","readRatioAvg":0.03676470588235294,"readMsAvg":"10","readRatioMax":0.2426470588235294,"readMsMax":"66","computeRatioAvg":0.051470588235294115,"computeMsAvg":"14","computeRatioMax":0.13602941176470587,"computeMsMax":"37","writeRatioAvg":0.003676470588235294,"writeMsAvg":"1","writeRatioMax":0.04044117647058824,"writeMsMax":"11","shuffleOutputBytes":"3914","shuffleOutputBytesSpilled":"0","recordsRead":"63562517","recordsWritten":"1935","parallelInputs":"1935","completedParallelInputs":"1935","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$1:value, $2:gas_price, $3:block_timestamp","FROM bigquery-public-data.crypto_ethereum_classic.transactions"]},{"kind":"READ","substeps":["$60","FROM __stage03_output"]},{"kind":"AGGREGATE","substeps":["$30 := SHARD_AVG($40)","$31 := SHARD_AVG($90)"]},{"kind":"COMPUTE","substeps":["$40 := CAST($91 AS NUMERIC)"]},{"kind":"JOIN","substeps":["$90 := $1, $91 := $2","INNER HASH JOIN EACH  WITH ALL  ON $50 = $60"]},{"kind":"COMPUTE","substeps":["$50 := date($3)"]},{"kind":"WRITE","substeps":["$30, $31","TO __stage04_output"]}],"slotMs":"191876","computeMode":"BIGQUERY"},{"name":"S05: Output","id":"5","startMs":"1762526209575","endMs":"1762526209671","inputStages":["4"],"waitRatioAvg":0.8713235294117647,"waitMsAvg":"237","waitRatioMax":0.8713235294117647,"waitMsMax":"237","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.09926470588235294,"computeMsAvg":"27","computeRatioMax":0.09926470588235294,"computeMsMax":"27","writeRatioAvg":0.014705882352941176,"writeMsAvg":"4","writeRatioMax":0.014705882352941176,"writeMsMax":"4","shuffleOutputBytes":"33","shuffleOutputBytesSpilled":"0","recordsRead":"1935","recordsWritten":"1","parallelInputs":"1","completedParallelInputs":"1","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$30, $31","FROM __stage04_output"]},{"kind":"AGGREGATE","substeps":["$20 := ROOT_AVG($30)","$21 := ROOT_AVG($31)"]},{"kind":"WRITE","substeps":["$20, $21","TO __stage05_output"]}],"slotMs":"57","computeMode":"BIGQUERY"}],"estimatedBytesProcessed":"2033938624","timeline":[{"elapsedMs":"654","totalSlotMs":"662656","pendingUnits":"0","completedUnits":"0","activeUnits":"0"},{"elapsedMs":"2346","totalSlotMs":"662656","pendingUnits":"0","completedUnits":"3972","activeUnits":"1649","estimatedRunnableUnits":"1000"}],"totalPartitionsProcessed":"1935","totalBytesProcessed":"2033938624","totalBytesBilled":"2034237440","billingTier":1,"totalSlotMs":"662656","cacheHit":false,"referencedTables":[{"projectId":"bigquery-public-data","datasetId":"crypto_ethereum_classic","tableId":"transactions"}],"statementType":"SELECT","performanceInsights":{"avgPreviousExecutionMs":"743"},"transferredBytes":"0","metadataCacheStatistics":{"tableMetadataCacheUsage":[{"tableReference":{"projectId":"bigquery-public-data","datasetId":"crypto_ethereum_classic","tableId":"transactions"},"unusedReason":"OTHER_REASON"}]}},"totalSlotMs":"662656","finalExecutionDurationMs":"924"},"status":{"state":"DONE"},"principal_subject":"user:admin@bentrollope.altostrat.com","jobCreationReason":{"code":"REQUESTED"}}'
++ jq -r .statistics.totalSlotMs
+ total_slot_ms=662656
++ jq -r .statistics.startTime
++ echo '{"kind":"bigquery#job","etag":"IrluFPAYQApB3Obs7hi+nw==","id":"tony-allen:US.bqjob_r2ad4ed23ab491507_0000019a5ebf9bbf_1","selfLink":"https://bigquery.googleapis.com/bigquery/v2/projects/tony-allen/jobs/bqjob_r2ad4ed23ab491507_0000019a5ebf9bbf_1?location=US","user_email":"admin@bentrollope.altostrat.com","configuration":{"query":{"query":"WITH max_date AS (\n    -- 1. Determine the latest date once in an efficient, independent step.\n    -- This operation is fast because it'\''s a single aggregation over the table.\n    SELECT MAX(DATE(block_timestamp)) AS max_dt\n    FROM `bigquery-public-data.crypto_ethereum_classic.transactions`\n)\nSELECT\n    -- 2. Calculate the average gas price (casting INTEGER to NUMERIC for precision)\n    AVG(CAST(t.gas_price AS NUMERIC)) AS avg_gas_price_wei,\n    -- 3. Calculate the average transaction value (using the existing NUMERIC value column)\n    AVG(t.value) AS avg_transaction_value_wei\nFROM\n    `bigquery-public-data.crypto_ethereum_classic.transactions` AS t\nINNER JOIN\n    -- 4. Join the main table to the single-row CTE, ensuring the filter is pushed down\n    -- and the table is only scanned for the single target date.\n    max_date AS m ON DATE(t.block_timestamp) = m.max_dt","destinationTable":{"projectId":"tony-allen","datasetId":"_e34c49c766e4fd3f5d404c3949b9e19fa7acb372","tableId":"anon51beefe1_b4ff_4771_9f80_2ac3a35b63b1"},"writeDisposition":"WRITE_TRUNCATE","priority":"INTERACTIVE","useQueryCache":false,"useLegacySql":false},"jobType":"QUERY"},"jobReference":{"projectId":"tony-allen","jobId":"bqjob_r2ad4ed23ab491507_0000019a5ebf9bbf_1","location":"US"},"statistics":{"creationTime":"1762526207213","startTime":"1762526207346","endTime":"1762526209934","totalBytesProcessed":"2033938624","query":{"queryPlan":[{"name":"S00: Input","id":"0","startMs":"1762526208787","endMs":"1762526209255","waitRatioAvg":0.2757352941176471,"waitMsAvg":"75","waitRatioMax":0.8161764705882353,"waitMsMax":"222","readRatioAvg":0.051470588235294115,"readMsAvg":"14","readRatioMax":1,"readMsMax":"272","computeRatioAvg":0.03308823529411765,"computeMsAvg":"9","computeRatioMax":0.13602941176470587,"computeMsMax":"37","writeRatioAvg":0.003676470588235294,"writeMsAvg":"1","writeRatioMax":0.09926470588235294,"writeMsMax":"27","shuffleOutputBytes":"9675","shuffleOutputBytesSpilled":"0","recordsRead":"63560582","recordsWritten":"1935","parallelInputs":"1935","completedParallelInputs":"1935","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$10:block_timestamp","FROM bigquery-public-data.crypto_ethereum_classic.transactions"]},{"kind":"AGGREGATE","substeps":["$70 := MAX($80)"]},{"kind":"COMPUTE","substeps":["$80 := date($10)"]},{"kind":"WRITE","substeps":["$70","TO __stage00_output"]}],"slotMs":"130755","computeMode":"BIGQUERY"},{"name":"S01: Aggregate","id":"1","startMs":"1762526209069","endMs":"1762526209302","inputStages":["0"],"waitRatioAvg":0.7977941176470589,"waitMsAvg":"217","waitRatioMax":0.7977941176470589,"waitMsMax":"217","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.08455882352941177,"computeMsAvg":"23","computeRatioMax":0.08455882352941177,"computeMsMax":"23","writeRatioAvg":0.011029411764705883,"writeMsAvg":"3","writeRatioMax":0.011029411764705883,"writeMsMax":"3","shuffleOutputBytes":"5","shuffleOutputBytesSpilled":"0","recordsRead":"1935","recordsWritten":"1","parallelInputs":"1","completedParallelInputs":"1","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$70","FROM __stage00_output"]},{"kind":"AGGREGATE","substeps":["$60 := MAX($70)"]},{"kind":"WRITE","substeps":["$60","TO __stage01_output"]}],"slotMs":"200","computeMode":"BIGQUERY"},{"name":"S03: Coalesce","id":"3","startMs":"1762526209384","endMs":"1762526209450","inputStages":["1"],"waitRatioAvg":0.29411764705882354,"waitMsAvg":"80","waitRatioMax":0.3014705882352941,"waitMsMax":"82","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.03308823529411765,"computeMsAvg":"9","computeRatioMax":0.051470588235294115,"computeMsMax":"14","writeRatioAvg":0.04411764705882353,"writeMsAvg":"12","writeRatioMax":0.11397058823529412,"writeMsMax":"31","shuffleOutputBytes":"5","shuffleOutputBytesSpilled":"0","recordsRead":"1","recordsWritten":"1","parallelInputs":"100","completedParallelInputs":"100","status":"COMPLETE","steps":[{"kind":"READ","substeps":["FROM __stage01_output"]}],"slotMs":"6051","computeMode":"BIGQUERY"},{"name":"S04: Join+","id":"4","startMs":"1762526209387","endMs":"1762526209659","inputStages":["3"],"waitRatioAvg":0.5073529411764706,"waitMsAvg":"138","waitRatioMax":0.8897058823529411,"waitMsMax":"242","readRatioAvg":0.03676470588235294,"readMsAvg":"10","readRatioMax":0.2426470588235294,"readMsMax":"66","computeRatioAvg":0.051470588235294115,"computeMsAvg":"14","computeRatioMax":0.13602941176470587,"computeMsMax":"37","writeRatioAvg":0.003676470588235294,"writeMsAvg":"1","writeRatioMax":0.04044117647058824,"writeMsMax":"11","shuffleOutputBytes":"3914","shuffleOutputBytesSpilled":"0","recordsRead":"63562517","recordsWritten":"1935","parallelInputs":"1935","completedParallelInputs":"1935","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$1:value, $2:gas_price, $3:block_timestamp","FROM bigquery-public-data.crypto_ethereum_classic.transactions"]},{"kind":"READ","substeps":["$60","FROM __stage03_output"]},{"kind":"AGGREGATE","substeps":["$30 := SHARD_AVG($40)","$31 := SHARD_AVG($90)"]},{"kind":"COMPUTE","substeps":["$40 := CAST($91 AS NUMERIC)"]},{"kind":"JOIN","substeps":["$90 := $1, $91 := $2","INNER HASH JOIN EACH  WITH ALL  ON $50 = $60"]},{"kind":"COMPUTE","substeps":["$50 := date($3)"]},{"kind":"WRITE","substeps":["$30, $31","TO __stage04_output"]}],"slotMs":"191876","computeMode":"BIGQUERY"},{"name":"S05: Output","id":"5","startMs":"1762526209575","endMs":"1762526209671","inputStages":["4"],"waitRatioAvg":0.8713235294117647,"waitMsAvg":"237","waitRatioMax":0.8713235294117647,"waitMsMax":"237","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.09926470588235294,"computeMsAvg":"27","computeRatioMax":0.09926470588235294,"computeMsMax":"27","writeRatioAvg":0.014705882352941176,"writeMsAvg":"4","writeRatioMax":0.014705882352941176,"writeMsMax":"4","shuffleOutputBytes":"33","shuffleOutputBytesSpilled":"0","recordsRead":"1935","recordsWritten":"1","parallelInputs":"1","completedParallelInputs":"1","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$30, $31","FROM __stage04_output"]},{"kind":"AGGREGATE","substeps":["$20 := ROOT_AVG($30)","$21 := ROOT_AVG($31)"]},{"kind":"WRITE","substeps":["$20, $21","TO __stage05_output"]}],"slotMs":"57","computeMode":"BIGQUERY"}],"estimatedBytesProcessed":"2033938624","timeline":[{"elapsedMs":"654","totalSlotMs":"662656","pendingUnits":"0","completedUnits":"0","activeUnits":"0"},{"elapsedMs":"2346","totalSlotMs":"662656","pendingUnits":"0","completedUnits":"3972","activeUnits":"1649","estimatedRunnableUnits":"1000"}],"totalPartitionsProcessed":"1935","totalBytesProcessed":"2033938624","totalBytesBilled":"2034237440","billingTier":1,"totalSlotMs":"662656","cacheHit":false,"referencedTables":[{"projectId":"bigquery-public-data","datasetId":"crypto_ethereum_classic","tableId":"transactions"}],"statementType":"SELECT","performanceInsights":{"avgPreviousExecutionMs":"743"},"transferredBytes":"0","metadataCacheStatistics":{"tableMetadataCacheUsage":[{"tableReference":{"projectId":"bigquery-public-data","datasetId":"crypto_ethereum_classic","tableId":"transactions"},"unusedReason":"OTHER_REASON"}]}},"totalSlotMs":"662656","finalExecutionDurationMs":"924"},"status":{"state":"DONE"},"principal_subject":"user:admin@bentrollope.altostrat.com","jobCreationReason":{"code":"REQUESTED"}}'
+ start_time=1762526207346
++ jq -r .statistics.endTime
++ echo '{"kind":"bigquery#job","etag":"IrluFPAYQApB3Obs7hi+nw==","id":"tony-allen:US.bqjob_r2ad4ed23ab491507_0000019a5ebf9bbf_1","selfLink":"https://bigquery.googleapis.com/bigquery/v2/projects/tony-allen/jobs/bqjob_r2ad4ed23ab491507_0000019a5ebf9bbf_1?location=US","user_email":"admin@bentrollope.altostrat.com","configuration":{"query":{"query":"WITH max_date AS (\n    -- 1. Determine the latest date once in an efficient, independent step.\n    -- This operation is fast because it'\''s a single aggregation over the table.\n    SELECT MAX(DATE(block_timestamp)) AS max_dt\n    FROM `bigquery-public-data.crypto_ethereum_classic.transactions`\n)\nSELECT\n    -- 2. Calculate the average gas price (casting INTEGER to NUMERIC for precision)\n    AVG(CAST(t.gas_price AS NUMERIC)) AS avg_gas_price_wei,\n    -- 3. Calculate the average transaction value (using the existing NUMERIC value column)\n    AVG(t.value) AS avg_transaction_value_wei\nFROM\n    `bigquery-public-data.crypto_ethereum_classic.transactions` AS t\nINNER JOIN\n    -- 4. Join the main table to the single-row CTE, ensuring the filter is pushed down\n    -- and the table is only scanned for the single target date.\n    max_date AS m ON DATE(t.block_timestamp) = m.max_dt","destinationTable":{"projectId":"tony-allen","datasetId":"_e34c49c766e4fd3f5d404c3949b9e19fa7acb372","tableId":"anon51beefe1_b4ff_4771_9f80_2ac3a35b63b1"},"writeDisposition":"WRITE_TRUNCATE","priority":"INTERACTIVE","useQueryCache":false,"useLegacySql":false},"jobType":"QUERY"},"jobReference":{"projectId":"tony-allen","jobId":"bqjob_r2ad4ed23ab491507_0000019a5ebf9bbf_1","location":"US"},"statistics":{"creationTime":"1762526207213","startTime":"1762526207346","endTime":"1762526209934","totalBytesProcessed":"2033938624","query":{"queryPlan":[{"name":"S00: Input","id":"0","startMs":"1762526208787","endMs":"1762526209255","waitRatioAvg":0.2757352941176471,"waitMsAvg":"75","waitRatioMax":0.8161764705882353,"waitMsMax":"222","readRatioAvg":0.051470588235294115,"readMsAvg":"14","readRatioMax":1,"readMsMax":"272","computeRatioAvg":0.03308823529411765,"computeMsAvg":"9","computeRatioMax":0.13602941176470587,"computeMsMax":"37","writeRatioAvg":0.003676470588235294,"writeMsAvg":"1","writeRatioMax":0.09926470588235294,"writeMsMax":"27","shuffleOutputBytes":"9675","shuffleOutputBytesSpilled":"0","recordsRead":"63560582","recordsWritten":"1935","parallelInputs":"1935","completedParallelInputs":"1935","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$10:block_timestamp","FROM bigquery-public-data.crypto_ethereum_classic.transactions"]},{"kind":"AGGREGATE","substeps":["$70 := MAX($80)"]},{"kind":"COMPUTE","substeps":["$80 := date($10)"]},{"kind":"WRITE","substeps":["$70","TO __stage00_output"]}],"slotMs":"130755","computeMode":"BIGQUERY"},{"name":"S01: Aggregate","id":"1","startMs":"1762526209069","endMs":"1762526209302","inputStages":["0"],"waitRatioAvg":0.7977941176470589,"waitMsAvg":"217","waitRatioMax":0.7977941176470589,"waitMsMax":"217","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.08455882352941177,"computeMsAvg":"23","computeRatioMax":0.08455882352941177,"computeMsMax":"23","writeRatioAvg":0.011029411764705883,"writeMsAvg":"3","writeRatioMax":0.011029411764705883,"writeMsMax":"3","shuffleOutputBytes":"5","shuffleOutputBytesSpilled":"0","recordsRead":"1935","recordsWritten":"1","parallelInputs":"1","completedParallelInputs":"1","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$70","FROM __stage00_output"]},{"kind":"AGGREGATE","substeps":["$60 := MAX($70)"]},{"kind":"WRITE","substeps":["$60","TO __stage01_output"]}],"slotMs":"200","computeMode":"BIGQUERY"},{"name":"S03: Coalesce","id":"3","startMs":"1762526209384","endMs":"1762526209450","inputStages":["1"],"waitRatioAvg":0.29411764705882354,"waitMsAvg":"80","waitRatioMax":0.3014705882352941,"waitMsMax":"82","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.03308823529411765,"computeMsAvg":"9","computeRatioMax":0.051470588235294115,"computeMsMax":"14","writeRatioAvg":0.04411764705882353,"writeMsAvg":"12","writeRatioMax":0.11397058823529412,"writeMsMax":"31","shuffleOutputBytes":"5","shuffleOutputBytesSpilled":"0","recordsRead":"1","recordsWritten":"1","parallelInputs":"100","completedParallelInputs":"100","status":"COMPLETE","steps":[{"kind":"READ","substeps":["FROM __stage01_output"]}],"slotMs":"6051","computeMode":"BIGQUERY"},{"name":"S04: Join+","id":"4","startMs":"1762526209387","endMs":"1762526209659","inputStages":["3"],"waitRatioAvg":0.5073529411764706,"waitMsAvg":"138","waitRatioMax":0.8897058823529411,"waitMsMax":"242","readRatioAvg":0.03676470588235294,"readMsAvg":"10","readRatioMax":0.2426470588235294,"readMsMax":"66","computeRatioAvg":0.051470588235294115,"computeMsAvg":"14","computeRatioMax":0.13602941176470587,"computeMsMax":"37","writeRatioAvg":0.003676470588235294,"writeMsAvg":"1","writeRatioMax":0.04044117647058824,"writeMsMax":"11","shuffleOutputBytes":"3914","shuffleOutputBytesSpilled":"0","recordsRead":"63562517","recordsWritten":"1935","parallelInputs":"1935","completedParallelInputs":"1935","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$1:value, $2:gas_price, $3:block_timestamp","FROM bigquery-public-data.crypto_ethereum_classic.transactions"]},{"kind":"READ","substeps":["$60","FROM __stage03_output"]},{"kind":"AGGREGATE","substeps":["$30 := SHARD_AVG($40)","$31 := SHARD_AVG($90)"]},{"kind":"COMPUTE","substeps":["$40 := CAST($91 AS NUMERIC)"]},{"kind":"JOIN","substeps":["$90 := $1, $91 := $2","INNER HASH JOIN EACH  WITH ALL  ON $50 = $60"]},{"kind":"COMPUTE","substeps":["$50 := date($3)"]},{"kind":"WRITE","substeps":["$30, $31","TO __stage04_output"]}],"slotMs":"191876","computeMode":"BIGQUERY"},{"name":"S05: Output","id":"5","startMs":"1762526209575","endMs":"1762526209671","inputStages":["4"],"waitRatioAvg":0.8713235294117647,"waitMsAvg":"237","waitRatioMax":0.8713235294117647,"waitMsMax":"237","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.09926470588235294,"computeMsAvg":"27","computeRatioMax":0.09926470588235294,"computeMsMax":"27","writeRatioAvg":0.014705882352941176,"writeMsAvg":"4","writeRatioMax":0.014705882352941176,"writeMsMax":"4","shuffleOutputBytes":"33","shuffleOutputBytesSpilled":"0","recordsRead":"1935","recordsWritten":"1","parallelInputs":"1","completedParallelInputs":"1","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$30, $31","FROM __stage04_output"]},{"kind":"AGGREGATE","substeps":["$20 := ROOT_AVG($30)","$21 := ROOT_AVG($31)"]},{"kind":"WRITE","substeps":["$20, $21","TO __stage05_output"]}],"slotMs":"57","computeMode":"BIGQUERY"}],"estimatedBytesProcessed":"2033938624","timeline":[{"elapsedMs":"654","totalSlotMs":"662656","pendingUnits":"0","completedUnits":"0","activeUnits":"0"},{"elapsedMs":"2346","totalSlotMs":"662656","pendingUnits":"0","completedUnits":"3972","activeUnits":"1649","estimatedRunnableUnits":"1000"}],"totalPartitionsProcessed":"1935","totalBytesProcessed":"2033938624","totalBytesBilled":"2034237440","billingTier":1,"totalSlotMs":"662656","cacheHit":false,"referencedTables":[{"projectId":"bigquery-public-data","datasetId":"crypto_ethereum_classic","tableId":"transactions"}],"statementType":"SELECT","performanceInsights":{"avgPreviousExecutionMs":"743"},"transferredBytes":"0","metadataCacheStatistics":{"tableMetadataCacheUsage":[{"tableReference":{"projectId":"bigquery-public-data","datasetId":"crypto_ethereum_classic","tableId":"transactions"},"unusedReason":"OTHER_REASON"}]}},"totalSlotMs":"662656","finalExecutionDurationMs":"924"},"status":{"state":"DONE"},"principal_subject":"user:admin@bentrollope.altostrat.com","jobCreationReason":{"code":"REQUESTED"}}'
+ end_time=1762526209934
++ echo 1762526207346
++ awk '{print int($1)}'
+ start_ms=1762526207346
++ echo 1762526209934
++ awk '{print int($1)}'
+ end_ms=1762526209934
+ duration_ms=2588
+ echo '  --- Execution Statistics ---'
  --- Execution Statistics ---
+ echo '  Duration: 2588 ms'
  Duration: 2588 ms
+ echo '  Bytes Processed: 2033938624 bytes'
  Bytes Processed: 2033938624 bytes
+ echo '  Slot Milliseconds: 662656'
  Slot Milliseconds: 662656
+ echo '  ----------------------------'
  ----------------------------
+ echo -e 'Daily Avg Optimized\tbqjob_r2ad4ed23ab491507_0000019a5ebf9bbf_1\t2588\t2033938624\t662656'
+ echo ''

+ echo '--- Running queries from erc20_high_activity_event_analysis_eval.sql ---'
--- Running queries from erc20_high_activity_event_analysis_eval.sql ---
+ run_query 'ERC20 Unoptimized' 'WITH ERC20_Contracts AS (
    -- CTE 1: Filters the small '\''contracts'\'' dimension table once to identify ERC20s.
    SELECT address 
    FROM `bigquery-public-data.crypto_ethereum_classic.contracts` 
    WHERE is_erc20 = TRUE
),
MonthlyLogCounts AS (
    -- CTE 2: Filters early and aggregates the massive '\''logs'\'' table to find high-activity contracts (> 1,000 logs/month).
    SELECT
        t1.address,
        FORMAT_DATE('\''%Y-%m'\'', t1.block_timestamp) AS transaction_month, 
        COUNT(t1.log_index) AS log_event_count 
    FROM
        `bigquery-public-data.crypto_ethereum_classic.logs` AS t1
    INNER JOIN
        ERC20_Contracts AS t2 ON t1.address = t2.address
    GROUP BY
        1, 2
    HAVING
        log_event_count > 1000
),
FrequentTopics AS (
    -- CTE 3: Joins the already filtered, small result from CTE 2 back to the '\''logs'\'' table
    -- only for the relevant contracts/months to find the topic frequency (event signature).
    SELECT
        t1.address,
        t1.transaction_month,
        topic,
        -- Applies a rank over the small, relevant subset of data.
        ROW_NUMBER() OVER (PARTITION BY t1.address, t1.transaction_month ORDER BY COUNT(topic) DESC) AS topic_rank
    FROM
        MonthlyLogCounts AS t1
    INNER JOIN
        `bigquery-public-data.crypto_ethereum_classic.logs` AS t2 
        ON t1.address = t2.address AND FORMAT_DATE('\''%Y-%m'\'', t2.block_timestamp) = t1.transaction_month
    CROSS JOIN
        UNNEST(t2.topics) AS topic WITH OFFSET AS topic_index
    WHERE
        topic_index = 0 -- Isolates the event signature hash (topics[0])
    GROUP BY
        1, 2, 3
)
-- Final Query: Selects the result ranked 1 (the most frequent event hash) for each contract/month.
SELECT
    COUNT(DISTINCT address) AS unique_erc20_contracts_exceeding_1k,
    ARRAY_AGG(
        STRUCT(t1.address, t1.transaction_month, t1.topic AS most_frequent_signature_hash) 
        ORDER BY t1.address, t1.transaction_month
    ) AS details_by_contract_and_month
FROM FrequentTopics AS t1
WHERE t1.topic_rank = 1'
+ local 'query_name=ERC20 Unoptimized'
+ local 'query=WITH ERC20_Contracts AS (
    -- CTE 1: Filters the small '\''contracts'\'' dimension table once to identify ERC20s.
    SELECT address 
    FROM `bigquery-public-data.crypto_ethereum_classic.contracts` 
    WHERE is_erc20 = TRUE
),
MonthlyLogCounts AS (
    -- CTE 2: Filters early and aggregates the massive '\''logs'\'' table to find high-activity contracts (> 1,000 logs/month).
    SELECT
        t1.address,
        FORMAT_DATE('\''%Y-%m'\'', t1.block_timestamp) AS transaction_month, 
        COUNT(t1.log_index) AS log_event_count 
    FROM
        `bigquery-public-data.crypto_ethereum_classic.logs` AS t1
    INNER JOIN
        ERC20_Contracts AS t2 ON t1.address = t2.address
    GROUP BY
        1, 2
    HAVING
        log_event_count > 1000
),
FrequentTopics AS (
    -- CTE 3: Joins the already filtered, small result from CTE 2 back to the '\''logs'\'' table
    -- only for the relevant contracts/months to find the topic frequency (event signature).
    SELECT
        t1.address,
        t1.transaction_month,
        topic,
        -- Applies a rank over the small, relevant subset of data.
        ROW_NUMBER() OVER (PARTITION BY t1.address, t1.transaction_month ORDER BY COUNT(topic) DESC) AS topic_rank
    FROM
        MonthlyLogCounts AS t1
    INNER JOIN
        `bigquery-public-data.crypto_ethereum_classic.logs` AS t2 
        ON t1.address = t2.address AND FORMAT_DATE('\''%Y-%m'\'', t2.block_timestamp) = t1.transaction_month
    CROSS JOIN
        UNNEST(t2.topics) AS topic WITH OFFSET AS topic_index
    WHERE
        topic_index = 0 -- Isolates the event signature hash (topics[0])
    GROUP BY
        1, 2, 3
)
-- Final Query: Selects the result ranked 1 (the most frequent event hash) for each contract/month.
SELECT
    COUNT(DISTINCT address) AS unique_erc20_contracts_exceeding_1k,
    ARRAY_AGG(
        STRUCT(t1.address, t1.transaction_month, t1.topic AS most_frequent_signature_hash) 
        ORDER BY t1.address, t1.transaction_month
    ) AS details_by_contract_and_month
FROM FrequentTopics AS t1
WHERE t1.topic_rank = 1'
+ echo ==================================================
==================================================
+ echo 'Executing ERC20 Unoptimized'
Executing ERC20 Unoptimized
+ echo ==================================================
==================================================
+ echo Query:
Query:
+ echo 'WITH ERC20_Contracts AS (
    -- CTE 1: Filters the small '\''contracts'\'' dimension table once to identify ERC20s.
    SELECT address 
    FROM `bigquery-public-data.crypto_ethereum_classic.contracts` 
    WHERE is_erc20 = TRUE
),
MonthlyLogCounts AS (
    -- CTE 2: Filters early and aggregates the massive '\''logs'\'' table to find high-activity contracts (> 1,000 logs/month).
    SELECT
        t1.address,
        FORMAT_DATE('\''%Y-%m'\'', t1.block_timestamp) AS transaction_month, 
        COUNT(t1.log_index) AS log_event_count 
    FROM
        `bigquery-public-data.crypto_ethereum_classic.logs` AS t1
    INNER JOIN
        ERC20_Contracts AS t2 ON t1.address = t2.address
    GROUP BY
        1, 2
    HAVING
        log_event_count > 1000
),
FrequentTopics AS (
    -- CTE 3: Joins the already filtered, small result from CTE 2 back to the '\''logs'\'' table
    -- only for the relevant contracts/months to find the topic frequency (event signature).
    SELECT
        t1.address,
        t1.transaction_month,
        topic,
        -- Applies a rank over the small, relevant subset of data.
        ROW_NUMBER() OVER (PARTITION BY t1.address, t1.transaction_month ORDER BY COUNT(topic) DESC) AS topic_rank
    FROM
        MonthlyLogCounts AS t1
    INNER JOIN
        `bigquery-public-data.crypto_ethereum_classic.logs` AS t2 
        ON t1.address = t2.address AND FORMAT_DATE('\''%Y-%m'\'', t2.block_timestamp) = t1.transaction_month
    CROSS JOIN
        UNNEST(t2.topics) AS topic WITH OFFSET AS topic_index
    WHERE
        topic_index = 0 -- Isolates the event signature hash (topics[0])
    GROUP BY
        1, 2, 3
)
-- Final Query: Selects the result ranked 1 (the most frequent event hash) for each contract/month.
SELECT
    COUNT(DISTINCT address) AS unique_erc20_contracts_exceeding_1k,
    ARRAY_AGG(
        STRUCT(t1.address, t1.transaction_month, t1.topic AS most_frequent_signature_hash) 
        ORDER BY t1.address, t1.transaction_month
    ) AS details_by_contract_and_month
FROM FrequentTopics AS t1
WHERE t1.topic_rank = 1'
WITH ERC20_Contracts AS (
    -- CTE 1: Filters the small 'contracts' dimension table once to identify ERC20s.
    SELECT address 
    FROM `bigquery-public-data.crypto_ethereum_classic.contracts` 
    WHERE is_erc20 = TRUE
),
MonthlyLogCounts AS (
    -- CTE 2: Filters early and aggregates the massive 'logs' table to find high-activity contracts (> 1,000 logs/month).
    SELECT
        t1.address,
        FORMAT_DATE('%Y-%m', t1.block_timestamp) AS transaction_month, 
        COUNT(t1.log_index) AS log_event_count 
    FROM
        `bigquery-public-data.crypto_ethereum_classic.logs` AS t1
    INNER JOIN
        ERC20_Contracts AS t2 ON t1.address = t2.address
    GROUP BY
        1, 2
    HAVING
        log_event_count > 1000
),
FrequentTopics AS (
    -- CTE 3: Joins the already filtered, small result from CTE 2 back to the 'logs' table
    -- only for the relevant contracts/months to find the topic frequency (event signature).
    SELECT
        t1.address,
        t1.transaction_month,
        topic,
        -- Applies a rank over the small, relevant subset of data.
        ROW_NUMBER() OVER (PARTITION BY t1.address, t1.transaction_month ORDER BY COUNT(topic) DESC) AS topic_rank
    FROM
        MonthlyLogCounts AS t1
    INNER JOIN
        `bigquery-public-data.crypto_ethereum_classic.logs` AS t2 
        ON t1.address = t2.address AND FORMAT_DATE('%Y-%m', t2.block_timestamp) = t1.transaction_month
    CROSS JOIN
        UNNEST(t2.topics) AS topic WITH OFFSET AS topic_index
    WHERE
        topic_index = 0 -- Isolates the event signature hash (topics[0])
    GROUP BY
        1, 2, 3
)
-- Final Query: Selects the result ranked 1 (the most frequent event hash) for each contract/month.
SELECT
    COUNT(DISTINCT address) AS unique_erc20_contracts_exceeding_1k,
    ARRAY_AGG(
        STRUCT(t1.address, t1.transaction_month, t1.topic AS most_frequent_signature_hash) 
        ORDER BY t1.address, t1.transaction_month
    ) AS details_by_contract_and_month
FROM FrequentTopics AS t1
WHERE t1.topic_rank = 1
+ echo --------------------------------------------------
--------------------------------------------------
++ bq query --nouse_cache --nosync --use_legacy_sql=false --format=json --location=US 'WITH ERC20_Contracts AS (
    -- CTE 1: Filters the small '\''contracts'\'' dimension table once to identify ERC20s.
    SELECT address 
    FROM `bigquery-public-data.crypto_ethereum_classic.contracts` 
    WHERE is_erc20 = TRUE
),
MonthlyLogCounts AS (
    -- CTE 2: Filters early and aggregates the massive '\''logs'\'' table to find high-activity contracts (> 1,000 logs/month).
    SELECT
        t1.address,
        FORMAT_DATE('\''%Y-%m'\'', t1.block_timestamp) AS transaction_month, 
        COUNT(t1.log_index) AS log_event_count 
    FROM
        `bigquery-public-data.crypto_ethereum_classic.logs` AS t1
    INNER JOIN
        ERC20_Contracts AS t2 ON t1.address = t2.address
    GROUP BY
        1, 2
    HAVING
        log_event_count > 1000
),
FrequentTopics AS (
    -- CTE 3: Joins the already filtered, small result from CTE 2 back to the '\''logs'\'' table
    -- only for the relevant contracts/months to find the topic frequency (event signature).
    SELECT
        t1.address,
        t1.transaction_month,
        topic,
        -- Applies a rank over the small, relevant subset of data.
        ROW_NUMBER() OVER (PARTITION BY t1.address, t1.transaction_month ORDER BY COUNT(topic) DESC) AS topic_rank
    FROM
        MonthlyLogCounts AS t1
    INNER JOIN
        `bigquery-public-data.crypto_ethereum_classic.logs` AS t2 
        ON t1.address = t2.address AND FORMAT_DATE('\''%Y-%m'\'', t2.block_timestamp) = t1.transaction_month
    CROSS JOIN
        UNNEST(t2.topics) AS topic WITH OFFSET AS topic_index
    WHERE
        topic_index = 0 -- Isolates the event signature hash (topics[0])
    GROUP BY
        1, 2, 3
)
-- Final Query: Selects the result ranked 1 (the most frequent event hash) for each contract/month.
SELECT
    COUNT(DISTINCT address) AS unique_erc20_contracts_exceeding_1k,
    ARRAY_AGG(
        STRUCT(t1.address, t1.transaction_month, t1.topic AS most_frequent_signature_hash) 
        ORDER BY t1.address, t1.transaction_month
    ) AS details_by_contract_and_month
FROM FrequentTopics AS t1
WHERE t1.topic_rank = 1'
+ job_submission_output='{"kind":"bigquery#job","etag":"4JxqtflCdS71mkVLreQAhQ==","id":"tony-allen:US.bqjob_r26d6267f686cc7b0_0000019a5ebfbe83_1","selfLink":"https://bigquery.googleapis.com/bigquery/v2/projects/tony-allen/jobs/bqjob_r26d6267f686cc7b0_0000019a5ebfbe83_1?location=US","user_email":"admin@bentrollope.altostrat.com","configuration":{"query":{"query":"WITH ERC20_Contracts AS (\n    -- CTE 1: Filters the small '\''contracts'\'' dimension table once to identify ERC20s.\n    SELECT address \n    FROM `bigquery-public-data.crypto_ethereum_classic.contracts` \n    WHERE is_erc20 = TRUE\n),\nMonthlyLogCounts AS (\n    -- CTE 2: Filters early and aggregates the massive '\''logs'\'' table to find high-activity contracts (> 1,000 logs/month).\n    SELECT\n        t1.address,\n        FORMAT_DATE('\''%Y-%m'\'', t1.block_timestamp) AS transaction_month, \n        COUNT(t1.log_index) AS log_event_count \n    FROM\n        `bigquery-public-data.crypto_ethereum_classic.logs` AS t1\n    INNER JOIN\n        ERC20_Contracts AS t2 ON t1.address = t2.address\n    GROUP BY\n        1, 2\n    HAVING\n        log_event_count > 1000\n),\nFrequentTopics AS (\n    -- CTE 3: Joins the already filtered, small result from CTE 2 back to the '\''logs'\'' table\n    -- only for the relevant contracts/months to find the topic frequency (event signature).\n    SELECT\n        t1.address,\n        t1.transaction_month,\n        topic,\n        -- Applies a rank over the small, relevant subset of data.\n        ROW_NUMBER() OVER (PARTITION BY t1.address, t1.transaction_month ORDER BY COUNT(topic) DESC) AS topic_rank\n    FROM\n        MonthlyLogCounts AS t1\n    INNER JOIN\n        `bigquery-public-data.crypto_ethereum_classic.logs` AS t2 \n        ON t1.address = t2.address AND FORMAT_DATE('\''%Y-%m'\'', t2.block_timestamp) = t1.transaction_month\n    CROSS JOIN\n        UNNEST(t2.topics) AS topic WITH OFFSET AS topic_index\n    WHERE\n        topic_index = 0 -- Isolates the event signature hash (topics[0])\n    GROUP BY\n        1, 2, 3\n)\n-- Final Query: Selects the result ranked 1 (the most frequent event hash) for each contract/month.\nSELECT\n    COUNT(DISTINCT address) AS unique_erc20_contracts_exceeding_1k,\n    ARRAY_AGG(\n        STRUCT(t1.address, t1.transaction_month, t1.topic AS most_frequent_signature_hash) \n        ORDER BY t1.address, t1.transaction_month\n    ) AS details_by_contract_and_month\nFROM FrequentTopics AS t1\nWHERE t1.topic_rank = 1","destinationTable":{"projectId":"tony-allen","datasetId":"_e34c49c766e4fd3f5d404c3949b9e19fa7acb372","tableId":"anond8998faa_8517_47a1_985b_969fb42cc254"},"writeDisposition":"WRITE_TRUNCATE","priority":"INTERACTIVE","useQueryCache":false,"useLegacySql":false},"jobType":"QUERY"},"jobReference":{"projectId":"tony-allen","jobId":"bqjob_r26d6267f686cc7b0_0000019a5ebfbe83_1","location":"US"},"statistics":{"creationTime":"1762526216058","startTime":"1762526216186","query":{"statementType":"SELECT","searchStatistics":{"indexUnusedReasons":[{"code":"INDEX_CONFIG_NOT_AVAILABLE","message":"There is no index configuration for the base table `bigquery-public-data:crypto_ethereum_classic.contracts`.","baseTable":{"projectId":"bigquery-public-data","datasetId":"crypto_ethereum_classic","tableId":"contracts"}},{"code":"INDEX_CONFIG_NOT_AVAILABLE","message":"There is no index configuration for the base table `bigquery-public-data:crypto_ethereum_classic.logs`.","baseTable":{"projectId":"bigquery-public-data","datasetId":"crypto_ethereum_classic","tableId":"logs"}}]}}},"status":{"state":"RUNNING"},"principal_subject":"user:admin@bentrollope.altostrat.com","jobCreationReason":{"code":"REQUESTED"}}'
++ echo '{"kind":"bigquery#job","etag":"4JxqtflCdS71mkVLreQAhQ==","id":"tony-allen:US.bqjob_r26d6267f686cc7b0_0000019a5ebfbe83_1","selfLink":"https://bigquery.googleapis.com/bigquery/v2/projects/tony-allen/jobs/bqjob_r26d6267f686cc7b0_0000019a5ebfbe83_1?location=US","user_email":"admin@bentrollope.altostrat.com","configuration":{"query":{"query":"WITH ERC20_Contracts AS (\n    -- CTE 1: Filters the small '\''contracts'\'' dimension table once to identify ERC20s.\n    SELECT address \n    FROM `bigquery-public-data.crypto_ethereum_classic.contracts` \n    WHERE is_erc20 = TRUE\n),\nMonthlyLogCounts AS (\n    -- CTE 2: Filters early and aggregates the massive '\''logs'\'' table to find high-activity contracts (> 1,000 logs/month).\n    SELECT\n        t1.address,\n        FORMAT_DATE('\''%Y-%m'\'', t1.block_timestamp) AS transaction_month, \n        COUNT(t1.log_index) AS log_event_count \n    FROM\n        `bigquery-public-data.crypto_ethereum_classic.logs` AS t1\n    INNER JOIN\n        ERC20_Contracts AS t2 ON t1.address = t2.address\n    GROUP BY\n        1, 2\n    HAVING\n        log_event_count > 1000\n),\nFrequentTopics AS (\n    -- CTE 3: Joins the already filtered, small result from CTE 2 back to the '\''logs'\'' table\n    -- only for the relevant contracts/months to find the topic frequency (event signature).\n    SELECT\n        t1.address,\n        t1.transaction_month,\n        topic,\n        -- Applies a rank over the small, relevant subset of data.\n        ROW_NUMBER() OVER (PARTITION BY t1.address, t1.transaction_month ORDER BY COUNT(topic) DESC) AS topic_rank\n    FROM\n        MonthlyLogCounts AS t1\n    INNER JOIN\n        `bigquery-public-data.crypto_ethereum_classic.logs` AS t2 \n        ON t1.address = t2.address AND FORMAT_DATE('\''%Y-%m'\'', t2.block_timestamp) = t1.transaction_month\n    CROSS JOIN\n        UNNEST(t2.topics) AS topic WITH OFFSET AS topic_index\n    WHERE\n        topic_index = 0 -- Isolates the event signature hash (topics[0])\n    GROUP BY\n        1, 2, 3\n)\n-- Final Query: Selects the result ranked 1 (the most frequent event hash) for each contract/month.\nSELECT\n    COUNT(DISTINCT address) AS unique_erc20_contracts_exceeding_1k,\n    ARRAY_AGG(\n        STRUCT(t1.address, t1.transaction_month, t1.topic AS most_frequent_signature_hash) \n        ORDER BY t1.address, t1.transaction_month\n    ) AS details_by_contract_and_month\nFROM FrequentTopics AS t1\nWHERE t1.topic_rank = 1","destinationTable":{"projectId":"tony-allen","datasetId":"_e34c49c766e4fd3f5d404c3949b9e19fa7acb372","tableId":"anond8998faa_8517_47a1_985b_969fb42cc254"},"writeDisposition":"WRITE_TRUNCATE","priority":"INTERACTIVE","useQueryCache":false,"useLegacySql":false},"jobType":"QUERY"},"jobReference":{"projectId":"tony-allen","jobId":"bqjob_r26d6267f686cc7b0_0000019a5ebfbe83_1","location":"US"},"statistics":{"creationTime":"1762526216058","startTime":"1762526216186","query":{"statementType":"SELECT","searchStatistics":{"indexUnusedReasons":[{"code":"INDEX_CONFIG_NOT_AVAILABLE","message":"There is no index configuration for the base table `bigquery-public-data:crypto_ethereum_classic.contracts`.","baseTable":{"projectId":"bigquery-public-data","datasetId":"crypto_ethereum_classic","tableId":"contracts"}},{"code":"INDEX_CONFIG_NOT_AVAILABLE","message":"There is no index configuration for the base table `bigquery-public-data:crypto_ethereum_classic.logs`.","baseTable":{"projectId":"bigquery-public-data","datasetId":"crypto_ethereum_classic","tableId":"logs"}}]}}},"status":{"state":"RUNNING"},"principal_subject":"user:admin@bentrollope.altostrat.com","jobCreationReason":{"code":"REQUESTED"}}'
++ jq -r .jobReference.jobId
+ job_id=bqjob_r26d6267f686cc7b0_0000019a5ebfbe83_1
+ '[' -n bqjob_r26d6267f686cc7b0_0000019a5ebfbe83_1 ']'
+ echo '  [SUCCESS] Query submitted.'
  [SUCCESS] Query submitted.
+ echo '  *** JOB ID FOR ERC20 Unoptimized: bqjob_r26d6267f686cc7b0_0000019a5ebfbe83_1 ***'
  *** JOB ID FOR ERC20 Unoptimized: bqjob_r26d6267f686cc7b0_0000019a5ebfbe83_1 ***
+ echo '  Waiting for job to complete...'
  Waiting for job to complete...
++ bq wait bqjob_r26d6267f686cc7b0_0000019a5ebfbe83_1
+ wait_output='Waiting on bqjob_r26d6267f686cc7b0_0000019a5ebfbe83_1 ... (0s) Current status: RUNNING                                                                                      Waiting on bqjob_r26d6267f686cc7b0_0000019a5ebfbe83_1 ... (0s) Current status: DONE   
Job tony-allen:bqjob_r26d6267f686cc7b0_0000019a5ebfbe83_1

  Job Type    State      Start Time         Duration                User Email              Bytes Processed   Bytes Billed   Billing Tier   Labels  
 ---------- --------- ----------------- ---------------- --------------------------------- ----------------- -------------- -------------- -------- 
  query      SUCCESS   07 Nov 14:36:56   0:00:04.875000   admin@bentrollope.altostrat.com   5555133989        5555355648     1                      '
+ '[' 0 -ne 0 ']'
+ echo '  Job completed. Fetching statistics...'
  Job completed. Fetching statistics...
++ bq show --format=json -j bqjob_r26d6267f686cc7b0_0000019a5ebfbe83_1
+ job_stats_json='{"kind":"bigquery#job","etag":"N6qAcrApAKrSYs0CXgKNkg==","id":"tony-allen:US.bqjob_r26d6267f686cc7b0_0000019a5ebfbe83_1","selfLink":"https://bigquery.googleapis.com/bigquery/v2/projects/tony-allen/jobs/bqjob_r26d6267f686cc7b0_0000019a5ebfbe83_1?location=US","user_email":"admin@bentrollope.altostrat.com","configuration":{"query":{"query":"WITH ERC20_Contracts AS (\n    -- CTE 1: Filters the small '\''contracts'\'' dimension table once to identify ERC20s.\n    SELECT address \n    FROM `bigquery-public-data.crypto_ethereum_classic.contracts` \n    WHERE is_erc20 = TRUE\n),\nMonthlyLogCounts AS (\n    -- CTE 2: Filters early and aggregates the massive '\''logs'\'' table to find high-activity contracts (> 1,000 logs/month).\n    SELECT\n        t1.address,\n        FORMAT_DATE('\''%Y-%m'\'', t1.block_timestamp) AS transaction_month, \n        COUNT(t1.log_index) AS log_event_count \n    FROM\n        `bigquery-public-data.crypto_ethereum_classic.logs` AS t1\n    INNER JOIN\n        ERC20_Contracts AS t2 ON t1.address = t2.address\n    GROUP BY\n        1, 2\n    HAVING\n        log_event_count > 1000\n),\nFrequentTopics AS (\n    -- CTE 3: Joins the already filtered, small result from CTE 2 back to the '\''logs'\'' table\n    -- only for the relevant contracts/months to find the topic frequency (event signature).\n    SELECT\n        t1.address,\n        t1.transaction_month,\n        topic,\n        -- Applies a rank over the small, relevant subset of data.\n        ROW_NUMBER() OVER (PARTITION BY t1.address, t1.transaction_month ORDER BY COUNT(topic) DESC) AS topic_rank\n    FROM\n        MonthlyLogCounts AS t1\n    INNER JOIN\n        `bigquery-public-data.crypto_ethereum_classic.logs` AS t2 \n        ON t1.address = t2.address AND FORMAT_DATE('\''%Y-%m'\'', t2.block_timestamp) = t1.transaction_month\n    CROSS JOIN\n        UNNEST(t2.topics) AS topic WITH OFFSET AS topic_index\n    WHERE\n        topic_index = 0 -- Isolates the event signature hash (topics[0])\n    GROUP BY\n        1, 2, 3\n)\n-- Final Query: Selects the result ranked 1 (the most frequent event hash) for each contract/month.\nSELECT\n    COUNT(DISTINCT address) AS unique_erc20_contracts_exceeding_1k,\n    ARRAY_AGG(\n        STRUCT(t1.address, t1.transaction_month, t1.topic AS most_frequent_signature_hash) \n        ORDER BY t1.address, t1.transaction_month\n    ) AS details_by_contract_and_month\nFROM FrequentTopics AS t1\nWHERE t1.topic_rank = 1","destinationTable":{"projectId":"tony-allen","datasetId":"_e34c49c766e4fd3f5d404c3949b9e19fa7acb372","tableId":"anond8998faa_8517_47a1_985b_969fb42cc254"},"writeDisposition":"WRITE_TRUNCATE","priority":"INTERACTIVE","useQueryCache":false,"useLegacySql":false},"jobType":"QUERY"},"jobReference":{"projectId":"tony-allen","jobId":"bqjob_r26d6267f686cc7b0_0000019a5ebfbe83_1","location":"US"},"statistics":{"creationTime":"1762526216058","startTime":"1762526216186","endTime":"1762526221061","totalBytesProcessed":"5555133989","query":{"queryPlan":[{"name":"S00: Input","id":"0","startMs":"1762526218462","endMs":"1762526218769","waitRatioAvg":0.5073529411764706,"waitMsAvg":"138","waitRatioMax":0.6360294117647058,"waitMsMax":"173","readRatioAvg":0.16176470588235295,"readMsAvg":"44","readRatioMax":0.8382352941176471,"readMsMax":"228","computeRatioAvg":0.04044117647058824,"computeMsAvg":"11","computeRatioMax":0.16544117647058823,"computeMsMax":"45","writeRatioAvg":0.011029411764705883,"writeMsAvg":"3","writeRatioMax":0.07352941176470588,"writeMsMax":"20","shuffleOutputBytes":"481938","shuffleOutputBytesSpilled":"0","recordsRead":"7724950","recordsWritten":"10254","parallelInputs":"1864","completedParallelInputs":"1864","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$20:address, $21:is_erc20","FROM bigquery-public-data.crypto_ethereum_classic.contracts","WHERE $21"]},{"kind":"WRITE","substeps":["$20","TO __stage00_output"]}],"slotMs":"43662","computeMode":"BIGQUERY"},{"name":"S02: Coalesce","id":"2","startMs":"1762526218861","endMs":"1762526218913","inputStages":["0"],"waitRatioAvg":0.2757352941176471,"waitMsAvg":"75","waitRatioMax":0.27941176470588236,"waitMsMax":"76","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.03676470588235294,"computeMsAvg":"10","computeRatioMax":0.0661764705882353,"computeMsMax":"18","writeRatioAvg":0.029411764705882353,"writeMsAvg":"8","writeRatioMax":0.07720588235294118,"writeMsMax":"21","shuffleOutputBytes":"481938","shuffleOutputBytesSpilled":"0","recordsRead":"10254","recordsWritten":"10254","parallelInputs":"100","completedParallelInputs":"100","status":"COMPLETE","steps":[{"kind":"READ","substeps":["FROM __stage00_output"]}],"slotMs":"6080","computeMode":"BIGQUERY"},{"name":"S03: Join+","id":"3","startMs":"1762526218864","endMs":"1762526219148","inputStages":["2"],"waitRatioAvg":0.4485294117647059,"waitMsAvg":"122","waitRatioMax":0.7683823529411765,"waitMsMax":"209","readRatioAvg":0.029411764705882353,"readMsAvg":"8","readRatioMax":0.26838235294117646,"readMsMax":"73","computeRatioAvg":0.06985294117647059,"computeMsAvg":"19","computeRatioMax":0.4117647058823529,"computeMsMax":"112","writeRatioAvg":0.029411764705882353,"writeMsAvg":"8","writeRatioMax":0.25,"writeMsMax":"68","shuffleOutputBytes":"614244","shuffleOutputBytesSpilled":"0","recordsRead":"31975135","recordsWritten":"9033","parallelInputs":"1934","completedParallelInputs":"1934","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$10:log_index, $11:address, $12:block_timestamp","FROM bigquery-public-data.crypto_ethereum_classic.logs"]},{"kind":"READ","substeps":["$20","FROM __stage02_output"]},{"kind":"AGGREGATE","substeps":["GROUP BY $290 := $281, $291 := $270","$260 := COUNT($280)"]},{"kind":"COMPUTE","substeps":["$270 := format_timestamp('\''%Y-%m'\'', $282)"]},{"kind":"JOIN","substeps":["$280 := $10, $281 := $11, $282 := $12","INNER HASH JOIN EACH  WITH ALL  ON $11 = $20"]},{"kind":"WRITE","substeps":["$290, $260, $291","TO __stage03_output","BY HASH($290, $291)"]}],"slotMs":"183199","computeMode":"BIGQUERY"},{"name":"S05: Aggregate+","id":"5","startMs":"1762526219260","endMs":"1762526219415","inputStages":["3"],"waitRatioAvg":0.45955882352941174,"waitMsAvg":"125","waitRatioMax":0.6580882352941176,"waitMsMax":"179","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.04779411764705882,"computeMsAvg":"13","computeRatioMax":0.09191176470588236,"computeMsMax":"25","writeRatioAvg":0.011029411764705883,"writeMsAvg":"3","writeRatioMax":0.05514705882352941,"writeMsMax":"15","shuffleOutputBytes":"4071","shuffleOutputBytesSpilled":"0","recordsRead":"9033","recordsWritten":"69","parallelInputs":"379","completedParallelInputs":"379","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$290, $260, $291","FROM __stage03_output"]},{"kind":"FILTER","substeps":["greater($250, 1000)"]},{"kind":"AGGREGATE","substeps":["GROUP BY $300 := $290, $301 := $291","$250 := SUM_OF_COUNTS($260)"]},{"kind":"WRITE","substeps":["$300, $301","TO __stage05_output"]}],"slotMs":"23381","computeMode":"BIGQUERY"},{"name":"S06: Coalesce","id":"6","startMs":"1762526219558","endMs":"1762526219620","inputStages":["5"],"waitRatioAvg":0.40808823529411764,"waitMsAvg":"111","waitRatioMax":0.4117647058823529,"waitMsMax":"112","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.03676470588235294,"computeMsAvg":"10","computeRatioMax":0.05514705882352941,"computeMsMax":"15","writeRatioAvg":0.051470588235294115,"writeMsAvg":"14","writeRatioMax":0.09926470588235294,"writeMsMax":"27","shuffleOutputBytes":"4071","shuffleOutputBytesSpilled":"0","recordsRead":"69","recordsWritten":"69","parallelInputs":"100","completedParallelInputs":"100","status":"COMPLETE","steps":[{"kind":"READ","substeps":["FROM __stage05_output"]}],"slotMs":"6270","computeMode":"BIGQUERY"},{"name":"S07: Join+","id":"7","startMs":"1762526219562","endMs":"1762526219766","inputStages":["6"],"waitRatioAvg":0.5808823529411765,"waitMsAvg":"158","waitRatioMax":0.875,"waitMsMax":"238","readRatioAvg":0.025735294117647058,"readMsAvg":"7","readRatioMax":0.33088235294117646,"readMsMax":"90","computeRatioAvg":0.08455882352941177,"computeMsAvg":"23","computeRatioMax":0.6029411764705882,"computeMsMax":"164","writeRatioAvg":0.011029411764705883,"writeMsAvg":"3","writeRatioMax":0.2610294117647059,"writeMsMax":"71","shuffleOutputBytes":"383362","shuffleOutputBytesSpilled":"0","recordsRead":"12277345","recordsWritten":"2758","parallelInputs":"1934","completedParallelInputs":"1934","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$1:address, $2:topics, $3:block_timestamp","FROM bigquery-public-data.crypto_ethereum_classic.logs"]},{"kind":"READ","substeps":["$300, $301","FROM __stage06_output"]},{"kind":"AGGREGATE","substeps":["GROUP BY $320 := $310, $321 := $311, $322 := $240","$210 := COUNT($240)"]},{"kind":"JOIN","substeps":["$312 := $2, $310 := $300, $311 := $301","INNER HASH JOIN EACH  WITH ALL  ON $1 = $300, $230 = $301"]},{"kind":"COMPUTE","substeps":["$230 := format_timestamp('\''%Y-%m'\'', $3)"]},{"kind":"FILTER","substeps":["equal($241, 0)"]},{"kind":"WRITE","substeps":["$320, $210, $322, $321","TO __stage07_output","BY HASH($320, $321, $322)"]}],"slotMs":"178560","computeMode":"BIGQUERY"},{"name":"S08: Aggregate","id":"8","startMs":"1762526219858","endMs":"1762526219923","inputStages":["7"],"waitRatioAvg":0.3014705882352941,"waitMsAvg":"82","waitRatioMax":0.3088235294117647,"waitMsMax":"84","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.051470588235294115,"computeMsAvg":"14","computeRatioMax":0.09191176470588236,"computeMsMax":"25","writeRatioAvg":0.025735294117647058,"writeMsAvg":"7","writeRatioMax":0.0661764705882353,"writeMsMax":"18","shuffleOutputBytes":"25298","shuffleOutputBytesSpilled":"0","recordsRead":"2758","recordsWritten":"182","parallelInputs":"231","completedParallelInputs":"231","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$320, $210, $322, $321","FROM __stage07_output"]},{"kind":"AGGREGATE","substeps":["GROUP BY $330 := $320, $331 := $321, $332 := $322","$190 := SUM_OF_COUNTS($210)"]},{"kind":"WRITE","substeps":["$330, $190, $332, $331","TO __stage08_output"]}],"slotMs":"16915","computeMode":"BIGQUERY"},{"name":"S09: Sort+","id":"9","startMs":"1762526220158","endMs":"1762526220212","inputStages":["8"],"waitRatioAvg":0.8308823529411765,"waitMsAvg":"226","waitRatioMax":0.8345588235294118,"waitMsMax":"227","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.04044117647058824,"computeMsAvg":"11","computeRatioMax":0.12867647058823528,"computeMsMax":"35","writeRatioAvg":0.03308823529411765,"writeMsAvg":"9","writeRatioMax":0.06985294117647059,"writeMsMax":"19","shuffleOutputBytes":"37582","shuffleOutputBytesSpilled":"0","recordsRead":"182","recordsWritten":"119","parallelInputs":"101","completedParallelInputs":"101","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$330, $190, $332, $331","FROM __stage08_output"]},{"kind":"READ","substeps":["$355","FROM __BROADCAST0"]},{"kind":"READ","substeps":["$200, $201, $202, $203","FROM __SHUFFLE3"]},{"kind":"AGGREGATE","substeps":["GROUP BY $380 := $140, $381 := $120","$110 := SHARD_ARRAY_AGG($124 ORDER BY $123 ASC, $122 ASC)","$111 := SHARD_ARRAY_AGG($121 ORDER BY $123 ASC, $122 ASC)","$112 := SHARD_ARRAY_AGG($122 ORDER BY $123 ASC, $122 ASC)","$113 := SHARD_ARRAY_AGG($123 ORDER BY $123 ASC, $122 ASC)"]},{"kind":"COMPUTE","substeps":["$120 := if(equal($140, 1), $160, NULL)","$121 := if(equal($140, 0), $162, NULL)","$122 := if(equal($140, 0), $163, NULL)","$123 := if(equal($140, 0), $160, NULL)","$124 := if(equal($140, 0), 1, NULL)"]},{"kind":"COMPUTE","substeps":["$130 := ARRAY<...>"]},{"kind":"FILTER","substeps":["equal($161, 1)"]},{"kind":"ANALYTIC_FUNCTION","substeps":["$170 := ROW_NUMBER() OVER (PARTITION BY $340, $343 ORDER BY $341 DESC)"]},{"kind":"SORT","substeps":["$220 ASC, $223 ASC, $221 DESC"]},{"kind":"ANALYTIC_FUNCTION","substeps":["$180 := ROW_NUMBER($355) OVER (PARTITION BY $360, $363 ORDER BY $361 DESC)"]},{"kind":"SORT","substeps":["$200 ASC, $203 ASC, $201 DESC"]},{"kind":"WRITE","substeps":["$110, $111, $112, $113, $381, $380","TO __stage09_output","BY HASH($380, $381)"]}],"slotMs":"6785","computeMode":"BIGQUERY"},{"name":"S0A: Aggregate+","id":"10","startMs":"1762526220459","endMs":"1762526220492","inputStages":["9"],"waitRatioAvg":0.8713235294117647,"waitMsAvg":"237","waitRatioMax":0.8713235294117647,"waitMsMax":"237","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.04411764705882353,"computeMsAvg":"12","computeRatioMax":0.0661764705882353,"computeMsMax":"18","writeRatioAvg":0.04411764705882353,"writeMsAvg":"12","writeRatioMax":0.0661764705882353,"writeMsMax":"18","shuffleOutputBytes":"9382","shuffleOutputBytesSpilled":"0","recordsRead":"119","recordsWritten":"11","parallelInputs":"10","completedParallelInputs":"10","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$110, $111, $112, $113, $381, $380","FROM __stage09_output"]},{"kind":"AGGREGATE","substeps":["GROUP BY $400 := $390","$80 := COUNT($94)","$81 := ANY_VALUE($93)","$82 := ANY_VALUE($92)","$83 := ANY_VALUE($91)","$84 := ANY_VALUE($90)"]},{"kind":"COMPUTE","substeps":["$90 := if(equal($390, 0), $103, NULL)","$91 := if(equal($390, 0), $102, NULL)","$92 := if(equal($390, 0), $101, NULL)","$93 := if(equal($390, 0), $100, NULL)","$94 := if(equal($390, 1), $391, NULL)"]},{"kind":"AGGREGATE","substeps":["GROUP BY $390 := $380, $391 := $381","$100 := ROOT_ARRAY_AGG($110 ORDER BY  ASC,  ASC)","$101 := ROOT_ARRAY_AGG($111 ORDER BY  ASC,  ASC)","$102 := ROOT_ARRAY_AGG($112 ORDER BY  ASC,  ASC)","$103 := ROOT_ARRAY_AGG($113 ORDER BY  ASC,  ASC)"]},{"kind":"WRITE","substeps":["$80, $81, $82, $83, $84, $400","TO __stage0A_output","BY HASH($400)"]}],"slotMs":"455","computeMode":"BIGQUERY"},{"name":"S0B: Aggregate+","id":"11","startMs":"1762526220763","endMs":"1762526220797","inputStages":["10"],"waitRatioAvg":0.9926470588235294,"waitMsAvg":"270","waitRatioMax":0.9926470588235294,"waitMsMax":"270","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.022058823529411766,"computeMsAvg":"6","computeRatioMax":0.022058823529411766,"computeMsMax":"6","writeRatioAvg":0.058823529411764705,"writeMsAvg":"16","writeRatioMax":0.058823529411764705,"writeMsMax":"16","shuffleOutputBytes":"9153","shuffleOutputBytesSpilled":"0","recordsRead":"11","recordsWritten":"1","parallelInputs":"1","completedParallelInputs":"1","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$80, $81, $82, $83, $84, $400","FROM __stage0A_output"]},{"kind":"AGGREGATE","substeps":["$50 := ANY_VALUE($64)","$51 := ANY_VALUE($63)","$52 := ANY_VALUE($62)","$53 := ANY_VALUE($61)","$54 := ANY_VALUE($60)"]},{"kind":"COMPUTE","substeps":["$60 := if(equal($410, 0), $74, NULL)","$61 := if(equal($410, 0), $73, NULL)","$62 := if(equal($410, 0), $72, NULL)","$63 := if(equal($410, 0), $71, NULL)","$64 := if(equal($410, 1), $70, NULL)"]},{"kind":"AGGREGATE","substeps":["GROUP BY $410 := $400","$70 := SUM_OF_COUNTS($80)","$71 := ANY_VALUE($81)","$72 := ANY_VALUE($82)","$73 := ANY_VALUE($83)","$74 := ANY_VALUE($84)"]},{"kind":"WRITE","substeps":["$50, $51, $52, $53, $54","TO __stage0B_output"]}],"slotMs":"70","computeMode":"BIGQUERY"},{"name":"S0C: Output","id":"12","startMs":"1762526220773","endMs":"1762526220814","inputStages":["11"],"waitRatioAvg":1,"waitMsAvg":"272","waitRatioMax":1,"waitMsMax":"272","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.0625,"computeMsAvg":"17","computeRatioMax":0.0625,"computeMsMax":"17","writeRatioAvg":0.05514705882352941,"writeMsAvg":"15","writeRatioMax":0.05514705882352941,"writeMsMax":"15","shuffleOutputBytes":"9884","shuffleOutputBytesSpilled":"0","recordsRead":"1","recordsWritten":"1","parallelInputs":"1","completedParallelInputs":"1","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$50, $51, $52, $53, $54","FROM __stage0B_output"]},{"kind":"COMPUTE","substeps":["$30 := MAKE_STRUCT($44, $43, $42, $41)","$31 := if(is_null($40), 0, $40)"]},{"kind":"AGGREGATE","substeps":["$40 := ANY_VALUE($50)","$41 := ANY_VALUE($51)","$42 := ANY_VALUE($52)","$43 := ANY_VALUE($53)","$44 := ANY_VALUE($54)"]},{"kind":"WRITE","substeps":["$30, $31","TO __stage0C_output"]}],"slotMs":"66","computeMode":"BIGQUERY"}],"estimatedBytesProcessed":"5555133989","timeline":[{"elapsedMs":"1814","totalSlotMs":"764250","pendingUnits":"0","completedUnits":"0","activeUnits":"0"},{"elapsedMs":"2814","totalSlotMs":"764250","pendingUnits":"1831","completedUnits":"2067","activeUnits":"987","estimatedRunnableUnits":"1000"},{"elapsedMs":"4635","totalSlotMs":"764250","pendingUnits":"0","completedUnits":"6655","activeUnits":"0","estimatedRunnableUnits":"10"}],"totalPartitionsProcessed":"3798","totalBytesProcessed":"5555133989","totalBytesBilled":"5555355648","billingTier":1,"totalSlotMs":"764250","cacheHit":false,"referencedTables":[{"projectId":"bigquery-public-data","datasetId":"crypto_ethereum_classic","tableId":"logs"},{"projectId":"bigquery-public-data","datasetId":"crypto_ethereum_classic","tableId":"contracts"}],"statementType":"SELECT","searchStatistics":{"indexUsageMode":"UNUSED","indexUnusedReasons":[{"code":"INDEX_CONFIG_NOT_AVAILABLE","message":"There is no index configuration for the base table `bigquery-public-data:crypto_ethereum_classic.contracts`.","baseTable":{"projectId":"bigquery-public-data","datasetId":"crypto_ethereum_classic","tableId":"contracts"}},{"code":"INDEX_CONFIG_NOT_AVAILABLE","message":"There is no index configuration for the base table `bigquery-public-data:crypto_ethereum_classic.logs`.","baseTable":{"projectId":"bigquery-public-data","datasetId":"crypto_ethereum_classic","tableId":"logs"}}]},"performanceInsights":{"avgPreviousExecutionMs":"2934"},"transferredBytes":"0","metadataCacheStatistics":{"tableMetadataCacheUsage":[{"tableReference":{"projectId":"bigquery-public-data","datasetId":"crypto_ethereum_classic","tableId":"logs"},"unusedReason":"OTHER_REASON"},{"tableReference":{"projectId":"bigquery-public-data","datasetId":"crypto_ethereum_classic","tableId":"contracts"},"unusedReason":"OTHER_REASON"}]}},"totalSlotMs":"764250","finalExecutionDurationMs":"2531"},"status":{"state":"DONE"},"principal_subject":"user:admin@bentrollope.altostrat.com","jobCreationReason":{"code":"REQUESTED"}}'
++ jq -r .statistics.totalBytesProcessed
++ echo '{"kind":"bigquery#job","etag":"N6qAcrApAKrSYs0CXgKNkg==","id":"tony-allen:US.bqjob_r26d6267f686cc7b0_0000019a5ebfbe83_1","selfLink":"https://bigquery.googleapis.com/bigquery/v2/projects/tony-allen/jobs/bqjob_r26d6267f686cc7b0_0000019a5ebfbe83_1?location=US","user_email":"admin@bentrollope.altostrat.com","configuration":{"query":{"query":"WITH ERC20_Contracts AS (\n    -- CTE 1: Filters the small '\''contracts'\'' dimension table once to identify ERC20s.\n    SELECT address \n    FROM `bigquery-public-data.crypto_ethereum_classic.contracts` \n    WHERE is_erc20 = TRUE\n),\nMonthlyLogCounts AS (\n    -- CTE 2: Filters early and aggregates the massive '\''logs'\'' table to find high-activity contracts (> 1,000 logs/month).\n    SELECT\n        t1.address,\n        FORMAT_DATE('\''%Y-%m'\'', t1.block_timestamp) AS transaction_month, \n        COUNT(t1.log_index) AS log_event_count \n    FROM\n        `bigquery-public-data.crypto_ethereum_classic.logs` AS t1\n    INNER JOIN\n        ERC20_Contracts AS t2 ON t1.address = t2.address\n    GROUP BY\n        1, 2\n    HAVING\n        log_event_count > 1000\n),\nFrequentTopics AS (\n    -- CTE 3: Joins the already filtered, small result from CTE 2 back to the '\''logs'\'' table\n    -- only for the relevant contracts/months to find the topic frequency (event signature).\n    SELECT\n        t1.address,\n        t1.transaction_month,\n        topic,\n        -- Applies a rank over the small, relevant subset of data.\n        ROW_NUMBER() OVER (PARTITION BY t1.address, t1.transaction_month ORDER BY COUNT(topic) DESC) AS topic_rank\n    FROM\n        MonthlyLogCounts AS t1\n    INNER JOIN\n        `bigquery-public-data.crypto_ethereum_classic.logs` AS t2 \n        ON t1.address = t2.address AND FORMAT_DATE('\''%Y-%m'\'', t2.block_timestamp) = t1.transaction_month\n    CROSS JOIN\n        UNNEST(t2.topics) AS topic WITH OFFSET AS topic_index\n    WHERE\n        topic_index = 0 -- Isolates the event signature hash (topics[0])\n    GROUP BY\n        1, 2, 3\n)\n-- Final Query: Selects the result ranked 1 (the most frequent event hash) for each contract/month.\nSELECT\n    COUNT(DISTINCT address) AS unique_erc20_contracts_exceeding_1k,\n    ARRAY_AGG(\n        STRUCT(t1.address, t1.transaction_month, t1.topic AS most_frequent_signature_hash) \n        ORDER BY t1.address, t1.transaction_month\n    ) AS details_by_contract_and_month\nFROM FrequentTopics AS t1\nWHERE t1.topic_rank = 1","destinationTable":{"projectId":"tony-allen","datasetId":"_e34c49c766e4fd3f5d404c3949b9e19fa7acb372","tableId":"anond8998faa_8517_47a1_985b_969fb42cc254"},"writeDisposition":"WRITE_TRUNCATE","priority":"INTERACTIVE","useQueryCache":false,"useLegacySql":false},"jobType":"QUERY"},"jobReference":{"projectId":"tony-allen","jobId":"bqjob_r26d6267f686cc7b0_0000019a5ebfbe83_1","location":"US"},"statistics":{"creationTime":"1762526216058","startTime":"1762526216186","endTime":"1762526221061","totalBytesProcessed":"5555133989","query":{"queryPlan":[{"name":"S00: Input","id":"0","startMs":"1762526218462","endMs":"1762526218769","waitRatioAvg":0.5073529411764706,"waitMsAvg":"138","waitRatioMax":0.6360294117647058,"waitMsMax":"173","readRatioAvg":0.16176470588235295,"readMsAvg":"44","readRatioMax":0.8382352941176471,"readMsMax":"228","computeRatioAvg":0.04044117647058824,"computeMsAvg":"11","computeRatioMax":0.16544117647058823,"computeMsMax":"45","writeRatioAvg":0.011029411764705883,"writeMsAvg":"3","writeRatioMax":0.07352941176470588,"writeMsMax":"20","shuffleOutputBytes":"481938","shuffleOutputBytesSpilled":"0","recordsRead":"7724950","recordsWritten":"10254","parallelInputs":"1864","completedParallelInputs":"1864","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$20:address, $21:is_erc20","FROM bigquery-public-data.crypto_ethereum_classic.contracts","WHERE $21"]},{"kind":"WRITE","substeps":["$20","TO __stage00_output"]}],"slotMs":"43662","computeMode":"BIGQUERY"},{"name":"S02: Coalesce","id":"2","startMs":"1762526218861","endMs":"1762526218913","inputStages":["0"],"waitRatioAvg":0.2757352941176471,"waitMsAvg":"75","waitRatioMax":0.27941176470588236,"waitMsMax":"76","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.03676470588235294,"computeMsAvg":"10","computeRatioMax":0.0661764705882353,"computeMsMax":"18","writeRatioAvg":0.029411764705882353,"writeMsAvg":"8","writeRatioMax":0.07720588235294118,"writeMsMax":"21","shuffleOutputBytes":"481938","shuffleOutputBytesSpilled":"0","recordsRead":"10254","recordsWritten":"10254","parallelInputs":"100","completedParallelInputs":"100","status":"COMPLETE","steps":[{"kind":"READ","substeps":["FROM __stage00_output"]}],"slotMs":"6080","computeMode":"BIGQUERY"},{"name":"S03: Join+","id":"3","startMs":"1762526218864","endMs":"1762526219148","inputStages":["2"],"waitRatioAvg":0.4485294117647059,"waitMsAvg":"122","waitRatioMax":0.7683823529411765,"waitMsMax":"209","readRatioAvg":0.029411764705882353,"readMsAvg":"8","readRatioMax":0.26838235294117646,"readMsMax":"73","computeRatioAvg":0.06985294117647059,"computeMsAvg":"19","computeRatioMax":0.4117647058823529,"computeMsMax":"112","writeRatioAvg":0.029411764705882353,"writeMsAvg":"8","writeRatioMax":0.25,"writeMsMax":"68","shuffleOutputBytes":"614244","shuffleOutputBytesSpilled":"0","recordsRead":"31975135","recordsWritten":"9033","parallelInputs":"1934","completedParallelInputs":"1934","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$10:log_index, $11:address, $12:block_timestamp","FROM bigquery-public-data.crypto_ethereum_classic.logs"]},{"kind":"READ","substeps":["$20","FROM __stage02_output"]},{"kind":"AGGREGATE","substeps":["GROUP BY $290 := $281, $291 := $270","$260 := COUNT($280)"]},{"kind":"COMPUTE","substeps":["$270 := format_timestamp('\''%Y-%m'\'', $282)"]},{"kind":"JOIN","substeps":["$280 := $10, $281 := $11, $282 := $12","INNER HASH JOIN EACH  WITH ALL  ON $11 = $20"]},{"kind":"WRITE","substeps":["$290, $260, $291","TO __stage03_output","BY HASH($290, $291)"]}],"slotMs":"183199","computeMode":"BIGQUERY"},{"name":"S05: Aggregate+","id":"5","startMs":"1762526219260","endMs":"1762526219415","inputStages":["3"],"waitRatioAvg":0.45955882352941174,"waitMsAvg":"125","waitRatioMax":0.6580882352941176,"waitMsMax":"179","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.04779411764705882,"computeMsAvg":"13","computeRatioMax":0.09191176470588236,"computeMsMax":"25","writeRatioAvg":0.011029411764705883,"writeMsAvg":"3","writeRatioMax":0.05514705882352941,"writeMsMax":"15","shuffleOutputBytes":"4071","shuffleOutputBytesSpilled":"0","recordsRead":"9033","recordsWritten":"69","parallelInputs":"379","completedParallelInputs":"379","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$290, $260, $291","FROM __stage03_output"]},{"kind":"FILTER","substeps":["greater($250, 1000)"]},{"kind":"AGGREGATE","substeps":["GROUP BY $300 := $290, $301 := $291","$250 := SUM_OF_COUNTS($260)"]},{"kind":"WRITE","substeps":["$300, $301","TO __stage05_output"]}],"slotMs":"23381","computeMode":"BIGQUERY"},{"name":"S06: Coalesce","id":"6","startMs":"1762526219558","endMs":"1762526219620","inputStages":["5"],"waitRatioAvg":0.40808823529411764,"waitMsAvg":"111","waitRatioMax":0.4117647058823529,"waitMsMax":"112","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.03676470588235294,"computeMsAvg":"10","computeRatioMax":0.05514705882352941,"computeMsMax":"15","writeRatioAvg":0.051470588235294115,"writeMsAvg":"14","writeRatioMax":0.09926470588235294,"writeMsMax":"27","shuffleOutputBytes":"4071","shuffleOutputBytesSpilled":"0","recordsRead":"69","recordsWritten":"69","parallelInputs":"100","completedParallelInputs":"100","status":"COMPLETE","steps":[{"kind":"READ","substeps":["FROM __stage05_output"]}],"slotMs":"6270","computeMode":"BIGQUERY"},{"name":"S07: Join+","id":"7","startMs":"1762526219562","endMs":"1762526219766","inputStages":["6"],"waitRatioAvg":0.5808823529411765,"waitMsAvg":"158","waitRatioMax":0.875,"waitMsMax":"238","readRatioAvg":0.025735294117647058,"readMsAvg":"7","readRatioMax":0.33088235294117646,"readMsMax":"90","computeRatioAvg":0.08455882352941177,"computeMsAvg":"23","computeRatioMax":0.6029411764705882,"computeMsMax":"164","writeRatioAvg":0.011029411764705883,"writeMsAvg":"3","writeRatioMax":0.2610294117647059,"writeMsMax":"71","shuffleOutputBytes":"383362","shuffleOutputBytesSpilled":"0","recordsRead":"12277345","recordsWritten":"2758","parallelInputs":"1934","completedParallelInputs":"1934","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$1:address, $2:topics, $3:block_timestamp","FROM bigquery-public-data.crypto_ethereum_classic.logs"]},{"kind":"READ","substeps":["$300, $301","FROM __stage06_output"]},{"kind":"AGGREGATE","substeps":["GROUP BY $320 := $310, $321 := $311, $322 := $240","$210 := COUNT($240)"]},{"kind":"JOIN","substeps":["$312 := $2, $310 := $300, $311 := $301","INNER HASH JOIN EACH  WITH ALL  ON $1 = $300, $230 = $301"]},{"kind":"COMPUTE","substeps":["$230 := format_timestamp('\''%Y-%m'\'', $3)"]},{"kind":"FILTER","substeps":["equal($241, 0)"]},{"kind":"WRITE","substeps":["$320, $210, $322, $321","TO __stage07_output","BY HASH($320, $321, $322)"]}],"slotMs":"178560","computeMode":"BIGQUERY"},{"name":"S08: Aggregate","id":"8","startMs":"1762526219858","endMs":"1762526219923","inputStages":["7"],"waitRatioAvg":0.3014705882352941,"waitMsAvg":"82","waitRatioMax":0.3088235294117647,"waitMsMax":"84","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.051470588235294115,"computeMsAvg":"14","computeRatioMax":0.09191176470588236,"computeMsMax":"25","writeRatioAvg":0.025735294117647058,"writeMsAvg":"7","writeRatioMax":0.0661764705882353,"writeMsMax":"18","shuffleOutputBytes":"25298","shuffleOutputBytesSpilled":"0","recordsRead":"2758","recordsWritten":"182","parallelInputs":"231","completedParallelInputs":"231","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$320, $210, $322, $321","FROM __stage07_output"]},{"kind":"AGGREGATE","substeps":["GROUP BY $330 := $320, $331 := $321, $332 := $322","$190 := SUM_OF_COUNTS($210)"]},{"kind":"WRITE","substeps":["$330, $190, $332, $331","TO __stage08_output"]}],"slotMs":"16915","computeMode":"BIGQUERY"},{"name":"S09: Sort+","id":"9","startMs":"1762526220158","endMs":"1762526220212","inputStages":["8"],"waitRatioAvg":0.8308823529411765,"waitMsAvg":"226","waitRatioMax":0.8345588235294118,"waitMsMax":"227","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.04044117647058824,"computeMsAvg":"11","computeRatioMax":0.12867647058823528,"computeMsMax":"35","writeRatioAvg":0.03308823529411765,"writeMsAvg":"9","writeRatioMax":0.06985294117647059,"writeMsMax":"19","shuffleOutputBytes":"37582","shuffleOutputBytesSpilled":"0","recordsRead":"182","recordsWritten":"119","parallelInputs":"101","completedParallelInputs":"101","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$330, $190, $332, $331","FROM __stage08_output"]},{"kind":"READ","substeps":["$355","FROM __BROADCAST0"]},{"kind":"READ","substeps":["$200, $201, $202, $203","FROM __SHUFFLE3"]},{"kind":"AGGREGATE","substeps":["GROUP BY $380 := $140, $381 := $120","$110 := SHARD_ARRAY_AGG($124 ORDER BY $123 ASC, $122 ASC)","$111 := SHARD_ARRAY_AGG($121 ORDER BY $123 ASC, $122 ASC)","$112 := SHARD_ARRAY_AGG($122 ORDER BY $123 ASC, $122 ASC)","$113 := SHARD_ARRAY_AGG($123 ORDER BY $123 ASC, $122 ASC)"]},{"kind":"COMPUTE","substeps":["$120 := if(equal($140, 1), $160, NULL)","$121 := if(equal($140, 0), $162, NULL)","$122 := if(equal($140, 0), $163, NULL)","$123 := if(equal($140, 0), $160, NULL)","$124 := if(equal($140, 0), 1, NULL)"]},{"kind":"COMPUTE","substeps":["$130 := ARRAY<...>"]},{"kind":"FILTER","substeps":["equal($161, 1)"]},{"kind":"ANALYTIC_FUNCTION","substeps":["$170 := ROW_NUMBER() OVER (PARTITION BY $340, $343 ORDER BY $341 DESC)"]},{"kind":"SORT","substeps":["$220 ASC, $223 ASC, $221 DESC"]},{"kind":"ANALYTIC_FUNCTION","substeps":["$180 := ROW_NUMBER($355) OVER (PARTITION BY $360, $363 ORDER BY $361 DESC)"]},{"kind":"SORT","substeps":["$200 ASC, $203 ASC, $201 DESC"]},{"kind":"WRITE","substeps":["$110, $111, $112, $113, $381, $380","TO __stage09_output","BY HASH($380, $381)"]}],"slotMs":"6785","computeMode":"BIGQUERY"},{"name":"S0A: Aggregate+","id":"10","startMs":"1762526220459","endMs":"1762526220492","inputStages":["9"],"waitRatioAvg":0.8713235294117647,"waitMsAvg":"237","waitRatioMax":0.8713235294117647,"waitMsMax":"237","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.04411764705882353,"computeMsAvg":"12","computeRatioMax":0.0661764705882353,"computeMsMax":"18","writeRatioAvg":0.04411764705882353,"writeMsAvg":"12","writeRatioMax":0.0661764705882353,"writeMsMax":"18","shuffleOutputBytes":"9382","shuffleOutputBytesSpilled":"0","recordsRead":"119","recordsWritten":"11","parallelInputs":"10","completedParallelInputs":"10","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$110, $111, $112, $113, $381, $380","FROM __stage09_output"]},{"kind":"AGGREGATE","substeps":["GROUP BY $400 := $390","$80 := COUNT($94)","$81 := ANY_VALUE($93)","$82 := ANY_VALUE($92)","$83 := ANY_VALUE($91)","$84 := ANY_VALUE($90)"]},{"kind":"COMPUTE","substeps":["$90 := if(equal($390, 0), $103, NULL)","$91 := if(equal($390, 0), $102, NULL)","$92 := if(equal($390, 0), $101, NULL)","$93 := if(equal($390, 0), $100, NULL)","$94 := if(equal($390, 1), $391, NULL)"]},{"kind":"AGGREGATE","substeps":["GROUP BY $390 := $380, $391 := $381","$100 := ROOT_ARRAY_AGG($110 ORDER BY  ASC,  ASC)","$101 := ROOT_ARRAY_AGG($111 ORDER BY  ASC,  ASC)","$102 := ROOT_ARRAY_AGG($112 ORDER BY  ASC,  ASC)","$103 := ROOT_ARRAY_AGG($113 ORDER BY  ASC,  ASC)"]},{"kind":"WRITE","substeps":["$80, $81, $82, $83, $84, $400","TO __stage0A_output","BY HASH($400)"]}],"slotMs":"455","computeMode":"BIGQUERY"},{"name":"S0B: Aggregate+","id":"11","startMs":"1762526220763","endMs":"1762526220797","inputStages":["10"],"waitRatioAvg":0.9926470588235294,"waitMsAvg":"270","waitRatioMax":0.9926470588235294,"waitMsMax":"270","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.022058823529411766,"computeMsAvg":"6","computeRatioMax":0.022058823529411766,"computeMsMax":"6","writeRatioAvg":0.058823529411764705,"writeMsAvg":"16","writeRatioMax":0.058823529411764705,"writeMsMax":"16","shuffleOutputBytes":"9153","shuffleOutputBytesSpilled":"0","recordsRead":"11","recordsWritten":"1","parallelInputs":"1","completedParallelInputs":"1","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$80, $81, $82, $83, $84, $400","FROM __stage0A_output"]},{"kind":"AGGREGATE","substeps":["$50 := ANY_VALUE($64)","$51 := ANY_VALUE($63)","$52 := ANY_VALUE($62)","$53 := ANY_VALUE($61)","$54 := ANY_VALUE($60)"]},{"kind":"COMPUTE","substeps":["$60 := if(equal($410, 0), $74, NULL)","$61 := if(equal($410, 0), $73, NULL)","$62 := if(equal($410, 0), $72, NULL)","$63 := if(equal($410, 0), $71, NULL)","$64 := if(equal($410, 1), $70, NULL)"]},{"kind":"AGGREGATE","substeps":["GROUP BY $410 := $400","$70 := SUM_OF_COUNTS($80)","$71 := ANY_VALUE($81)","$72 := ANY_VALUE($82)","$73 := ANY_VALUE($83)","$74 := ANY_VALUE($84)"]},{"kind":"WRITE","substeps":["$50, $51, $52, $53, $54","TO __stage0B_output"]}],"slotMs":"70","computeMode":"BIGQUERY"},{"name":"S0C: Output","id":"12","startMs":"1762526220773","endMs":"1762526220814","inputStages":["11"],"waitRatioAvg":1,"waitMsAvg":"272","waitRatioMax":1,"waitMsMax":"272","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.0625,"computeMsAvg":"17","computeRatioMax":0.0625,"computeMsMax":"17","writeRatioAvg":0.05514705882352941,"writeMsAvg":"15","writeRatioMax":0.05514705882352941,"writeMsMax":"15","shuffleOutputBytes":"9884","shuffleOutputBytesSpilled":"0","recordsRead":"1","recordsWritten":"1","parallelInputs":"1","completedParallelInputs":"1","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$50, $51, $52, $53, $54","FROM __stage0B_output"]},{"kind":"COMPUTE","substeps":["$30 := MAKE_STRUCT($44, $43, $42, $41)","$31 := if(is_null($40), 0, $40)"]},{"kind":"AGGREGATE","substeps":["$40 := ANY_VALUE($50)","$41 := ANY_VALUE($51)","$42 := ANY_VALUE($52)","$43 := ANY_VALUE($53)","$44 := ANY_VALUE($54)"]},{"kind":"WRITE","substeps":["$30, $31","TO __stage0C_output"]}],"slotMs":"66","computeMode":"BIGQUERY"}],"estimatedBytesProcessed":"5555133989","timeline":[{"elapsedMs":"1814","totalSlotMs":"764250","pendingUnits":"0","completedUnits":"0","activeUnits":"0"},{"elapsedMs":"2814","totalSlotMs":"764250","pendingUnits":"1831","completedUnits":"2067","activeUnits":"987","estimatedRunnableUnits":"1000"},{"elapsedMs":"4635","totalSlotMs":"764250","pendingUnits":"0","completedUnits":"6655","activeUnits":"0","estimatedRunnableUnits":"10"}],"totalPartitionsProcessed":"3798","totalBytesProcessed":"5555133989","totalBytesBilled":"5555355648","billingTier":1,"totalSlotMs":"764250","cacheHit":false,"referencedTables":[{"projectId":"bigquery-public-data","datasetId":"crypto_ethereum_classic","tableId":"logs"},{"projectId":"bigquery-public-data","datasetId":"crypto_ethereum_classic","tableId":"contracts"}],"statementType":"SELECT","searchStatistics":{"indexUsageMode":"UNUSED","indexUnusedReasons":[{"code":"INDEX_CONFIG_NOT_AVAILABLE","message":"There is no index configuration for the base table `bigquery-public-data:crypto_ethereum_classic.contracts`.","baseTable":{"projectId":"bigquery-public-data","datasetId":"crypto_ethereum_classic","tableId":"contracts"}},{"code":"INDEX_CONFIG_NOT_AVAILABLE","message":"There is no index configuration for the base table `bigquery-public-data:crypto_ethereum_classic.logs`.","baseTable":{"projectId":"bigquery-public-data","datasetId":"crypto_ethereum_classic","tableId":"logs"}}]},"performanceInsights":{"avgPreviousExecutionMs":"2934"},"transferredBytes":"0","metadataCacheStatistics":{"tableMetadataCacheUsage":[{"tableReference":{"projectId":"bigquery-public-data","datasetId":"crypto_ethereum_classic","tableId":"logs"},"unusedReason":"OTHER_REASON"},{"tableReference":{"projectId":"bigquery-public-data","datasetId":"crypto_ethereum_classic","tableId":"contracts"},"unusedReason":"OTHER_REASON"}]}},"totalSlotMs":"764250","finalExecutionDurationMs":"2531"},"status":{"state":"DONE"},"principal_subject":"user:admin@bentrollope.altostrat.com","jobCreationReason":{"code":"REQUESTED"}}'
+ total_bytes_processed=5555133989
++ jq -r .statistics.totalSlotMs
++ echo '{"kind":"bigquery#job","etag":"N6qAcrApAKrSYs0CXgKNkg==","id":"tony-allen:US.bqjob_r26d6267f686cc7b0_0000019a5ebfbe83_1","selfLink":"https://bigquery.googleapis.com/bigquery/v2/projects/tony-allen/jobs/bqjob_r26d6267f686cc7b0_0000019a5ebfbe83_1?location=US","user_email":"admin@bentrollope.altostrat.com","configuration":{"query":{"query":"WITH ERC20_Contracts AS (\n    -- CTE 1: Filters the small '\''contracts'\'' dimension table once to identify ERC20s.\n    SELECT address \n    FROM `bigquery-public-data.crypto_ethereum_classic.contracts` \n    WHERE is_erc20 = TRUE\n),\nMonthlyLogCounts AS (\n    -- CTE 2: Filters early and aggregates the massive '\''logs'\'' table to find high-activity contracts (> 1,000 logs/month).\n    SELECT\n        t1.address,\n        FORMAT_DATE('\''%Y-%m'\'', t1.block_timestamp) AS transaction_month, \n        COUNT(t1.log_index) AS log_event_count \n    FROM\n        `bigquery-public-data.crypto_ethereum_classic.logs` AS t1\n    INNER JOIN\n        ERC20_Contracts AS t2 ON t1.address = t2.address\n    GROUP BY\n        1, 2\n    HAVING\n        log_event_count > 1000\n),\nFrequentTopics AS (\n    -- CTE 3: Joins the already filtered, small result from CTE 2 back to the '\''logs'\'' table\n    -- only for the relevant contracts/months to find the topic frequency (event signature).\n    SELECT\n        t1.address,\n        t1.transaction_month,\n        topic,\n        -- Applies a rank over the small, relevant subset of data.\n        ROW_NUMBER() OVER (PARTITION BY t1.address, t1.transaction_month ORDER BY COUNT(topic) DESC) AS topic_rank\n    FROM\n        MonthlyLogCounts AS t1\n    INNER JOIN\n        `bigquery-public-data.crypto_ethereum_classic.logs` AS t2 \n        ON t1.address = t2.address AND FORMAT_DATE('\''%Y-%m'\'', t2.block_timestamp) = t1.transaction_month\n    CROSS JOIN\n        UNNEST(t2.topics) AS topic WITH OFFSET AS topic_index\n    WHERE\n        topic_index = 0 -- Isolates the event signature hash (topics[0])\n    GROUP BY\n        1, 2, 3\n)\n-- Final Query: Selects the result ranked 1 (the most frequent event hash) for each contract/month.\nSELECT\n    COUNT(DISTINCT address) AS unique_erc20_contracts_exceeding_1k,\n    ARRAY_AGG(\n        STRUCT(t1.address, t1.transaction_month, t1.topic AS most_frequent_signature_hash) \n        ORDER BY t1.address, t1.transaction_month\n    ) AS details_by_contract_and_month\nFROM FrequentTopics AS t1\nWHERE t1.topic_rank = 1","destinationTable":{"projectId":"tony-allen","datasetId":"_e34c49c766e4fd3f5d404c3949b9e19fa7acb372","tableId":"anond8998faa_8517_47a1_985b_969fb42cc254"},"writeDisposition":"WRITE_TRUNCATE","priority":"INTERACTIVE","useQueryCache":false,"useLegacySql":false},"jobType":"QUERY"},"jobReference":{"projectId":"tony-allen","jobId":"bqjob_r26d6267f686cc7b0_0000019a5ebfbe83_1","location":"US"},"statistics":{"creationTime":"1762526216058","startTime":"1762526216186","endTime":"1762526221061","totalBytesProcessed":"5555133989","query":{"queryPlan":[{"name":"S00: Input","id":"0","startMs":"1762526218462","endMs":"1762526218769","waitRatioAvg":0.5073529411764706,"waitMsAvg":"138","waitRatioMax":0.6360294117647058,"waitMsMax":"173","readRatioAvg":0.16176470588235295,"readMsAvg":"44","readRatioMax":0.8382352941176471,"readMsMax":"228","computeRatioAvg":0.04044117647058824,"computeMsAvg":"11","computeRatioMax":0.16544117647058823,"computeMsMax":"45","writeRatioAvg":0.011029411764705883,"writeMsAvg":"3","writeRatioMax":0.07352941176470588,"writeMsMax":"20","shuffleOutputBytes":"481938","shuffleOutputBytesSpilled":"0","recordsRead":"7724950","recordsWritten":"10254","parallelInputs":"1864","completedParallelInputs":"1864","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$20:address, $21:is_erc20","FROM bigquery-public-data.crypto_ethereum_classic.contracts","WHERE $21"]},{"kind":"WRITE","substeps":["$20","TO __stage00_output"]}],"slotMs":"43662","computeMode":"BIGQUERY"},{"name":"S02: Coalesce","id":"2","startMs":"1762526218861","endMs":"1762526218913","inputStages":["0"],"waitRatioAvg":0.2757352941176471,"waitMsAvg":"75","waitRatioMax":0.27941176470588236,"waitMsMax":"76","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.03676470588235294,"computeMsAvg":"10","computeRatioMax":0.0661764705882353,"computeMsMax":"18","writeRatioAvg":0.029411764705882353,"writeMsAvg":"8","writeRatioMax":0.07720588235294118,"writeMsMax":"21","shuffleOutputBytes":"481938","shuffleOutputBytesSpilled":"0","recordsRead":"10254","recordsWritten":"10254","parallelInputs":"100","completedParallelInputs":"100","status":"COMPLETE","steps":[{"kind":"READ","substeps":["FROM __stage00_output"]}],"slotMs":"6080","computeMode":"BIGQUERY"},{"name":"S03: Join+","id":"3","startMs":"1762526218864","endMs":"1762526219148","inputStages":["2"],"waitRatioAvg":0.4485294117647059,"waitMsAvg":"122","waitRatioMax":0.7683823529411765,"waitMsMax":"209","readRatioAvg":0.029411764705882353,"readMsAvg":"8","readRatioMax":0.26838235294117646,"readMsMax":"73","computeRatioAvg":0.06985294117647059,"computeMsAvg":"19","computeRatioMax":0.4117647058823529,"computeMsMax":"112","writeRatioAvg":0.029411764705882353,"writeMsAvg":"8","writeRatioMax":0.25,"writeMsMax":"68","shuffleOutputBytes":"614244","shuffleOutputBytesSpilled":"0","recordsRead":"31975135","recordsWritten":"9033","parallelInputs":"1934","completedParallelInputs":"1934","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$10:log_index, $11:address, $12:block_timestamp","FROM bigquery-public-data.crypto_ethereum_classic.logs"]},{"kind":"READ","substeps":["$20","FROM __stage02_output"]},{"kind":"AGGREGATE","substeps":["GROUP BY $290 := $281, $291 := $270","$260 := COUNT($280)"]},{"kind":"COMPUTE","substeps":["$270 := format_timestamp('\''%Y-%m'\'', $282)"]},{"kind":"JOIN","substeps":["$280 := $10, $281 := $11, $282 := $12","INNER HASH JOIN EACH  WITH ALL  ON $11 = $20"]},{"kind":"WRITE","substeps":["$290, $260, $291","TO __stage03_output","BY HASH($290, $291)"]}],"slotMs":"183199","computeMode":"BIGQUERY"},{"name":"S05: Aggregate+","id":"5","startMs":"1762526219260","endMs":"1762526219415","inputStages":["3"],"waitRatioAvg":0.45955882352941174,"waitMsAvg":"125","waitRatioMax":0.6580882352941176,"waitMsMax":"179","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.04779411764705882,"computeMsAvg":"13","computeRatioMax":0.09191176470588236,"computeMsMax":"25","writeRatioAvg":0.011029411764705883,"writeMsAvg":"3","writeRatioMax":0.05514705882352941,"writeMsMax":"15","shuffleOutputBytes":"4071","shuffleOutputBytesSpilled":"0","recordsRead":"9033","recordsWritten":"69","parallelInputs":"379","completedParallelInputs":"379","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$290, $260, $291","FROM __stage03_output"]},{"kind":"FILTER","substeps":["greater($250, 1000)"]},{"kind":"AGGREGATE","substeps":["GROUP BY $300 := $290, $301 := $291","$250 := SUM_OF_COUNTS($260)"]},{"kind":"WRITE","substeps":["$300, $301","TO __stage05_output"]}],"slotMs":"23381","computeMode":"BIGQUERY"},{"name":"S06: Coalesce","id":"6","startMs":"1762526219558","endMs":"1762526219620","inputStages":["5"],"waitRatioAvg":0.40808823529411764,"waitMsAvg":"111","waitRatioMax":0.4117647058823529,"waitMsMax":"112","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.03676470588235294,"computeMsAvg":"10","computeRatioMax":0.05514705882352941,"computeMsMax":"15","writeRatioAvg":0.051470588235294115,"writeMsAvg":"14","writeRatioMax":0.09926470588235294,"writeMsMax":"27","shuffleOutputBytes":"4071","shuffleOutputBytesSpilled":"0","recordsRead":"69","recordsWritten":"69","parallelInputs":"100","completedParallelInputs":"100","status":"COMPLETE","steps":[{"kind":"READ","substeps":["FROM __stage05_output"]}],"slotMs":"6270","computeMode":"BIGQUERY"},{"name":"S07: Join+","id":"7","startMs":"1762526219562","endMs":"1762526219766","inputStages":["6"],"waitRatioAvg":0.5808823529411765,"waitMsAvg":"158","waitRatioMax":0.875,"waitMsMax":"238","readRatioAvg":0.025735294117647058,"readMsAvg":"7","readRatioMax":0.33088235294117646,"readMsMax":"90","computeRatioAvg":0.08455882352941177,"computeMsAvg":"23","computeRatioMax":0.6029411764705882,"computeMsMax":"164","writeRatioAvg":0.011029411764705883,"writeMsAvg":"3","writeRatioMax":0.2610294117647059,"writeMsMax":"71","shuffleOutputBytes":"383362","shuffleOutputBytesSpilled":"0","recordsRead":"12277345","recordsWritten":"2758","parallelInputs":"1934","completedParallelInputs":"1934","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$1:address, $2:topics, $3:block_timestamp","FROM bigquery-public-data.crypto_ethereum_classic.logs"]},{"kind":"READ","substeps":["$300, $301","FROM __stage06_output"]},{"kind":"AGGREGATE","substeps":["GROUP BY $320 := $310, $321 := $311, $322 := $240","$210 := COUNT($240)"]},{"kind":"JOIN","substeps":["$312 := $2, $310 := $300, $311 := $301","INNER HASH JOIN EACH  WITH ALL  ON $1 = $300, $230 = $301"]},{"kind":"COMPUTE","substeps":["$230 := format_timestamp('\''%Y-%m'\'', $3)"]},{"kind":"FILTER","substeps":["equal($241, 0)"]},{"kind":"WRITE","substeps":["$320, $210, $322, $321","TO __stage07_output","BY HASH($320, $321, $322)"]}],"slotMs":"178560","computeMode":"BIGQUERY"},{"name":"S08: Aggregate","id":"8","startMs":"1762526219858","endMs":"1762526219923","inputStages":["7"],"waitRatioAvg":0.3014705882352941,"waitMsAvg":"82","waitRatioMax":0.3088235294117647,"waitMsMax":"84","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.051470588235294115,"computeMsAvg":"14","computeRatioMax":0.09191176470588236,"computeMsMax":"25","writeRatioAvg":0.025735294117647058,"writeMsAvg":"7","writeRatioMax":0.0661764705882353,"writeMsMax":"18","shuffleOutputBytes":"25298","shuffleOutputBytesSpilled":"0","recordsRead":"2758","recordsWritten":"182","parallelInputs":"231","completedParallelInputs":"231","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$320, $210, $322, $321","FROM __stage07_output"]},{"kind":"AGGREGATE","substeps":["GROUP BY $330 := $320, $331 := $321, $332 := $322","$190 := SUM_OF_COUNTS($210)"]},{"kind":"WRITE","substeps":["$330, $190, $332, $331","TO __stage08_output"]}],"slotMs":"16915","computeMode":"BIGQUERY"},{"name":"S09: Sort+","id":"9","startMs":"1762526220158","endMs":"1762526220212","inputStages":["8"],"waitRatioAvg":0.8308823529411765,"waitMsAvg":"226","waitRatioMax":0.8345588235294118,"waitMsMax":"227","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.04044117647058824,"computeMsAvg":"11","computeRatioMax":0.12867647058823528,"computeMsMax":"35","writeRatioAvg":0.03308823529411765,"writeMsAvg":"9","writeRatioMax":0.06985294117647059,"writeMsMax":"19","shuffleOutputBytes":"37582","shuffleOutputBytesSpilled":"0","recordsRead":"182","recordsWritten":"119","parallelInputs":"101","completedParallelInputs":"101","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$330, $190, $332, $331","FROM __stage08_output"]},{"kind":"READ","substeps":["$355","FROM __BROADCAST0"]},{"kind":"READ","substeps":["$200, $201, $202, $203","FROM __SHUFFLE3"]},{"kind":"AGGREGATE","substeps":["GROUP BY $380 := $140, $381 := $120","$110 := SHARD_ARRAY_AGG($124 ORDER BY $123 ASC, $122 ASC)","$111 := SHARD_ARRAY_AGG($121 ORDER BY $123 ASC, $122 ASC)","$112 := SHARD_ARRAY_AGG($122 ORDER BY $123 ASC, $122 ASC)","$113 := SHARD_ARRAY_AGG($123 ORDER BY $123 ASC, $122 ASC)"]},{"kind":"COMPUTE","substeps":["$120 := if(equal($140, 1), $160, NULL)","$121 := if(equal($140, 0), $162, NULL)","$122 := if(equal($140, 0), $163, NULL)","$123 := if(equal($140, 0), $160, NULL)","$124 := if(equal($140, 0), 1, NULL)"]},{"kind":"COMPUTE","substeps":["$130 := ARRAY<...>"]},{"kind":"FILTER","substeps":["equal($161, 1)"]},{"kind":"ANALYTIC_FUNCTION","substeps":["$170 := ROW_NUMBER() OVER (PARTITION BY $340, $343 ORDER BY $341 DESC)"]},{"kind":"SORT","substeps":["$220 ASC, $223 ASC, $221 DESC"]},{"kind":"ANALYTIC_FUNCTION","substeps":["$180 := ROW_NUMBER($355) OVER (PARTITION BY $360, $363 ORDER BY $361 DESC)"]},{"kind":"SORT","substeps":["$200 ASC, $203 ASC, $201 DESC"]},{"kind":"WRITE","substeps":["$110, $111, $112, $113, $381, $380","TO __stage09_output","BY HASH($380, $381)"]}],"slotMs":"6785","computeMode":"BIGQUERY"},{"name":"S0A: Aggregate+","id":"10","startMs":"1762526220459","endMs":"1762526220492","inputStages":["9"],"waitRatioAvg":0.8713235294117647,"waitMsAvg":"237","waitRatioMax":0.8713235294117647,"waitMsMax":"237","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.04411764705882353,"computeMsAvg":"12","computeRatioMax":0.0661764705882353,"computeMsMax":"18","writeRatioAvg":0.04411764705882353,"writeMsAvg":"12","writeRatioMax":0.0661764705882353,"writeMsMax":"18","shuffleOutputBytes":"9382","shuffleOutputBytesSpilled":"0","recordsRead":"119","recordsWritten":"11","parallelInputs":"10","completedParallelInputs":"10","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$110, $111, $112, $113, $381, $380","FROM __stage09_output"]},{"kind":"AGGREGATE","substeps":["GROUP BY $400 := $390","$80 := COUNT($94)","$81 := ANY_VALUE($93)","$82 := ANY_VALUE($92)","$83 := ANY_VALUE($91)","$84 := ANY_VALUE($90)"]},{"kind":"COMPUTE","substeps":["$90 := if(equal($390, 0), $103, NULL)","$91 := if(equal($390, 0), $102, NULL)","$92 := if(equal($390, 0), $101, NULL)","$93 := if(equal($390, 0), $100, NULL)","$94 := if(equal($390, 1), $391, NULL)"]},{"kind":"AGGREGATE","substeps":["GROUP BY $390 := $380, $391 := $381","$100 := ROOT_ARRAY_AGG($110 ORDER BY  ASC,  ASC)","$101 := ROOT_ARRAY_AGG($111 ORDER BY  ASC,  ASC)","$102 := ROOT_ARRAY_AGG($112 ORDER BY  ASC,  ASC)","$103 := ROOT_ARRAY_AGG($113 ORDER BY  ASC,  ASC)"]},{"kind":"WRITE","substeps":["$80, $81, $82, $83, $84, $400","TO __stage0A_output","BY HASH($400)"]}],"slotMs":"455","computeMode":"BIGQUERY"},{"name":"S0B: Aggregate+","id":"11","startMs":"1762526220763","endMs":"1762526220797","inputStages":["10"],"waitRatioAvg":0.9926470588235294,"waitMsAvg":"270","waitRatioMax":0.9926470588235294,"waitMsMax":"270","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.022058823529411766,"computeMsAvg":"6","computeRatioMax":0.022058823529411766,"computeMsMax":"6","writeRatioAvg":0.058823529411764705,"writeMsAvg":"16","writeRatioMax":0.058823529411764705,"writeMsMax":"16","shuffleOutputBytes":"9153","shuffleOutputBytesSpilled":"0","recordsRead":"11","recordsWritten":"1","parallelInputs":"1","completedParallelInputs":"1","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$80, $81, $82, $83, $84, $400","FROM __stage0A_output"]},{"kind":"AGGREGATE","substeps":["$50 := ANY_VALUE($64)","$51 := ANY_VALUE($63)","$52 := ANY_VALUE($62)","$53 := ANY_VALUE($61)","$54 := ANY_VALUE($60)"]},{"kind":"COMPUTE","substeps":["$60 := if(equal($410, 0), $74, NULL)","$61 := if(equal($410, 0), $73, NULL)","$62 := if(equal($410, 0), $72, NULL)","$63 := if(equal($410, 0), $71, NULL)","$64 := if(equal($410, 1), $70, NULL)"]},{"kind":"AGGREGATE","substeps":["GROUP BY $410 := $400","$70 := SUM_OF_COUNTS($80)","$71 := ANY_VALUE($81)","$72 := ANY_VALUE($82)","$73 := ANY_VALUE($83)","$74 := ANY_VALUE($84)"]},{"kind":"WRITE","substeps":["$50, $51, $52, $53, $54","TO __stage0B_output"]}],"slotMs":"70","computeMode":"BIGQUERY"},{"name":"S0C: Output","id":"12","startMs":"1762526220773","endMs":"1762526220814","inputStages":["11"],"waitRatioAvg":1,"waitMsAvg":"272","waitRatioMax":1,"waitMsMax":"272","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.0625,"computeMsAvg":"17","computeRatioMax":0.0625,"computeMsMax":"17","writeRatioAvg":0.05514705882352941,"writeMsAvg":"15","writeRatioMax":0.05514705882352941,"writeMsMax":"15","shuffleOutputBytes":"9884","shuffleOutputBytesSpilled":"0","recordsRead":"1","recordsWritten":"1","parallelInputs":"1","completedParallelInputs":"1","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$50, $51, $52, $53, $54","FROM __stage0B_output"]},{"kind":"COMPUTE","substeps":["$30 := MAKE_STRUCT($44, $43, $42, $41)","$31 := if(is_null($40), 0, $40)"]},{"kind":"AGGREGATE","substeps":["$40 := ANY_VALUE($50)","$41 := ANY_VALUE($51)","$42 := ANY_VALUE($52)","$43 := ANY_VALUE($53)","$44 := ANY_VALUE($54)"]},{"kind":"WRITE","substeps":["$30, $31","TO __stage0C_output"]}],"slotMs":"66","computeMode":"BIGQUERY"}],"estimatedBytesProcessed":"5555133989","timeline":[{"elapsedMs":"1814","totalSlotMs":"764250","pendingUnits":"0","completedUnits":"0","activeUnits":"0"},{"elapsedMs":"2814","totalSlotMs":"764250","pendingUnits":"1831","completedUnits":"2067","activeUnits":"987","estimatedRunnableUnits":"1000"},{"elapsedMs":"4635","totalSlotMs":"764250","pendingUnits":"0","completedUnits":"6655","activeUnits":"0","estimatedRunnableUnits":"10"}],"totalPartitionsProcessed":"3798","totalBytesProcessed":"5555133989","totalBytesBilled":"5555355648","billingTier":1,"totalSlotMs":"764250","cacheHit":false,"referencedTables":[{"projectId":"bigquery-public-data","datasetId":"crypto_ethereum_classic","tableId":"logs"},{"projectId":"bigquery-public-data","datasetId":"crypto_ethereum_classic","tableId":"contracts"}],"statementType":"SELECT","searchStatistics":{"indexUsageMode":"UNUSED","indexUnusedReasons":[{"code":"INDEX_CONFIG_NOT_AVAILABLE","message":"There is no index configuration for the base table `bigquery-public-data:crypto_ethereum_classic.contracts`.","baseTable":{"projectId":"bigquery-public-data","datasetId":"crypto_ethereum_classic","tableId":"contracts"}},{"code":"INDEX_CONFIG_NOT_AVAILABLE","message":"There is no index configuration for the base table `bigquery-public-data:crypto_ethereum_classic.logs`.","baseTable":{"projectId":"bigquery-public-data","datasetId":"crypto_ethereum_classic","tableId":"logs"}}]},"performanceInsights":{"avgPreviousExecutionMs":"2934"},"transferredBytes":"0","metadataCacheStatistics":{"tableMetadataCacheUsage":[{"tableReference":{"projectId":"bigquery-public-data","datasetId":"crypto_ethereum_classic","tableId":"logs"},"unusedReason":"OTHER_REASON"},{"tableReference":{"projectId":"bigquery-public-data","datasetId":"crypto_ethereum_classic","tableId":"contracts"},"unusedReason":"OTHER_REASON"}]}},"totalSlotMs":"764250","finalExecutionDurationMs":"2531"},"status":{"state":"DONE"},"principal_subject":"user:admin@bentrollope.altostrat.com","jobCreationReason":{"code":"REQUESTED"}}'
+ total_slot_ms=764250
++ echo '{"kind":"bigquery#job","etag":"N6qAcrApAKrSYs0CXgKNkg==","id":"tony-allen:US.bqjob_r26d6267f686cc7b0_0000019a5ebfbe83_1","selfLink":"https://bigquery.googleapis.com/bigquery/v2/projects/tony-allen/jobs/bqjob_r26d6267f686cc7b0_0000019a5ebfbe83_1?location=US","user_email":"admin@bentrollope.altostrat.com","configuration":{"query":{"query":"WITH ERC20_Contracts AS (\n    -- CTE 1: Filters the small '\''contracts'\'' dimension table once to identify ERC20s.\n    SELECT address \n    FROM `bigquery-public-data.crypto_ethereum_classic.contracts` \n    WHERE is_erc20 = TRUE\n),\nMonthlyLogCounts AS (\n    -- CTE 2: Filters early and aggregates the massive '\''logs'\'' table to find high-activity contracts (> 1,000 logs/month).\n    SELECT\n        t1.address,\n        FORMAT_DATE('\''%Y-%m'\'', t1.block_timestamp) AS transaction_month, \n        COUNT(t1.log_index) AS log_event_count \n    FROM\n        `bigquery-public-data.crypto_ethereum_classic.logs` AS t1\n    INNER JOIN\n        ERC20_Contracts AS t2 ON t1.address = t2.address\n    GROUP BY\n        1, 2\n    HAVING\n        log_event_count > 1000\n),\nFrequentTopics AS (\n    -- CTE 3: Joins the already filtered, small result from CTE 2 back to the '\''logs'\'' table\n    -- only for the relevant contracts/months to find the topic frequency (event signature).\n    SELECT\n        t1.address,\n        t1.transaction_month,\n        topic,\n        -- Applies a rank over the small, relevant subset of data.\n        ROW_NUMBER() OVER (PARTITION BY t1.address, t1.transaction_month ORDER BY COUNT(topic) DESC) AS topic_rank\n    FROM\n        MonthlyLogCounts AS t1\n    INNER JOIN\n        `bigquery-public-data.crypto_ethereum_classic.logs` AS t2 \n        ON t1.address = t2.address AND FORMAT_DATE('\''%Y-%m'\'', t2.block_timestamp) = t1.transaction_month\n    CROSS JOIN\n        UNNEST(t2.topics) AS topic WITH OFFSET AS topic_index\n    WHERE\n        topic_index = 0 -- Isolates the event signature hash (topics[0])\n    GROUP BY\n        1, 2, 3\n)\n-- Final Query: Selects the result ranked 1 (the most frequent event hash) for each contract/month.\nSELECT\n    COUNT(DISTINCT address) AS unique_erc20_contracts_exceeding_1k,\n    ARRAY_AGG(\n        STRUCT(t1.address, t1.transaction_month, t1.topic AS most_frequent_signature_hash) \n        ORDER BY t1.address, t1.transaction_month\n    ) AS details_by_contract_and_month\nFROM FrequentTopics AS t1\nWHERE t1.topic_rank = 1","destinationTable":{"projectId":"tony-allen","datasetId":"_e34c49c766e4fd3f5d404c3949b9e19fa7acb372","tableId":"anond8998faa_8517_47a1_985b_969fb42cc254"},"writeDisposition":"WRITE_TRUNCATE","priority":"INTERACTIVE","useQueryCache":false,"useLegacySql":false},"jobType":"QUERY"},"jobReference":{"projectId":"tony-allen","jobId":"bqjob_r26d6267f686cc7b0_0000019a5ebfbe83_1","location":"US"},"statistics":{"creationTime":"1762526216058","startTime":"1762526216186","endTime":"1762526221061","totalBytesProcessed":"5555133989","query":{"queryPlan":[{"name":"S00: Input","id":"0","startMs":"1762526218462","endMs":"1762526218769","waitRatioAvg":0.5073529411764706,"waitMsAvg":"138","waitRatioMax":0.6360294117647058,"waitMsMax":"173","readRatioAvg":0.16176470588235295,"readMsAvg":"44","readRatioMax":0.8382352941176471,"readMsMax":"228","computeRatioAvg":0.04044117647058824,"computeMsAvg":"11","computeRatioMax":0.16544117647058823,"computeMsMax":"45","writeRatioAvg":0.011029411764705883,"writeMsAvg":"3","writeRatioMax":0.07352941176470588,"writeMsMax":"20","shuffleOutputBytes":"481938","shuffleOutputBytesSpilled":"0","recordsRead":"7724950","recordsWritten":"10254","parallelInputs":"1864","completedParallelInputs":"1864","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$20:address, $21:is_erc20","FROM bigquery-public-data.crypto_ethereum_classic.contracts","WHERE $21"]},{"kind":"WRITE","substeps":["$20","TO __stage00_output"]}],"slotMs":"43662","computeMode":"BIGQUERY"},{"name":"S02: Coalesce","id":"2","startMs":"1762526218861","endMs":"1762526218913","inputStages":["0"],"waitRatioAvg":0.2757352941176471,"waitMsAvg":"75","waitRatioMax":0.27941176470588236,"waitMsMax":"76","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.03676470588235294,"computeMsAvg":"10","computeRatioMax":0.0661764705882353,"computeMsMax":"18","writeRatioAvg":0.029411764705882353,"writeMsAvg":"8","writeRatioMax":0.07720588235294118,"writeMsMax":"21","shuffleOutputBytes":"481938","shuffleOutputBytesSpilled":"0","recordsRead":"10254","recordsWritten":"10254","parallelInputs":"100","completedParallelInputs":"100","status":"COMPLETE","steps":[{"kind":"READ","substeps":["FROM __stage00_output"]}],"slotMs":"6080","computeMode":"BIGQUERY"},{"name":"S03: Join+","id":"3","startMs":"1762526218864","endMs":"1762526219148","inputStages":["2"],"waitRatioAvg":0.4485294117647059,"waitMsAvg":"122","waitRatioMax":0.7683823529411765,"waitMsMax":"209","readRatioAvg":0.029411764705882353,"readMsAvg":"8","readRatioMax":0.26838235294117646,"readMsMax":"73","computeRatioAvg":0.06985294117647059,"computeMsAvg":"19","computeRatioMax":0.4117647058823529,"computeMsMax":"112","writeRatioAvg":0.029411764705882353,"writeMsAvg":"8","writeRatioMax":0.25,"writeMsMax":"68","shuffleOutputBytes":"614244","shuffleOutputBytesSpilled":"0","recordsRead":"31975135","recordsWritten":"9033","parallelInputs":"1934","completedParallelInputs":"1934","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$10:log_index, $11:address, $12:block_timestamp","FROM bigquery-public-data.crypto_ethereum_classic.logs"]},{"kind":"READ","substeps":["$20","FROM __stage02_output"]},{"kind":"AGGREGATE","substeps":["GROUP BY $290 := $281, $291 := $270","$260 := COUNT($280)"]},{"kind":"COMPUTE","substeps":["$270 := format_timestamp('\''%Y-%m'\'', $282)"]},{"kind":"JOIN","substeps":["$280 := $10, $281 := $11, $282 := $12","INNER HASH JOIN EACH  WITH ALL  ON $11 = $20"]},{"kind":"WRITE","substeps":["$290, $260, $291","TO __stage03_output","BY HASH($290, $291)"]}],"slotMs":"183199","computeMode":"BIGQUERY"},{"name":"S05: Aggregate+","id":"5","startMs":"1762526219260","endMs":"1762526219415","inputStages":["3"],"waitRatioAvg":0.45955882352941174,"waitMsAvg":"125","waitRatioMax":0.6580882352941176,"waitMsMax":"179","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.04779411764705882,"computeMsAvg":"13","computeRatioMax":0.09191176470588236,"computeMsMax":"25","writeRatioAvg":0.011029411764705883,"writeMsAvg":"3","writeRatioMax":0.05514705882352941,"writeMsMax":"15","shuffleOutputBytes":"4071","shuffleOutputBytesSpilled":"0","recordsRead":"9033","recordsWritten":"69","parallelInputs":"379","completedParallelInputs":"379","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$290, $260, $291","FROM __stage03_output"]},{"kind":"FILTER","substeps":["greater($250, 1000)"]},{"kind":"AGGREGATE","substeps":["GROUP BY $300 := $290, $301 := $291","$250 := SUM_OF_COUNTS($260)"]},{"kind":"WRITE","substeps":["$300, $301","TO __stage05_output"]}],"slotMs":"23381","computeMode":"BIGQUERY"},{"name":"S06: Coalesce","id":"6","startMs":"1762526219558","endMs":"1762526219620","inputStages":["5"],"waitRatioAvg":0.40808823529411764,"waitMsAvg":"111","waitRatioMax":0.4117647058823529,"waitMsMax":"112","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.03676470588235294,"computeMsAvg":"10","computeRatioMax":0.05514705882352941,"computeMsMax":"15","writeRatioAvg":0.051470588235294115,"writeMsAvg":"14","writeRatioMax":0.09926470588235294,"writeMsMax":"27","shuffleOutputBytes":"4071","shuffleOutputBytesSpilled":"0","recordsRead":"69","recordsWritten":"69","parallelInputs":"100","completedParallelInputs":"100","status":"COMPLETE","steps":[{"kind":"READ","substeps":["FROM __stage05_output"]}],"slotMs":"6270","computeMode":"BIGQUERY"},{"name":"S07: Join+","id":"7","startMs":"1762526219562","endMs":"1762526219766","inputStages":["6"],"waitRatioAvg":0.5808823529411765,"waitMsAvg":"158","waitRatioMax":0.875,"waitMsMax":"238","readRatioAvg":0.025735294117647058,"readMsAvg":"7","readRatioMax":0.33088235294117646,"readMsMax":"90","computeRatioAvg":0.08455882352941177,"computeMsAvg":"23","computeRatioMax":0.6029411764705882,"computeMsMax":"164","writeRatioAvg":0.011029411764705883,"writeMsAvg":"3","writeRatioMax":0.2610294117647059,"writeMsMax":"71","shuffleOutputBytes":"383362","shuffleOutputBytesSpilled":"0","recordsRead":"12277345","recordsWritten":"2758","parallelInputs":"1934","completedParallelInputs":"1934","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$1:address, $2:topics, $3:block_timestamp","FROM bigquery-public-data.crypto_ethereum_classic.logs"]},{"kind":"READ","substeps":["$300, $301","FROM __stage06_output"]},{"kind":"AGGREGATE","substeps":["GROUP BY $320 := $310, $321 := $311, $322 := $240","$210 := COUNT($240)"]},{"kind":"JOIN","substeps":["$312 := $2, $310 := $300, $311 := $301","INNER HASH JOIN EACH  WITH ALL  ON $1 = $300, $230 = $301"]},{"kind":"COMPUTE","substeps":["$230 := format_timestamp('\''%Y-%m'\'', $3)"]},{"kind":"FILTER","substeps":["equal($241, 0)"]},{"kind":"WRITE","substeps":["$320, $210, $322, $321","TO __stage07_output","BY HASH($320, $321, $322)"]}],"slotMs":"178560","computeMode":"BIGQUERY"},{"name":"S08: Aggregate","id":"8","startMs":"1762526219858","endMs":"1762526219923","inputStages":["7"],"waitRatioAvg":0.3014705882352941,"waitMsAvg":"82","waitRatioMax":0.3088235294117647,"waitMsMax":"84","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.051470588235294115,"computeMsAvg":"14","computeRatioMax":0.09191176470588236,"computeMsMax":"25","writeRatioAvg":0.025735294117647058,"writeMsAvg":"7","writeRatioMax":0.0661764705882353,"writeMsMax":"18","shuffleOutputBytes":"25298","shuffleOutputBytesSpilled":"0","recordsRead":"2758","recordsWritten":"182","parallelInputs":"231","completedParallelInputs":"231","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$320, $210, $322, $321","FROM __stage07_output"]},{"kind":"AGGREGATE","substeps":["GROUP BY $330 := $320, $331 := $321, $332 := $322","$190 := SUM_OF_COUNTS($210)"]},{"kind":"WRITE","substeps":["$330, $190, $332, $331","TO __stage08_output"]}],"slotMs":"16915","computeMode":"BIGQUERY"},{"name":"S09: Sort+","id":"9","startMs":"1762526220158","endMs":"1762526220212","inputStages":["8"],"waitRatioAvg":0.8308823529411765,"waitMsAvg":"226","waitRatioMax":0.8345588235294118,"waitMsMax":"227","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.04044117647058824,"computeMsAvg":"11","computeRatioMax":0.12867647058823528,"computeMsMax":"35","writeRatioAvg":0.03308823529411765,"writeMsAvg":"9","writeRatioMax":0.06985294117647059,"writeMsMax":"19","shuffleOutputBytes":"37582","shuffleOutputBytesSpilled":"0","recordsRead":"182","recordsWritten":"119","parallelInputs":"101","completedParallelInputs":"101","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$330, $190, $332, $331","FROM __stage08_output"]},{"kind":"READ","substeps":["$355","FROM __BROADCAST0"]},{"kind":"READ","substeps":["$200, $201, $202, $203","FROM __SHUFFLE3"]},{"kind":"AGGREGATE","substeps":["GROUP BY $380 := $140, $381 := $120","$110 := SHARD_ARRAY_AGG($124 ORDER BY $123 ASC, $122 ASC)","$111 := SHARD_ARRAY_AGG($121 ORDER BY $123 ASC, $122 ASC)","$112 := SHARD_ARRAY_AGG($122 ORDER BY $123 ASC, $122 ASC)","$113 := SHARD_ARRAY_AGG($123 ORDER BY $123 ASC, $122 ASC)"]},{"kind":"COMPUTE","substeps":["$120 := if(equal($140, 1), $160, NULL)","$121 := if(equal($140, 0), $162, NULL)","$122 := if(equal($140, 0), $163, NULL)","$123 := if(equal($140, 0), $160, NULL)","$124 := if(equal($140, 0), 1, NULL)"]},{"kind":"COMPUTE","substeps":["$130 := ARRAY<...>"]},{"kind":"FILTER","substeps":["equal($161, 1)"]},{"kind":"ANALYTIC_FUNCTION","substeps":["$170 := ROW_NUMBER() OVER (PARTITION BY $340, $343 ORDER BY $341 DESC)"]},{"kind":"SORT","substeps":["$220 ASC, $223 ASC, $221 DESC"]},{"kind":"ANALYTIC_FUNCTION","substeps":["$180 := ROW_NUMBER($355) OVER (PARTITION BY $360, $363 ORDER BY $361 DESC)"]},{"kind":"SORT","substeps":["$200 ASC, $203 ASC, $201 DESC"]},{"kind":"WRITE","substeps":["$110, $111, $112, $113, $381, $380","TO __stage09_output","BY HASH($380, $381)"]}],"slotMs":"6785","computeMode":"BIGQUERY"},{"name":"S0A: Aggregate+","id":"10","startMs":"1762526220459","endMs":"1762526220492","inputStages":["9"],"waitRatioAvg":0.8713235294117647,"waitMsAvg":"237","waitRatioMax":0.8713235294117647,"waitMsMax":"237","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.04411764705882353,"computeMsAvg":"12","computeRatioMax":0.0661764705882353,"computeMsMax":"18","writeRatioAvg":0.04411764705882353,"writeMsAvg":"12","writeRatioMax":0.0661764705882353,"writeMsMax":"18","shuffleOutputBytes":"9382","shuffleOutputBytesSpilled":"0","recordsRead":"119","recordsWritten":"11","parallelInputs":"10","completedParallelInputs":"10","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$110, $111, $112, $113, $381, $380","FROM __stage09_output"]},{"kind":"AGGREGATE","substeps":["GROUP BY $400 := $390","$80 := COUNT($94)","$81 := ANY_VALUE($93)","$82 := ANY_VALUE($92)","$83 := ANY_VALUE($91)","$84 := ANY_VALUE($90)"]},{"kind":"COMPUTE","substeps":["$90 := if(equal($390, 0), $103, NULL)","$91 := if(equal($390, 0), $102, NULL)","$92 := if(equal($390, 0), $101, NULL)","$93 := if(equal($390, 0), $100, NULL)","$94 := if(equal($390, 1), $391, NULL)"]},{"kind":"AGGREGATE","substeps":["GROUP BY $390 := $380, $391 := $381","$100 := ROOT_ARRAY_AGG($110 ORDER BY  ASC,  ASC)","$101 := ROOT_ARRAY_AGG($111 ORDER BY  ASC,  ASC)","$102 := ROOT_ARRAY_AGG($112 ORDER BY  ASC,  ASC)","$103 := ROOT_ARRAY_AGG($113 ORDER BY  ASC,  ASC)"]},{"kind":"WRITE","substeps":["$80, $81, $82, $83, $84, $400","TO __stage0A_output","BY HASH($400)"]}],"slotMs":"455","computeMode":"BIGQUERY"},{"name":"S0B: Aggregate+","id":"11","startMs":"1762526220763","endMs":"1762526220797","inputStages":["10"],"waitRatioAvg":0.9926470588235294,"waitMsAvg":"270","waitRatioMax":0.9926470588235294,"waitMsMax":"270","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.022058823529411766,"computeMsAvg":"6","computeRatioMax":0.022058823529411766,"computeMsMax":"6","writeRatioAvg":0.058823529411764705,"writeMsAvg":"16","writeRatioMax":0.058823529411764705,"writeMsMax":"16","shuffleOutputBytes":"9153","shuffleOutputBytesSpilled":"0","recordsRead":"11","recordsWritten":"1","parallelInputs":"1","completedParallelInputs":"1","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$80, $81, $82, $83, $84, $400","FROM __stage0A_output"]},{"kind":"AGGREGATE","substeps":["$50 := ANY_VALUE($64)","$51 := ANY_VALUE($63)","$52 := ANY_VALUE($62)","$53 := ANY_VALUE($61)","$54 := ANY_VALUE($60)"]},{"kind":"COMPUTE","substeps":["$60 := if(equal($410, 0), $74, NULL)","$61 := if(equal($410, 0), $73, NULL)","$62 := if(equal($410, 0), $72, NULL)","$63 := if(equal($410, 0), $71, NULL)","$64 := if(equal($410, 1), $70, NULL)"]},{"kind":"AGGREGATE","substeps":["GROUP BY $410 := $400","$70 := SUM_OF_COUNTS($80)","$71 := ANY_VALUE($81)","$72 := ANY_VALUE($82)","$73 := ANY_VALUE($83)","$74 := ANY_VALUE($84)"]},{"kind":"WRITE","substeps":["$50, $51, $52, $53, $54","TO __stage0B_output"]}],"slotMs":"70","computeMode":"BIGQUERY"},{"name":"S0C: Output","id":"12","startMs":"1762526220773","endMs":"1762526220814","inputStages":["11"],"waitRatioAvg":1,"waitMsAvg":"272","waitRatioMax":1,"waitMsMax":"272","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.0625,"computeMsAvg":"17","computeRatioMax":0.0625,"computeMsMax":"17","writeRatioAvg":0.05514705882352941,"writeMsAvg":"15","writeRatioMax":0.05514705882352941,"writeMsMax":"15","shuffleOutputBytes":"9884","shuffleOutputBytesSpilled":"0","recordsRead":"1","recordsWritten":"1","parallelInputs":"1","completedParallelInputs":"1","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$50, $51, $52, $53, $54","FROM __stage0B_output"]},{"kind":"COMPUTE","substeps":["$30 := MAKE_STRUCT($44, $43, $42, $41)","$31 := if(is_null($40), 0, $40)"]},{"kind":"AGGREGATE","substeps":["$40 := ANY_VALUE($50)","$41 := ANY_VALUE($51)","$42 := ANY_VALUE($52)","$43 := ANY_VALUE($53)","$44 := ANY_VALUE($54)"]},{"kind":"WRITE","substeps":["$30, $31","TO __stage0C_output"]}],"slotMs":"66","computeMode":"BIGQUERY"}],"estimatedBytesProcessed":"5555133989","timeline":[{"elapsedMs":"1814","totalSlotMs":"764250","pendingUnits":"0","completedUnits":"0","activeUnits":"0"},{"elapsedMs":"2814","totalSlotMs":"764250","pendingUnits":"1831","completedUnits":"2067","activeUnits":"987","estimatedRunnableUnits":"1000"},{"elapsedMs":"4635","totalSlotMs":"764250","pendingUnits":"0","completedUnits":"6655","activeUnits":"0","estimatedRunnableUnits":"10"}],"totalPartitionsProcessed":"3798","totalBytesProcessed":"5555133989","totalBytesBilled":"5555355648","billingTier":1,"totalSlotMs":"764250","cacheHit":false,"referencedTables":[{"projectId":"bigquery-public-data","datasetId":"crypto_ethereum_classic","tableId":"logs"},{"projectId":"bigquery-public-data","datasetId":"crypto_ethereum_classic","tableId":"contracts"}],"statementType":"SELECT","searchStatistics":{"indexUsageMode":"UNUSED","indexUnusedReasons":[{"code":"INDEX_CONFIG_NOT_AVAILABLE","message":"There is no index configuration for the base table `bigquery-public-data:crypto_ethereum_classic.contracts`.","baseTable":{"projectId":"bigquery-public-data","datasetId":"crypto_ethereum_classic","tableId":"contracts"}},{"code":"INDEX_CONFIG_NOT_AVAILABLE","message":"There is no index configuration for the base table `bigquery-public-data:crypto_ethereum_classic.logs`.","baseTable":{"projectId":"bigquery-public-data","datasetId":"crypto_ethereum_classic","tableId":"logs"}}]},"performanceInsights":{"avgPreviousExecutionMs":"2934"},"transferredBytes":"0","metadataCacheStatistics":{"tableMetadataCacheUsage":[{"tableReference":{"projectId":"bigquery-public-data","datasetId":"crypto_ethereum_classic","tableId":"logs"},"unusedReason":"OTHER_REASON"},{"tableReference":{"projectId":"bigquery-public-data","datasetId":"crypto_ethereum_classic","tableId":"contracts"},"unusedReason":"OTHER_REASON"}]}},"totalSlotMs":"764250","finalExecutionDurationMs":"2531"},"status":{"state":"DONE"},"principal_subject":"user:admin@bentrollope.altostrat.com","jobCreationReason":{"code":"REQUESTED"}}'
++ jq -r .statistics.startTime
+ start_time=1762526216186
++ echo '{"kind":"bigquery#job","etag":"N6qAcrApAKrSYs0CXgKNkg==","id":"tony-allen:US.bqjob_r26d6267f686cc7b0_0000019a5ebfbe83_1","selfLink":"https://bigquery.googleapis.com/bigquery/v2/projects/tony-allen/jobs/bqjob_r26d6267f686cc7b0_0000019a5ebfbe83_1?location=US","user_email":"admin@bentrollope.altostrat.com","configuration":{"query":{"query":"WITH ERC20_Contracts AS (\n    -- CTE 1: Filters the small '\''contracts'\'' dimension table once to identify ERC20s.\n    SELECT address \n    FROM `bigquery-public-data.crypto_ethereum_classic.contracts` \n    WHERE is_erc20 = TRUE\n),\nMonthlyLogCounts AS (\n    -- CTE 2: Filters early and aggregates the massive '\''logs'\'' table to find high-activity contracts (> 1,000 logs/month).\n    SELECT\n        t1.address,\n        FORMAT_DATE('\''%Y-%m'\'', t1.block_timestamp) AS transaction_month, \n        COUNT(t1.log_index) AS log_event_count \n    FROM\n        `bigquery-public-data.crypto_ethereum_classic.logs` AS t1\n    INNER JOIN\n        ERC20_Contracts AS t2 ON t1.address = t2.address\n    GROUP BY\n        1, 2\n    HAVING\n        log_event_count > 1000\n),\nFrequentTopics AS (\n    -- CTE 3: Joins the already filtered, small result from CTE 2 back to the '\''logs'\'' table\n    -- only for the relevant contracts/months to find the topic frequency (event signature).\n    SELECT\n        t1.address,\n        t1.transaction_month,\n        topic,\n        -- Applies a rank over the small, relevant subset of data.\n        ROW_NUMBER() OVER (PARTITION BY t1.address, t1.transaction_month ORDER BY COUNT(topic) DESC) AS topic_rank\n    FROM\n        MonthlyLogCounts AS t1\n    INNER JOIN\n        `bigquery-public-data.crypto_ethereum_classic.logs` AS t2 \n        ON t1.address = t2.address AND FORMAT_DATE('\''%Y-%m'\'', t2.block_timestamp) = t1.transaction_month\n    CROSS JOIN\n        UNNEST(t2.topics) AS topic WITH OFFSET AS topic_index\n    WHERE\n        topic_index = 0 -- Isolates the event signature hash (topics[0])\n    GROUP BY\n        1, 2, 3\n)\n-- Final Query: Selects the result ranked 1 (the most frequent event hash) for each contract/month.\nSELECT\n    COUNT(DISTINCT address) AS unique_erc20_contracts_exceeding_1k,\n    ARRAY_AGG(\n        STRUCT(t1.address, t1.transaction_month, t1.topic AS most_frequent_signature_hash) \n        ORDER BY t1.address, t1.transaction_month\n    ) AS details_by_contract_and_month\nFROM FrequentTopics AS t1\nWHERE t1.topic_rank = 1","destinationTable":{"projectId":"tony-allen","datasetId":"_e34c49c766e4fd3f5d404c3949b9e19fa7acb372","tableId":"anond8998faa_8517_47a1_985b_969fb42cc254"},"writeDisposition":"WRITE_TRUNCATE","priority":"INTERACTIVE","useQueryCache":false,"useLegacySql":false},"jobType":"QUERY"},"jobReference":{"projectId":"tony-allen","jobId":"bqjob_r26d6267f686cc7b0_0000019a5ebfbe83_1","location":"US"},"statistics":{"creationTime":"1762526216058","startTime":"1762526216186","endTime":"1762526221061","totalBytesProcessed":"5555133989","query":{"queryPlan":[{"name":"S00: Input","id":"0","startMs":"1762526218462","endMs":"1762526218769","waitRatioAvg":0.5073529411764706,"waitMsAvg":"138","waitRatioMax":0.6360294117647058,"waitMsMax":"173","readRatioAvg":0.16176470588235295,"readMsAvg":"44","readRatioMax":0.8382352941176471,"readMsMax":"228","computeRatioAvg":0.04044117647058824,"computeMsAvg":"11","computeRatioMax":0.16544117647058823,"computeMsMax":"45","writeRatioAvg":0.011029411764705883,"writeMsAvg":"3","writeRatioMax":0.07352941176470588,"writeMsMax":"20","shuffleOutputBytes":"481938","shuffleOutputBytesSpilled":"0","recordsRead":"7724950","recordsWritten":"10254","parallelInputs":"1864","completedParallelInputs":"1864","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$20:address, $21:is_erc20","FROM bigquery-public-data.crypto_ethereum_classic.contracts","WHERE $21"]},{"kind":"WRITE","substeps":["$20","TO __stage00_output"]}],"slotMs":"43662","computeMode":"BIGQUERY"},{"name":"S02: Coalesce","id":"2","startMs":"1762526218861","endMs":"1762526218913","inputStages":["0"],"waitRatioAvg":0.2757352941176471,"waitMsAvg":"75","waitRatioMax":0.27941176470588236,"waitMsMax":"76","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.03676470588235294,"computeMsAvg":"10","computeRatioMax":0.0661764705882353,"computeMsMax":"18","writeRatioAvg":0.029411764705882353,"writeMsAvg":"8","writeRatioMax":0.07720588235294118,"writeMsMax":"21","shuffleOutputBytes":"481938","shuffleOutputBytesSpilled":"0","recordsRead":"10254","recordsWritten":"10254","parallelInputs":"100","completedParallelInputs":"100","status":"COMPLETE","steps":[{"kind":"READ","substeps":["FROM __stage00_output"]}],"slotMs":"6080","computeMode":"BIGQUERY"},{"name":"S03: Join+","id":"3","startMs":"1762526218864","endMs":"1762526219148","inputStages":["2"],"waitRatioAvg":0.4485294117647059,"waitMsAvg":"122","waitRatioMax":0.7683823529411765,"waitMsMax":"209","readRatioAvg":0.029411764705882353,"readMsAvg":"8","readRatioMax":0.26838235294117646,"readMsMax":"73","computeRatioAvg":0.06985294117647059,"computeMsAvg":"19","computeRatioMax":0.4117647058823529,"computeMsMax":"112","writeRatioAvg":0.029411764705882353,"writeMsAvg":"8","writeRatioMax":0.25,"writeMsMax":"68","shuffleOutputBytes":"614244","shuffleOutputBytesSpilled":"0","recordsRead":"31975135","recordsWritten":"9033","parallelInputs":"1934","completedParallelInputs":"1934","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$10:log_index, $11:address, $12:block_timestamp","FROM bigquery-public-data.crypto_ethereum_classic.logs"]},{"kind":"READ","substeps":["$20","FROM __stage02_output"]},{"kind":"AGGREGATE","substeps":["GROUP BY $290 := $281, $291 := $270","$260 := COUNT($280)"]},{"kind":"COMPUTE","substeps":["$270 := format_timestamp('\''%Y-%m'\'', $282)"]},{"kind":"JOIN","substeps":["$280 := $10, $281 := $11, $282 := $12","INNER HASH JOIN EACH  WITH ALL  ON $11 = $20"]},{"kind":"WRITE","substeps":["$290, $260, $291","TO __stage03_output","BY HASH($290, $291)"]}],"slotMs":"183199","computeMode":"BIGQUERY"},{"name":"S05: Aggregate+","id":"5","startMs":"1762526219260","endMs":"1762526219415","inputStages":["3"],"waitRatioAvg":0.45955882352941174,"waitMsAvg":"125","waitRatioMax":0.6580882352941176,"waitMsMax":"179","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.04779411764705882,"computeMsAvg":"13","computeRatioMax":0.09191176470588236,"computeMsMax":"25","writeRatioAvg":0.011029411764705883,"writeMsAvg":"3","writeRatioMax":0.05514705882352941,"writeMsMax":"15","shuffleOutputBytes":"4071","shuffleOutputBytesSpilled":"0","recordsRead":"9033","recordsWritten":"69","parallelInputs":"379","completedParallelInputs":"379","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$290, $260, $291","FROM __stage03_output"]},{"kind":"FILTER","substeps":["greater($250, 1000)"]},{"kind":"AGGREGATE","substeps":["GROUP BY $300 := $290, $301 := $291","$250 := SUM_OF_COUNTS($260)"]},{"kind":"WRITE","substeps":["$300, $301","TO __stage05_output"]}],"slotMs":"23381","computeMode":"BIGQUERY"},{"name":"S06: Coalesce","id":"6","startMs":"1762526219558","endMs":"1762526219620","inputStages":["5"],"waitRatioAvg":0.40808823529411764,"waitMsAvg":"111","waitRatioMax":0.4117647058823529,"waitMsMax":"112","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.03676470588235294,"computeMsAvg":"10","computeRatioMax":0.05514705882352941,"computeMsMax":"15","writeRatioAvg":0.051470588235294115,"writeMsAvg":"14","writeRatioMax":0.09926470588235294,"writeMsMax":"27","shuffleOutputBytes":"4071","shuffleOutputBytesSpilled":"0","recordsRead":"69","recordsWritten":"69","parallelInputs":"100","completedParallelInputs":"100","status":"COMPLETE","steps":[{"kind":"READ","substeps":["FROM __stage05_output"]}],"slotMs":"6270","computeMode":"BIGQUERY"},{"name":"S07: Join+","id":"7","startMs":"1762526219562","endMs":"1762526219766","inputStages":["6"],"waitRatioAvg":0.5808823529411765,"waitMsAvg":"158","waitRatioMax":0.875,"waitMsMax":"238","readRatioAvg":0.025735294117647058,"readMsAvg":"7","readRatioMax":0.33088235294117646,"readMsMax":"90","computeRatioAvg":0.08455882352941177,"computeMsAvg":"23","computeRatioMax":0.6029411764705882,"computeMsMax":"164","writeRatioAvg":0.011029411764705883,"writeMsAvg":"3","writeRatioMax":0.2610294117647059,"writeMsMax":"71","shuffleOutputBytes":"383362","shuffleOutputBytesSpilled":"0","recordsRead":"12277345","recordsWritten":"2758","parallelInputs":"1934","completedParallelInputs":"1934","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$1:address, $2:topics, $3:block_timestamp","FROM bigquery-public-data.crypto_ethereum_classic.logs"]},{"kind":"READ","substeps":["$300, $301","FROM __stage06_output"]},{"kind":"AGGREGATE","substeps":["GROUP BY $320 := $310, $321 := $311, $322 := $240","$210 := COUNT($240)"]},{"kind":"JOIN","substeps":["$312 := $2, $310 := $300, $311 := $301","INNER HASH JOIN EACH  WITH ALL  ON $1 = $300, $230 = $301"]},{"kind":"COMPUTE","substeps":["$230 := format_timestamp('\''%Y-%m'\'', $3)"]},{"kind":"FILTER","substeps":["equal($241, 0)"]},{"kind":"WRITE","substeps":["$320, $210, $322, $321","TO __stage07_output","BY HASH($320, $321, $322)"]}],"slotMs":"178560","computeMode":"BIGQUERY"},{"name":"S08: Aggregate","id":"8","startMs":"1762526219858","endMs":"1762526219923","inputStages":["7"],"waitRatioAvg":0.3014705882352941,"waitMsAvg":"82","waitRatioMax":0.3088235294117647,"waitMsMax":"84","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.051470588235294115,"computeMsAvg":"14","computeRatioMax":0.09191176470588236,"computeMsMax":"25","writeRatioAvg":0.025735294117647058,"writeMsAvg":"7","writeRatioMax":0.0661764705882353,"writeMsMax":"18","shuffleOutputBytes":"25298","shuffleOutputBytesSpilled":"0","recordsRead":"2758","recordsWritten":"182","parallelInputs":"231","completedParallelInputs":"231","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$320, $210, $322, $321","FROM __stage07_output"]},{"kind":"AGGREGATE","substeps":["GROUP BY $330 := $320, $331 := $321, $332 := $322","$190 := SUM_OF_COUNTS($210)"]},{"kind":"WRITE","substeps":["$330, $190, $332, $331","TO __stage08_output"]}],"slotMs":"16915","computeMode":"BIGQUERY"},{"name":"S09: Sort+","id":"9","startMs":"1762526220158","endMs":"1762526220212","inputStages":["8"],"waitRatioAvg":0.8308823529411765,"waitMsAvg":"226","waitRatioMax":0.8345588235294118,"waitMsMax":"227","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.04044117647058824,"computeMsAvg":"11","computeRatioMax":0.12867647058823528,"computeMsMax":"35","writeRatioAvg":0.03308823529411765,"writeMsAvg":"9","writeRatioMax":0.06985294117647059,"writeMsMax":"19","shuffleOutputBytes":"37582","shuffleOutputBytesSpilled":"0","recordsRead":"182","recordsWritten":"119","parallelInputs":"101","completedParallelInputs":"101","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$330, $190, $332, $331","FROM __stage08_output"]},{"kind":"READ","substeps":["$355","FROM __BROADCAST0"]},{"kind":"READ","substeps":["$200, $201, $202, $203","FROM __SHUFFLE3"]},{"kind":"AGGREGATE","substeps":["GROUP BY $380 := $140, $381 := $120","$110 := SHARD_ARRAY_AGG($124 ORDER BY $123 ASC, $122 ASC)","$111 := SHARD_ARRAY_AGG($121 ORDER BY $123 ASC, $122 ASC)","$112 := SHARD_ARRAY_AGG($122 ORDER BY $123 ASC, $122 ASC)","$113 := SHARD_ARRAY_AGG($123 ORDER BY $123 ASC, $122 ASC)"]},{"kind":"COMPUTE","substeps":["$120 := if(equal($140, 1), $160, NULL)","$121 := if(equal($140, 0), $162, NULL)","$122 := if(equal($140, 0), $163, NULL)","$123 := if(equal($140, 0), $160, NULL)","$124 := if(equal($140, 0), 1, NULL)"]},{"kind":"COMPUTE","substeps":["$130 := ARRAY<...>"]},{"kind":"FILTER","substeps":["equal($161, 1)"]},{"kind":"ANALYTIC_FUNCTION","substeps":["$170 := ROW_NUMBER() OVER (PARTITION BY $340, $343 ORDER BY $341 DESC)"]},{"kind":"SORT","substeps":["$220 ASC, $223 ASC, $221 DESC"]},{"kind":"ANALYTIC_FUNCTION","substeps":["$180 := ROW_NUMBER($355) OVER (PARTITION BY $360, $363 ORDER BY $361 DESC)"]},{"kind":"SORT","substeps":["$200 ASC, $203 ASC, $201 DESC"]},{"kind":"WRITE","substeps":["$110, $111, $112, $113, $381, $380","TO __stage09_output","BY H++ jq -r .statistics.endTime
ASH($380, $381)"]}],"slotMs":"6785","computeMode":"BIGQUERY"},{"name":"S0A: Aggregate+","id":"10","startMs":"1762526220459","endMs":"1762526220492","inputStages":["9"],"waitRatioAvg":0.8713235294117647,"waitMsAvg":"237","waitRatioMax":0.8713235294117647,"waitMsMax":"237","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.04411764705882353,"computeMsAvg":"12","computeRatioMax":0.0661764705882353,"computeMsMax":"18","writeRatioAvg":0.04411764705882353,"writeMsAvg":"12","writeRatioMax":0.0661764705882353,"writeMsMax":"18","shuffleOutputBytes":"9382","shuffleOutputBytesSpilled":"0","recordsRead":"119","recordsWritten":"11","parallelInputs":"10","completedParallelInputs":"10","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$110, $111, $112, $113, $381, $380","FROM __stage09_output"]},{"kind":"AGGREGATE","substeps":["GROUP BY $400 := $390","$80 := COUNT($94)","$81 := ANY_VALUE($93)","$82 := ANY_VALUE($92)","$83 := ANY_VALUE($91)","$84 := ANY_VALUE($90)"]},{"kind":"COMPUTE","substeps":["$90 := if(equal($390, 0), $103, NULL)","$91 := if(equal($390, 0), $102, NULL)","$92 := if(equal($390, 0), $101, NULL)","$93 := if(equal($390, 0), $100, NULL)","$94 := if(equal($390, 1), $391, NULL)"]},{"kind":"AGGREGATE","substeps":["GROUP BY $390 := $380, $391 := $381","$100 := ROOT_ARRAY_AGG($110 ORDER BY  ASC,  ASC)","$101 := ROOT_ARRAY_AGG($111 ORDER BY  ASC,  ASC)","$102 := ROOT_ARRAY_AGG($112 ORDER BY  ASC,  ASC)","$103 := ROOT_ARRAY_AGG($113 ORDER BY  ASC,  ASC)"]},{"kind":"WRITE","substeps":["$80, $81, $82, $83, $84, $400","TO __stage0A_output","BY HASH($400)"]}],"slotMs":"455","computeMode":"BIGQUERY"},{"name":"S0B: Aggregate+","id":"11","startMs":"1762526220763","endMs":"1762526220797","inputStages":["10"],"waitRatioAvg":0.9926470588235294,"waitMsAvg":"270","waitRatioMax":0.9926470588235294,"waitMsMax":"270","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.022058823529411766,"computeMsAvg":"6","computeRatioMax":0.022058823529411766,"computeMsMax":"6","writeRatioAvg":0.058823529411764705,"writeMsAvg":"16","writeRatioMax":0.058823529411764705,"writeMsMax":"16","shuffleOutputBytes":"9153","shuffleOutputBytesSpilled":"0","recordsRead":"11","recordsWritten":"1","parallelInputs":"1","completedParallelInputs":"1","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$80, $81, $82, $83, $84, $400","FROM __stage0A_output"]},{"kind":"AGGREGATE","substeps":["$50 := ANY_VALUE($64)","$51 := ANY_VALUE($63)","$52 := ANY_VALUE($62)","$53 := ANY_VALUE($61)","$54 := ANY_VALUE($60)"]},{"kind":"COMPUTE","substeps":["$60 := if(equal($410, 0), $74, NULL)","$61 := if(equal($410, 0), $73, NULL)","$62 := if(equal($410, 0), $72, NULL)","$63 := if(equal($410, 0), $71, NULL)","$64 := if(equal($410, 1), $70, NULL)"]},{"kind":"AGGREGATE","substeps":["GROUP BY $410 := $400","$70 := SUM_OF_COUNTS($80)","$71 := ANY_VALUE($81)","$72 := ANY_VALUE($82)","$73 := ANY_VALUE($83)","$74 := ANY_VALUE($84)"]},{"kind":"WRITE","substeps":["$50, $51, $52, $53, $54","TO __stage0B_output"]}],"slotMs":"70","computeMode":"BIGQUERY"},{"name":"S0C: Output","id":"12","startMs":"1762526220773","endMs":"1762526220814","inputStages":["11"],"waitRatioAvg":1,"waitMsAvg":"272","waitRatioMax":1,"waitMsMax":"272","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.0625,"computeMsAvg":"17","computeRatioMax":0.0625,"computeMsMax":"17","writeRatioAvg":0.05514705882352941,"writeMsAvg":"15","writeRatioMax":0.05514705882352941,"writeMsMax":"15","shuffleOutputBytes":"9884","shuffleOutputBytesSpilled":"0","recordsRead":"1","recordsWritten":"1","parallelInputs":"1","completedParallelInputs":"1","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$50, $51, $52, $53, $54","FROM __stage0B_output"]},{"kind":"COMPUTE","substeps":["$30 := MAKE_STRUCT($44, $43, $42, $41)","$31 := if(is_null($40), 0, $40)"]},{"kind":"AGGREGATE","substeps":["$40 := ANY_VALUE($50)","$41 := ANY_VALUE($51)","$42 := ANY_VALUE($52)","$43 := ANY_VALUE($53)","$44 := ANY_VALUE($54)"]},{"kind":"WRITE","substeps":["$30, $31","TO __stage0C_output"]}],"slotMs":"66","computeMode":"BIGQUERY"}],"estimatedBytesProcessed":"5555133989","timeline":[{"elapsedMs":"1814","totalSlotMs":"764250","pendingUnits":"0","completedUnits":"0","activeUnits":"0"},{"elapsedMs":"2814","totalSlotMs":"764250","pendingUnits":"1831","completedUnits":"2067","activeUnits":"987","estimatedRunnableUnits":"1000"},{"elapsedMs":"4635","totalSlotMs":"764250","pendingUnits":"0","completedUnits":"6655","activeUnits":"0","estimatedRunnableUnits":"10"}],"totalPartitionsProcessed":"3798","totalBytesProcessed":"5555133989","totalBytesBilled":"5555355648","billingTier":1,"totalSlotMs":"764250","cacheHit":false,"referencedTables":[{"projectId":"bigquery-public-data","datasetId":"crypto_ethereum_classic","tableId":"logs"},{"projectId":"bigquery-public-data","datasetId":"crypto_ethereum_classic","tableId":"contracts"}],"statementType":"SELECT","searchStatistics":{"indexUsageMode":"UNUSED","indexUnusedReasons":[{"code":"INDEX_CONFIG_NOT_AVAILABLE","message":"There is no index configuration for the base table `bigquery-public-data:crypto_ethereum_classic.contracts`.","baseTable":{"projectId":"bigquery-public-data","datasetId":"crypto_ethereum_classic","tableId":"contracts"}},{"code":"INDEX_CONFIG_NOT_AVAILABLE","message":"There is no index configuration for the base table `bigquery-public-data:crypto_ethereum_classic.logs`.","baseTable":{"projectId":"bigquery-public-data","datasetId":"crypto_ethereum_classic","tableId":"logs"}}]},"performanceInsights":{"avgPreviousExecutionMs":"2934"},"transferredBytes":"0","metadataCacheStatistics":{"tableMetadataCacheUsage":[{"tableReference":{"projectId":"bigquery-public-data","datasetId":"crypto_ethereum_classic","tableId":"logs"},"unusedReason":"OTHER_REASON"},{"tableReference":{"projectId":"bigquery-public-data","datasetId":"crypto_ethereum_classic","tableId":"contracts"},"unusedReason":"OTHER_REASON"}]}},"totalSlotMs":"764250","finalExecutionDurationMs":"2531"},"status":{"state":"DONE"},"principal_subject":"user:admin@bentrollope.altostrat.com","jobCreationReason":{"code":"REQUESTED"}}'
+ end_time=1762526221061
++ echo 1762526216186
++ awk '{print int($1)}'
+ start_ms=1762526216186
++ echo 1762526221061
++ awk '{print int($1)}'
+ end_ms=1762526221061
+ duration_ms=4875
+ echo '  --- Execution Statistics ---'
  --- Execution Statistics ---
+ echo '  Duration: 4875 ms'
  Duration: 4875 ms
+ echo '  Bytes Processed: 5555133989 bytes'
  Bytes Processed: 5555133989 bytes
+ echo '  Slot Milliseconds: 764250'
  Slot Milliseconds: 764250
+ echo '  ----------------------------'
  ----------------------------
+ echo -e 'ERC20 Unoptimized\tbqjob_r26d6267f686cc7b0_0000019a5ebfbe83_1\t4875\t5555133989\t764250'
+ echo ''

+ run_query 'ERC20 Optimized' 'WITH ERC20_Contracts AS (
    SELECT address FROM `bigquery-public-data.crypto_ethereum_classic.contracts` WHERE is_erc20 = TRUE
),
MonthlyLogCounts AS (
    SELECT
        t1.address,
        FORMAT_DATE('\''%Y-%m'\'', t1.block_timestamp) AS transaction_month, 
        COUNT(t1.log_index) AS log_event_count 
    FROM
        `bigquery-public-data.crypto_ethereum_classic.logs` AS t1
    INNER JOIN
        ERC20_Contracts AS t2 ON t1.address = t2.address
    GROUP BY
        1, 2
    HAVING
        log_event_count > 1000
),
FrequentTopics AS (
    SELECT
        t1.address,
        t1.transaction_month,
        topic,
        ROW_NUMBER() OVER (PARTITION BY t1.address, t1.transaction_month ORDER BY COUNT(topic) DESC) AS topic_rank
    FROM
        MonthlyLogCounts AS t1 -- Joins the already filtered and aggregated small list
    INNER JOIN
        `bigquery-public-data.crypto_ethereum_classic.logs` AS t2 
        ON t1.address = t2.address AND FORMAT_DATE('\''%Y-%m'\'', t2.block_timestamp) = t1.transaction_month
    CROSS JOIN
        UNNEST(t2.topics) AS topic WITH OFFSET AS topic_index
    WHERE
        topic_index = 0
    GROUP BY
        1, 2, 3
)
SELECT
    COUNT(DISTINCT address) AS unique_erc20_contracts_exceeding_1k,
    ARRAY_AGG(
        STRUCT(t1.address, t1.transaction_month, t1.topic AS most_frequent_signature_hash) 
        ORDER BY t1.address, t1.transaction_month
    ) AS details_by_contract_and_month
FROM FrequentTopics AS t1
WHERE t1.topic_rank = 1'
+ local 'query_name=ERC20 Optimized'
+ local 'query=WITH ERC20_Contracts AS (
    SELECT address FROM `bigquery-public-data.crypto_ethereum_classic.contracts` WHERE is_erc20 = TRUE
),
MonthlyLogCounts AS (
    SELECT
        t1.address,
        FORMAT_DATE('\''%Y-%m'\'', t1.block_timestamp) AS transaction_month, 
        COUNT(t1.log_index) AS log_event_count 
    FROM
        `bigquery-public-data.crypto_ethereum_classic.logs` AS t1
    INNER JOIN
        ERC20_Contracts AS t2 ON t1.address = t2.address
    GROUP BY
        1, 2
    HAVING
        log_event_count > 1000
),
FrequentTopics AS (
    SELECT
        t1.address,
        t1.transaction_month,
        topic,
        ROW_NUMBER() OVER (PARTITION BY t1.address, t1.transaction_month ORDER BY COUNT(topic) DESC) AS topic_rank
    FROM
        MonthlyLogCounts AS t1 -- Joins the already filtered and aggregated small list
    INNER JOIN
        `bigquery-public-data.crypto_ethereum_classic.logs` AS t2 
        ON t1.address = t2.address AND FORMAT_DATE('\''%Y-%m'\'', t2.block_timestamp) = t1.transaction_month
    CROSS JOIN
        UNNEST(t2.topics) AS topic WITH OFFSET AS topic_index
    WHERE
        topic_index = 0
    GROUP BY
        1, 2, 3
)
SELECT
    COUNT(DISTINCT address) AS unique_erc20_contracts_exceeding_1k,
    ARRAY_AGG(
        STRUCT(t1.address, t1.transaction_month, t1.topic AS most_frequent_signature_hash) 
        ORDER BY t1.address, t1.transaction_month
    ) AS details_by_contract_and_month
FROM FrequentTopics AS t1
WHERE t1.topic_rank = 1'
+ echo ==================================================
==================================================
+ echo 'Executing ERC20 Optimized'
Executing ERC20 Optimized
+ echo ==================================================
==================================================
+ echo Query:
Query:
+ echo 'WITH ERC20_Contracts AS (
    SELECT address FROM `bigquery-public-data.crypto_ethereum_classic.contracts` WHERE is_erc20 = TRUE
),
MonthlyLogCounts AS (
    SELECT
        t1.address,
        FORMAT_DATE('\''%Y-%m'\'', t1.block_timestamp) AS transaction_month, 
        COUNT(t1.log_index) AS log_event_count 
    FROM
        `bigquery-public-data.crypto_ethereum_classic.logs` AS t1
    INNER JOIN
        ERC20_Contracts AS t2 ON t1.address = t2.address
    GROUP BY
        1, 2
    HAVING
        log_event_count > 1000
),
FrequentTopics AS (
    SELECT
        t1.address,
        t1.transaction_month,
        topic,
        ROW_NUMBER() OVER (PARTITION BY t1.address, t1.transaction_month ORDER BY COUNT(topic) DESC) AS topic_rank
    FROM
        MonthlyLogCounts AS t1 -- Joins the already filtered and aggregated small list
    INNER JOIN
        `bigquery-public-data.crypto_ethereum_classic.logs` AS t2 
        ON t1.address = t2.address AND FORMAT_DATE('\''%Y-%m'\'', t2.block_timestamp) = t1.transaction_month
    CROSS JOIN
        UNNEST(t2.topics) AS topic WITH OFFSET AS topic_index
    WHERE
        topic_index = 0
    GROUP BY
        1, 2, 3
)
SELECT
    COUNT(DISTINCT address) AS unique_erc20_contracts_exceeding_1k,
    ARRAY_AGG(
        STRUCT(t1.address, t1.transaction_month, t1.topic AS most_frequent_signature_hash) 
        ORDER BY t1.address, t1.transaction_month
    ) AS details_by_contract_and_month
FROM FrequentTopics AS t1
WHERE t1.topic_rank = 1'
WITH ERC20_Contracts AS (
    SELECT address FROM `bigquery-public-data.crypto_ethereum_classic.contracts` WHERE is_erc20 = TRUE
),
MonthlyLogCounts AS (
    SELECT
        t1.address,
        FORMAT_DATE('%Y-%m', t1.block_timestamp) AS transaction_month, 
        COUNT(t1.log_index) AS log_event_count 
    FROM
        `bigquery-public-data.crypto_ethereum_classic.logs` AS t1
    INNER JOIN
        ERC20_Contracts AS t2 ON t1.address = t2.address
    GROUP BY
        1, 2
    HAVING
        log_event_count > 1000
),
FrequentTopics AS (
    SELECT
        t1.address,
        t1.transaction_month,
        topic,
        ROW_NUMBER() OVER (PARTITION BY t1.address, t1.transaction_month ORDER BY COUNT(topic) DESC) AS topic_rank
    FROM
        MonthlyLogCounts AS t1 -- Joins the already filtered and aggregated small list
    INNER JOIN
        `bigquery-public-data.crypto_ethereum_classic.logs` AS t2 
        ON t1.address = t2.address AND FORMAT_DATE('%Y-%m', t2.block_timestamp) = t1.transaction_month
    CROSS JOIN
        UNNEST(t2.topics) AS topic WITH OFFSET AS topic_index
    WHERE
        topic_index = 0
    GROUP BY
        1, 2, 3
)
SELECT
    COUNT(DISTINCT address) AS unique_erc20_contracts_exceeding_1k,
    ARRAY_AGG(
        STRUCT(t1.address, t1.transaction_month, t1.topic AS most_frequent_signature_hash) 
        ORDER BY t1.address, t1.transaction_month
    ) AS details_by_contract_and_month
FROM FrequentTopics AS t1
WHERE t1.topic_rank = 1
+ echo --------------------------------------------------
--------------------------------------------------
++ bq query --nouse_cache --nosync --use_legacy_sql=false --format=json --location=US 'WITH ERC20_Contracts AS (
    SELECT address FROM `bigquery-public-data.crypto_ethereum_classic.contracts` WHERE is_erc20 = TRUE
),
MonthlyLogCounts AS (
    SELECT
        t1.address,
        FORMAT_DATE('\''%Y-%m'\'', t1.block_timestamp) AS transaction_month, 
        COUNT(t1.log_index) AS log_event_count 
    FROM
        `bigquery-public-data.crypto_ethereum_classic.logs` AS t1
    INNER JOIN
        ERC20_Contracts AS t2 ON t1.address = t2.address
    GROUP BY
        1, 2
    HAVING
        log_event_count > 1000
),
FrequentTopics AS (
    SELECT
        t1.address,
        t1.transaction_month,
        topic,
        ROW_NUMBER() OVER (PARTITION BY t1.address, t1.transaction_month ORDER BY COUNT(topic) DESC) AS topic_rank
    FROM
        MonthlyLogCounts AS t1 -- Joins the already filtered and aggregated small list
    INNER JOIN
        `bigquery-public-data.crypto_ethereum_classic.logs` AS t2 
        ON t1.address = t2.address AND FORMAT_DATE('\''%Y-%m'\'', t2.block_timestamp) = t1.transaction_month
    CROSS JOIN
        UNNEST(t2.topics) AS topic WITH OFFSET AS topic_index
    WHERE
        topic_index = 0
    GROUP BY
        1, 2, 3
)
SELECT
    COUNT(DISTINCT address) AS unique_erc20_contracts_exceeding_1k,
    ARRAY_AGG(
        STRUCT(t1.address, t1.transaction_month, t1.topic AS most_frequent_signature_hash) 
        ORDER BY t1.address, t1.transaction_month
    ) AS details_by_contract_and_month
FROM FrequentTopics AS t1
WHERE t1.topic_rank = 1'
+ job_submission_output='{"kind":"bigquery#job","etag":"F4k8jTxyJqU2gZbv3Cc8Og==","id":"tony-allen:US.bqjob_r771b8ddb25c487fd_0000019a5ebfe6c8_1","selfLink":"https://bigquery.googleapis.com/bigquery/v2/projects/tony-allen/jobs/bqjob_r771b8ddb25c487fd_0000019a5ebfe6c8_1?location=US","user_email":"admin@bentrollope.altostrat.com","configuration":{"query":{"query":"WITH ERC20_Contracts AS (\n    SELECT address FROM `bigquery-public-data.crypto_ethereum_classic.contracts` WHERE is_erc20 = TRUE\n),\nMonthlyLogCounts AS (\n    SELECT\n        t1.address,\n        FORMAT_DATE('\''%Y-%m'\'', t1.block_timestamp) AS transaction_month, \n        COUNT(t1.log_index) AS log_event_count \n    FROM\n        `bigquery-public-data.crypto_ethereum_classic.logs` AS t1\n    INNER JOIN\n        ERC20_Contracts AS t2 ON t1.address = t2.address\n    GROUP BY\n        1, 2\n    HAVING\n        log_event_count > 1000\n),\nFrequentTopics AS (\n    SELECT\n        t1.address,\n        t1.transaction_month,\n        topic,\n        ROW_NUMBER() OVER (PARTITION BY t1.address, t1.transaction_month ORDER BY COUNT(topic) DESC) AS topic_rank\n    FROM\n        MonthlyLogCounts AS t1 -- Joins the already filtered and aggregated small list\n    INNER JOIN\n        `bigquery-public-data.crypto_ethereum_classic.logs` AS t2 \n        ON t1.address = t2.address AND FORMAT_DATE('\''%Y-%m'\'', t2.block_timestamp) = t1.transaction_month\n    CROSS JOIN\n        UNNEST(t2.topics) AS topic WITH OFFSET AS topic_index\n    WHERE\n        topic_index = 0\n    GROUP BY\n        1, 2, 3\n)\nSELECT\n    COUNT(DISTINCT address) AS unique_erc20_contracts_exceeding_1k,\n    ARRAY_AGG(\n        STRUCT(t1.address, t1.transaction_month, t1.topic AS most_frequent_signature_hash) \n        ORDER BY t1.address, t1.transaction_month\n    ) AS details_by_contract_and_month\nFROM FrequentTopics AS t1\nWHERE t1.topic_rank = 1","destinationTable":{"projectId":"tony-allen","datasetId":"_e34c49c766e4fd3f5d404c3949b9e19fa7acb372","tableId":"anon0319fea4_7cc3_4aac_a596_39df1d13ceff"},"writeDisposition":"WRITE_TRUNCATE","priority":"INTERACTIVE","useQueryCache":false,"useLegacySql":false},"jobType":"QUERY"},"jobReference":{"projectId":"tony-allen","jobId":"bqjob_r771b8ddb25c487fd_0000019a5ebfe6c8_1","location":"US"},"statistics":{"creationTime":"1762526226356","startTime":"1762526226453","query":{"statementType":"SELECT","searchStatistics":{"indexUnusedReasons":[{"code":"INDEX_CONFIG_NOT_AVAILABLE","message":"There is no index configuration for the base table `bigquery-public-data:crypto_ethereum_classic.contracts`.","baseTable":{"projectId":"bigquery-public-data","datasetId":"crypto_ethereum_classic","tableId":"contracts"}},{"code":"INDEX_CONFIG_NOT_AVAILABLE","message":"There is no index configuration for the base table `bigquery-public-data:crypto_ethereum_classic.logs`.","baseTable":{"projectId":"bigquery-public-data","datasetId":"crypto_ethereum_classic","tableId":"logs"}}]}}},"status":{"state":"RUNNING"},"principal_subject":"user:admin@bentrollope.altostrat.com","jobCreationReason":{"code":"REQUESTED"}}'
++ jq -r .jobReference.jobId
++ echo '{"kind":"bigquery#job","etag":"F4k8jTxyJqU2gZbv3Cc8Og==","id":"tony-allen:US.bqjob_r771b8ddb25c487fd_0000019a5ebfe6c8_1","selfLink":"https://bigquery.googleapis.com/bigquery/v2/projects/tony-allen/jobs/bqjob_r771b8ddb25c487fd_0000019a5ebfe6c8_1?location=US","user_email":"admin@bentrollope.altostrat.com","configuration":{"query":{"query":"WITH ERC20_Contracts AS (\n    SELECT address FROM `bigquery-public-data.crypto_ethereum_classic.contracts` WHERE is_erc20 = TRUE\n),\nMonthlyLogCounts AS (\n    SELECT\n        t1.address,\n        FORMAT_DATE('\''%Y-%m'\'', t1.block_timestamp) AS transaction_month, \n        COUNT(t1.log_index) AS log_event_count \n    FROM\n        `bigquery-public-data.crypto_ethereum_classic.logs` AS t1\n    INNER JOIN\n        ERC20_Contracts AS t2 ON t1.address = t2.address\n    GROUP BY\n        1, 2\n    HAVING\n        log_event_count > 1000\n),\nFrequentTopics AS (\n    SELECT\n        t1.address,\n        t1.transaction_month,\n        topic,\n        ROW_NUMBER() OVER (PARTITION BY t1.address, t1.transaction_month ORDER BY COUNT(topic) DESC) AS topic_rank\n    FROM\n        MonthlyLogCounts AS t1 -- Joins the already filtered and aggregated small list\n    INNER JOIN\n        `bigquery-public-data.crypto_ethereum_classic.logs` AS t2 \n        ON t1.address = t2.address AND FORMAT_DATE('\''%Y-%m'\'', t2.block_timestamp) = t1.transaction_month\n    CROSS JOIN\n        UNNEST(t2.topics) AS topic WITH OFFSET AS topic_index\n    WHERE\n        topic_index = 0\n    GROUP BY\n        1, 2, 3\n)\nSELECT\n    COUNT(DISTINCT address) AS unique_erc20_contracts_exceeding_1k,\n    ARRAY_AGG(\n        STRUCT(t1.address, t1.transaction_month, t1.topic AS most_frequent_signature_hash) \n        ORDER BY t1.address, t1.transaction_month\n    ) AS details_by_contract_and_month\nFROM FrequentTopics AS t1\nWHERE t1.topic_rank = 1","destinationTable":{"projectId":"tony-allen","datasetId":"_e34c49c766e4fd3f5d404c3949b9e19fa7acb372","tableId":"anon0319fea4_7cc3_4aac_a596_39df1d13ceff"},"writeDisposition":"WRITE_TRUNCATE","priority":"INTERACTIVE","useQueryCache":false,"useLegacySql":false},"jobType":"QUERY"},"jobReference":{"projectId":"tony-allen","jobId":"bqjob_r771b8ddb25c487fd_0000019a5ebfe6c8_1","location":"US"},"statistics":{"creationTime":"1762526226356","startTime":"1762526226453","query":{"statementType":"SELECT","searchStatistics":{"indexUnusedReasons":[{"code":"INDEX_CONFIG_NOT_AVAILABLE","message":"There is no index configuration for the base table `bigquery-public-data:crypto_ethereum_classic.contracts`.","baseTable":{"projectId":"bigquery-public-data","datasetId":"crypto_ethereum_classic","tableId":"contracts"}},{"code":"INDEX_CONFIG_NOT_AVAILABLE","message":"There is no index configuration for the base table `bigquery-public-data:crypto_ethereum_classic.logs`.","baseTable":{"projectId":"bigquery-public-data","datasetId":"crypto_ethereum_classic","tableId":"logs"}}]}}},"status":{"state":"RUNNING"},"principal_subject":"user:admin@bentrollope.altostrat.com","jobCreationReason":{"code":"REQUESTED"}}'
+ job_id=bqjob_r771b8ddb25c487fd_0000019a5ebfe6c8_1
+ '[' -n bqjob_r771b8ddb25c487fd_0000019a5ebfe6c8_1 ']'
+ echo '  [SUCCESS] Query submitted.'
  [SUCCESS] Query submitted.
+ echo '  *** JOB ID FOR ERC20 Optimized: bqjob_r771b8ddb25c487fd_0000019a5ebfe6c8_1 ***'
  *** JOB ID FOR ERC20 Optimized: bqjob_r771b8ddb25c487fd_0000019a5ebfe6c8_1 ***
+ echo '  Waiting for job to complete...'
  Waiting for job to complete...
++ bq wait bqjob_r771b8ddb25c487fd_0000019a5ebfe6c8_1
+ wait_output='Waiting on bqjob_r771b8ddb25c487fd_0000019a5ebfe6c8_1 ... (0s) Current status: RUNNING                                                                                      Waiting on bqjob_r771b8ddb25c487fd_0000019a5ebfe6c8_1 ... (0s) Current status: DONE   
Job tony-allen:bqjob_r771b8ddb25c487fd_0000019a5ebfe6c8_1

  Job Type    State      Start Time         Duration                User Email              Bytes Processed   Bytes Billed   Billing Tier   Labels  
 ---------- --------- ----------------- ---------------- --------------------------------- ----------------- -------------- -------------- -------- 
  query      SUCCESS   07 Nov 14:37:06   0:00:05.059000   admin@bentrollope.altostrat.com   5555133989        5555355648     1                      '
+ '[' 0 -ne 0 ']'
+ echo '  Job completed. Fetching statistics...'
  Job completed. Fetching statistics...
++ bq show --format=json -j bqjob_r771b8ddb25c487fd_0000019a5ebfe6c8_1
+ job_stats_json='{"kind":"bigquery#job","etag":"dTzYWIKMTuVKO/uQ4lPshQ==","id":"tony-allen:US.bqjob_r771b8ddb25c487fd_0000019a5ebfe6c8_1","selfLink":"https://bigquery.googleapis.com/bigquery/v2/projects/tony-allen/jobs/bqjob_r771b8ddb25c487fd_0000019a5ebfe6c8_1?location=US","user_email":"admin@bentrollope.altostrat.com","configuration":{"query":{"query":"WITH ERC20_Contracts AS (\n    SELECT address FROM `bigquery-public-data.crypto_ethereum_classic.contracts` WHERE is_erc20 = TRUE\n),\nMonthlyLogCounts AS (\n    SELECT\n        t1.address,\n        FORMAT_DATE('\''%Y-%m'\'', t1.block_timestamp) AS transaction_month, \n        COUNT(t1.log_index) AS log_event_count \n    FROM\n        `bigquery-public-data.crypto_ethereum_classic.logs` AS t1\n    INNER JOIN\n        ERC20_Contracts AS t2 ON t1.address = t2.address\n    GROUP BY\n        1, 2\n    HAVING\n        log_event_count > 1000\n),\nFrequentTopics AS (\n    SELECT\n        t1.address,\n        t1.transaction_month,\n        topic,\n        ROW_NUMBER() OVER (PARTITION BY t1.address, t1.transaction_month ORDER BY COUNT(topic) DESC) AS topic_rank\n    FROM\n        MonthlyLogCounts AS t1 -- Joins the already filtered and aggregated small list\n    INNER JOIN\n        `bigquery-public-data.crypto_ethereum_classic.logs` AS t2 \n        ON t1.address = t2.address AND FORMAT_DATE('\''%Y-%m'\'', t2.block_timestamp) = t1.transaction_month\n    CROSS JOIN\n        UNNEST(t2.topics) AS topic WITH OFFSET AS topic_index\n    WHERE\n        topic_index = 0\n    GROUP BY\n        1, 2, 3\n)\nSELECT\n    COUNT(DISTINCT address) AS unique_erc20_contracts_exceeding_1k,\n    ARRAY_AGG(\n        STRUCT(t1.address, t1.transaction_month, t1.topic AS most_frequent_signature_hash) \n        ORDER BY t1.address, t1.transaction_month\n    ) AS details_by_contract_and_month\nFROM FrequentTopics AS t1\nWHERE t1.topic_rank = 1","destinationTable":{"projectId":"tony-allen","datasetId":"_e34c49c766e4fd3f5d404c3949b9e19fa7acb372","tableId":"anon0319fea4_7cc3_4aac_a596_39df1d13ceff"},"writeDisposition":"WRITE_TRUNCATE","priority":"INTERACTIVE","useQueryCache":false,"useLegacySql":false},"jobType":"QUERY"},"jobReference":{"projectId":"tony-allen","jobId":"bqjob_r771b8ddb25c487fd_0000019a5ebfe6c8_1","location":"US"},"statistics":{"creationTime":"1762526226356","startTime":"1762526226453","endTime":"1762526231512","totalBytesProcessed":"5555133989","query":{"queryPlan":[{"name":"S00: Input","id":"0","startMs":"1762526228839","endMs":"1762526229014","waitRatioAvg":0.006211180124223602,"waitMsAvg":"2","waitRatioMax":0.012422360248447204,"waitMsMax":"4","readRatioAvg":0.037267080745341616,"readMsAvg":"12","readRatioMax":0.484472049689441,"readMsMax":"156","computeRatioAvg":0.040372670807453416,"computeMsAvg":"13","computeRatioMax":0.13043478260869565,"computeMsMax":"42","writeRatioAvg":0.015527950310559006,"writeMsAvg":"5","writeRatioMax":0.08385093167701864,"writeMsMax":"27","shuffleOutputBytes":"481938","shuffleOutputBytesSpilled":"0","recordsRead":"7724950","recordsWritten":"10254","parallelInputs":"1864","completedParallelInputs":"1864","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$20:address, $21:is_erc20","FROM bigquery-public-data.crypto_ethereum_classic.contracts","WHERE $21"]},{"kind":"WRITE","substeps":["$20","TO __stage00_output"]}],"slotMs":"21426","computeMode":"BIGQUERY"},{"name":"S02: Coalesce","id":"2","startMs":"1762526229238","endMs":"1762526229329","inputStages":["0"],"waitRatioAvg":0.6211180124223602,"waitMsAvg":"200","waitRatioMax":0.6242236024844721,"waitMsMax":"201","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.034161490683229816,"computeMsAvg":"11","computeRatioMax":0.059006211180124224,"computeMsMax":"19","writeRatioAvg":0.043478260869565216,"writeMsAvg":"14","writeRatioMax":0.10248447204968944,"writeMsMax":"33","shuffleOutputBytes":"481938","shuffleOutputBytesSpilled":"0","recordsRead":"10254","recordsWritten":"10254","parallelInputs":"100","completedParallelInputs":"100","status":"COMPLETE","steps":[{"kind":"READ","substeps":["FROM __stage00_output"]}],"slotMs":"9362","computeMode":"BIGQUERY"},{"name":"S03: Join+","id":"3","startMs":"1762526229242","endMs":"1762526229616","inputStages":["2"],"waitRatioAvg":0.7857142857142857,"waitMsAvg":"253","waitRatioMax":1,"waitMsMax":"322","readRatioAvg":0.024844720496894408,"readMsAvg":"8","readRatioMax":0.6925465838509317,"readMsMax":"223","computeRatioAvg":0.059006211180124224,"computeMsAvg":"19","computeRatioMax":0.2732919254658385,"computeMsMax":"88","writeRatioAvg":0.021739130434782608,"writeMsAvg":"7","writeRatioMax":0.13354037267080746,"writeMsMax":"43","shuffleOutputBytes":"614244","shuffleOutputBytesSpilled":"0","recordsRead":"31975135","recordsWritten":"9033","parallelInputs":"1934","completedParallelInputs":"1934","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$10:log_index, $11:address, $12:block_timestamp","FROM bigquery-public-data.crypto_ethereum_classic.logs"]},{"kind":"READ","substeps":["$20","FROM __stage02_output"]},{"kind":"AGGREGATE","substeps":["GROUP BY $290 := $281, $291 := $270","$260 := COUNT($280)"]},{"kind":"COMPUTE","substeps":["$270 := format_timestamp('\''%Y-%m'\'', $282)"]},{"kind":"JOIN","substeps":["$280 := $10, $281 := $11, $282 := $12","INNER HASH JOIN EACH  WITH ALL  ON $11 = $20"]},{"kind":"WRITE","substeps":["$290, $260, $291","TO __stage03_output","BY HASH($290, $291)"]}],"slotMs":"195853","computeMode":"BIGQUERY"},{"name":"S05: Aggregate+","id":"5","startMs":"1762526229741","endMs":"1762526229861","inputStages":["3"],"waitRatioAvg":0.391304347826087,"waitMsAvg":"126","waitRatioMax":0.5559006211180124,"waitMsMax":"179","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.040372670807453416,"computeMsAvg":"13","computeRatioMax":0.08695652173913043,"computeMsMax":"28","writeRatioAvg":0.012422360248447204,"writeMsAvg":"4","writeRatioMax":0.055900621118012424,"writeMsMax":"18","shuffleOutputBytes":"4071","shuffleOutputBytesSpilled":"0","recordsRead":"9033","recordsWritten":"69","parallelInputs":"379","completedParallelInputs":"379","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$290, $260, $291","FROM __stage03_output"]},{"kind":"FILTER","substeps":["greater($250, 1000)"]},{"kind":"AGGREGATE","substeps":["GROUP BY $300 := $290, $301 := $291","$250 := SUM_OF_COUNTS($260)"]},{"kind":"WRITE","substeps":["$300, $301","TO __stage05_output"]}],"slotMs":"17518","computeMode":"BIGQUERY"},{"name":"S06: Coalesce","id":"6","startMs":"1762526230037","endMs":"1762526230100","inputStages":["5"],"waitRatioAvg":0.45652173913043476,"waitMsAvg":"147","waitRatioMax":0.45962732919254656,"waitMsMax":"148","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.031055900621118012,"computeMsAvg":"10","computeRatioMax":0.049689440993788817,"computeMsMax":"16","writeRatioAvg":0.037267080745341616,"writeMsAvg":"12","writeRatioMax":0.06521739130434782,"writeMsMax":"21","shuffleOutputBytes":"4071","shuffleOutputBytesSpilled":"0","recordsRead":"69","recordsWritten":"69","parallelInputs":"100","completedParallelInputs":"100","status":"COMPLETE","steps":[{"kind":"READ","substeps":["FROM __stage05_output"]}],"slotMs":"6768","computeMode":"BIGQUERY"},{"name":"S07: Join+","id":"7","startMs":"1762526230041","endMs":"1762526230236","inputStages":["6"],"waitRatioAvg":0.6086956521739131,"waitMsAvg":"196","waitRatioMax":0.8167701863354038,"waitMsMax":"263","readRatioAvg":0.021739130434782608,"readMsAvg":"7","readRatioMax":0.12111801242236025,"readMsMax":"39","computeRatioAvg":0.07142857142857142,"computeMsAvg":"23","computeRatioMax":0.46273291925465837,"computeMsMax":"149","writeRatioAvg":0.009316770186335404,"writeMsAvg":"3","writeRatioMax":0.12422360248447205,"writeMsMax":"40","shuffleOutputBytes":"383362","shuffleOutputBytesSpilled":"0","recordsRead":"12277345","recordsWritten":"2758","parallelInputs":"1934","completedParallelInputs":"1934","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$1:address, $2:topics, $3:block_timestamp","FROM bigquery-public-data.crypto_ethereum_classic.logs"]},{"kind":"READ","substeps":["$300, $301","FROM __stage06_output"]},{"kind":"AGGREGATE","substeps":["GROUP BY $320 := $310, $321 := $311, $322 := $240","$210 := COUNT($240)"]},{"kind":"JOIN","substeps":["$312 := $2, $310 := $300, $311 := $301","INNER HASH JOIN EACH  WITH ALL  ON $1 = $300, $230 = $301"]},{"kind":"COMPUTE","substeps":["$230 := format_timestamp('\''%Y-%m'\'', $3)"]},{"kind":"FILTER","substeps":["equal($241, 0)"]},{"kind":"WRITE","substeps":["$320, $210, $322, $321","TO __stage07_output","BY HASH($320, $321, $322)"]}],"slotMs":"162933","computeMode":"BIGQUERY"},{"name":"S08: Aggregate","id":"8","startMs":"1762526230338","endMs":"1762526230395","inputStages":["7"],"waitRatioAvg":0.2639751552795031,"waitMsAvg":"85","waitRatioMax":0.2670807453416149,"waitMsMax":"86","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.040372670807453416,"computeMsAvg":"13","computeRatioMax":0.06521739130434782,"computeMsMax":"21","writeRatioAvg":0.034161490683229816,"writeMsAvg":"11","writeRatioMax":0.059006211180124224,"writeMsMax":"19","shuffleOutputBytes":"25298","shuffleOutputBytesSpilled":"0","recordsRead":"2758","recordsWritten":"182","parallelInputs":"231","completedParallelInputs":"231","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$320, $210, $322, $321","FROM __stage07_output"]},{"kind":"AGGREGATE","substeps":["GROUP BY $330 := $320, $331 := $321, $332 := $322","$190 := SUM_OF_COUNTS($210)"]},{"kind":"WRITE","substeps":["$330, $190, $332, $331","TO __stage08_output"]}],"slotMs":"14090","computeMode":"BIGQUERY"},{"name":"S09: Sort+","id":"9","startMs":"1762526230638","endMs":"1762526230697","inputStages":["8"],"waitRatioAvg":0.7204968944099379,"waitMsAvg":"232","waitRatioMax":0.7236024844720497,"waitMsMax":"233","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.034161490683229816,"computeMsAvg":"11","computeRatioMax":0.059006211180124224,"computeMsMax":"19","writeRatioAvg":0.043478260869565216,"writeMsAvg":"14","writeRatioMax":0.07453416149068323,"writeMsMax":"24","shuffleOutputBytes":"37582","shuffleOutputBytesSpilled":"0","recordsRead":"182","recordsWritten":"119","parallelInputs":"101","completedParallelInputs":"101","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$330, $190, $332, $331","FROM __stage08_output"]},{"kind":"READ","substeps":["$355","FROM __BROADCAST0"]},{"kind":"READ","substeps":["$200, $201, $202, $203","FROM __SHUFFLE3"]},{"kind":"AGGREGATE","substeps":["GROUP BY $380 := $140, $381 := $120","$110 := SHARD_ARRAY_AGG($124 ORDER BY $123 ASC, $122 ASC)","$111 := SHARD_ARRAY_AGG($121 ORDER BY $123 ASC, $122 ASC)","$112 := SHARD_ARRAY_AGG($122 ORDER BY $123 ASC, $122 ASC)","$113 := SHARD_ARRAY_AGG($123 ORDER BY $123 ASC, $122 ASC)"]},{"kind":"COMPUTE","substeps":["$120 := if(equal($140, 1), $160, NULL)","$121 := if(equal($140, 0), $162, NULL)","$122 := if(equal($140, 0), $163, NULL)","$123 := if(equal($140, 0), $160, NULL)","$124 := if(equal($140, 0), 1, NULL)"]},{"kind":"COMPUTE","substeps":["$130 := ARRAY<...>"]},{"kind":"FILTER","substeps":["equal($161, 1)"]},{"kind":"ANALYTIC_FUNCTION","substeps":["$170 := ROW_NUMBER() OVER (PARTITION BY $340, $343 ORDER BY $341 DESC)"]},{"kind":"SORT","substeps":["$220 ASC, $223 ASC, $221 DESC"]},{"kind":"ANALYTIC_FUNCTION","substeps":["$180 := ROW_NUMBER($355) OVER (PARTITION BY $360, $363 ORDER BY $361 DESC)"]},{"kind":"SORT","substeps":["$200 ASC, $203 ASC, $201 DESC"]},{"kind":"WRITE","substeps":["$110, $111, $112, $113, $381, $380","TO __stage09_output","BY HASH($380, $381)"]}],"slotMs":"8238","computeMode":"BIGQUERY"},{"name":"S0A: Aggregate+","id":"10","startMs":"1762526230940","endMs":"1762526230975","inputStages":["9"],"waitRatioAvg":0.7267080745341615,"waitMsAvg":"234","waitRatioMax":0.7267080745341615,"waitMsMax":"234","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.037267080745341616,"computeMsAvg":"12","computeRatioMax":0.052795031055900624,"computeMsMax":"17","writeRatioAvg":0.046583850931677016,"writeMsAvg":"15","writeRatioMax":0.055900621118012424,"writeMsMax":"18","shuffleOutputBytes":"9382","shuffleOutputBytesSpilled":"0","recordsRead":"119","recordsWritten":"11","parallelInputs":"10","completedParallelInputs":"10","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$110, $111, $112, $113, $381, $380","FROM __stage09_output"]},{"kind":"AGGREGATE","substeps":["GROUP BY $400 := $390","$80 := COUNT($94)","$81 := ANY_VALUE($93)","$82 := ANY_VALUE($92)","$83 := ANY_VALUE($91)","$84 := ANY_VALUE($90)"]},{"kind":"COMPUTE","substeps":["$90 := if(equal($390, 0), $103, NULL)","$91 := if(equal($390, 0), $102, NULL)","$92 := if(equal($390, 0), $101, NULL)","$93 := if(equal($390, 0), $100, NULL)","$94 := if(equal($390, 1), $391, NULL)"]},{"kind":"AGGREGATE","substeps":["GROUP BY $390 := $380, $391 := $381","$100 := ROOT_ARRAY_AGG($110 ORDER BY  ASC,  ASC)","$101 := ROOT_ARRAY_AGG($111 ORDER BY  ASC,  ASC)","$102 := ROOT_ARRAY_AGG($112 ORDER BY  ASC,  ASC)","$103 := ROOT_ARRAY_AGG($113 ORDER BY  ASC,  ASC)"]},{"kind":"WRITE","substeps":["$80, $81, $82, $83, $84, $400","TO __stage0A_output","BY HASH($400)"]}],"slotMs":"471","computeMode":"BIGQUERY"},{"name":"S0B: Aggregate+","id":"11","startMs":"1762526231239","endMs":"1762526231283","inputStages":["10"],"waitRatioAvg":0.8136645962732919,"waitMsAvg":"262","waitRatioMax":0.8136645962732919,"waitMsMax":"262","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.034161490683229816,"computeMsAvg":"11","computeRatioMax":0.034161490683229816,"computeMsMax":"11","writeRatioAvg":0.049689440993788817,"writeMsAvg":"16","writeRatioMax":0.049689440993788817,"writeMsMax":"16","shuffleOutputBytes":"9153","shuffleOutputBytesSpilled":"0","recordsRead":"11","recordsWritten":"1","parallelInputs":"1","completedParallelInputs":"1","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$80, $81, $82, $83, $84, $400","FROM __stage0A_output"]},{"kind":"AGGREGATE","substeps":["$50 := ANY_VALUE($64)","$51 := ANY_VALUE($63)","$52 := ANY_VALUE($62)","$53 := ANY_VALUE($61)","$54 := ANY_VALUE($60)"]},{"kind":"COMPUTE","substeps":["$60 := if(equal($410, 0), $74, NULL)","$61 := if(equal($410, 0), $73, NULL)","$62 := if(equal($410, 0), $72, NULL)","$63 := if(equal($410, 0), $71, NULL)","$64 := if(equal($410, 1), $70, NULL)"]},{"kind":"AGGREGATE","substeps":["GROUP BY $410 := $400","$70 := SUM_OF_COUNTS($80)","$71 := ANY_VALUE($81)","$72 := ANY_VALUE($82)","$73 := ANY_VALUE($83)","$74 := ANY_VALUE($84)"]},{"kind":"WRITE","substeps":["$50, $51, $52, $53, $54","TO __stage0B_output"]}],"slotMs":"31","computeMode":"BIGQUERY"},{"name":"S0C: Output","id":"12","startMs":"1762526231239","endMs":"1762526231288","inputStages":["11"],"waitRatioAvg":0.7888198757763976,"waitMsAvg":"254","waitRatioMax":0.7888198757763976,"waitMsMax":"254","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.018633540372670808,"computeMsAvg":"6","computeRatioMax":0.018633540372670808,"computeMsMax":"6","writeRatioAvg":0.012422360248447204,"writeMsAvg":"4","writeRatioMax":0.012422360248447204,"writeMsMax":"4","shuffleOutputBytes":"9884","shuffleOutputBytesSpilled":"0","recordsRead":"1","recordsWritten":"1","parallelInputs":"1","completedParallelInputs":"1","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$50, $51, $52, $53, $54","FROM __stage0B_output"]},{"kind":"COMPUTE","substeps":["$30 := MAKE_STRUCT($44, $43, $42, $41)","$31 := if(is_null($40), 0, $40)"]},{"kind":"AGGREGATE","substeps":["$40 := ANY_VALUE($50)","$41 := ANY_VALUE($51)","$42 := ANY_VALUE($52)","$43 := ANY_VALUE($53)","$44 := ANY_VALUE($54)"]},{"kind":"WRITE","substeps":["$30, $31","TO __stage0C_output"]}],"slotMs":"51","computeMode":"BIGQUERY"}],"estimatedBytesProcessed":"5555133989","timeline":[{"elapsedMs":"1547","totalSlotMs":"609042","pendingUnits":"0","completedUnits":"0","activeUnits":"0"},{"elapsedMs":"2547","totalSlotMs":"609597","pendingUnits":"1357","completedUnits":"2441","activeUnits":"971","estimatedRunnableUnits":"0"},{"elapsedMs":"3547","totalSlotMs":"609597","pendingUnits":"2034","completedUnits":"4277","activeUnits":"0","estimatedRunnableUnits":"0"},{"elapsedMs":"4843","totalSlotMs":"609597","pendingUnits":"0","completedUnits":"6655","activeUnits":"10","estimatedRunnableUnits":"0"}],"totalPartitionsProcessed":"3798","totalBytesProcessed":"5555133989","totalBytesBilled":"5555355648","billingTier":1,"totalSlotMs":"609597","cacheHit":false,"referencedTables":[{"projectId":"bigquery-public-data","datasetId":"crypto_ethereum_classic","tableId":"logs"},{"projectId":"bigquery-public-data","datasetId":"crypto_ethereum_classic","tableId":"contracts"}],"statementType":"SELECT","searchStatistics":{"indexUsageMode":"UNUSED","indexUnusedReasons":[{"code":"INDEX_CONFIG_NOT_AVAILABLE","message":"There is no index configuration for the base table `bigquery-public-data:crypto_ethereum_classic.contracts`.","baseTable":{"projectId":"bigquery-public-data","datasetId":"crypto_ethereum_classic","tableId":"contracts"}},{"code":"INDEX_CONFIG_NOT_AVAILABLE","message":"There is no index configuration for the base table `bigquery-public-data:crypto_ethereum_classic.logs`.","baseTable":{"projectId":"bigquery-public-data","datasetId":"crypto_ethereum_classic","tableId":"logs"}}]},"performanceInsights":{"avgPreviousExecutionMs":"2877"},"transferredBytes":"0","metadataCacheStatistics":{"tableMetadataCacheUsage":[{"tableReference":{"projectId":"bigquery-public-data","datasetId":"crypto_ethereum_classic","tableId":"logs"},"unusedReason":"OTHER_REASON"},{"tableReference":{"projectId":"bigquery-public-data","datasetId":"crypto_ethereum_classic","tableId":"contracts"},"unusedReason":"OTHER_REASON"}]}},"totalSlotMs":"609597","finalExecutionDurationMs":"2502"},"status":{"state":"DONE"},"principal_subject":"user:admin@bentrollope.altostrat.com","jobCreationReason":{"code":"REQUESTED"}}'
++ jq -r .statistics.totalBytesProcessed
++ echo '{"kind":"bigquery#job","etag":"dTzYWIKMTuVKO/uQ4lPshQ==","id":"tony-allen:US.bqjob_r771b8ddb25c487fd_0000019a5ebfe6c8_1","selfLink":"https://bigquery.googleapis.com/bigquery/v2/projects/tony-allen/jobs/bqjob_r771b8ddb25c487fd_0000019a5ebfe6c8_1?location=US","user_email":"admin@bentrollope.altostrat.com","configuration":{"query":{"query":"WITH ERC20_Contracts AS (\n    SELECT address FROM `bigquery-public-data.crypto_ethereum_classic.contracts` WHERE is_erc20 = TRUE\n),\nMonthlyLogCounts AS (\n    SELECT\n        t1.address,\n        FORMAT_DATE('\''%Y-%m'\'', t1.block_timestamp) AS transaction_month, \n        COUNT(t1.log_index) AS log_event_count \n    FROM\n        `bigquery-public-data.crypto_ethereum_classic.logs` AS t1\n    INNER JOIN\n        ERC20_Contracts AS t2 ON t1.address = t2.address\n    GROUP BY\n        1, 2\n    HAVING\n        log_event_count > 1000\n),\nFrequentTopics AS (\n    SELECT\n        t1.address,\n        t1.transaction_month,\n        topic,\n        ROW_NUMBER() OVER (PARTITION BY t1.address, t1.transaction_month ORDER BY COUNT(topic) DESC) AS topic_rank\n    FROM\n        MonthlyLogCounts AS t1 -- Joins the already filtered and aggregated small list\n    INNER JOIN\n        `bigquery-public-data.crypto_ethereum_classic.logs` AS t2 \n        ON t1.address = t2.address AND FORMAT_DATE('\''%Y-%m'\'', t2.block_timestamp) = t1.transaction_month\n    CROSS JOIN\n        UNNEST(t2.topics) AS topic WITH OFFSET AS topic_index\n    WHERE\n        topic_index = 0\n    GROUP BY\n        1, 2, 3\n)\nSELECT\n    COUNT(DISTINCT address) AS unique_erc20_contracts_exceeding_1k,\n    ARRAY_AGG(\n        STRUCT(t1.address, t1.transaction_month, t1.topic AS most_frequent_signature_hash) \n        ORDER BY t1.address, t1.transaction_month\n    ) AS details_by_contract_and_month\nFROM FrequentTopics AS t1\nWHERE t1.topic_rank = 1","destinationTable":{"projectId":"tony-allen","datasetId":"_e34c49c766e4fd3f5d404c3949b9e19fa7acb372","tableId":"anon0319fea4_7cc3_4aac_a596_39df1d13ceff"},"writeDisposition":"WRITE_TRUNCATE","priority":"INTERACTIVE","useQueryCache":false,"useLegacySql":false},"jobType":"QUERY"},"jobReference":{"projectId":"tony-allen","jobId":"bqjob_r771b8ddb25c487fd_0000019a5ebfe6c8_1","location":"US"},"statistics":{"creationTime":"1762526226356","startTime":"1762526226453","endTime":"1762526231512","totalBytesProcessed":"5555133989","query":{"queryPlan":[{"name":"S00: Input","id":"0","startMs":"1762526228839","endMs":"1762526229014","waitRatioAvg":0.006211180124223602,"waitMsAvg":"2","waitRatioMax":0.012422360248447204,"waitMsMax":"4","readRatioAvg":0.037267080745341616,"readMsAvg":"12","readRatioMax":0.484472049689441,"readMsMax":"156","computeRatioAvg":0.040372670807453416,"computeMsAvg":"13","computeRatioMax":0.13043478260869565,"computeMsMax":"42","writeRatioAvg":0.015527950310559006,"writeMsAvg":"5","writeRatioMax":0.08385093167701864,"writeMsMax":"27","shuffleOutputBytes":"481938","shuffleOutputBytesSpilled":"0","recordsRead":"7724950","recordsWritten":"10254","parallelInputs":"1864","completedParallelInputs":"1864","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$20:address, $21:is_erc20","FROM bigquery-public-data.crypto_ethereum_classic.contracts","WHERE $21"]},{"kind":"WRITE","substeps":["$20","TO __stage00_output"]}],"slotMs":"21426","computeMode":"BIGQUERY"},{"name":"S02: Coalesce","id":"2","startMs":"1762526229238","endMs":"1762526229329","inputStages":["0"],"waitRatioAvg":0.6211180124223602,"waitMsAvg":"200","waitRatioMax":0.6242236024844721,"waitMsMax":"201","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.034161490683229816,"computeMsAvg":"11","computeRatioMax":0.059006211180124224,"computeMsMax":"19","writeRatioAvg":0.043478260869565216,"writeMsAvg":"14","writeRatioMax":0.10248447204968944,"writeMsMax":"33","shuffleOutputBytes":"481938","shuffleOutputBytesSpilled":"0","recordsRead":"10254","recordsWritten":"10254","parallelInputs":"100","completedParallelInputs":"100","status":"COMPLETE","steps":[{"kind":"READ","substeps":["FROM __stage00_output"]}],"slotMs":"9362","computeMode":"BIGQUERY"},{"name":"S03: Join+","id":"3","startMs":"1762526229242","endMs":"1762526229616","inputStages":["2"],"waitRatioAvg":0.7857142857142857,"waitMsAvg":"253","waitRatioMax":1,"waitMsMax":"322","readRatioAvg":0.024844720496894408,"readMsAvg":"8","readRatioMax":0.6925465838509317,"readMsMax":"223","computeRatioAvg":0.059006211180124224,"computeMsAvg":"19","computeRatioMax":0.2732919254658385,"computeMsMax":"88","writeRatioAvg":0.021739130434782608,"writeMsAvg":"7","writeRatioMax":0.13354037267080746,"writeMsMax":"43","shuffleOutputBytes":"614244","shuffleOutputBytesSpilled":"0","recordsRead":"31975135","recordsWritten":"9033","parallelInputs":"1934","completedParallelInputs":"1934","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$10:log_index, $11:address, $12:block_timestamp","FROM bigquery-public-data.crypto_ethereum_classic.logs"]},{"kind":"READ","substeps":["$20","FROM __stage02_output"]},{"kind":"AGGREGATE","substeps":["GROUP BY $290 := $281, $291 := $270","$260 := COUNT($280)"]},{"kind":"COMPUTE","substeps":["$270 := format_timestamp('\''%Y-%m'\'', $282)"]},{"kind":"JOIN","substeps":["$280 := $10, $281 := $11, $282 := $12","INNER HASH JOIN EACH  WITH ALL  ON $11 = $20"]},{"kind":"WRITE","substeps":["$290, $260, $291","TO __stage03_output","BY HASH($290, $291)"]}],"slotMs":"195853","computeMode":"BIGQUERY"},{"name":"S05: Aggregate+","id":"5","startMs":"1762526229741","endMs":"1762526229861","inputStages":["3"],"waitRatioAvg":0.391304347826087,"waitMsAvg":"126","waitRatioMax":0.5559006211180124,"waitMsMax":"179","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.040372670807453416,"computeMsAvg":"13","computeRatioMax":0.08695652173913043,"computeMsMax":"28","writeRatioAvg":0.012422360248447204,"writeMsAvg":"4","writeRatioMax":0.055900621118012424,"writeMsMax":"18","shuffleOutputBytes":"4071","shuffleOutputBytesSpilled":"0","recordsRead":"9033","recordsWritten":"69","parallelInputs":"379","completedParallelInputs":"379","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$290, $260, $291","FROM __stage03_output"]},{"kind":"FILTER","substeps":["greater($250, 1000)"]},{"kind":"AGGREGATE","substeps":["GROUP BY $300 := $290, $301 := $291","$250 := SUM_OF_COUNTS($260)"]},{"kind":"WRITE","substeps":["$300, $301","TO __stage05_output"]}],"slotMs":"17518","computeMode":"BIGQUERY"},{"name":"S06: Coalesce","id":"6","startMs":"1762526230037","endMs":"1762526230100","inputStages":["5"],"waitRatioAvg":0.45652173913043476,"waitMsAvg":"147","waitRatioMax":0.45962732919254656,"waitMsMax":"148","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.031055900621118012,"computeMsAvg":"10","computeRatioMax":0.049689440993788817,"computeMsMax":"16","writeRatioAvg":0.037267080745341616,"writeMsAvg":"12","writeRatioMax":0.06521739130434782,"writeMsMax":"21","shuffleOutputBytes":"4071","shuffleOutputBytesSpilled":"0","recordsRead":"69","recordsWritten":"69","parallelInputs":"100","completedParallelInputs":"100","status":"COMPLETE","steps":[{"kind":"READ","substeps":["FROM __stage05_output"]}],"slotMs":"6768","computeMode":"BIGQUERY"},{"name":"S07: Join+","id":"7","startMs":"1762526230041","endMs":"1762526230236","inputStages":["6"],"waitRatioAvg":0.6086956521739131,"waitMsAvg":"196","waitRatioMax":0.8167701863354038,"waitMsMax":"263","readRatioAvg":0.021739130434782608,"readMsAvg":"7","readRatioMax":0.12111801242236025,"readMsMax":"39","computeRatioAvg":0.07142857142857142,"computeMsAvg":"23","computeRatioMax":0.46273291925465837,"computeMsMax":"149","writeRatioAvg":0.009316770186335404,"writeMsAvg":"3","writeRatioMax":0.12422360248447205,"writeMsMax":"40","shuffleOutputBytes":"383362","shuffleOutputBytesSpilled":"0","recordsRead":"12277345","recordsWritten":"2758","parallelInputs":"1934","completedParallelInputs":"1934","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$1:address, $2:topics, $3:block_timestamp","FROM bigquery-public-data.crypto_ethereum_classic.logs"]},{"kind":"READ","substeps":["$300, $301","FROM __stage06_output"]},{"kind":"AGGREGATE","substeps":["GROUP BY $320 := $310, $321 := $311, $322 := $240","$210 := COUNT($240)"]},{"kind":"JOIN","substeps":["$312 := $2, $310 := $300, $311 := $301","INNER HASH JOIN EACH  WITH ALL  ON $1 = $300, $230 = $301"]},{"kind":"COMPUTE","substeps":["$230 := format_timestamp('\''%Y-%m'\'', $3)"]},{"kind":"FILTER","substeps":["equal($241, 0)"]},{"kind":"WRITE","substeps":["$320, $210, $322, $321","TO __stage07_output","BY HASH($320, $321, $322)"]}],"slotMs":"162933","computeMode":"BIGQUERY"},{"name":"S08: Aggregate","id":"8","startMs":"1762526230338","endMs":"1762526230395","inputStages":["7"],"waitRatioAvg":0.2639751552795031,"waitMsAvg":"85","waitRatioMax":0.2670807453416149,"waitMsMax":"86","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.040372670807453416,"computeMsAvg":"13","computeRatioMax":0.06521739130434782,"computeMsMax":"21","writeRatioAvg":0.034161490683229816,"writeMsAvg":"11","writeRatioMax":0.059006211180124224,"writeMsMax":"19","shuffleOutputBytes":"25298","shuffleOutputBytesSpilled":"0","recordsRead":"2758","recordsWritten":"182","parallelInputs":"231","completedParallelInputs":"231","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$320, $210, $322, $321","FROM __stage07_output"]},{"kind":"AGGREGATE","substeps":["GROUP BY $330 := $320, $331 := $321, $332 := $322","$190 := SUM_OF_COUNTS($210)"]},{"kind":"WRITE","substeps":["$330, $190, $332, $331","TO __stage08_output"]}],"slotMs":"14090","computeMode":"BIGQUERY"},{"name":"S09: Sort+","id":"9","startMs":"1762526230638","endMs":"1762526230697","inputStages":["8"],"waitRatioAvg":0.7204968944099379,"waitMsAvg":"232","waitRatioMax":0.7236024844720497,"waitMsMax":"233","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.034161490683229816,"computeMsAvg":"11","computeRatioMax":0.059006211180124224,"computeMsMax":"19","writeRatioAvg":0.043478260869565216,"writeMsAvg":"14","writeRatioMax":0.07453416149068323,"writeMsMax":"24","shuffleOutputBytes":"37582","shuffleOutputBytesSpilled":"0","recordsRead":"182","recordsWritten":"119","parallelInputs":"101","completedParallelInputs":"101","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$330, $190, $332, $331","FROM __stage08_output"]},{"kind":"READ","substeps":["$355","FROM __BROADCAST0"]},{"kind":"READ","substeps":["$200, $201, $202, $203","FROM __SHUFFLE3"]},{"kind":"AGGREGATE","substeps":["GROUP BY $380 := $140, $381 := $120","$110 := SHARD_ARRAY_AGG($124 ORDER BY $123 ASC, $122 ASC)","$111 := SHARD_ARRAY_AGG($121 ORDER BY $123 ASC, $122 ASC)","$112 := SHARD_ARRAY_AGG($122 ORDER BY $123 ASC, $122 ASC)","$113 := SHARD_ARRAY_AGG($123 ORDER BY $123 ASC, $122 ASC)"]},{"kind":"COMPUTE","substeps":["$120 := if(equal($140, 1), $160, NULL)","$121 := if(equal($140, 0), $162, NULL)","$122 := if(equal($140, 0), $163, NULL)","$123 := if(equal($140, 0), $160, NULL)","$124 := if(equal($140, 0), 1, NULL)"]},{"kind":"COMPUTE","substeps":["$130 := ARRAY<...>"]},{"kind":"FILTER","substeps":["equal($161, 1)"]},{"kind":"ANALYTIC_FUNCTION","substeps":["$170 := ROW_NUMBER() OVER (PARTITION BY $340, $343 ORDER BY $341 DESC)"]},{"kind":"SORT","substeps":["$220 ASC, $223 ASC, $221 DESC"]},{"kind":"ANALYTIC_FUNCTION","substeps":["$180 := ROW_NUMBER($355) OVER (PARTITION BY $360, $363 ORDER BY $361 DESC)"]},{"kind":"SORT","substeps":["$200 ASC, $203 ASC, $201 DESC"]},{"kind":"WRITE","substeps":["$110, $111, $112, $113, $381, $380","TO __stage09_output","BY HASH($380, $381)"]}],"slotMs":"8238","computeMode":"BIGQUERY"},{"name":"S0A: Aggregate+","id":"10","startMs":"1762526230940","endMs":"1762526230975","inputStages":["9"],"waitRatioAvg":0.7267080745341615,"waitMsAvg":"234","waitRatioMax":0.7267080745341615,"waitMsMax":"234","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.037267080745341616,"computeMsAvg":"12","computeRatioMax":0.052795031055900624,"computeMsMax":"17","writeRatioAvg":0.046583850931677016,"writeMsAvg":"15","writeRatioMax":0.055900621118012424,"writeMsMax":"18","shuffleOutputBytes":"9382","shuffleOutputBytesSpilled":"0","recordsRead":"119","recordsWritten":"11","parallelInputs":"10","completedParallelInputs":"10","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$110, $111, $112, $113, $381, $380","FROM __stage09_output"]},{"kind":"AGGREGATE","substeps":["GROUP BY $400 := $390","$80 := COUNT($94)","$81 := ANY_VALUE($93)","$82 := ANY_VALUE($92)","$83 := ANY_VALUE($91)","$84 := ANY_VALUE($90)"]},{"kind":"COMPUTE","substeps":["$90 := if(equal($390, 0), $103, NULL)","$91 := if(equal($390, 0), $102, NULL)","$92 := if(equal($390, 0), $101, NULL)","$93 := if(equal($390, 0), $100, NULL)","$94 := if(equal($390, 1), $391, NULL)"]},{"kind":"AGGREGATE","substeps":["GROUP BY $390 := $380, $391 := $381","$100 := ROOT_ARRAY_AGG($110 ORDER BY  ASC,  ASC)","$101 := ROOT_ARRAY_AGG($111 ORDER BY  ASC,  ASC)","$102 := ROOT_ARRAY_AGG($112 ORDER BY  ASC,  ASC)","$103 := ROOT_ARRAY_AGG($113 ORDER BY  ASC,  ASC)"]},{"kind":"WRITE","substeps":["$80, $81, $82, $83, $84, $400","TO __stage0A_output","BY HASH($400)"]}],"slotMs":"471","computeMode":"BIGQUERY"},{"name":"S0B: Aggregate+","id":"11","startMs":"1762526231239","endMs":"1762526231283","inputStages":["10"],"waitRatioAvg":0.8136645962732919,"waitMsAvg":"262","waitRatioMax":0.8136645962732919,"waitMsMax":"262","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.034161490683229816,"computeMsAvg":"11","computeRatioMax":0.034161490683229816,"computeMsMax":"11","writeRatioAvg":0.049689440993788817,"writeMsAvg":"16","writeRatioMax":0.049689440993788817,"writeMsMax":"16","shuffleOutputBytes":"9153","shuffleOutputBytesSpilled":"0","recordsRead":"11","recordsWritten":"1","parallelInputs":"1","completedParallelInputs":"1","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$80, $81, $82, $83, $84, $400","FROM __stage0A_output"]},{"kind":"AGGREGATE","substeps":["$50 := ANY_VALUE($64)","$51 := ANY_VALUE($63)","$52 := ANY_VALUE($62)","$53 := ANY_VALUE($61)","$54 := ANY_VALUE($60)"]},{"kind":"COMPUTE","substeps":["$60 := if(equal($410, 0), $74, NULL)","$61 := if(equal($410, 0), $73, NULL)","$62 := if(equal($410, 0), $72, NULL)","$63 := if(equal($410, 0), $71, NULL)","$64 := if(equal($410, 1), $70, NULL)"]},{"kind":"AGGREGATE","substeps":["GROUP BY $410 := $400","$70 := SUM_OF_COUNTS($80)","$71 := ANY_VALUE($81)","$72 := ANY_VALUE($82)","$73 := ANY_VALUE($83)","$74 := ANY_VALUE($84)"]},{"kind":"WRITE","substeps":["$50, $51, $52, $53, $54","TO __stage0B_output"]}],"slotMs":"31","computeMode":"BIGQUERY"},{"name":"S0C: Output","id":"12","startMs":"1762526231239","endMs":"1762526231288","inputStages":["11"],"waitRatioAvg":0.7888198757763976,"waitMsAvg":"254","waitRatioMax":0.7888198757763976,"waitMsMax":"254","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.018633540372670808,"computeMsAvg":"6","computeRatioMax":0.018633540372670808,"computeMsMax":"6","writeRatioAvg":0.012422360248447204,"writeMsAvg":"4","writeRatioMax":0.012422360248447204,"writeMsMax":"4","shuffleOutputBytes":"9884","shuffleOutputBytesSpilled":"0","recordsRead":"1","recordsWritten":"1","parallelInputs":"1","completedParallelInputs":"1","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$50, $51, $52, $53, $54","FROM __stage0B_output"]},{"kind":"COMPUTE","substeps":["$30 := MAKE_STRUCT($44, $43, $42, $41)","$31 := if(is_null($40), 0, $40)"]},{"kind":"AGGREGATE","substeps":["$40 := ANY_VALUE($50)","$41 := ANY_VALUE($51)","$42 := ANY_VALUE($52)","$43 := ANY_VALUE($53)","$44 := ANY_VALUE($54)"]},{"kind":"WRITE","substeps":["$30, $31","TO __stage0C_output"]}],"slotMs":"51","computeMode":"BIGQUERY"}],"estimatedBytesProcessed":"5555133989","timeline":[{"elapsedMs":"1547","totalSlotMs":"609042","pendingUnits":"0","completedUnits":"0","activeUnits":"0"},{"elapsedMs":"2547","totalSlotMs":"609597","pendingUnits":"1357","completedUnits":"2441","activeUnits":"971","estimatedRunnableUnits":"0"},{"elapsedMs":"3547","totalSlotMs":"609597","pendingUnits":"2034","completedUnits":"4277","activeUnits":"0","estimatedRunnableUnits":"0"},{"elapsedMs":"4843","totalSlotMs":"609597","pendingUnits":"0","completedUnits":"6655","activeUnits":"10","estimatedRunnableUnits":"0"}],"totalPartitionsProcessed":"3798","totalBytesProcessed":"5555133989","totalBytesBilled":"5555355648","billingTier":1,"totalSlotMs":"609597","cacheHit":false,"referencedTables":[{"projectId":"bigquery-public-data","datasetId":"crypto_ethereum_classic","tableId":"logs"},{"projectId":"bigquery-public-data","datasetId":"crypto_ethereum_classic","tableId":"contracts"}],"statementType":"SELECT","searchStatistics":{"indexUsageMode":"UNUSED","indexUnusedReasons":[{"code":"INDEX_CONFIG_NOT_AVAILABLE","message":"There is no index configuration for the base table `bigquery-public-data:crypto_ethereum_classic.contracts`.","baseTable":{"projectId":"bigquery-public-data","datasetId":"crypto_ethereum_classic","tableId":"contracts"}},{"code":"INDEX_CONFIG_NOT_AVAILABLE","message":"There is no index configuration for the base table `bigquery-public-data:crypto_ethereum_classic.logs`.","baseTable":{"projectId":"bigquery-public-data","datasetId":"crypto_ethereum_classic","tableId":"logs"}}]},"performanceInsights":{"avgPreviousExecutionMs":"2877"},"transferredBytes":"0","metadataCacheStatistics":{"tableMetadataCacheUsage":[{"tableReference":{"projectId":"bigquery-public-data","datasetId":"crypto_ethereum_classic","tableId":"logs"},"unusedReason":"OTHER_REASON"},{"tableReference":{"projectId":"bigquery-public-data","datasetId":"crypto_ethereum_classic","tableId":"contracts"},"unusedReason":"OTHER_REASON"}]}},"totalSlotMs":"609597","finalExecutionDurationMs":"2502"},"status":{"state":"DONE"},"principal_subject":"user:admin@bentrollope.altostrat.com","jobCreationReason":{"code":"REQUESTED"}}'
+ total_bytes_processed=5555133989
++ jq -r .statistics.totalSlotMs
++ echo '{"kind":"bigquery#job","etag":"dTzYWIKMTuVKO/uQ4lPshQ==","id":"tony-allen:US.bqjob_r771b8ddb25c487fd_0000019a5ebfe6c8_1","selfLink":"https://bigquery.googleapis.com/bigquery/v2/projects/tony-allen/jobs/bqjob_r771b8ddb25c487fd_0000019a5ebfe6c8_1?location=US","user_email":"admin@bentrollope.altostrat.com","configuration":{"query":{"query":"WITH ERC20_Contracts AS (\n    SELECT address FROM `bigquery-public-data.crypto_ethereum_classic.contracts` WHERE is_erc20 = TRUE\n),\nMonthlyLogCounts AS (\n    SELECT\n        t1.address,\n        FORMAT_DATE('\''%Y-%m'\'', t1.block_timestamp) AS transaction_month, \n        COUNT(t1.log_index) AS log_event_count \n    FROM\n        `bigquery-public-data.crypto_ethereum_classic.logs` AS t1\n    INNER JOIN\n        ERC20_Contracts AS t2 ON t1.address = t2.address\n    GROUP BY\n        1, 2\n    HAVING\n        log_event_count > 1000\n),\nFrequentTopics AS (\n    SELECT\n        t1.address,\n        t1.transaction_month,\n        topic,\n        ROW_NUMBER() OVER (PARTITION BY t1.address, t1.transaction_month ORDER BY COUNT(topic) DESC) AS topic_rank\n    FROM\n        MonthlyLogCounts AS t1 -- Joins the already filtered and aggregated small list\n    INNER JOIN\n        `bigquery-public-data.crypto_ethereum_classic.logs` AS t2 \n        ON t1.address = t2.address AND FORMAT_DATE('\''%Y-%m'\'', t2.block_timestamp) = t1.transaction_month\n    CROSS JOIN\n        UNNEST(t2.topics) AS topic WITH OFFSET AS topic_index\n    WHERE\n        topic_index = 0\n    GROUP BY\n        1, 2, 3\n)\nSELECT\n    COUNT(DISTINCT address) AS unique_erc20_contracts_exceeding_1k,\n    ARRAY_AGG(\n        STRUCT(t1.address, t1.transaction_month, t1.topic AS most_frequent_signature_hash) \n        ORDER BY t1.address, t1.transaction_month\n    ) AS details_by_contract_and_month\nFROM FrequentTopics AS t1\nWHERE t1.topic_rank = 1","destinationTable":{"projectId":"tony-allen","datasetId":"_e34c49c766e4fd3f5d404c3949b9e19fa7acb372","tableId":"anon0319fea4_7cc3_4aac_a596_39df1d13ceff"},"writeDisposition":"WRITE_TRUNCATE","priority":"INTERACTIVE","useQueryCache":false,"useLegacySql":false},"jobType":"QUERY"},"jobReference":{"projectId":"tony-allen","jobId":"bqjob_r771b8ddb25c487fd_0000019a5ebfe6c8_1","location":"US"},"statistics":{"creationTime":"1762526226356","startTime":"1762526226453","endTime":"1762526231512","totalBytesProcessed":"5555133989","query":{"queryPlan":[{"name":"S00: Input","id":"0","startMs":"1762526228839","endMs":"1762526229014","waitRatioAvg":0.006211180124223602,"waitMsAvg":"2","waitRatioMax":0.012422360248447204,"waitMsMax":"4","readRatioAvg":0.037267080745341616,"readMsAvg":"12","readRatioMax":0.484472049689441,"readMsMax":"156","computeRatioAvg":0.040372670807453416,"computeMsAvg":"13","computeRatioMax":0.13043478260869565,"computeMsMax":"42","writeRatioAvg":0.015527950310559006,"writeMsAvg":"5","writeRatioMax":0.08385093167701864,"writeMsMax":"27","shuffleOutputBytes":"481938","shuffleOutputBytesSpilled":"0","recordsRead":"7724950","recordsWritten":"10254","parallelInputs":"1864","completedParallelInputs":"1864","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$20:address, $21:is_erc20","FROM bigquery-public-data.crypto_ethereum_classic.contracts","WHERE $21"]},{"kind":"WRITE","substeps":["$20","TO __stage00_output"]}],"slotMs":"21426","computeMode":"BIGQUERY"},{"name":"S02: Coalesce","id":"2","startMs":"1762526229238","endMs":"1762526229329","inputStages":["0"],"waitRatioAvg":0.6211180124223602,"waitMsAvg":"200","waitRatioMax":0.6242236024844721,"waitMsMax":"201","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.034161490683229816,"computeMsAvg":"11","computeRatioMax":0.059006211180124224,"computeMsMax":"19","writeRatioAvg":0.043478260869565216,"writeMsAvg":"14","writeRatioMax":0.10248447204968944,"writeMsMax":"33","shuffleOutputBytes":"481938","shuffleOutputBytesSpilled":"0","recordsRead":"10254","recordsWritten":"10254","parallelInputs":"100","completedParallelInputs":"100","status":"COMPLETE","steps":[{"kind":"READ","substeps":["FROM __stage00_output"]}],"slotMs":"9362","computeMode":"BIGQUERY"},{"name":"S03: Join+","id":"3","startMs":"1762526229242","endMs":"1762526229616","inputStages":["2"],"waitRatioAvg":0.7857142857142857,"waitMsAvg":"253","waitRatioMax":1,"waitMsMax":"322","readRatioAvg":0.024844720496894408,"readMsAvg":"8","readRatioMax":0.6925465838509317,"readMsMax":"223","computeRatioAvg":0.059006211180124224,"computeMsAvg":"19","computeRatioMax":0.2732919254658385,"computeMsMax":"88","writeRatioAvg":0.021739130434782608,"writeMsAvg":"7","writeRatioMax":0.13354037267080746,"writeMsMax":"43","shuffleOutputBytes":"614244","shuffleOutputBytesSpilled":"0","recordsRead":"31975135","recordsWritten":"9033","parallelInputs":"1934","completedParallelInputs":"1934","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$10:log_index, $11:address, $12:block_timestamp","FROM bigquery-public-data.crypto_ethereum_classic.logs"]},{"kind":"READ","substeps":["$20","FROM __stage02_output"]},{"kind":"AGGREGATE","substeps":["GROUP BY $290 := $281, $291 := $270","$260 := COUNT($280)"]},{"kind":"COMPUTE","substeps":["$270 := format_timestamp('\''%Y-%m'\'', $282)"]},{"kind":"JOIN","substeps":["$280 := $10, $281 := $11, $282 := $12","INNER HASH JOIN EACH  WITH ALL  ON $11 = $20"]},{"kind":"WRITE","substeps":["$290, $260, $291","TO __stage03_output","BY HASH($290, $291)"]}],"slotMs":"195853","computeMode":"BIGQUERY"},{"name":"S05: Aggregate+","id":"5","startMs":"1762526229741","endMs":"1762526229861","inputStages":["3"],"waitRatioAvg":0.391304347826087,"waitMsAvg":"126","waitRatioMax":0.5559006211180124,"waitMsMax":"179","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.040372670807453416,"computeMsAvg":"13","computeRatioMax":0.08695652173913043,"computeMsMax":"28","writeRatioAvg":0.012422360248447204,"writeMsAvg":"4","writeRatioMax":0.055900621118012424,"writeMsMax":"18","shuffleOutputBytes":"4071","shuffleOutputBytesSpilled":"0","recordsRead":"9033","recordsWritten":"69","parallelInputs":"379","completedParallelInputs":"379","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$290, $260, $291","FROM __stage03_output"]},{"kind":"FILTER","substeps":["greater($250, 1000)"]},{"kind":"AGGREGATE","substeps":["GROUP BY $300 := $290, $301 := $291","$250 := SUM_OF_COUNTS($260)"]},{"kind":"WRITE","substeps":["$300, $301","TO __stage05_output"]}],"slotMs":"17518","computeMode":"BIGQUERY"},{"name":"S06: Coalesce","id":"6","startMs":"1762526230037","endMs":"1762526230100","inputStages":["5"],"waitRatioAvg":0.45652173913043476,"waitMsAvg":"147","waitRatioMax":0.45962732919254656,"waitMsMax":"148","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.031055900621118012,"computeMsAvg":"10","computeRatioMax":0.049689440993788817,"computeMsMax":"16","writeRatioAvg":0.037267080745341616,"writeMsAvg":"12","writeRatioMax":0.06521739130434782,"writeMsMax":"21","shuffleOutputBytes":"4071","shuffleOutputBytesSpilled":"0","recordsRead":"69","recordsWritten":"69","parallelInputs":"100","completedParallelInputs":"100","status":"COMPLETE","steps":[{"kind":"READ","substeps":["FROM __stage05_output"]}],"slotMs":"6768","computeMode":"BIGQUERY"},{"name":"S07: Join+","id":"7","startMs":"1762526230041","endMs":"1762526230236","inputStages":["6"],"waitRatioAvg":0.6086956521739131,"waitMsAvg":"196","waitRatioMax":0.8167701863354038,"waitMsMax":"263","readRatioAvg":0.021739130434782608,"readMsAvg":"7","readRatioMax":0.12111801242236025,"readMsMax":"39","computeRatioAvg":0.07142857142857142,"computeMsAvg":"23","computeRatioMax":0.46273291925465837,"computeMsMax":"149","writeRatioAvg":0.009316770186335404,"writeMsAvg":"3","writeRatioMax":0.12422360248447205,"writeMsMax":"40","shuffleOutputBytes":"383362","shuffleOutputBytesSpilled":"0","recordsRead":"12277345","recordsWritten":"2758","parallelInputs":"1934","completedParallelInputs":"1934","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$1:address, $2:topics, $3:block_timestamp","FROM bigquery-public-data.crypto_ethereum_classic.logs"]},{"kind":"READ","substeps":["$300, $301","FROM __stage06_output"]},{"kind":"AGGREGATE","substeps":["GROUP BY $320 := $310, $321 := $311, $322 := $240","$210 := COUNT($240)"]},{"kind":"JOIN","substeps":["$312 := $2, $310 := $300, $311 := $301","INNER HASH JOIN EACH  WITH ALL  ON $1 = $300, $230 = $301"]},{"kind":"COMPUTE","substeps":["$230 := format_timestamp('\''%Y-%m'\'', $3)"]},{"kind":"FILTER","substeps":["equal($241, 0)"]},{"kind":"WRITE","substeps":["$320, $210, $322, $321","TO __stage07_output","BY HASH($320, $321, $322)"]}],"slotMs":"162933","computeMode":"BIGQUERY"},{"name":"S08: Aggregate","id":"8","startMs":"1762526230338","endMs":"1762526230395","inputStages":["7"],"waitRatioAvg":0.2639751552795031,"waitMsAvg":"85","waitRatioMax":0.2670807453416149,"waitMsMax":"86","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.040372670807453416,"computeMsAvg":"13","computeRatioMax":0.06521739130434782,"computeMsMax":"21","writeRatioAvg":0.034161490683229816,"writeMsAvg":"11","writeRatioMax":0.059006211180124224,"writeMsMax":"19","shuffleOutputBytes":"25298","shuffleOutputBytesSpilled":"0","recordsRead":"2758","recordsWritten":"182","parallelInputs":"231","completedParallelInputs":"231","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$320, $210, $322, $321","FROM __stage07_output"]},{"kind":"AGGREGATE","substeps":["GROUP BY $330 := $320, $331 := $321, $332 := $322","$190 := SUM_OF_COUNTS($210)"]},{"kind":"WRITE","substeps":["$330, $190, $332, $331","TO __stage08_output"]}],"slotMs":"14090","computeMode":"BIGQUERY"},{"name":"S09: Sort+","id":"9","startMs":"1762526230638","endMs":"1762526230697","inputStages":["8"],"waitRatioAvg":0.7204968944099379,"waitMsAvg":"232","waitRatioMax":0.7236024844720497,"waitMsMax":"233","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.034161490683229816,"computeMsAvg":"11","computeRatioMax":0.059006211180124224,"computeMsMax":"19","writeRatioAvg":0.043478260869565216,"writeMsAvg":"14","writeRatioMax":0.07453416149068323,"writeMsMax":"24","shuffleOutputBytes":"37582","shuffleOutputBytesSpilled":"0","recordsRead":"182","recordsWritten":"119","parallelInputs":"101","completedParallelInputs":"101","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$330, $190, $332, $331","FROM __stage08_output"]},{"kind":"READ","substeps":["$355","FROM __BROADCAST0"]},{"kind":"READ","substeps":["$200, $201, $202, $203","FROM __SHUFFLE3"]},{"kind":"AGGREGATE","substeps":["GROUP BY $380 := $140, $381 := $120","$110 := SHARD_ARRAY_AGG($124 ORDER BY $123 ASC, $122 ASC)","$111 := SHARD_ARRAY_AGG($121 ORDER BY $123 ASC, $122 ASC)","$112 := SHARD_ARRAY_AGG($122 ORDER BY $123 ASC, $122 ASC)","$113 := SHARD_ARRAY_AGG($123 ORDER BY $123 ASC, $122 ASC)"]},{"kind":"COMPUTE","substeps":["$120 := if(equal($140, 1), $160, NULL)","$121 := if(equal($140, 0), $162, NULL)","$122 := if(equal($140, 0), $163, NULL)","$123 := if(equal($140, 0), $160, NULL)","$124 := if(equal($140, 0), 1, NULL)"]},{"kind":"COMPUTE","substeps":["$130 := ARRAY<...>"]},{"kind":"FILTER","substeps":["equal($161, 1)"]},{"kind":"ANALYTIC_FUNCTION","substeps":["$170 := ROW_NUMBER() OVER (PARTITION BY $340, $343 ORDER BY $341 DESC)"]},{"kind":"SORT","substeps":["$220 ASC, $223 ASC, $221 DESC"]},{"kind":"ANALYTIC_FUNCTION","substeps":["$180 := ROW_NUMBER($355) OVER (PARTITION BY $360, $363 ORDER BY $361 DESC)"]},{"kind":"SORT","substeps":["$200 ASC, $203 ASC, $201 DESC"]},{"kind":"WRITE","substeps":["$110, $111, $112, $113, $381, $380","TO __stage09_output","BY HASH($380, $381)"]}],"slotMs":"8238","computeMode":"BIGQUERY"},{"name":"S0A: Aggregate+","id":"10","startMs":"1762526230940","endMs":"1762526230975","inputStages":["9"],"waitRatioAvg":0.7267080745341615,"waitMsAvg":"234","waitRatioMax":0.7267080745341615,"waitMsMax":"234","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.037267080745341616,"computeMsAvg":"12","computeRatioMax":0.052795031055900624,"computeMsMax":"17","writeRatioAvg":0.046583850931677016,"writeMsAvg":"15","writeRatioMax":0.055900621118012424,"writeMsMax":"18","shuffleOutputBytes":"9382","shuffleOutputBytesSpilled":"0","recordsRead":"119","recordsWritten":"11","parallelInputs":"10","completedParallelInputs":"10","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$110, $111, $112, $113, $381, $380","FROM __stage09_output"]},{"kind":"AGGREGATE","substeps":["GROUP BY $400 := $390","$80 := COUNT($94)","$81 := ANY_VALUE($93)","$82 := ANY_VALUE($92)","$83 := ANY_VALUE($91)","$84 := ANY_VALUE($90)"]},{"kind":"COMPUTE","substeps":["$90 := if(equal($390, 0), $103, NULL)","$91 := if(equal($390, 0), $102, NULL)","$92 := if(equal($390, 0), $101, NULL)","$93 := if(equal($390, 0), $100, NULL)","$94 := if(equal($390, 1), $391, NULL)"]},{"kind":"AGGREGATE","substeps":["GROUP BY $390 := $380, $391 := $381","$100 := ROOT_ARRAY_AGG($110 ORDER BY  ASC,  ASC)","$101 := ROOT_ARRAY_AGG($111 ORDER BY  ASC,  ASC)","$102 := ROOT_ARRAY_AGG($112 ORDER BY  ASC,  ASC)","$103 := ROOT_ARRAY_AGG($113 ORDER BY  ASC,  ASC)"]},{"kind":"WRITE","substeps":["$80, $81, $82, $83, $84, $400","TO __stage0A_output","BY HASH($400)"]}],"slotMs":"471","computeMode":"BIGQUERY"},{"name":"S0B: Aggregate+","id":"11","startMs":"1762526231239","endMs":"1762526231283","inputStages":["10"],"waitRatioAvg":0.8136645962732919,"waitMsAvg":"262","waitRatioMax":0.8136645962732919,"waitMsMax":"262","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.034161490683229816,"computeMsAvg":"11","computeRatioMax":0.034161490683229816,"computeMsMax":"11","writeRatioAvg":0.049689440993788817,"writeMsAvg":"16","writeRatioMax":0.049689440993788817,"writeMsMax":"16","shuffleOutputBytes":"9153","shuffleOutputBytesSpilled":"0","recordsRead":"11","recordsWritten":"1","parallelInputs":"1","completedParallelInputs":"1","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$80, $81, $82, $83, $84, $400","FROM __stage0A_output"]},{"kind":"AGGREGATE","substeps":["$50 := ANY_VALUE($64)","$51 := ANY_VALUE($63)","$52 := ANY_VALUE($62)","$53 := ANY_VALUE($61)","$54 := ANY_VALUE($60)"]},{"kind":"COMPUTE","substeps":["$60 := if(equal($410, 0), $74, NULL)","$61 := if(equal($410, 0), $73, NULL)","$62 := if(equal($410, 0), $72, NULL)","$63 := if(equal($410, 0), $71, NULL)","$64 := if(equal($410, 1), $70, NULL)"]},{"kind":"AGGREGATE","substeps":["GROUP BY $410 := $400","$70 := SUM_OF_COUNTS($80)","$71 := ANY_VALUE($81)","$72 := ANY_VALUE($82)","$73 := ANY_VALUE($83)","$74 := ANY_VALUE($84)"]},{"kind":"WRITE","substeps":["$50, $51, $52, $53, $54","TO __stage0B_output"]}],"slotMs":"31","computeMode":"BIGQUERY"},{"name":"S0C: Output","id":"12","startMs":"1762526231239","endMs":"1762526231288","inputStages":["11"],"waitRatioAvg":0.7888198757763976,"waitMsAvg":"254","waitRatioMax":0.7888198757763976,"waitMsMax":"254","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.018633540372670808,"computeMsAvg":"6","computeRatioMax":0.018633540372670808,"computeMsMax":"6","writeRatioAvg":0.012422360248447204,"writeMsAvg":"4","writeRatioMax":0.012422360248447204,"writeMsMax":"4","shuffleOutputBytes":"9884","shuffleOutputBytesSpilled":"0","recordsRead":"1","recordsWritten":"1","parallelInputs":"1","completedParallelInputs":"1","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$50, $51, $52, $53, $54","FROM __stage0B_output"]},{"kind":"COMPUTE","substeps":["$30 := MAKE_STRUCT($44, $43, $42, $41)","$31 := if(is_null($40), 0, $40)"]},{"kind":"AGGREGATE","substeps":["$40 := ANY_VALUE($50)","$41 := ANY_VALUE($51)","$42 := ANY_VALUE($52)","$43 := ANY_VALUE($53)","$44 := ANY_VALUE($54)"]},{"kind":"WRITE","substeps":["$30, $31","TO __stage0C_output"]}],"slotMs":"51","computeMode":"BIGQUERY"}],"estimatedBytesProcessed":"5555133989","timeline":[{"elapsedMs":"1547","totalSlotMs":"609042","pendingUnits":"0","completedUnits":"0","activeUnits":"0"},{"elapsedMs":"2547","totalSlotMs":"609597","pendingUnits":"1357","completedUnits":"2441","activeUnits":"971","estimatedRunnableUnits":"0"},{"elapsedMs":"3547","totalSlotMs":"609597","pendingUnits":"2034","completedUnits":"4277","activeUnits":"0","estimatedRunnableUnits":"0"},{"elapsedMs":"4843","totalSlotMs":"609597","pendingUnits":"0","completedUnits":"6655","activeUnits":"10","estimatedRunnableUnits":"0"}],"totalPartitionsProcessed":"3798","totalBytesProcessed":"5555133989","totalBytesBilled":"5555355648","billingTier":1,"totalSlotMs":"609597","cacheHit":false,"referencedTables":[{"projectId":"bigquery-public-data","datasetId":"crypto_ethereum_classic","tableId":"logs"},{"projectId":"bigquery-public-data","datasetId":"crypto_ethereum_classic","tableId":"contracts"}],"statementType":"SELECT","searchStatistics":{"indexUsageMode":"UNUSED","indexUnusedReasons":[{"code":"INDEX_CONFIG_NOT_AVAILABLE","message":"There is no index configuration for the base table `bigquery-public-data:crypto_ethereum_classic.contracts`.","baseTable":{"projectId":"bigquery-public-data","datasetId":"crypto_ethereum_classic","tableId":"contracts"}},{"code":"INDEX_CONFIG_NOT_AVAILABLE","message":"There is no index configuration for the base table `bigquery-public-data:crypto_ethereum_classic.logs`.","baseTable":{"projectId":"bigquery-public-data","datasetId":"crypto_ethereum_classic","tableId":"logs"}}]},"performanceInsights":{"avgPreviousExecutionMs":"2877"},"transferredBytes":"0","metadataCacheStatistics":{"tableMetadataCacheUsage":[{"tableReference":{"projectId":"bigquery-public-data","datasetId":"crypto_ethereum_classic","tableId":"logs"},"unusedReason":"OTHER_REASON"},{"tableReference":{"projectId":"bigquery-public-data","datasetId":"crypto_ethereum_classic","tableId":"contracts"},"unusedReason":"OTHER_REASON"}]}},"totalSlotMs":"609597","finalExecutionDurationMs":"2502"},"status":{"state":"DONE"},"principal_subject":"user:admin@bentrollope.altostrat.com","jobCreationReason":{"code":"REQUESTED"}}'
+ total_slot_ms=609597
++ jq -r .statistics.startTime
++ echo '{"kind":"bigquery#job","etag":"dTzYWIKMTuVKO/uQ4lPshQ==","id":"tony-allen:US.bqjob_r771b8ddb25c487fd_0000019a5ebfe6c8_1","selfLink":"https://bigquery.googleapis.com/bigquery/v2/projects/tony-allen/jobs/bqjob_r771b8ddb25c487fd_0000019a5ebfe6c8_1?location=US","user_email":"admin@bentrollope.altostrat.com","configuration":{"query":{"query":"WITH ERC20_Contracts AS (\n    SELECT address FROM `bigquery-public-data.crypto_ethereum_classic.contracts` WHERE is_erc20 = TRUE\n),\nMonthlyLogCounts AS (\n    SELECT\n        t1.address,\n        FORMAT_DATE('\''%Y-%m'\'', t1.block_timestamp) AS transaction_month, \n        COUNT(t1.log_index) AS log_event_count \n    FROM\n        `bigquery-public-data.crypto_ethereum_classic.logs` AS t1\n    INNER JOIN\n        ERC20_Contracts AS t2 ON t1.address = t2.address\n    GROUP BY\n        1, 2\n    HAVING\n        log_event_count > 1000\n),\nFrequentTopics AS (\n    SELECT\n        t1.address,\n        t1.transaction_month,\n        topic,\n        ROW_NUMBER() OVER (PARTITION BY t1.address, t1.transaction_month ORDER BY COUNT(topic) DESC) AS topic_rank\n    FROM\n        MonthlyLogCounts AS t1 -- Joins the already filtered and aggregated small list\n    INNER JOIN\n        `bigquery-public-data.crypto_ethereum_classic.logs` AS t2 \n        ON t1.address = t2.address AND FORMAT_DATE('\''%Y-%m'\'', t2.block_timestamp) = t1.transaction_month\n    CROSS JOIN\n        UNNEST(t2.topics) AS topic WITH OFFSET AS topic_index\n    WHERE\n        topic_index = 0\n    GROUP BY\n        1, 2, 3\n)\nSELECT\n    COUNT(DISTINCT address) AS unique_erc20_contracts_exceeding_1k,\n    ARRAY_AGG(\n        STRUCT(t1.address, t1.transaction_month, t1.topic AS most_frequent_signature_hash) \n        ORDER BY t1.address, t1.transaction_month\n    ) AS details_by_contract_and_month\nFROM FrequentTopics AS t1\nWHERE t1.topic_rank = 1","destinationTable":{"projectId":"tony-allen","datasetId":"_e34c49c766e4fd3f5d404c3949b9e19fa7acb372","tableId":"anon0319fea4_7cc3_4aac_a596_39df1d13ceff"},"writeDisposition":"WRITE_TRUNCATE","priority":"INTERACTIVE","useQueryCache":false,"useLegacySql":false},"jobType":"QUERY"},"jobReference":{"projectId":"tony-allen","jobId":"bqjob_r771b8ddb25c487fd_0000019a5ebfe6c8_1","location":"US"},"statistics":{"creationTime":"1762526226356","startTime":"1762526226453","endTime":"1762526231512","totalBytesProcessed":"5555133989","query":{"queryPlan":[{"name":"S00: Input","id":"0","startMs":"1762526228839","endMs":"1762526229014","waitRatioAvg":0.006211180124223602,"waitMsAvg":"2","waitRatioMax":0.012422360248447204,"waitMsMax":"4","readRatioAvg":0.037267080745341616,"readMsAvg":"12","readRatioMax":0.484472049689441,"readMsMax":"156","computeRatioAvg":0.040372670807453416,"computeMsAvg":"13","computeRatioMax":0.13043478260869565,"computeMsMax":"42","writeRatioAvg":0.015527950310559006,"writeMsAvg":"5","writeRatioMax":0.08385093167701864,"writeMsMax":"27","shuffleOutputBytes":"481938","shuffleOutputBytesSpilled":"0","recordsRead":"7724950","recordsWritten":"10254","parallelInputs":"1864","completedParallelInputs":"1864","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$20:address, $21:is_erc20","FROM bigquery-public-data.crypto_ethereum_classic.contracts","WHERE $21"]},{"kind":"WRITE","substeps":["$20","TO __stage00_output"]}],"slotMs":"21426","computeMode":"BIGQUERY"},{"name":"S02: Coalesce","id":"2","startMs":"1762526229238","endMs":"1762526229329","inputStages":["0"],"waitRatioAvg":0.6211180124223602,"waitMsAvg":"200","waitRatioMax":0.6242236024844721,"waitMsMax":"201","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.034161490683229816,"computeMsAvg":"11","computeRatioMax":0.059006211180124224,"computeMsMax":"19","writeRatioAvg":0.043478260869565216,"writeMsAvg":"14","writeRatioMax":0.10248447204968944,"writeMsMax":"33","shuffleOutputBytes":"481938","shuffleOutputBytesSpilled":"0","recordsRead":"10254","recordsWritten":"10254","parallelInputs":"100","completedParallelInputs":"100","status":"COMPLETE","steps":[{"kind":"READ","substeps":["FROM __stage00_output"]}],"slotMs":"9362","computeMode":"BIGQUERY"},{"name":"S03: Join+","id":"3","startMs":"1762526229242","endMs":"1762526229616","inputStages":["2"],"waitRatioAvg":0.7857142857142857,"waitMsAvg":"253","waitRatioMax":1,"waitMsMax":"322","readRatioAvg":0.024844720496894408,"readMsAvg":"8","readRatioMax":0.6925465838509317,"readMsMax":"223","computeRatioAvg":0.059006211180124224,"computeMsAvg":"19","computeRatioMax":0.2732919254658385,"computeMsMax":"88","writeRatioAvg":0.021739130434782608,"writeMsAvg":"7","writeRatioMax":0.13354037267080746,"writeMsMax":"43","shuffleOutputBytes":"614244","shuffleOutputBytesSpilled":"0","recordsRead":"31975135","recordsWritten":"9033","parallelInputs":"1934","completedParallelInputs":"1934","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$10:log_index, $11:address, $12:block_timestamp","FROM bigquery-public-data.crypto_ethereum_classic.logs"]},{"kind":"READ","substeps":["$20","FROM __stage02_output"]},{"kind":"AGGREGATE","substeps":["GROUP BY $290 := $281, $291 := $270","$260 := COUNT($280)"]},{"kind":"COMPUTE","substeps":["$270 := format_timestamp('\''%Y-%m'\'', $282)"]},{"kind":"JOIN","substeps":["$280 := $10, $281 := $11, $282 := $12","INNER HASH JOIN EACH  WITH ALL  ON $11 = $20"]},{"kind":"WRITE","substeps":["$290, $260, $291","TO __stage03_output","BY HASH($290, $291)"]}],"slotMs":"195853","computeMode":"BIGQUERY"},{"name":"S05: Aggregate+","id":"5","startMs":"1762526229741","endMs":"1762526229861","inputStages":["3"],"waitRatioAvg":0.391304347826087,"waitMsAvg":"126","waitRatioMax":0.5559006211180124,"waitMsMax":"179","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.040372670807453416,"computeMsAvg":"13","computeRatioMax":0.08695652173913043,"computeMsMax":"28","writeRatioAvg":0.012422360248447204,"writeMsAvg":"4","writeRatioMax":0.055900621118012424,"writeMsMax":"18","shuffleOutputBytes":"4071","shuffleOutputBytesSpilled":"0","recordsRead":"9033","recordsWritten":"69","parallelInputs":"379","completedParallelInputs":"379","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$290, $260, $291","FROM __stage03_output"]},{"kind":"FILTER","substeps":["greater($250, 1000)"]},{"kind":"AGGREGATE","substeps":["GROUP BY $300 := $290, $301 := $291","$250 := SUM_OF_COUNTS($260)"]},{"kind":"WRITE","substeps":["$300, $301","TO __stage05_output"]}],"slotMs":"17518","computeMode":"BIGQUERY"},{"name":"S06: Coalesce","id":"6","startMs":"1762526230037","endMs":"1762526230100","inputStages":["5"],"waitRatioAvg":0.45652173913043476,"waitMsAvg":"147","waitRatioMax":0.45962732919254656,"waitMsMax":"148","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.031055900621118012,"computeMsAvg":"10","computeRatioMax":0.049689440993788817,"computeMsMax":"16","writeRatioAvg":0.037267080745341616,"writeMsAvg":"12","writeRatioMax":0.06521739130434782,"writeMsMax":"21","shuffleOutputBytes":"4071","shuffleOutputBytesSpilled":"0","recordsRead":"69","recordsWritten":"69","parallelInputs":"100","completedParallelInputs":"100","status":"COMPLETE","steps":[{"kind":"READ","substeps":["FROM __stage05_output"]}],"slotMs":"6768","computeMode":"BIGQUERY"},{"name":"S07: Join+","id":"7","startMs":"1762526230041","endMs":"1762526230236","inputStages":["6"],"waitRatioAvg":0.6086956521739131,"waitMsAvg":"196","waitRatioMax":0.8167701863354038,"waitMsMax":"263","readRatioAvg":0.021739130434782608,"readMsAvg":"7","readRatioMax":0.12111801242236025,"readMsMax":"39","computeRatioAvg":0.07142857142857142,"computeMsAvg":"23","computeRatioMax":0.46273291925465837,"computeMsMax":"149","writeRatioAvg":0.009316770186335404,"writeMsAvg":"3","writeRatioMax":0.12422360248447205,"writeMsMax":"40","shuffleOutputBytes":"383362","shuffleOutputBytesSpilled":"0","recordsRead":"12277345","recordsWritten":"2758","parallelInputs":"1934","completedParallelInputs":"1934","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$1:address, $2:topics, $3:block_timestamp","FROM bigquery-public-data.crypto_ethereum_classic.logs"]},{"kind":"READ","substeps":["$300, $301","FROM __stage06_output"]},{"kind":"AGGREGATE","substeps":["GROUP BY $320 := $310, $321 := $311, $322 := $240","$210 := COUNT($240)"]},{"kind":"JOIN","substeps":["$312 := $2, $310 := $300, $311 := $301","INNER HASH JOIN EACH  WITH ALL  ON $1 = $300, $230 = $301"]},{"kind":"COMPUTE","substeps":["$230 := format_timestamp('\''%Y-%m'\'', $3)"]},{"kind":"FILTER","substeps":["equal($241, 0)"]},{"kind":"WRITE","substeps":["$320, $210, $322, $321","TO __stage07_output","BY HASH($320, $321, $322)"]}],"slotMs":"162933","computeMode":"BIGQUERY"},{"name":"S08: Aggregate","id":"8","startMs":"1762526230338","endMs":"1762526230395","inputStages":["7"],"waitRatioAvg":0.2639751552795031,"waitMsAvg":"85","waitRatioMax":0.2670807453416149,"waitMsMax":"86","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.040372670807453416,"computeMsAvg":"13","computeRatioMax":0.06521739130434782,"computeMsMax":"21","writeRatioAvg":0.034161490683229816,"writeMsAvg":"11","writeRatioMax":0.059006211180124224,"writeMsMax":"19","shuffleOutputBytes":"25298","shuffleOutputBytesSpilled":"0","recordsRead":"2758","recordsWritten":"182","parallelInputs":"231","completedParallelInputs":"231","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$320, $210, $322, $321","FROM __stage07_output"]},{"kind":"AGGREGATE","substeps":["GROUP BY $330 := $320, $331 := $321, $332 := $322","$190 := SUM_OF_COUNTS($210)"]},{"kind":"WRITE","substeps":["$330, $190, $332, $331","TO __stage08_output"]}],"slotMs":"14090","computeMode":"BIGQUERY"},{"name":"S09: Sort+","id":"9","startMs":"1762526230638","endMs":"1762526230697","inputStages":["8"],"waitRatioAvg":0.7204968944099379,"waitMsAvg":"232","waitRatioMax":0.7236024844720497,"waitMsMax":"233","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.034161490683229816,"computeMsAvg":"11","computeRatioMax":0.059006211180124224,"computeMsMax":"19","writeRatioAvg":0.043478260869565216,"writeMsAvg":"14","writeRatioMax":0.07453416149068323,"writeMsMax":"24","shuffleOutputBytes":"37582","shuffleOutputBytesSpilled":"0","recordsRead":"182","recordsWritten":"119","parallelInputs":"101","completedParallelInputs":"101","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$330, $190, $332, $331","FROM __stage08_output"]},{"kind":"READ","substeps":["$355","FROM __BROADCAST0"]},{"kind":"READ","substeps":["$200, $201, $202, $203","FROM __SHUFFLE3"]},{"kind":"AGGREGATE","substeps":["GROUP BY $380 := $140, $381 := $120","$110 := SHARD_ARRAY_AGG($124 ORDER BY $123 ASC, $122 ASC)","$111 := SHARD_ARRAY_AGG($121 ORDER BY $123 ASC, $122 ASC)","$112 := SHARD_ARRAY_AGG($122 ORDER BY $123 ASC, $122 ASC)","$113 := SHARD_ARRAY_AGG($123 ORDER BY $123 ASC, $122 ASC)"]},{"kind":"COMPUTE","substeps":["$120 := if(equal($140, 1), $160, NULL)","$121 := if(equal($140, 0), $162, NULL)","$122 := if(equal($140, 0), $163, NULL)","$123 := if(equal($140, 0), $160, NULL)","$124 := if(equal($140, 0), 1, NULL)"]},{"kind":"COMPUTE","substeps":["$130 := ARRAY<...>"]},{"kind":"FILTER","substeps":["equal($161, 1)"]},{"kind":"ANALYTIC_FUNCTION","substeps":["$170 := ROW_NUMBER() OVER (PARTITION BY $340, $343 ORDER BY $341 DESC)"]},{"kind":"SORT","substeps":["$220 ASC, $223 ASC, $221 DESC"]},{"kind":"ANALYTIC_FUNCTION","substeps":["$180 := ROW_NUMBER($355) OVER (PARTITION BY $360, $363 ORDER BY $361 DESC)"]},{"kind":"SORT","substeps":["$200 ASC, $203 ASC, $201 DESC"]},{"kind":"WRITE","substeps":["$110, $111, $112, $113, $381, $380","TO __stage09_output","BY HASH($380, $381)"]}],"slotMs":"8238","computeMode":"BIGQUERY"},{"name":"S0A: Aggregate+","id":"10","startMs":"1762526230940","endMs":"1762526230975","inputStages":["9"],"waitRatioAvg":0.7267080745341615,"waitMsAvg":"234","waitRatioMax":0.7267080745341615,"waitMsMax":"234","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.037267080745341616,"computeMsAvg":"12","computeRatioMax":0.052795031055900624,"computeMsMax":"17","writeRatioAvg":0.046583850931677016,"writeMsAvg":"15","writeRatioMax":0.055900621118012424,"writeMsMax":"18","shuffleOutputBytes":"9382","shuffleOutputBytesSpilled":"0","recordsRead":"119","recordsWritten":"11","parallelInputs":"10","completedParallelInputs":"10","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$110, $111, $112, $113, $381, $380","FROM __stage09_output"]},{"kind":"AGGREGATE","substeps":["GROUP BY $400 := $390","$80 := COUNT($94)","$81 := ANY_VALUE($93)","$82 := ANY_VALUE($92)","$83 := ANY_VALUE($91)","$84 := ANY_VALUE($90)"]},{"kind":"COMPUTE","substeps":["$90 := if(equal($390, 0), $103, NULL)","$91 := if(equal($390, 0), $102, NULL)","$92 := if(equal($390, 0), $101, NULL)","$93 := if(equal($390, 0), $100, NULL)","$94 := if(equal($390, 1), $391, NULL)"]},{"kind":"AGGREGATE","substeps":["GROUP BY $390 := $380, $391 := $381","$100 := ROOT_ARRAY_AGG($110 ORDER BY  ASC,  ASC)","$101 := ROOT_ARRAY_AGG($111 ORDER BY  ASC,  ASC)","$102 := ROOT_ARRAY_AGG($112 ORDER BY  ASC,  ASC)","$103 := ROOT_ARRAY_AGG($113 ORDER BY  ASC,  ASC)"]},{"kind":"WRITE","substeps":["$80, $81, $82, $83, $84, $400","TO __stage0A_output","BY HASH($400)"]}],"slotMs":"471","computeMode":"BIGQUERY"},{"name":"S0B: Aggregate+","id":"11","startMs":"1762526231239","endMs":"1762526231283","inputStages":["10"],"waitRatioAvg":0.8136645962732919,"waitMsAvg":"262","waitRatioMax":0.8136645962732919,"waitMsMax":"262","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.034161490683229816,"computeMsAvg":"11","computeRatioMax":0.034161490683229816,"computeMsMax":"11","writeRatioAvg":0.049689440993788817,"writeMsAvg":"16","writeRatioMax":0.049689440993788817,"writeMsMax":"16","shuffleOutputBytes":"9153","shuffleOutputBytesSpilled":"0","recordsRead":"11","recordsWritten":"1","parallelInputs":"1","completedParallelInputs":"1","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$80, $81, $82, $83, $84, $400","FROM __stage0A_output"]},{"kind":"AGGREGATE","substeps":["$50 := ANY_VALUE($64)","$51 := ANY_VALUE($63)","$52 := ANY_VALUE($62)","$53 := ANY_VALUE($61)","$54 := ANY_VALUE($60)"]},{"kind":"COMPUTE","substeps":["$60 := if(equal($410, 0), $74, NULL)","$61 := if(equal($410, 0), $73, NULL)","$62 := if(equal($410, 0), $72, NULL)","$63 := if(equal($410, 0), $71, NULL)","$64 := if(equal($410, 1), $70, NULL)"]},{"kind":"AGGREGATE","substeps":["GROUP BY $410 := $400","$70 := SUM_OF_COUNTS($80)","$71 := ANY_VALUE($81)","$72 := ANY_VALUE($82)","$73 := ANY_VALUE($83)","$74 := ANY_VALUE($84)"]},{"kind":"WRITE","substeps":["$50, $51, $52, $53, $54","TO __stage0B_output"]}],"slotMs":"31","computeMode":"BIGQUERY"},{"name":"S0C: Output","id":"12","startMs":"1762526231239","endMs":"1762526231288","inputStages":["11"],"waitRatioAvg":0.7888198757763976,"waitMsAvg":"254","waitRatioMax":0.7888198757763976,"waitMsMax":"254","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.018633540372670808,"computeMsAvg":"6","computeRatioMax":0.018633540372670808,"computeMsMax":"6","writeRatioAvg":0.012422360248447204,"writeMsAvg":"4","writeRatioMax":0.012422360248447204,"writeMsMax":"4","shuffleOutputBytes":"9884","shuffleOutputBytesSpilled":"0","recordsRead":"1","recordsWritten":"1","parallelInputs":"1","completedParallelInputs":"1","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$50, $51, $52, $53, $54","FROM __stage0B_output"]},{"kind":"COMPUTE","substeps":["$30 := MAKE_STRUCT($44, $43, $42, $41)","$31 := if(is_null($40), 0, $40)"]},{"kind":"AGGREGATE","substeps":["$40 := ANY_VALUE($50)","$41 := ANY_VALUE($51)","$42 := ANY_VALUE($52)","$43 := ANY_VALUE($53)","$44 := ANY_VALUE($54)"]},{"kind":"WRITE","substeps":["$30, $31","TO __stage0C_output"]}],"slotMs":"51","computeMode":"BIGQUERY"}],"estimatedBytesProcessed":"5555133989","timeline":[{"elapsedMs":"1547","totalSlotMs":"609042","pendingUnits":"0","completedUnits":"0","activeUnits":"0"},{"elapsedMs":"2547","totalSlotMs":"609597","pendingUnits":"1357","completedUnits":"2441","activeUnits":"971","estimatedRunnableUnits":"0"},{"elapsedMs":"3547","totalSlotMs":"609597","pendingUnits":"2034","completedUnits":"4277","activeUnits":"0","estimatedRunnableUnits":"0"},{"elapsedMs":"4843","totalSlotMs":"609597","pendingUnits":"0","completedUnits":"6655","activeUnits":"10","estimatedRunnableUnits":"0"}],"totalPartitionsProcessed":"3798","totalBytesProcessed":"5555133989","totalBytesBilled":"5555355648","billingTier":1,"totalSlotMs":"609597","cacheHit":false,"referencedTables":[{"projectId":"bigquery-public-data","datasetId":"crypto_ethereum_classic","tableId":"logs"},{"projectId":"bigquery-public-data","datasetId":"crypto_ethereum_classic","tableId":"contracts"}],"statementType":"SELECT","searchStatistics":{"indexUsageMode":"UNUSED","indexUnusedReasons":[{"code":"INDEX_CONFIG_NOT_AVAILABLE","message":"There is no index configuration for the base table `bigquery-public-data:crypto_ethereum_classic.contracts`.","baseTable":{"projectId":"bigquery-public-data","datasetId":"crypto_ethereum_classic","tableId":"contracts"}},{"code":"INDEX_CONFIG_NOT_AVAILABLE","message":"There is no index configuration for the base table `bigquery-public-data:crypto_ethereum_classic.logs`.","baseTable":{"projectId":"bigquery-public-data","datasetId":"crypto_ethereum_classic","tableId":"logs"}}]},"performanceInsights":{"avgPreviousExecutionMs":"2877"},"transferredBytes":"0","metadataCacheStatistics":{"tableMetadataCacheUsage":[{"tableReference":{"projectId":"bigquery-public-data","datasetId":"crypto_ethereum_classic","tableId":"logs"},"unusedReason":"OTHER_REASON"},{"tableReference":{"projectId":"bigquery-public-data","datasetId":"crypto_ethereum_classic","tableId":"contracts"},"unusedReason":"OTHER_REASON"}]}},"totalSlotMs":"609597","finalExecutionDurationMs":"2502"},"status":{"state":"DONE"},"principal_subject":"user:admin@bentrollope.altostrat.com","jobCreationReason":{"code":"REQUESTED"}}'
+ start_time=1762526226453
++ jq -r .statistics.endTime
++ echo '{"kind":"bigquery#job","etag":"dTzYWIKMTuVKO/uQ4lPshQ==","id":"tony-allen:US.bqjob_r771b8ddb25c487fd_0000019a5ebfe6c8_1","selfLink":"https://bigquery.googleapis.com/bigquery/v2/projects/tony-allen/jobs/bqjob_r771b8ddb25c487fd_0000019a5ebfe6c8_1?location=US","user_email":"admin@bentrollope.altostrat.com","configuration":{"query":{"query":"WITH ERC20_Contracts AS (\n    SELECT address FROM `bigquery-public-data.crypto_ethereum_classic.contracts` WHERE is_erc20 = TRUE\n),\nMonthlyLogCounts AS (\n    SELECT\n        t1.address,\n        FORMAT_DATE('\''%Y-%m'\'', t1.block_timestamp) AS transaction_month, \n        COUNT(t1.log_index) AS log_event_count \n    FROM\n        `bigquery-public-data.crypto_ethereum_classic.logs` AS t1\n    INNER JOIN\n        ERC20_Contracts AS t2 ON t1.address = t2.address\n    GROUP BY\n        1, 2\n    HAVING\n        log_event_count > 1000\n),\nFrequentTopics AS (\n    SELECT\n        t1.address,\n        t1.transaction_month,\n        topic,\n        ROW_NUMBER() OVER (PARTITION BY t1.address, t1.transaction_month ORDER BY COUNT(topic) DESC) AS topic_rank\n    FROM\n        MonthlyLogCounts AS t1 -- Joins the already filtered and aggregated small list\n    INNER JOIN\n        `bigquery-public-data.crypto_ethereum_classic.logs` AS t2 \n        ON t1.address = t2.address AND FORMAT_DATE('\''%Y-%m'\'', t2.block_timestamp) = t1.transaction_month\n    CROSS JOIN\n        UNNEST(t2.topics) AS topic WITH OFFSET AS topic_index\n    WHERE\n        topic_index = 0\n    GROUP BY\n        1, 2, 3\n)\nSELECT\n    COUNT(DISTINCT address) AS unique_erc20_contracts_exceeding_1k,\n    ARRAY_AGG(\n        STRUCT(t1.address, t1.transaction_month, t1.topic AS most_frequent_signature_hash) \n        ORDER BY t1.address, t1.transaction_month\n    ) AS details_by_contract_and_month\nFROM FrequentTopics AS t1\nWHERE t1.topic_rank = 1","destinationTable":{"projectId":"tony-allen","datasetId":"_e34c49c766e4fd3f5d404c3949b9e19fa7acb372","tableId":"anon0319fea4_7cc3_4aac_a596_39df1d13ceff"},"writeDisposition":"WRITE_TRUNCATE","priority":"INTERACTIVE","useQueryCache":false,"useLegacySql":false},"jobType":"QUERY"},"jobReference":{"projectId":"tony-allen","jobId":"bqjob_r771b8ddb25c487fd_0000019a5ebfe6c8_1","location":"US"},"statistics":{"creationTime":"1762526226356","startTime":"1762526226453","endTime":"1762526231512","totalBytesProcessed":"5555133989","query":{"queryPlan":[{"name":"S00: Input","id":"0","startMs":"1762526228839","endMs":"1762526229014","waitRatioAvg":0.006211180124223602,"waitMsAvg":"2","waitRatioMax":0.012422360248447204,"waitMsMax":"4","readRatioAvg":0.037267080745341616,"readMsAvg":"12","readRatioMax":0.484472049689441,"readMsMax":"156","computeRatioAvg":0.040372670807453416,"computeMsAvg":"13","computeRatioMax":0.13043478260869565,"computeMsMax":"42","writeRatioAvg":0.015527950310559006,"writeMsAvg":"5","writeRatioMax":0.08385093167701864,"writeMsMax":"27","shuffleOutputBytes":"481938","shuffleOutputBytesSpilled":"0","recordsRead":"7724950","recordsWritten":"10254","parallelInputs":"1864","completedParallelInputs":"1864","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$20:address, $21:is_erc20","FROM bigquery-public-data.crypto_ethereum_classic.contracts","WHERE $21"]},{"kind":"WRITE","substeps":["$20","TO __stage00_output"]}],"slotMs":"21426","computeMode":"BIGQUERY"},{"name":"S02: Coalesce","id":"2","startMs":"1762526229238","endMs":"1762526229329","inputStages":["0"],"waitRatioAvg":0.6211180124223602,"waitMsAvg":"200","waitRatioMax":0.6242236024844721,"waitMsMax":"201","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.034161490683229816,"computeMsAvg":"11","computeRatioMax":0.059006211180124224,"computeMsMax":"19","writeRatioAvg":0.043478260869565216,"writeMsAvg":"14","writeRatioMax":0.10248447204968944,"writeMsMax":"33","shuffleOutputBytes":"481938","shuffleOutputBytesSpilled":"0","recordsRead":"10254","recordsWritten":"10254","parallelInputs":"100","completedParallelInputs":"100","status":"COMPLETE","steps":[{"kind":"READ","substeps":["FROM __stage00_output"]}],"slotMs":"9362","computeMode":"BIGQUERY"},{"name":"S03: Join+","id":"3","startMs":"1762526229242","endMs":"1762526229616","inputStages":["2"],"waitRatioAvg":0.7857142857142857,"waitMsAvg":"253","waitRatioMax":1,"waitMsMax":"322","readRatioAvg":0.024844720496894408,"readMsAvg":"8","readRatioMax":0.6925465838509317,"readMsMax":"223","computeRatioAvg":0.059006211180124224,"computeMsAvg":"19","computeRatioMax":0.2732919254658385,"computeMsMax":"88","writeRatioAvg":0.021739130434782608,"writeMsAvg":"7","writeRatioMax":0.13354037267080746,"writeMsMax":"43","shuffleOutputBytes":"614244","shuffleOutputBytesSpilled":"0","recordsRead":"31975135","recordsWritten":"9033","parallelInputs":"1934","completedParallelInputs":"1934","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$10:log_index, $11:address, $12:block_timestamp","FROM bigquery-public-data.crypto_ethereum_classic.logs"]},{"kind":"READ","substeps":["$20","FROM __stage02_output"]},{"kind":"AGGREGATE","substeps":["GROUP BY $290 := $281, $291 := $270","$260 := COUNT($280)"]},{"kind":"COMPUTE","substeps":["$270 := format_timestamp('\''%Y-%m'\'', $282)"]},{"kind":"JOIN","substeps":["$280 := $10, $281 := $11, $282 := $12","INNER HASH JOIN EACH  WITH ALL  ON $11 = $20"]},{"kind":"WRITE","substeps":["$290, $260, $291","TO __stage03_output","BY HASH($290, $291)"]}],"slotMs":"195853","computeMode":"BIGQUERY"},{"name":"S05: Aggregate+","id":"5","startMs":"1762526229741","endMs":"1762526229861","inputStages":["3"],"waitRatioAvg":0.391304347826087,"waitMsAvg":"126","waitRatioMax":0.5559006211180124,"waitMsMax":"179","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.040372670807453416,"computeMsAvg":"13","computeRatioMax":0.08695652173913043,"computeMsMax":"28","writeRatioAvg":0.012422360248447204,"writeMsAvg":"4","writeRatioMax":0.055900621118012424,"writeMsMax":"18","shuffleOutputBytes":"4071","shuffleOutputBytesSpilled":"0","recordsRead":"9033","recordsWritten":"69","parallelInputs":"379","completedParallelInputs":"379","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$290, $260, $291","FROM __stage03_output"]},{"kind":"FILTER","substeps":["greater($250, 1000)"]},{"kind":"AGGREGATE","substeps":["GROUP BY $300 := $290, $301 := $291","$250 := SUM_OF_COUNTS($260)"]},{"kind":"WRITE","substeps":["$300, $301","TO __stage05_output"]}],"slotMs":"17518","computeMode":"BIGQUERY"},{"name":"S06: Coalesce","id":"6","startMs":"1762526230037","endMs":"1762526230100","inputStages":["5"],"waitRatioAvg":0.45652173913043476,"waitMsAvg":"147","waitRatioMax":0.45962732919254656,"waitMsMax":"148","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.031055900621118012,"computeMsAvg":"10","computeRatioMax":0.049689440993788817,"computeMsMax":"16","writeRatioAvg":0.037267080745341616,"writeMsAvg":"12","writeRatioMax":0.06521739130434782,"writeMsMax":"21","shuffleOutputBytes":"4071","shuffleOutputBytesSpilled":"0","recordsRead":"69","recordsWritten":"69","parallelInputs":"100","completedParallelInputs":"100","status":"COMPLETE","steps":[{"kind":"READ","substeps":["FROM __stage05_output"]}],"slotMs":"6768","computeMode":"BIGQUERY"},{"name":"S07: Join+","id":"7","startMs":"1762526230041","endMs":"1762526230236","inputStages":["6"],"waitRatioAvg":0.6086956521739131,"waitMsAvg":"196","waitRatioMax":0.8167701863354038,"waitMsMax":"263","readRatioAvg":0.021739130434782608,"readMsAvg":"7","readRatioMax":0.12111801242236025,"readMsMax":"39","computeRatioAvg":0.07142857142857142,"computeMsAvg":"23","computeRatioMax":0.46273291925465837,"computeMsMax":"149","writeRatioAvg":0.009316770186335404,"writeMsAvg":"3","writeRatioMax":0.12422360248447205,"writeMsMax":"40","shuffleOutputBytes":"383362","shuffleOutputBytesSpilled":"0","recordsRead":"12277345","recordsWritten":"2758","parallelInputs":"1934","completedParallelInputs":"1934","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$1:address, $2:topics, $3:block_timestamp","FROM bigquery-public-data.crypto_ethereum_classic.logs"]},{"kind":"READ","substeps":["$300, $301","FROM __stage06_output"]},{"kind":"AGGREGATE","substeps":["GROUP BY $320 := $310, $321 := $311, $322 := $240","$210 := COUNT($240)"]},{"kind":"JOIN","substeps":["$312 := $2, $310 := $300, $311 := $301","INNER HASH JOIN EACH  WITH ALL  ON $1 = $300, $230 = $301"]},{"kind":"COMPUTE","substeps":["$230 := format_timestamp('\''%Y-%m'\'', $3)"]},{"kind":"FILTER","substeps":["equal($241, 0)"]},{"kind":"WRITE","substeps":["$320, $210, $322, $321","TO __stage07_output","BY HASH($320, $321, $322)"]}],"slotMs":"162933","computeMode":"BIGQUERY"},{"name":"S08: Aggregate","id":"8","startMs":"1762526230338","endMs":"1762526230395","inputStages":["7"],"waitRatioAvg":0.2639751552795031,"waitMsAvg":"85","waitRatioMax":0.2670807453416149,"waitMsMax":"86","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.040372670807453416,"computeMsAvg":"13","computeRatioMax":0.06521739130434782,"computeMsMax":"21","writeRatioAvg":0.034161490683229816,"writeMsAvg":"11","writeRatioMax":0.059006211180124224,"writeMsMax":"19","shuffleOutputBytes":"25298","shuffleOutputBytesSpilled":"0","recordsRead":"2758","recordsWritten":"182","parallelInputs":"231","completedParallelInputs":"231","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$320, $210, $322, $321","FROM __stage07_output"]},{"kind":"AGGREGATE","substeps":["GROUP BY $330 := $320, $331 := $321, $332 := $322","$190 := SUM_OF_COUNTS($210)"]},{"kind":"WRITE","substeps":["$330, $190, $332, $331","TO __stage08_output"]}],"slotMs":"14090","computeMode":"BIGQUERY"},{"name":"S09: Sort+","id":"9","startMs":"1762526230638","endMs":"1762526230697","inputStages":["8"],"waitRatioAvg":0.7204968944099379,"waitMsAvg":"232","waitRatioMax":0.7236024844720497,"waitMsMax":"233","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.034161490683229816,"computeMsAvg":"11","computeRatioMax":0.059006211180124224,"computeMsMax":"19","writeRatioAvg":0.043478260869565216,"writeMsAvg":"14","writeRatioMax":0.07453416149068323,"writeMsMax":"24","shuffleOutputBytes":"37582","shuffleOutputBytesSpilled":"0","recordsRead":"182","recordsWritten":"119","parallelInputs":"101","completedParallelInputs":"101","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$330, $190, $332, $331","FROM __stage08_output"]},{"kind":"READ","substeps":["$355","FROM __BROADCAST0"]},{"kind":"READ","substeps":["$200, $201, $202, $203","FROM __SHUFFLE3"]},{"kind":"AGGREGATE","substeps":["GROUP BY $380 := $140, $381 := $120","$110 := SHARD_ARRAY_AGG($124 ORDER BY $123 ASC, $122 ASC)","$111 := SHARD_ARRAY_AGG($121 ORDER BY $123 ASC, $122 ASC)","$112 := SHARD_ARRAY_AGG($122 ORDER BY $123 ASC, $122 ASC)","$113 := SHARD_ARRAY_AGG($123 ORDER BY $123 ASC, $122 ASC)"]},{"kind":"COMPUTE","substeps":["$120 := if(equal($140, 1), $160, NULL)","$121 := if(equal($140, 0), $162, NULL)","$122 := if(equal($140, 0), $163, NULL)","$123 := if(equal($140, 0), $160, NULL)","$124 := if(equal($140, 0), 1, NULL)"]},{"kind":"COMPUTE","substeps":["$130 := ARRAY<...>"]},{"kind":"FILTER","substeps":["equal($161, 1)"]},{"kind":"ANALYTIC_FUNCTION","substeps":["$170 := ROW_NUMBER() OVER (PARTITION BY $340, $343 ORDER BY $341 DESC)"]},{"kind":"SORT","substeps":["$220 ASC, $223 ASC, $221 DESC"]},{"kind":"ANALYTIC_FUNCTION","substeps":["$180 := ROW_NUMBER($355) OVER (PARTITION BY $360, $363 ORDER BY $361 DESC)"]},{"kind":"SORT","substeps":["$200 ASC, $203 ASC, $201 DESC"]},{"kind":"WRITE","substeps":["$110, $111, $112, $113, $381, $380","TO __stage09_output","BY HASH($380, $381)"]}],"slotMs":"8238","computeMode":"BIGQUERY"},{"name":"S0A: Aggregate+","id":"10","startMs":"1762526230940","endMs":"1762526230975","inputStages":["9"],"waitRatioAvg":0.7267080745341615,"waitMsAvg":"234","waitRatioMax":0.7267080745341615,"waitMsMax":"234","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.037267080745341616,"computeMsAvg":"12","computeRatioMax":0.052795031055900624,"computeMsMax":"17","writeRatioAvg":0.046583850931677016,"writeMsAvg":"15","writeRatioMax":0.055900621118012424,"writeMsMax":"18","shuffleOutputBytes":"9382","shuffleOutputBytesSpilled":"0","recordsRead":"119","recordsWritten":"11","parallelInputs":"10","completedParallelInputs":"10","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$110, $111, $112, $113, $381, $380","FROM __stage09_output"]},{"kind":"AGGREGATE","substeps":["GROUP BY $400 := $390","$80 := COUNT($94)","$81 := ANY_VALUE($93)","$82 := ANY_VALUE($92)","$83 := ANY_VALUE($91)","$84 := ANY_VALUE($90)"]},{"kind":"COMPUTE","substeps":["$90 := if(equal($390, 0), $103, NULL)","$91 := if(equal($390, 0), $102, NULL)","$92 := if(equal($390, 0), $101, NULL)","$93 := if(equal($390, 0), $100, NULL)","$94 := if(equal($390, 1), $391, NULL)"]},{"kind":"AGGREGATE","substeps":["GROUP BY $390 := $380, $391 := $381","$100 := ROOT_ARRAY_AGG($110 ORDER BY  ASC,  ASC)","$101 := ROOT_ARRAY_AGG($111 ORDER BY  ASC,  ASC)","$102 := ROOT_ARRAY_AGG($112 ORDER BY  ASC,  ASC)","$103 := ROOT_ARRAY_AGG($113 ORDER BY  ASC,  ASC)"]},{"kind":"WRITE","substeps":["$80, $81, $82, $83, $84, $400","TO __stage0A_output","BY HASH($400)"]}],"slotMs":"471","computeMode":"BIGQUERY"},{"name":"S0B: Aggregate+","id":"11","startMs":"1762526231239","endMs":"1762526231283","inputStages":["10"],"waitRatioAvg":0.8136645962732919,"waitMsAvg":"262","waitRatioMax":0.8136645962732919,"waitMsMax":"262","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.034161490683229816,"computeMsAvg":"11","computeRatioMax":0.034161490683229816,"computeMsMax":"11","writeRatioAvg":0.049689440993788817,"writeMsAvg":"16","writeRatioMax":0.049689440993788817,"writeMsMax":"16","shuffleOutputBytes":"9153","shuffleOutputBytesSpilled":"0","recordsRead":"11","recordsWritten":"1","parallelInputs":"1","completedParallelInputs":"1","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$80, $81, $82, $83, $84, $400","FROM __stage0A_output"]},{"kind":"AGGREGATE","substeps":["$50 := ANY_VALUE($64)","$51 := ANY_VALUE($63)","$52 := ANY_VALUE($62)","$53 := ANY_VALUE($61)","$54 := ANY_VALUE($60)"]},{"kind":"COMPUTE","substeps":["$60 := if(equal($410, 0), $74, NULL)","$61 := if(equal($410, 0), $73, NULL)","$62 := if(equal($410, 0), $72, NULL)","$63 := if(equal($410, 0), $71, NULL)","$64 := if(equal($410, 1), $70, NULL)"]},{"kind":"AGGREGATE","substeps":["GROUP BY $410 := $400","$70 := SUM_OF_COUNTS($80)","$71 := ANY_VALUE($81)","$72 := ANY_VALUE($82)","$73 := ANY_VALUE($83)","$74 := ANY_VALUE($84)"]},{"kind":"WRITE","substeps":["$50, $51, $52, $53, $54","TO __stage0B_output"]}],"slotMs":"31","computeMode":"BIGQUERY"},{"name":"S0C: Output","id":"12","startMs":"1762526231239","endMs":"1762526231288","inputStages":["11"],"waitRatioAvg":0.7888198757763976,"waitMsAvg":"254","waitRatioMax":0.7888198757763976,"waitMsMax":"254","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.018633540372670808,"computeMsAvg":"6","computeRatioMax":0.018633540372670808,"computeMsMax":"6","writeRatioAvg":0.012422360248447204,"writeMsAvg":"4","writeRatioMax":0.012422360248447204,"writeMsMax":"4","shuffleOutputBytes":"9884","shuffleOutputBytesSpilled":"0","recordsRead":"1","recordsWritten":"1","parallelInputs":"1","completedParallelInputs":"1","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$50, $51, $52, $53, $54","FROM __stage0B_output"]},{"kind":"COMPUTE","substeps":["$30 := MAKE_STRUCT($44, $43, $42, $41)","$31 := if(is_null($40), 0, $40)"]},{"kind":"AGGREGATE","substeps":["$40 := ANY_VALUE($50)","$41 := ANY_VALUE($51)","$42 := ANY_VALUE($52)","$43 := ANY_VALUE($53)","$44 := ANY_VALUE($54)"]},{"kind":"WRITE","substeps":["$30, $31","TO __stage0C_output"]}],"slotMs":"51","computeMode":"BIGQUERY"}],"estimatedBytesProcessed":"5555133989","timeline":[{"elapsedMs":"1547","totalSlotMs":"609042","pendingUnits":"0","completedUnits":"0","activeUnits":"0"},{"elapsedMs":"2547","totalSlotMs":"609597","pendingUnits":"1357","completedUnits":"2441","activeUnits":"971","estimatedRunnableUnits":"0"},{"elapsedMs":"3547","totalSlotMs":"609597","pendingUnits":"2034","completedUnits":"4277","activeUnits":"0","estimatedRunnableUnits":"0"},{"elapsedMs":"4843","totalSlotMs":"609597","pendingUnits":"0","completedUnits":"6655","activeUnits":"10","estimatedRunnableUnits":"0"}],"totalPartitionsProcessed":"3798","totalBytesProcessed":"5555133989","totalBytesBilled":"5555355648","billingTier":1,"totalSlotMs":"609597","cacheHit":false,"referencedTables":[{"projectId":"bigquery-public-data","datasetId":"crypto_ethereum_classic","tableId":"logs"},{"projectId":"bigquery-public-data","datasetId":"crypto_ethereum_classic","tableId":"contracts"}],"statementType":"SELECT","searchStatistics":{"indexUsageMode":"UNUSED","indexUnusedReasons":[{"code":"INDEX_CONFIG_NOT_AVAILABLE","message":"There is no index configuration for the base table `bigquery-public-data:crypto_ethereum_classic.contracts`.","baseTable":{"projectId":"bigquery-public-data","datasetId":"crypto_ethereum_classic","tableId":"contracts"}},{"code":"INDEX_CONFIG_NOT_AVAILABLE","message":"There is no index configuration for the base table `bigquery-public-data:crypto_ethereum_classic.logs`.","baseTable":{"projectId":"bigquery-public-data","datasetId":"crypto_ethereum_classic","tableId":"logs"}}]},"performanceInsights":{"avgPreviousExecutionMs":"2877"},"transferredBytes":"0","metadataCacheStatistics":{"tableMetadataCacheUsage":[{"tableReference":{"projectId":"bigquery-public-data","datasetId":"crypto_ethereum_classic","tableId":"logs"},"unusedReason":"OTHER_REASON"},{"tableReference":{"projectId":"bigquery-public-data","datasetId":"crypto_ethereum_classic","tableId":"contracts"},"unusedReason":"OTHER_REASON"}]}},"totalSlotMs":"609597","finalExecutionDurationMs":"2502"},"status":{"state":"DONE"},"principal_subject":"user:admin@bentrollope.altostrat.com","jobCreationReason":{"code":"REQUESTED"}}'
+ end_time=1762526231512
++ echo 1762526226453
++ awk '{print int($1)}'
+ start_ms=1762526226453
++ echo 1762526231512
++ awk '{print int($1)}'
+ end_ms=1762526231512
+ duration_ms=5059
+ echo '  --- Execution Statistics ---'
  --- Execution Statistics ---
+ echo '  Duration: 5059 ms'
  Duration: 5059 ms
+ echo '  Bytes Processed: 5555133989 bytes'
  Bytes Processed: 5555133989 bytes
+ echo '  Slot Milliseconds: 609597'
  Slot Milliseconds: 609597
+ echo '  ----------------------------'
  ----------------------------
+ echo -e 'ERC20 Optimized\tbqjob_r771b8ddb25c487fd_0000019a5ebfe6c8_1\t5059\t5555133989\t609597'
+ echo ''

+ echo '--- Running queries from peak_security_block_details_eval.sql ---'
--- Running queries from peak_security_block_details_eval.sql ---
+ run_query 'Peak Security Unoptimized' 'SELECT
    t1.miner,
    t1.gas_limit
FROM
    `bigquery-public-data.crypto_ethereum_classic.blocks` AS t1
WHERE
    t1.total_difficulty = (
        -- This forces a scan of the blocks table
        SELECT
            MAX(total_difficulty)
        FROM
            `bigquery-public-data.crypto_ethereum_classic.blocks`
    )
LIMIT 1'
+ local 'query_name=Peak Security Unoptimized'
+ local 'query=SELECT
    t1.miner,
    t1.gas_limit
FROM
    `bigquery-public-data.crypto_ethereum_classic.blocks` AS t1
WHERE
    t1.total_difficulty = (
        -- This forces a scan of the blocks table
        SELECT
            MAX(total_difficulty)
        FROM
            `bigquery-public-data.crypto_ethereum_classic.blocks`
    )
LIMIT 1'
+ echo ==================================================
==================================================
+ echo 'Executing Peak Security Unoptimized'
Executing Peak Security Unoptimized
+ echo ==================================================
==================================================
+ echo Query:
Query:
+ echo 'SELECT
    t1.miner,
    t1.gas_limit
FROM
    `bigquery-public-data.crypto_ethereum_classic.blocks` AS t1
WHERE
    t1.total_difficulty = (
        -- This forces a scan of the blocks table
        SELECT
            MAX(total_difficulty)
        FROM
            `bigquery-public-data.crypto_ethereum_classic.blocks`
    )
LIMIT 1'
SELECT
    t1.miner,
    t1.gas_limit
FROM
    `bigquery-public-data.crypto_ethereum_classic.blocks` AS t1
WHERE
    t1.total_difficulty = (
        -- This forces a scan of the blocks table
        SELECT
            MAX(total_difficulty)
        FROM
            `bigquery-public-data.crypto_ethereum_classic.blocks`
    )
LIMIT 1
+ echo --------------------------------------------------
--------------------------------------------------
++ bq query --nouse_cache --nosync --use_legacy_sql=false --format=json --location=US 'SELECT
    t1.miner,
    t1.gas_limit
FROM
    `bigquery-public-data.crypto_ethereum_classic.blocks` AS t1
WHERE
    t1.total_difficulty = (
        -- This forces a scan of the blocks table
        SELECT
            MAX(total_difficulty)
        FROM
            `bigquery-public-data.crypto_ethereum_classic.blocks`
    )
LIMIT 1'
+ job_submission_output='{"kind":"bigquery#job","etag":"+9hFWNjTA17A2HuFUpDe1w==","id":"tony-allen:US.bqjob_r458abb7915cd0a8e_0000019a5ec00f8f_1","selfLink":"https://bigquery.googleapis.com/bigquery/v2/projects/tony-allen/jobs/bqjob_r458abb7915cd0a8e_0000019a5ec00f8f_1?location=US","user_email":"admin@bentrollope.altostrat.com","configuration":{"query":{"query":"SELECT\n    t1.miner,\n    t1.gas_limit\nFROM\n    `bigquery-public-data.crypto_ethereum_classic.blocks` AS t1\nWHERE\n    t1.total_difficulty = (\n        -- This forces a scan of the blocks table\n        SELECT\n            MAX(total_difficulty)\n        FROM\n            `bigquery-public-data.crypto_ethereum_classic.blocks`\n    )\nLIMIT 1","destinationTable":{"projectId":"tony-allen","datasetId":"_e34c49c766e4fd3f5d404c3949b9e19fa7acb372","tableId":"anon9a4ca751_fdfc_4ede_a82b_e954cf6d0d51"},"writeDisposition":"WRITE_TRUNCATE","priority":"INTERACTIVE","useQueryCache":false,"useLegacySql":false},"jobType":"QUERY"},"jobReference":{"projectId":"tony-allen","jobId":"bqjob_r458abb7915cd0a8e_0000019a5ec00f8f_1","location":"US"},"statistics":{"creationTime":"1762526236844","startTime":"1762526236968","query":{"statementType":"SELECT"}},"status":{"state":"RUNNING"},"principal_subject":"user:admin@bentrollope.altostrat.com","jobCreationReason":{"code":"REQUESTED"}}'
++ echo '{"kind":"bigquery#job","etag":"+9hFWNjTA17A2HuFUpDe1w==","id":"tony-allen:US.bqjob_r458abb7915cd0a8e_0000019a5ec00f8f_1","selfLink":"https://bigquery.googleapis.com/bigquery/v2/projects/tony-allen/jobs/bqjob_r458abb7915cd0a8e_0000019a5ec00f8f_1?location=US","user_email":"admin@bentrollope.altostrat.com","configuration":{"query":{"query":"SELECT\n    t1.miner,\n    t1.gas_limit\nFROM\n    `bigquery-public-data.crypto_ethereum_classic.blocks` AS t1\nWHERE\n    t1.total_difficulty = (\n        -- This forces a scan of the blocks table\n        SELECT\n            MAX(total_difficulty)\n        FROM\n            `bigquery-public-data.crypto_ethereum_classic.blocks`\n    )\nLIMIT 1","destinationTable":{"projectId":"tony-allen","datasetId":"_e34c49c766e4fd3f5d404c3949b9e19fa7acb372","tableId":"anon9a4ca751_fdfc_4ede_a82b_e954cf6d0d51"},"writeDisposition":"WRITE_TRUNCATE","priority":"INTERACTIVE","useQueryCache":false,"useLegacySql":false},"jobType":"QUERY"},"jobReference":{"projectId":"tony-allen","jobId":"bqjob_r458abb7915cd0a8e_0000019a5ec00f8f_1","location":"US"},"statistics":{"creationTime":"1762526236844","startTime":"1762526236968","query":{"statementType":"SELECT"}},"status":{"state":"RUNNING"},"principal_subject":"user:admin@bentrollope.altostrat.com","jobCreationReason":{"code":"REQUESTED"}}'
++ jq -r .jobReference.jobId
+ job_id=bqjob_r458abb7915cd0a8e_0000019a5ec00f8f_1
+ '[' -n bqjob_r458abb7915cd0a8e_0000019a5ec00f8f_1 ']'
+ echo '  [SUCCESS] Query submitted.'
  [SUCCESS] Query submitted.
+ echo '  *** JOB ID FOR Peak Security Unoptimized: bqjob_r458abb7915cd0a8e_0000019a5ec00f8f_1 ***'
  *** JOB ID FOR Peak Security Unoptimized: bqjob_r458abb7915cd0a8e_0000019a5ec00f8f_1 ***
+ echo '  Waiting for job to complete...'
  Waiting for job to complete...
++ bq wait bqjob_r458abb7915cd0a8e_0000019a5ec00f8f_1
+ wait_output='Waiting on bqjob_r458abb7915cd0a8e_0000019a5ec00f8f_1 ... (0s) Current status: DONE   
Job tony-allen:bqjob_r458abb7915cd0a8e_0000019a5ec00f8f_1

  Job Type    State      Start Time         Duration                User Email              Bytes Processed   Bytes Billed   Billing Tier   Labels  
 ---------- --------- ----------------- ---------------- --------------------------------- ----------------- -------------- -------------- -------- 
  query      SUCCESS   07 Nov 14:37:16   0:00:03.173000   admin@bentrollope.altostrat.com   792963980         793772032      1                      '
+ '[' 0 -ne 0 ']'
+ echo '  Job completed. Fetching statistics...'
  Job completed. Fetching statistics...
++ bq show --format=json -j bqjob_r458abb7915cd0a8e_0000019a5ec00f8f_1
+ job_stats_json='{"kind":"bigquery#job","etag":"XMz6IxECdBKld2D+jdNyGw==","id":"tony-allen:US.bqjob_r458abb7915cd0a8e_0000019a5ec00f8f_1","selfLink":"https://bigquery.googleapis.com/bigquery/v2/projects/tony-allen/jobs/bqjob_r458abb7915cd0a8e_0000019a5ec00f8f_1?location=US","user_email":"admin@bentrollope.altostrat.com","configuration":{"query":{"query":"SELECT\n    t1.miner,\n    t1.gas_limit\nFROM\n    `bigquery-public-data.crypto_ethereum_classic.blocks` AS t1\nWHERE\n    t1.total_difficulty = (\n        -- This forces a scan of the blocks table\n        SELECT\n            MAX(total_difficulty)\n        FROM\n            `bigquery-public-data.crypto_ethereum_classic.blocks`\n    )\nLIMIT 1","destinationTable":{"projectId":"tony-allen","datasetId":"_e34c49c766e4fd3f5d404c3949b9e19fa7acb372","tableId":"anon9a4ca751_fdfc_4ede_a82b_e954cf6d0d51"},"writeDisposition":"WRITE_TRUNCATE","priority":"INTERACTIVE","useQueryCache":false,"useLegacySql":false},"jobType":"QUERY"},"jobReference":{"projectId":"tony-allen","jobId":"bqjob_r458abb7915cd0a8e_0000019a5ec00f8f_1","location":"US"},"statistics":{"creationTime":"1762526236844","startTime":"1762526236968","endTime":"1762526240141","totalBytesProcessed":"792963980","query":{"queryPlan":[{"name":"S00: Input","id":"0","startMs":"1762526239233","endMs":"1762526239633","waitRatioAvg":0.5454545454545454,"waitMsAvg":"192","waitRatioMax":0.7982954545454546,"waitMsMax":"281","readRatioAvg":0.1278409090909091,"readMsAvg":"45","readRatioMax":0.96875,"readMsMax":"341","computeRatioAvg":0.02556818181818182,"computeMsAvg":"9","computeRatioMax":0.05965909090909091,"computeMsMax":"21","writeRatioAvg":0.002840909090909091,"writeMsAvg":"1","writeRatioMax":0.07670454545454546,"writeMsMax":"27","shuffleOutputBytes":"33048","shuffleOutputBytesSpilled":"0","recordsRead":"11661235","recordsWritten":"1944","parallelInputs":"1944","completedParallelInputs":"1944","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$10:total_difficulty","FROM bigquery-public-data.crypto_ethereum_classic.blocks"]},{"kind":"AGGREGATE","substeps":["$30 := MAX($10)"]},{"kind":"WRITE","substeps":["$30","TO __stage00_output"]}],"slotMs":"211537","computeMode":"BIGQUERY"},{"name":"S01: Aggregate","id":"1","startMs":"1762526239385","endMs":"1762526239638","inputStages":["0"],"waitRatioAvg":1,"waitMsAvg":"352","waitRatioMax":1,"waitMsMax":"352","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.0625,"computeMsAvg":"22","computeRatioMax":0.0625,"computeMsMax":"22","writeRatioAvg":0.002840909090909091,"writeMsAvg":"1","writeRatioMax":0.002840909090909091,"writeMsMax":"1","shuffleOutputBytes":"17","shuffleOutputBytesSpilled":"0","recordsRead":"1944","recordsWritten":"1","parallelInputs":"1","completedParallelInputs":"1","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$30","FROM __stage00_output"]},{"kind":"AGGREGATE","substeps":["$20 := MAX($30)"]},{"kind":"WRITE","substeps":["$20","TO __stage01_output"]}],"slotMs":"112","computeMode":"BIGQUERY"},{"name":"S02: Compute","id":"2","startMs":"1762526239838","endMs":"1762526239942","inputStages":["1"],"waitRatioAvg":0.5511363636363636,"waitMsAvg":"194","waitRatioMax":0.6960227272727273,"waitMsMax":"245","readRatioAvg":0.019886363636363636,"readMsAvg":"7","readRatioMax":0.23295454545454544,"readMsMax":"82","computeRatioAvg":0.022727272727272728,"computeMsAvg":"8","computeRatioMax":0.05397727272727273,"computeMsMax":"19","writeRatioAvg":0.005681818181818182,"writeMsAvg":"2","writeRatioMax":0.09943181818181818,"writeMsMax":"35","shuffleOutputBytes":"56","shuffleOutputBytesSpilled":"0","recordsRead":"6396","recordsWritten":"1","parallelInputs":"1944","completedParallelInputs":"1926","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$20","FROM __stage01_output"]},{"kind":"READ","substeps":["$1:miner, $2:total_difficulty, $3:gas_limit","FROM bigquery-public-data.crypto_ethereum_classic.blocks","WHERE equal($2, NUMERIC<...>)"]},{"kind":"LIMIT","substeps":["1"]},{"kind":"WRITE","substeps":["$1, $3","TO __stage02_output"]}],"slotMs":"93670","computeMode":"BIGQUERY"},{"name":"S03: Output","id":"3","startMs":"1762526239923","endMs":"1762526239958","inputStages":["2"],"waitRatioAvg":0.6761363636363636,"waitMsAvg":"238","waitRatioMax":0.6761363636363636,"waitMsMax":"238","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.03125,"computeMsAvg":"11","computeRatioMax":0.03125,"computeMsMax":"11","writeRatioAvg":0.008522727272727272,"writeMsAvg":"3","writeRatioMax":0.008522727272727272,"writeMsMax":"3","shuffleOutputBytes":"55","shuffleOutputBytesSpilled":"0","recordsRead":"1","recordsWritten":"1","parallelInputs":"1","completedParallelInputs":"1","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$1, $3","FROM __stage02_output"]},{"kind":"LIMIT","substeps":["1"]},{"kind":"WRITE","substeps":["$1, $3","TO __stage03_output"]}],"slotMs":"33","computeMode":"BIGQUERY"}],"estimatedBytesProcessed":"792963980","timeline":[{"elapsedMs":"2032","totalSlotMs":"306285","pendingUnits":"0","completedUnits":"0","activeUnits":"0"},{"elapsedMs":"3032","totalSlotMs":"306285","pendingUnits":"18","completedUnits":"3872","activeUnits":"506","estimatedRunnableUnits":"0"}],"totalPartitionsProcessed":"1944","totalBytesProcessed":"792963980","totalBytesBilled":"793772032","billingTier":1,"totalSlotMs":"306285","cacheHit":false,"referencedTables":[{"projectId":"bigquery-public-data","datasetId":"crypto_ethereum_classic","tableId":"blocks"}],"statementType":"SELECT","performanceInsights":{"avgPreviousExecutionMs":"1204"},"transferredBytes":"0","metadataCacheStatistics":{"tableMetadataCacheUsage":[{"tableReference":{"projectId":"bigquery-public-data","datasetId":"crypto_ethereum_classic","tableId":"blocks"},"unusedReason":"OTHER_REASON"}]}},"totalSlotMs":"306285","finalExecutionDurationMs":"879"},"status":{"state":"DONE"},"principal_subject":"user:admin@bentrollope.altostrat.com","jobCreationReason":{"code":"REQUESTED"}}'
++ echo '{"kind":"bigquery#job","etag":"XMz6IxECdBKld2D+jdNyGw==","id":"tony-allen:US.bqjob_r458abb7915cd0a8e_0000019a5ec00f8f_1","selfLink":"https://bigquery.googleapis.com/bigquery/v2/projects/tony-allen/jobs/bqjob_r458abb7915cd0a8e_0000019a5ec00f8f_1?location=US","user_email":"admin@bentrollope.altostrat.com","configuration":{"query":{"query":"SELECT\n    t1.miner,\n    t1.gas_limit\nFROM\n    `bigquery-public-data.crypto_ethereum_classic.blocks` AS t1\nWHERE\n    t1.total_difficulty = (\n        -- This forces a scan of the blocks table\n        SELECT\n            MAX(total_difficulty)\n        FROM\n            `bigquery-public-data.crypto_ethereum_classic.blocks`\n    )\nLIMIT 1","destinationTable":{"projectId":"tony-allen","datasetId":"_e34c49c766e4fd3f5d404c3949b9e19fa7acb372","tableId":"anon9a4ca751_fdfc_4ede_a82b_e954cf6d0d51"},"writeDisposition":"WRITE_TRUNCATE","priority":"INTERACTIVE","useQueryCache":false,"useLegacySql":false},"jobType":"QUERY"},"jobReference":{"projectId":"tony-allen","jobId":"bqjob_r458abb7915cd0a8e_0000019a5ec00f8f_1","location":"US"},"statistics":{"creationTime":"1762526236844","startTime":"1762526236968","endTime":"1762526240141","totalBytesProcessed":"792963980","query":{"queryPlan":[{"name":"S00: Input","id":"0","startMs":"1762526239233","endMs":"1762526239633","waitRatioAvg":0.5454545454545454,"waitMsAvg":"192","waitRatioMax":0.7982954545454546,"waitMsMax":"281","readRatioAvg":0.1278409090909091,"readMsAvg":"45","readRatioMax":0.96875,"readMsMax":"341","computeRatioAvg":0.02556818181818182,"computeMsAvg":"9","computeRatioMax":0.05965909090909091,"computeMsMax":"21","writeRatioAvg":0.002840909090909091,"writeMsAvg":"1","writeRatioMax":0.07670454545454546,"writeMsMax":"27","shuffleOutputBytes":"33048","shuffleOutputBytesSpilled":"0","recordsRead":"11661235","recordsWritten":"1944","parallelInputs":"1944","completedParallelInputs":"1944","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$10:total_difficulty","FROM bigquery-public-data.crypto_ethereum_classic.blocks"]},{"kind":"AGGREGATE","substeps":["$30 := MAX($10)"]},{"kind":"WRITE","substeps":["$30","TO __stage00_output"]}],"slotMs":"211537","computeMode":"BIGQUERY"},{"name":"S01: Aggregate","id":"1","startMs":"1762526239385","endMs":"1762526239638","inputStages":["0"],"waitRatioAvg":1,"waitMsAvg":"352","waitRatioMax":1,"waitMsMax":"352","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.0625,"computeMsAvg":"22","computeRatioMax":0.0625,"computeMsMax":"22","writeRatioAvg":0.002840909090909091,"writeMsAvg":"1","writeRatioMax":0.002840909090909091,"writeMsMax":"1","shuffleOutputBytes":"17","shuffleOutputBytesSpilled":"0","recordsRead":"1944","recordsWritten":"1","parallelInputs":"1","completedParallelInputs":"1","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$30","FROM __stage00_output"]},{"kind":"AGGREGATE","substeps":["$20 := MAX($30)"]},{"kind":"WRITE","substeps":["$20","TO __stage01_output"]}],"slotMs":"112","computeMode":"BIGQUERY"},{"name":"S02: Compute","id":"2","startMs":"1762526239838","endMs":"1762526239942","inputStages":["1"],"waitRatioAvg":0.5511363636363636,"waitMsAvg":"194","waitRatioMax":0.6960227272727273,"waitMsMax":"245","readRatioAvg":0.019886363636363636,"readMsAvg":"7","readRatioMax":0.23295454545454544,"readMsMax":"82","computeRatioAvg":0.022727272727272728,"computeMsAvg":"8","computeRatioMax":0.05397727272727273,"computeMsMax":"19","writeRatioAvg":0.005681818181818182,"writeMsAvg":"2","writeRatioMax":0.09943181818181818,"writeMsMax":"35","shuffleOutputBytes":"56","shuffleOutputBytesSpilled":"0","recordsRead":"6396","recordsWritten":"1","parallelInputs":"1944","completedParallelInputs":"1926","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$20","FROM __stage01_output"]},{"kind":"READ","substeps":["$1:miner, $2:total_difficulty, $3:gas_limit","FROM bigquery-public-data.crypto_ethereum_classic.blocks","WHERE equal($2, NUMERIC<...>)"]},{"kind":"LIMIT","substeps":["1"]},{"kind":"WRITE","substeps":["$1, $3","TO __stage02_output"]}],"slotMs":"93670","computeMode":"BIGQUERY"},{"name":"S03: Output","id":"3","startMs":"1762526239923","endMs":"1762526239958","inputStages":["2"],"waitRatioAvg":0.6761363636363636,"waitMsAvg":"238","waitRatioMax":0.6761363636363636,"waitMsMax":"238","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.03125,"computeMsAvg":"11","computeRatioMax":0.03125,"computeMsMax":"11","writeRatioAvg":0.008522727272727272,"writeMsAvg":"3","writeRatioMax":0.008522727272727272,"writeMsMax":"3","shuffleOutputBytes":"55","shuffleOutputBytesSpilled":"0","recordsRead":"1","recordsWritten":"1","parallelInputs":"1","completedParallelInputs":"1","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$1, $3","FROM __stage02_output"]},{"kind":"LIMIT","substeps":["1"]},{"kind":"WRITE","substeps":["$1, $3","TO __stage03_output"]}],"slotMs":"33","computeMode":"BIGQUERY"}],"estimatedBytesProcessed":"792963980","timeline":[{"elapsedMs":"2032","totalSlotMs":"306285","pendingUnits":"0","completedUnits":"0","activeUnits":"0"},{"elapsedMs":"3032","totalSlotMs":"306285","pendingUnits":"18","completedUnits":"3872","activeUnits":"506","estimatedRunnableUnits":"0"}],"totalPartitionsProcessed":"1944","totalBytesProcessed":"792963980","totalBytesBilled":"793772032","billingTier":1,"totalSlotMs":"306285","cacheHit":false,"referencedTables":[{"projectId":"bigquery-public-data","datasetId":"crypto_ethereum_classic","tableId":"blocks"}],"statementType":"SELECT","performanceInsights":{"avgPreviousExecutionMs":"1204"},"transferredBytes":"0","metadataCacheStatistics":{"tableMetadataCacheUsage":[{"tableReference":{"projectId":"bigquery-public-data","datasetId":"crypto_ethereum_classic","tableId":"blocks"},"unusedReason":"OTHER_REASON"}]}},"totalSlotMs":"306285","finalExecutionDurationMs":"879"},"status":{"state":"DONE"},"principal_subject":"user:admin@bentrollope.altostrat.com","jobCreationReason":{"code":"REQUESTED"}}'
++ jq -r .statistics.totalBytesProcessed
+ total_bytes_processed=792963980
++ jq -r .statistics.totalSlotMs
++ echo '{"kind":"bigquery#job","etag":"XMz6IxECdBKld2D+jdNyGw==","id":"tony-allen:US.bqjob_r458abb7915cd0a8e_0000019a5ec00f8f_1","selfLink":"https://bigquery.googleapis.com/bigquery/v2/projects/tony-allen/jobs/bqjob_r458abb7915cd0a8e_0000019a5ec00f8f_1?location=US","user_email":"admin@bentrollope.altostrat.com","configuration":{"query":{"query":"SELECT\n    t1.miner,\n    t1.gas_limit\nFROM\n    `bigquery-public-data.crypto_ethereum_classic.blocks` AS t1\nWHERE\n    t1.total_difficulty = (\n        -- This forces a scan of the blocks table\n        SELECT\n            MAX(total_difficulty)\n        FROM\n            `bigquery-public-data.crypto_ethereum_classic.blocks`\n    )\nLIMIT 1","destinationTable":{"projectId":"tony-allen","datasetId":"_e34c49c766e4fd3f5d404c3949b9e19fa7acb372","tableId":"anon9a4ca751_fdfc_4ede_a82b_e954cf6d0d51"},"writeDisposition":"WRITE_TRUNCATE","priority":"INTERACTIVE","useQueryCache":false,"useLegacySql":false},"jobType":"QUERY"},"jobReference":{"projectId":"tony-allen","jobId":"bqjob_r458abb7915cd0a8e_0000019a5ec00f8f_1","location":"US"},"statistics":{"creationTime":"1762526236844","startTime":"1762526236968","endTime":"1762526240141","totalBytesProcessed":"792963980","query":{"queryPlan":[{"name":"S00: Input","id":"0","startMs":"1762526239233","endMs":"1762526239633","waitRatioAvg":0.5454545454545454,"waitMsAvg":"192","waitRatioMax":0.7982954545454546,"waitMsMax":"281","readRatioAvg":0.1278409090909091,"readMsAvg":"45","readRatioMax":0.96875,"readMsMax":"341","computeRatioAvg":0.02556818181818182,"computeMsAvg":"9","computeRatioMax":0.05965909090909091,"computeMsMax":"21","writeRatioAvg":0.002840909090909091,"writeMsAvg":"1","writeRatioMax":0.07670454545454546,"writeMsMax":"27","shuffleOutputBytes":"33048","shuffleOutputBytesSpilled":"0","recordsRead":"11661235","recordsWritten":"1944","parallelInputs":"1944","completedParallelInputs":"1944","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$10:total_difficulty","FROM bigquery-public-data.crypto_ethereum_classic.blocks"]},{"kind":"AGGREGATE","substeps":["$30 := MAX($10)"]},{"kind":"WRITE","substeps":["$30","TO __stage00_output"]}],"slotMs":"211537","computeMode":"BIGQUERY"},{"name":"S01: Aggregate","id":"1","startMs":"1762526239385","endMs":"1762526239638","inputStages":["0"],"waitRatioAvg":1,"waitMsAvg":"352","waitRatioMax":1,"waitMsMax":"352","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.0625,"computeMsAvg":"22","computeRatioMax":0.0625,"computeMsMax":"22","writeRatioAvg":0.002840909090909091,"writeMsAvg":"1","writeRatioMax":0.002840909090909091,"writeMsMax":"1","shuffleOutputBytes":"17","shuffleOutputBytesSpilled":"0","recordsRead":"1944","recordsWritten":"1","parallelInputs":"1","completedParallelInputs":"1","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$30","FROM __stage00_output"]},{"kind":"AGGREGATE","substeps":["$20 := MAX($30)"]},{"kind":"WRITE","substeps":["$20","TO __stage01_output"]}],"slotMs":"112","computeMode":"BIGQUERY"},{"name":"S02: Compute","id":"2","startMs":"1762526239838","endMs":"1762526239942","inputStages":["1"],"waitRatioAvg":0.5511363636363636,"waitMsAvg":"194","waitRatioMax":0.6960227272727273,"waitMsMax":"245","readRatioAvg":0.019886363636363636,"readMsAvg":"7","readRatioMax":0.23295454545454544,"readMsMax":"82","computeRatioAvg":0.022727272727272728,"computeMsAvg":"8","computeRatioMax":0.05397727272727273,"computeMsMax":"19","writeRatioAvg":0.005681818181818182,"writeMsAvg":"2","writeRatioMax":0.09943181818181818,"writeMsMax":"35","shuffleOutputBytes":"56","shuffleOutputBytesSpilled":"0","recordsRead":"6396","recordsWritten":"1","parallelInputs":"1944","completedParallelInputs":"1926","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$20","FROM __stage01_output"]},{"kind":"READ","substeps":["$1:miner, $2:total_difficulty, $3:gas_limit","FROM bigquery-public-data.crypto_ethereum_classic.blocks","WHERE equal($2, NUMERIC<...>)"]},{"kind":"LIMIT","substeps":["1"]},{"kind":"WRITE","substeps":["$1, $3","TO __stage02_output"]}],"slotMs":"93670","computeMode":"BIGQUERY"},{"name":"S03: Output","id":"3","startMs":"1762526239923","endMs":"1762526239958","inputStages":["2"],"waitRatioAvg":0.6761363636363636,"waitMsAvg":"238","waitRatioMax":0.6761363636363636,"waitMsMax":"238","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.03125,"computeMsAvg":"11","computeRatioMax":0.03125,"computeMsMax":"11","writeRatioAvg":0.008522727272727272,"writeMsAvg":"3","writeRatioMax":0.008522727272727272,"writeMsMax":"3","shuffleOutputBytes":"55","shuffleOutputBytesSpilled":"0","recordsRead":"1","recordsWritten":"1","parallelInputs":"1","completedParallelInputs":"1","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$1, $3","FROM __stage02_output"]},{"kind":"LIMIT","substeps":["1"]},{"kind":"WRITE","substeps":["$1, $3","TO __stage03_output"]}],"slotMs":"33","computeMode":"BIGQUERY"}],"estimatedBytesProcessed":"792963980","timeline":[{"elapsedMs":"2032","totalSlotMs":"306285","pendingUnits":"0","completedUnits":"0","activeUnits":"0"},{"elapsedMs":"3032","totalSlotMs":"306285","pendingUnits":"18","completedUnits":"3872","activeUnits":"506","estimatedRunnableUnits":"0"}],"totalPartitionsProcessed":"1944","totalBytesProcessed":"792963980","totalBytesBilled":"793772032","billingTier":1,"totalSlotMs":"306285","cacheHit":false,"referencedTables":[{"projectId":"bigquery-public-data","datasetId":"crypto_ethereum_classic","tableId":"blocks"}],"statementType":"SELECT","performanceInsights":{"avgPreviousExecutionMs":"1204"},"transferredBytes":"0","metadataCacheStatistics":{"tableMetadataCacheUsage":[{"tableReference":{"projectId":"bigquery-public-data","datasetId":"crypto_ethereum_classic","tableId":"blocks"},"unusedReason":"OTHER_REASON"}]}},"totalSlotMs":"306285","finalExecutionDurationMs":"879"},"status":{"state":"DONE"},"principal_subject":"user:admin@bentrollope.altostrat.com","jobCreationReason":{"code":"REQUESTED"}}'
+ total_slot_ms=306285
++ echo '{"kind":"bigquery#job","etag":"XMz6IxECdBKld2D+jdNyGw==","id":"tony-allen:US.bqjob_r458abb7915cd0a8e_0000019a5ec00f8f_1","selfLink":"https://bigquery.googleapis.com/bigquery/v2/projects/tony-allen/jobs/bqjob_r458abb7915cd0a8e_0000019a5ec00f8f_1?location=US","user_email":"admin@bentrollope.altostrat.com","configuration":{"query":{"query":"SELECT\n    t1.miner,\n    t1.gas_limit\nFROM\n    `bigquery-public-data.crypto_ethereum_classic.blocks` AS t1\nWHERE\n    t1.total_difficulty = (\n        -- This forces a scan of the blocks table\n        SELECT\n            MAX(total_difficulty)\n        FROM\n            `bigquery-public-data.crypto_ethereum_classic.blocks`\n    )\nLIMIT 1","destinationTable":{"projectId":"tony-allen","datasetId":"_e34c49c766e4fd3f5d404c3949b9e19fa7acb372","tableId":"anon9a4ca751_fdfc_4ede_a82b_e954cf6d0d51"},"writeDisposition":"WRITE_TRUNCATE","priority":"INTERACTIVE","useQueryCache":false,"useLegacySql":false},"jobType":"QUERY"},"jobReference":{"projectId":"tony-allen","jobId":"bqjob_r458abb7915cd0a8e_0000019a5ec00f8f_1","location":"US"},"statistics":{"creationTime":"1762526236844","startTime":"1762526236968","endTime":"1762526240141","totalBytesProcessed":"792963980","query":{"queryPlan":[{"name":"S00: Input","id":"0","startMs":"1762526239233","endMs":"1762526239633","waitRatioAvg":0.5454545454545454,"waitMsAvg":"192","waitRatioMax":0.7982954545454546,"waitMsMax":"281","readRatioAvg":0.1278409090909091,"readMsAvg":"45","readRatioMax":0.96875,"readMsMax":"341","computeRatioAvg":0.02556818181818182,"computeMsAvg":"9","computeRatioMax":0.05965909090909091,"computeMsMax":"21","writeRatioAvg":0.002840909090909091,"writeMsAvg":"1","writeRatioMax":0.07670454545454546,"writeMsMax":"27","shuffleOutputBytes":"33048","shuffleOutputBytesSpilled":"0","recordsRead":"11661235","recordsWritten":"1944","parallelInputs":"1944","completedParallelInputs":"1944","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$10:total_difficulty","FROM bigquery-public-data.crypto_ethereum_classic.blocks"]},{"kind":"AGGREGATE","substeps":["$30 := MAX($10)"]},{"kind":"WRITE","substeps":["$30","TO __stage00_output"]}],"slotMs":"211537","computeMode":"BIGQUERY"},{"name":"S01: Aggregate","id":"1","startMs":"1762526239385","endMs":"1762526239638","inputStages":["0"],"waitRatioAvg":1,"waitMsAvg":"352","waitRatioMax":1,"waitMsMax":"352","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.0625,"computeMsAvg":"22","computeRatioMax":0.0625,"computeMsMax":"22","writeRatioAvg":0.002840909090909091,"writeMsAvg":"1","writeRatioMax":0.002840909090909091,"writeMsMax":"1","shuffleOutputBytes":"17","shuffleOutputBytesSpilled":"0","recordsRead":"1944","recordsWritten":"1","parallelInputs":"1","completedParallelInputs":"1","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$30","FROM __stage00_output"]},{"kind":"AGGREGATE","substeps":["$20 := MAX($30)"]},{"kind":"WRITE","substeps":["$20","TO __stage01_output"]}],"slotMs":"112","computeMode":"BIGQUERY"},{"name":"S02: Compute","id":"2","startMs":"1762526239838","endMs":"1762526239942","inputStages":["1"],"waitRatioAvg":0.5511363636363636,"waitMsAvg":"194","waitRatioMax":0.6960227272727273,"waitMsMax":"245","readRatioAvg":0.019886363636363636,"readMsAvg":"7","readRatioMax":0.23295454545454544,"readMsMax":"82","computeRatioAvg":0.022727272727272728,"computeMsAvg":"8","computeRatioMax":0.05397727272727273,"computeMsMax":"19","writeRatioAvg":0.005681818181818182,"writeMsAvg":"2","writeRatioMax":0.09943181818181818,"writeMsMax":"35","shuffleOutputBytes":"56","shuffleOutputBytesSpilled":"0","recordsRead":"6396","recordsWritten":"1","parallelInputs":"1944","completedParallelInputs":"1926","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$20","FROM __stage01_output"]},{"kind":"READ","substeps":["$1:miner, $2:total_difficulty, $3:gas_limit","FROM bigquery-public-data.crypto_ethereum_classic.blocks","WHERE equal($2, NUMERIC<...>)"]},{"kind":"LIMIT","substeps":["1"]},{"kind":"WRITE","substeps":["$1, $3","TO __stage02_output"]}],"slotMs":"93670","computeMode":"BIGQUERY"},{"name":"S03: Output","id":"3","startMs":"1762526239923","endMs":"1762526239958","inputStages":["2"],"waitRatioAvg":0.6761363636363636,"waitMsAvg":"238","waitRatioMax":0.6761363636363636,"waitMsMax":"238","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.03125,"computeMsAvg":"11","computeRatioMax":0.03125,"computeMsMax":"11","writeRatioAvg":0.008522727272727272,"writeMsAvg":"3","writeRatioMax":0.008522727272727272,"writeMsMax":"3","shuffleOutputBytes":"55","shuffleOutputBytesSpilled":"0","recordsRead":"1","recordsWritten":"1","parallelInputs":"1","completedParallelInputs":"1","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$1, $3","FROM __stage02_output"]},{"kind":"LIMIT","substeps":["1"]},{"kind":"WRITE","substeps":["$1, $3","TO __stage03_output"]}],"slotMs":"33","computeMode":"BIGQUERY"}],"estimatedBytesProcessed":"792963980","timeline":[{"elapsedMs":"2032","totalSlotMs":"306285","pendingUnits":"0","completedUnits":"0","activeUnits":"0"},{"elapsedMs":"3032","totalSlotMs":"306285","pendingUnits":"18","completedUnits":"3872","activeUnits":"506","estimatedRunnableUnits":"0"}],"totalPartitionsProcessed":"1944","totalBytesProcessed":"792963980","totalBytesBilled":"793772032","billingTier":1,"totalSlotMs":"306285","cacheHit":false,"referencedTables":[{"projectId":"bigquery-public-data","datasetId":"crypto_ethereum_classic","tableId":"blocks"}],"statementType":"SELECT","performanceInsights":{"avgPreviousExecutionMs":"1204"},"transferredBytes":"0","metadataCacheStatistics":{"tableMetadataCacheUsage":[{"tableReference":{"projectId":"bigquery-public-data","datasetId":"crypto_ethereum_classic","tableId":"blocks"},"unusedReason":"OTHER_REASON"}]}},"totalSlotMs":"306285","finalExecutionDurationMs":"879"},"status":{"state":"DONE"},"principal_subject":"user:admin@bentrollope.altostrat.com","jobCreationReason":{"code":"REQUESTED"}}'
++ jq -r .statistics.startTime
+ start_time=1762526236968
++ echo '{"kind":"bigquery#job","etag":"XMz6IxECdBKld2D+jdNyGw==","id":"tony-allen:US.bqjob_r458abb7915cd0a8e_0000019a5ec00f8f_1","selfLink":"https://bigquery.googleapis.com/bigquery/v2/projects/tony-allen/jobs/bqjob_r458abb7915cd0a8e_0000019a5ec00f8f_1?location=US","user_email":"admin@bentrollope.altostrat.com","configuration":{"query":{"query":"SELECT\n    t1.miner,\n    t1.gas_limit\nFROM\n    `bigquery-public-data.crypto_ethereum_classic.blocks` AS t1\nWHERE\n    t1.total_difficulty = (\n        -- This forces a scan of the blocks table\n        SELECT\n            MAX(total_difficulty)\n        FROM\n            `bigquery-public-data.crypto_ethereum_classic.blocks`\n    )\nLIMIT 1","destinationTable":{"projectId":"tony-allen","datasetId":"_e34c49c766e4fd3f5d404c3949b9e19fa7acb372","tableId":"anon9a4ca751_fdfc_4ede_a82b_e954cf6d0d51"},"writeDisposition":"WRITE_TRUNCATE","priority":"INTERACTIVE","useQueryCache":false,"useLegacySql":false},"jobType":"QUERY"},"jobReference":{"projectId":"tony-allen","jobId":"bqjob_r458abb7915cd0a8e_0000019a5ec00f8f_1","location":"US"},"statistics":{"creationTime":"1762526236844","startTime":"1762526236968","endTime":"1762526240141","totalBytesProcessed":"792963980","query":{"queryPlan":[{"name":"S00: Input","id":"0","startMs":"1762526239233","endMs":"1762526239633","waitRatioAvg":0.5454545454545454,"waitMsAvg":"192","waitRatioMax":0.7982954545454546,"waitMsMax":"281","readRatioAvg":0.1278409090909091,"readMsAvg":"45","readRatioMax":0.96875,"readMsMax":"341","computeRatioAvg":0.02556818181818182,"computeMsAvg":"9","computeRatioMax":0.05965909090909091,"computeMsMax":"21","writeRatioAvg":0.002840909090909091,"writeMsAvg":"1","writeRatioMax":0.07670454545454546,"writeMsMax":"27","shuffleOutputBytes":"33048","shuffleOutputBytesSpilled":"0","recordsRead":"11661235","recordsWritten":"1944","parallelInputs":"1944","completedParallelInputs":"1944","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$10:total_difficulty","FROM bigquery-public-data.crypto_ethereum_classic.blocks"]},{"kind":"AGGREGATE","substeps":["$30 := MAX($10)"]},{"kind":"WRITE","substeps":["$30","TO __stage00_output"]}],"slotMs":"211537","computeMode":"BIGQUERY"},{"name":"S01: Aggregate","id":"1","startMs":"1762526239385","endMs":"1762526239638","inputStages":["0"],"waitRatioAvg":1,"waitMsAvg":"352","waitRatioMax":1,"waitMsMax":"352","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.0625,"computeMsAvg":"22","computeRatioMax":0.0625,"computeMsMax":"22","writeRatioAvg":0.002840909090909091,"writeMsAvg":"1","writeRatioMax":0.002840909090909091,"writeMsMax":"1","shuffleOutputBytes":"17","shuffleOutputBytesSpilled":"0","recordsRead":"1944","recordsWritten":"1","parallelInputs":"1","completedParallelInputs":"1","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$30","FROM __stage00_output"]},{"kind":"AGGREGATE","substeps":["$20 := MAX($30)"]},{"kind":"WRITE","substeps":["$20","TO __stage01_output"]}],"slotMs":"112","computeMode":"BIGQUERY"},{"name":"S02: Compute","id":"2","startMs":"1762526239838","endMs":"1762526239942","inputStages":["1"],"waitRatioAvg":0.5511363636363636,"waitMsAvg":"194","waitRatioMax":0.6960227272727273,"waitMsMax":"245","readRatioAvg":0.019886363636363636,"readMsAvg":"7","readRatioMax":0.23295454545454544,"readMsMax":"82","computeRatioAvg":0.022727272727272728,"computeMsAvg":"8","computeRatioMax":0.05397727272727273,"computeMsMax":"19","writeRatioAvg":0.005681818181818182,"writeMsAvg":"2","writeRatioMax":0.09943181818181818,"writeMsMax":"35","shuffleOutputBytes":"56","shuffleOutputBytesSpilled":"0","recordsRead":"6396","recordsWritten":"1","parallelInputs":"1944","completedParallelInputs":"1926","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$20","FROM __stage01_output"]},{"kind":"READ","substeps":["$1:miner, $2:total_difficulty, $3:gas_limit","FROM bigquery-public-data.crypto_ethereum_classic.blocks","WHERE equal($2, NUMERIC<...>)"]},{"kind":"LIMIT","substeps":["1"]},{"kind":"WRITE","substeps":["$1, $3","TO __stage02_output"]}],"slotMs":"93670","computeMode":"BIGQUERY"},{"name":"S03: Output","id":"3","startMs":"1762526239923","endMs":"1762526239958","inputStages":["2"],"waitRatioAvg":0.6761363636363636,"waitMsAvg":"238","waitRatioMax":0.6761363636363636,"waitMsMax":"238","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.03125,"computeMsAvg":"11","computeRatioMax":0.03125,"computeMsMax":"11","writeRatioAvg":0.008522727272727272,"writeMsAvg":"3","writeRatioMax":0.008522727272727272,"writeMsMax":"3","shuffleOutputBytes":"55","shuffleOutputBytesSpilled":"0","recordsRead":"1","recordsWritten":"1","parallelInputs":"1","completedParallelInputs":"1","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$1, $3","FROM __stage02_output"]},{"kind":"LIMIT","substeps":["1"]},{"kind":"WRITE","substeps":["$1, $3","TO __stage03_output"]}],"slotMs":"33","computeMode":"BIGQUERY"}],"estimatedBytesProcessed":"792963980","timeline":[{"elapsedMs":"2032","totalSlotMs":"306285","pendingUnits":"0","completedUnits":"0","activeUnits":"0"},{"elapsedMs":"3032","totalSlotMs":"306285","pendingUnits":"18","completedUnits":"3872","activeUnits":"506","estimatedRunnableUnits":"0"}],"totalPartitionsProcessed":"1944","totalBytesProcessed":"792963980","totalBytesBilled":"793772032","billingTier":1,"totalSlotMs":"306285","cacheHit":false,"referencedTables":[{"projectId":"bigquery-public-data","datasetId":"crypto_ethereum_classic","tableId":"blocks"}],"statementType":"SELECT","performanceInsights":{"avgPreviousExecutionMs":"1204"},"transferredBytes":"0","metadataCacheStatistics":{"tableMetadataCacheUsage":[{"tableReference":{"projectId":"bigquery-public-data","datasetId":"crypto_ethereum_classic","tableId":"blocks"},"unusedReason":"OTHER_REASON"}]}},"totalSlotMs":"306285","finalExecutionDurationMs":"879"},"status":{"state":"DONE"},"principal_subject":"user:admin@bentrollope.altostrat.com","jobCreationReason":{"code":"REQUESTED"}}'
++ jq -r .statistics.endTime
+ end_time=1762526240141
++ echo 1762526236968
++ awk '{print int($1)}'
+ start_ms=1762526236968
++ echo 1762526240141
++ awk '{print int($1)}'
+ end_ms=1762526240141
+ duration_ms=3173
+ echo '  --- Execution Statistics ---'
  --- Execution Statistics ---
+ echo '  Duration: 3173 ms'
  Duration: 3173 ms
+ echo '  Bytes Processed: 792963980 bytes'
  Bytes Processed: 792963980 bytes
+ echo '  Slot Milliseconds: 306285'
  Slot Milliseconds: 306285
+ echo '  ----------------------------'
  ----------------------------
+ echo -e 'Peak Security Unoptimized\tbqjob_r458abb7915cd0a8e_0000019a5ec00f8f_1\t3173\t792963980\t306285'
+ echo ''

+ run_query 'Peak Security Optimized' 'SELECT
    t1.miner,
    t1.gas_limit
FROM
    (
        SELECT
            miner,
            gas_limit,
            ROW_NUMBER() OVER (ORDER BY total_difficulty DESC) AS rank_by_difficulty
        FROM
            `bigquery-public-data.crypto_ethereum_classic.blocks`
    ) AS t1
WHERE
    t1.rank_by_difficulty = 1
LIMIT 1'
+ local 'query_name=Peak Security Optimized'
+ local 'query=SELECT
    t1.miner,
    t1.gas_limit
FROM
    (
        SELECT
            miner,
            gas_limit,
            ROW_NUMBER() OVER (ORDER BY total_difficulty DESC) AS rank_by_difficulty
        FROM
            `bigquery-public-data.crypto_ethereum_classic.blocks`
    ) AS t1
WHERE
    t1.rank_by_difficulty = 1
LIMIT 1'
+ echo ==================================================
==================================================
+ echo 'Executing Peak Security Optimized'
Executing Peak Security Optimized
+ echo ==================================================
==================================================
+ echo Query:
Query:
+ echo 'SELECT
    t1.miner,
    t1.gas_limit
FROM
    (
        SELECT
            miner,
            gas_limit,
            ROW_NUMBER() OVER (ORDER BY total_difficulty DESC) AS rank_by_difficulty
        FROM
            `bigquery-public-data.crypto_ethereum_classic.blocks`
    ) AS t1
WHERE
    t1.rank_by_difficulty = 1
LIMIT 1'
SELECT
    t1.miner,
    t1.gas_limit
FROM
    (
        SELECT
            miner,
            gas_limit,
            ROW_NUMBER() OVER (ORDER BY total_difficulty DESC) AS rank_by_difficulty
        FROM
            `bigquery-public-data.crypto_ethereum_classic.blocks`
    ) AS t1
WHERE
    t1.rank_by_difficulty = 1
LIMIT 1
+ echo --------------------------------------------------
--------------------------------------------------
++ bq query --nouse_cache --nosync --use_legacy_sql=false --format=json --location=US 'SELECT
    t1.miner,
    t1.gas_limit
FROM
    (
        SELECT
            miner,
            gas_limit,
            ROW_NUMBER() OVER (ORDER BY total_difficulty DESC) AS rank_by_difficulty
        FROM
            `bigquery-public-data.crypto_ethereum_classic.blocks`
    ) AS t1
WHERE
    t1.rank_by_difficulty = 1
LIMIT 1'
+ job_submission_output='{"kind":"bigquery#job","etag":"6xjqhlumFJDAuULaHFfJ6Q==","id":"tony-allen:US.bqjob_rf81d48568d0a1d4_0000019a5ec0344b_1","selfLink":"https://bigquery.googleapis.com/bigquery/v2/projects/tony-allen/jobs/bqjob_rf81d48568d0a1d4_0000019a5ec0344b_1?location=US","user_email":"admin@bentrollope.altostrat.com","configuration":{"query":{"query":"SELECT\n    t1.miner,\n    t1.gas_limit\nFROM\n    (\n        SELECT\n            miner,\n            gas_limit,\n            ROW_NUMBER() OVER (ORDER BY total_difficulty DESC) AS rank_by_difficulty\n        FROM\n            `bigquery-public-data.crypto_ethereum_classic.blocks`\n    ) AS t1\nWHERE\n    t1.rank_by_difficulty = 1\nLIMIT 1","destinationTable":{"projectId":"tony-allen","datasetId":"_e34c49c766e4fd3f5d404c3949b9e19fa7acb372","tableId":"anonb38b1c6c_559e_4237_9633_af3ff78ec4a4"},"writeDisposition":"WRITE_TRUNCATE","priority":"INTERACTIVE","useQueryCache":false,"useLegacySql":false},"jobType":"QUERY"},"jobReference":{"projectId":"tony-allen","jobId":"bqjob_rf81d48568d0a1d4_0000019a5ec0344b_1","location":"US"},"statistics":{"creationTime":"1762526246301","startTime":"1762526246450","query":{"statementType":"SELECT","searchStatistics":{"indexUnusedReasons":[{"code":"INDEX_CONFIG_NOT_AVAILABLE","message":"There is no index configuration for the base table `bigquery-public-data:crypto_ethereum_classic.blocks`.","baseTable":{"projectId":"bigquery-public-data","datasetId":"crypto_ethereum_classic","tableId":"blocks"}}]}}},"status":{"state":"RUNNING"},"principal_subject":"user:admin@bentrollope.altostrat.com","jobCreationReason":{"code":"REQUESTED"}}'
++ echo '{"kind":"bigquery#job","etag":"6xjqhlumFJDAuULaHFfJ6Q==","id":"tony-allen:US.bqjob_rf81d48568d0a1d4_0000019a5ec0344b_1","selfLink":"https://bigquery.googleapis.com/bigquery/v2/projects/tony-allen/jobs/bqjob_rf81d48568d0a1d4_0000019a5ec0344b_1?location=US","user_email":"admin@bentrollope.altostrat.com","configuration":{"query":{"query":"SELECT\n    t1.miner,\n    t1.gas_limit\nFROM\n    (\n        SELECT\n            miner,\n            gas_limit,\n            ROW_NUMBER() OVER (ORDER BY total_difficulty DESC) AS rank_by_difficulty\n        FROM\n            `bigquery-public-data.crypto_ethereum_classic.blocks`\n    ) AS t1\nWHERE\n    t1.rank_by_difficulty = 1\nLIMIT 1","destinationTable":{"projectId":"tony-allen","datasetId":"_e34c49c766e4fd3f5d404c3949b9e19fa7acb372","tableId":"anonb38b1c6c_559e_4237_9633_af3ff78ec4a4"},"writeDisposition":"WRITE_TRUNCATE","priority":"INTERACTIVE","useQueryCache":false,"useLegacySql":false},"jobType":"QUERY"},"jobReference":{"projectId":"tony-allen","jobId":"bqjob_rf81d48568d0a1d4_0000019a5ec0344b_1","location":"US"},"statistics":{"creationTime":"1762526246301","startTime":"1762526246450","query":{"statementType":"SELECT","searchStatistics":{"indexUnusedReasons":[{"code":"INDEX_CONFIG_NOT_AVAILABLE","message":"There is no index configuration for the base table `bigquery-public-data:crypto_ethereum_classic.blocks`.","baseTable":{"projectId":"bigquery-public-data","datasetId":"crypto_ethereum_classic","tableId":"blocks"}}]}}},"status":{"state":"RUNNING"},"principal_subject":"user:admin@bentrollope.altostrat.com","jobCreationReason":{"code":"REQUESTED"}}'
++ jq -r .jobReference.jobId
+ job_id=bqjob_rf81d48568d0a1d4_0000019a5ec0344b_1
+ '[' -n bqjob_rf81d48568d0a1d4_0000019a5ec0344b_1 ']'
+ echo '  [SUCCESS] Query submitted.'
  [SUCCESS] Query submitted.
+ echo '  *** JOB ID FOR Peak Security Optimized: bqjob_rf81d48568d0a1d4_0000019a5ec0344b_1 ***'
  *** JOB ID FOR Peak Security Optimized: bqjob_rf81d48568d0a1d4_0000019a5ec0344b_1 ***
+ echo '  Waiting for job to complete...'
  Waiting for job to complete...
++ bq wait bqjob_rf81d48568d0a1d4_0000019a5ec0344b_1
+ wait_output='Waiting on bqjob_rf81d48568d0a1d4_0000019a5ec0344b_1 ... (0s) Current status: RUNNING                                                                                     Waiting on bqjob_rf81d48568d0a1d4_0000019a5ec0344b_1 ... (1s) Current status: RUNNING                                                                                     Waiting on bqjob_rf81d48568d0a1d4_0000019a5ec0344b_1 ... (1s) Current status: DONE   
Job tony-allen:bqjob_rf81d48568d0a1d4_0000019a5ec0344b_1

  Job Type    State      Start Time         Duration                User Email              Bytes Processed   Bytes Billed   Billing Tier   Labels  
 ---------- --------- ----------------- ---------------- --------------------------------- ----------------- -------------- -------------- -------- 
  query      SUCCESS   07 Nov 14:37:26   0:00:06.682000   admin@bentrollope.altostrat.com   792963980         793772032      1                      '
+ '[' 0 -ne 0 ']'
+ echo '  Job completed. Fetching statistics...'
  Job completed. Fetching statistics...
++ bq show --format=json -j bqjob_rf81d48568d0a1d4_0000019a5ec0344b_1
+ job_stats_json='{"kind":"bigquery#job","etag":"CAWPP1ok/PoA8rukby3fBw==","id":"tony-allen:US.bqjob_rf81d48568d0a1d4_0000019a5ec0344b_1","selfLink":"https://bigquery.googleapis.com/bigquery/v2/projects/tony-allen/jobs/bqjob_rf81d48568d0a1d4_0000019a5ec0344b_1?location=US","user_email":"admin@bentrollope.altostrat.com","configuration":{"query":{"query":"SELECT\n    t1.miner,\n    t1.gas_limit\nFROM\n    (\n        SELECT\n            miner,\n            gas_limit,\n            ROW_NUMBER() OVER (ORDER BY total_difficulty DESC) AS rank_by_difficulty\n        FROM\n            `bigquery-public-data.crypto_ethereum_classic.blocks`\n    ) AS t1\nWHERE\n    t1.rank_by_difficulty = 1\nLIMIT 1","destinationTable":{"projectId":"tony-allen","datasetId":"_e34c49c766e4fd3f5d404c3949b9e19fa7acb372","tableId":"anonb38b1c6c_559e_4237_9633_af3ff78ec4a4"},"writeDisposition":"WRITE_TRUNCATE","priority":"INTERACTIVE","useQueryCache":false,"useLegacySql":false},"jobType":"QUERY"},"jobReference":{"projectId":"tony-allen","jobId":"bqjob_rf81d48568d0a1d4_0000019a5ec0344b_1","location":"US"},"statistics":{"creationTime":"1762526246301","startTime":"1762526246450","endTime":"1762526253132","totalBytesProcessed":"792963980","query":{"queryPlan":[{"name":"S00: Input","id":"0","startMs":"1762526248729","endMs":"1762526249198","waitRatioAvg":0.050219856514695675,"waitMsAvg":"217","waitRatioMax":0.07336264753529276,"waitMsMax":"317","readRatioAvg":0.0037028465632955336,"readMsAvg":"16","readRatioMax":0.10113399676000925,"readMsMax":"437","computeRatioAvg":0.003934274473501504,"computeMsAvg":"17","computeRatioMax":0.009025688498032862,"computeMsMax":"39","writeRatioAvg":0.0016199953714417959,"writeMsAvg":"7","writeRatioMax":0.011802823420504514,"writeMsMax":"51","shuffleOutputBytes":"851270155","shuffleOutputBytesSpilled":"0","recordsRead":"11661235","recordsWritten":"11661235","parallelInputs":"1944","completedParallelInputs":"1944","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$1:miner, $2:total_difficulty, $3:gas_limit","FROM bigquery-public-data.crypto_ethereum_classic.blocks"]},{"kind":"WRITE","substeps":["$1, $2, $3","TO __stage00_output"]}],"slotMs":"240253","computeMode":"BIGQUERY"},{"name":"S01: Repartition","id":"1","startMs":"1762526248924","endMs":"1762526250784","inputStages":["0"],"waitRatioAvg":0.0372598935431613,"waitMsAvg":"161","waitRatioMax":0.0372598935431613,"waitMsMax":"161","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":1,"computeMsAvg":"4321","computeRatioMax":1,"computeMsMax":"4321","writeRatioAvg":0.003934274473501504,"writeMsAvg":"17","writeRatioMax":0.003934274473501504,"writeMsMax":"17","shuffleOutputBytes":"270744809","shuffleOutputBytesSpilled":"0","recordsRead":"3708833","recordsWritten":"3708833","parallelInputs":"1","completedParallelInputs":"1","status":"COMPLETE","steps":[{"kind":"READ","substeps":["FROM __stage00_output"]}],"slotMs":"3381","computeMode":"BIGQUERY"},{"name":"S02: Compute","id":"2","startMs":"1762526250786","endMs":"1762526250849","inputStages":["0","1"],"waitRatioAvg":0.00023142791020597085,"waitMsAvg":"1","waitRatioMax":0.0006942837306179125,"waitMsMax":"3","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.00833140476741495,"computeMsAvg":"36","computeRatioMax":0.011802823420504514,"computeMsMax":"51","writeRatioAvg":0.001388567461235825,"writeMsAvg":"6","writeRatioMax":0.003934274473501504,"writeMsMax":"17","shuffleOutputBytes":"5967","shuffleOutputBytesSpilled":"0","recordsRead":"11544627","recordsWritten":"351","parallelInputs":"100","completedParallelInputs":"99","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$1, $2, $3","FROM __stage00_output"]},{"kind":"WRITE","substeps":["$2","TO __stage02_output"]}],"slotMs":"8001","computeMode":"BIGQUERY"},{"name":"S03: Sort+","id":"3","startMs":"1762526250817","endMs":"1762526250849","inputStages":["2"],"waitRatioAvg":0.0071742652163850965,"waitMsAvg":"31","waitRatioMax":0.0071742652163850965,"waitMsMax":"31","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.0009257116408238834,"computeMsAvg":"4","computeRatioMax":0.0009257116408238834,"computeMsMax":"4","writeRatioAvg":0.00023142791020597085,"writeMsAvg":"1","writeRatioMax":0.00023142791020597085,"writeMsMax":"1","shuffleOutputBytes":"111","shuffleOutputBytesSpilled":"0","recordsRead":"352","recordsWritten":"1","parallelInputs":"1","completedParallelInputs":"1","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$2","FROM __stage02_output"]},{"kind":"AGGREGATE","substeps":["$37 := ARRAY_AGG($36)"]},{"kind":"SORT","substeps":["$2 DESC"]},{"kind":"WRITE","substeps":["$37","TO __stage03_output"]}],"slotMs":"53","computeMode":"BIGQUERY"},{"name":"S04: Compute","id":"4","startMs":"1762526250817","endMs":"1762526250984","inputStages":["3","0","1"],"waitRatioAvg":0.010645683869474658,"waitMsAvg":"46","waitRatioMax":0.028002777134922472,"waitMsMax":"121","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.028465632955334413,"computeMsAvg":"123","computeRatioMax":0.043277019208516544,"computeMsMax":"187","writeRatioAvg":0.0025457070122656793,"writeMsAvg":"11","writeRatioMax":0.006942837306179125,"writeMsMax":"30","shuffleOutputBytes":"851270155","shuffleOutputBytesSpilled":"0","recordsRead":"11661335","recordsWritten":"11661235","parallelInputs":"100","completedParallelInputs":"100","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$37","FROM __stage03_output"]},{"kind":"READ","substeps":["$1, $2, $3","FROM __stage00_output"]},{"kind":"WRITE","substeps":["$1, $2, $3","TO __stage04_output"]}],"slotMs":"24514","computeMode":"BIGQUERY"},{"name":"S05: Aggregate+","id":"5","startMs":"1762526250908","endMs":"1762526251453","inputStages":["4"],"waitRatioAvg":0.02823420504512844,"waitMsAvg":"122","waitRatioMax":0.03008562832677621,"waitMsMax":"130","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.1610738255033557,"computeMsAvg":"696","computeRatioMax":0.22749363573246933,"computeMsMax":"983","writeRatioAvg":0.0011571395510298543,"writeMsAvg":"5","writeRatioMax":0.0025457070122656793,"writeMsMax":"11","shuffleOutputBytes":"185","shuffleOutputBytesSpilled":"0","recordsRead":"11661235","recordsWritten":"5","parallelInputs":"5","completedParallelInputs":"5","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$1, $2, $3","FROM __stage04_output"]},{"kind":"AGGREGATE","substeps":["$12 := shard_sink_stats($11)"]},{"kind":"COMPUTE","substeps":["$11 := STRUCT<...>"]},{"kind":"WRITE","substeps":["$12","TO __stage05_output"]}],"slotMs":"3940","computeMode":"BIGQUERY"},{"name":"S06: Aggregate","id":"6","startMs":"1762526250910","endMs":"1762526251451","inputStages":["5"],"waitRatioAvg":0.08701689423744503,"waitMsAvg":"376","waitRatioMax":0.08701689423744503,"waitMsMax":"376","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.0011571395510298543,"computeMsAvg":"5","computeRatioMax":0.0011571395510298543,"computeMsMax":"5","writeRatioAvg":0.00023142791020597085,"writeMsAvg":"1","writeRatioMax":0.00023142791020597085,"writeMsMax":"1","shuffleOutputBytes":"63","shuffleOutputBytesSpilled":"0","recordsRead":"5","recordsWritten":"1","parallelInputs":"1","completedParallelInputs":"1","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$12","FROM __stage05_output"]},{"kind":"AGGREGATE","substeps":["$13 := root_sink_stats($12)"]},{"kind":"WRITE","substeps":["$13","TO __stage06_output"]}],"slotMs":"90","computeMode":"BIGQUERY"},{"name":"S07: Sort+","id":"7","startMs":"1762526251688","endMs":"1762526252756","inputStages":["4","6"],"waitRatioAvg":0.053691275167785234,"waitMsAvg":"232","waitRatioMax":0.053691275167785234,"waitMsMax":"232","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.4961814394816015,"computeMsAvg":"2144","computeRatioMax":0.5345984725757926,"computeMsMax":"2310","writeRatioAvg":0.0004628558204119417,"writeMsAvg":"2","writeRatioMax":0.0004628558204119417,"writeMsMax":"2","shuffleOutputBytes":"56","shuffleOutputBytesSpilled":"0","recordsRead":"4223277","recordsWritten":"1","parallelInputs":"5","completedParallelInputs":"2","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$13","FROM __stage06_output"]},{"kind":"READ","substeps":["$1, $2, $3","FROM __stage04_output"]},{"kind":"LIMIT","substeps":["1"]},{"kind":"FILTER","substeps":["equal($10, 1)"]},{"kind":"ANALYTIC_FUNCTION","substeps":["$10 := ROW_NUMBER($13) OVER (ORDER BY $21 DESC)"]},{"kind":"SORT","substeps":["$2 DESC"]},{"kind":"WRITE","substeps":["$30, $31","TO __stage07_output"]}],"slotMs":"9036","computeMode":"BIGQUERY"},{"name":"S08: Output","id":"8","startMs":"1762526251688","endMs":"1762526252917","inputStages":["7"],"waitRatioAvg":0.05137699606572552,"waitMsAvg":"222","waitRatioMax":0.05137699606572552,"waitMsMax":"222","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.003008562832677621,"computeMsAvg":"13","computeRatioMax":0.003008562832677621,"computeMsMax":"13","writeRatioAvg":0.0009257116408238834,"writeMsAvg":"4","writeRatioMax":0.0009257116408238834,"writeMsMax":"4","shuffleOutputBytes":"55","shuffleOutputBytesSpilled":"0","recordsRead":"1","recordsWritten":"1","parallelInputs":"1","completedParallelInputs":"1","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$30, $31","FROM __stage07_output"]},{"kind":"LIMIT","substeps":["1"]},{"kind":"WRITE","substeps":["$30, $31","TO __stage08_output"]}],"slotMs":"2082","computeMode":"BIGQUERY"}],"estimatedBytesProcessed":"792963980","timeline":[{"elapsedMs":"1550","totalSlotMs":"245376","pendingUnits":"0","completedUnits":"0","activeUnits":"0"},{"elapsedMs":"2550","totalSlotMs":"281976","pendingUnits":"827","completedUnits":"1118","activeUnits":"672","estimatedRunnableUnits":"0"},{"elapsedMs":"3550","totalSlotMs":"293096","pendingUnits":"1","completedUnits":"1944","activeUnits":"1","estimatedRunnableUnits":"1000"},{"elapsedMs":"4550","totalSlotMs":"293096","pendingUnits":"75","completedUnits":"2077","activeUnits":"74","estimatedRunnableUnits":"0"},{"elapsedMs":"6484","totalSlotMs":"293096","pendingUnits":"4","completedUnits":"2154","activeUnits":"6","estimatedRunnableUnits":"6"}],"totalPartitionsProcessed":"1944","totalBytesProcessed":"792963980","totalBytesBilled":"793772032","billingTier":1,"totalSlotMs":"293096","cacheHit":false,"referencedTables":[{"projectId":"bigquery-public-data","datasetId":"crypto_ethereum_classic","tableId":"blocks"}],"statementType":"SELECT","searchStatistics":{"indexUsageMode":"UNUSED","indexUnusedReasons":[{"code":"INDEX_CONFIG_NOT_AVAILABLE","message":"There is no index configuration for the base table `bigquery-public-data:crypto_ethereum_classic.blocks`.","baseTable":{"projectId":"bigquery-public-data","datasetId":"crypto_ethereum_classic","tableId":"blocks"}}]},"performanceInsights":{"avgPreviousExecutionMs":"3310"},"transferredBytes":"0","metadataCacheStatistics":{"tableMetadataCacheUsage":[{"tableReference":{"projectId":"bigquery-public-data","datasetId":"crypto_ethereum_classic","tableId":"blocks"},"unusedReason":"OTHER_REASON"}]}},"totalSlotMs":"293096","finalExecutionDurationMs":"4387"},"status":{"state":"DONE"},"principal_subject":"user:admin@bentrollope.altostrat.com","jobCreationReason":{"code":"REQUESTED"}}'
++ echo '{"kind":"bigquery#job","etag":"CAWPP1ok/PoA8rukby3fBw==","id":"tony-allen:US.bqjob_rf81d48568d0a1d4_0000019a5ec0344b_1","selfLink":"https://bigquery.googleapis.com/bigquery/v2/projects/tony-allen/jobs/bqjob_rf81d48568d0a1d4_0000019a5ec0344b_1?location=US","user_email":"admin@bentrollope.altostrat.com","configuration":{"query":{"query":"SELECT\n    t1.miner,\n    t1.gas_limit\nFROM\n    (\n        SELECT\n            miner,\n            gas_limit,\n            ROW_NUMBER() OVER (ORDER BY total_difficulty DESC) AS rank_by_difficulty\n        FROM\n            `bigquery-public-data.crypto_ethereum_classic.blocks`\n    ) AS t1\nWHERE\n    t1.rank_by_difficulty = 1\nLIMIT 1","destinationTable":{"projectId":"tony-allen","datasetId":"_e34c49c766e4fd3f5d404c3949b9e19fa7acb372","tableId":"anonb38b1c6c_559e_4237_9633_af3ff78ec4a4"},"writeDisposition":"WRITE_TRUNCATE","priority":"INTERACTIVE","useQueryCache":false,"useLegacySql":false},"jobType":"QUERY"},"jobReference":{"projectId":"tony-allen","jobId":"bqjob_rf81d48568d0a1d4_0000019a5ec0344b_1","location":"US"},"statistics":{"creationTime":"1762526246301","startTime":"1762526246450","endTime":"1762526253132","totalBytesProcessed":"792963980","query":{"queryPlan":[{"name":"S00: Input","id":"0","startMs":"1762526248729","endMs":"1762526249198","waitRatioAvg":0.050219856514695675,"waitMsAvg":"217","waitRatioMax":0.07336264753529276,"waitMsMax":"317","readRatioAvg":0.0037028465632955336,"readMsAvg":"16","readRatioMax":0.10113399676000925,"readMsMax":"437","computeRatioAvg":0.003934274473501504,"computeMsAvg":"17","computeRatioMax":0.009025688498032862,"computeMsMax":"39","writeRatioAvg":0.0016199953714417959,"writeMsAvg":"7","writeRatioMax":0.011802823420504514,"writeMsMax":"51","shuffleOutputBytes":"851270155","shuffleOutputBytesSpilled":"0","recordsRead":"11661235","recordsWritten":"11661235","parallelInputs":"1944","completedParallelInputs":"1944","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$1:miner, $2:total_difficulty, $3:gas_limit","FROM bigquery-public-data.crypto_ethereum_classic.blocks"]},{"kind":"WRITE","substeps":["$1, $2, $3","TO __stage00_output"]}],"slotMs":"240253","computeMode":"BIGQUERY"},{"name":"S01: Repartition","id":"1","startMs":"1762526248924","endMs":"1762526250784","inputStages":["0"],"waitRatioAvg":0.0372598935431613,"waitMsAvg":"161","waitRatioMax":0.0372598935431613,"waitMsMax":"161","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":1,"computeMsAvg":"4321","computeRatioMax":1,"computeMsMax":"4321","writeRatioAvg":0.003934274473501504,"writeMsAvg":"17","writeRatioMax":0.003934274473501504,"writeMsMax":"17","shuffleOutputBytes":"270744809","shuffleOutputBytesSpilled":"0","recordsRead":"3708833","recordsWritten":"3708833","parallelInputs":"1","completedParallelInputs":"1","status":"COMPLETE","steps":[{"kind":"READ","substeps":["FROM __stage00_output"]}],"slotMs":"3381","computeMode":"BIGQUERY"},{"name":"S02: Compute","id":"2","startMs":"1762526250786","endMs":"1762526250849","inputStages":["0","1"],"waitRatioAvg":0.00023142791020597085,"waitMsAvg":"1","waitRatioMax":0.0006942837306179125,"waitMsMax":"3","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.00833140476741495,"computeMsAvg":"36","computeRatioMax":0.011802823420504514,"computeMsMax":"51","writeRatioAvg":0.001388567461235825,"writeMsAvg":"6","writeRatioMax":0.003934274473501504,"writeMsMax":"17","shuffleOutputBytes":"5967","shuffleOutputBytesSpilled":"0","recordsRead":"11544627","recordsWritten":"351","parallelInputs":"100","completedParallelInputs":"99","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$1, $2, $3","FROM __stage00_output"]},{"kind":"WRITE","substeps":["$2","TO __stage02_output"]}],"slotMs":"8001","computeMode":"BIGQUERY"},{"name":"S03: Sort+","id":"3","startMs":"1762526250817","endMs":"1762526250849","inputStages":["2"],"waitRatioAvg":0.0071742652163850965,"waitMsAvg":"31","waitRatioMax":0.0071742652163850965,"waitMsMax":"31","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.0009257116408238834,"computeMsAvg":"4","computeRatioMax":0.0009257116408238834,"computeMsMax":"4","writeRatioAvg":0.00023142791020597085,"writeMsAvg":"1","writeRatioMax":0.00023142791020597085,"writeMsMax":"1","shuffleOutputBytes":"111","shuffleOutputBytesSpilled":"0","recordsRead":"352","recordsWritten":"1","parallelInputs":"1","completedParallelInputs":"1","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$2","FROM __stage02_output"]},{"kind":"AGGREGATE","substeps":["$37 := ARRAY_AGG($36)"]},{"kind":"SORT","substeps":["$2 DESC"]},{"kind":"WRITE","substeps":["$37","TO __stage03_output"]}],"slotMs":"53","computeMode":"BIGQUERY"},{"name":"S04: Compute","id":"4","startMs":"1762526250817","endMs":"1762526250984","inputStages":["3","0","1"],"waitRatioAvg":0.010645683869474658,"waitMsAvg":"46","waitRatioMax":0.028002777134922472,"waitMsMax":"121","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.028465632955334413,"computeMsAvg":"123","computeRatioMax":0.043277019208516544,"computeMsMax":"187","writeRatioAvg":0.0025457070122656793,"writeMsAvg":"11","writeRatioMax":0.006942837306179125,"writeMsMax":"30","shuffleOutputBytes":"851270155","shuffleOutputBytesSpilled":"0","recordsRead":"11661335","recordsWritten":"11661235","parallelInputs":"100","completedParallelInputs":"100","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$37","FROM __stage03_output"]},{"kind":"READ","substeps":["$1, $2, $3","FROM __stage00_output"]},{"kind":"WRITE","substeps":["$1, $2, $3","TO __stage04_output"]}],"slotMs":"24514","computeMode":"BIGQUERY"},{"name":"S05: Aggregate+","id":"5","startMs":"1762526250908","endMs":"1762526251453","inputStages":["4"],"waitRatioAvg":0.02823420504512844,"waitMsAvg":"122","waitRatioMax":0.03008562832677621,"waitMsMax":"130","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.1610738255033557,"computeMsAvg":"696","computeRatioMax":0.22749363573246933,"computeMsMax":"983","writeRatioAvg":0.0011571395510298543,"writeMsAvg":"5","writeRatioMax":0.0025457070122656793,"writeMsMax":"11","shuffleOutputBytes":"185","shuffleOutputBytesSpilled":"0","recordsRead":"11661235","recordsWritten":"5","parallelInputs":"5","completedParallelInputs":"5","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$1, $2, $3","FROM __stage04_output"]},{"kind":"AGGREGATE","substeps":["$12 := shard_sink_stats($11)"]},{"kind":"COMPUTE","substeps":["$11 := STRUCT<...>"]},{"kind":"WRITE","substeps":["$12","TO __stage05_output"]}],"slotMs":"3940","computeMode":"BIGQUERY"},{"name":"S06: Aggregate","id":"6","startMs":"1762526250910","endMs":"1762526251451","inputStages":["5"],"waitRatioAvg":0.08701689423744503,"waitMsAvg":"376","waitRatioMax":0.08701689423744503,"waitMsMax":"376","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.0011571395510298543,"computeMsAvg":"5","computeRatioMax":0.0011571395510298543,"computeMsMax":"5","writeRatioAvg":0.00023142791020597085,"writeMsAvg":"1","writeRatioMax":0.00023142791020597085,"writeMsMax":"1","shuffleOutputBytes":"63","shuffleOutputBytesSpilled":"0","recordsRead":"5","recordsWritten":"1","parallelInputs":"1","completedParallelInputs":"1","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$12","FROM __stage05_output"]},{"kind":"AGGREGATE","substeps":["$13 := root_sink_stats($12)"]},{"kind":"WRITE","substeps":["$13","TO __stage06_output"]}],"slotMs":"90","computeMode":"BIGQUERY"},{"name":"S07: Sort+","id":"7","startMs":"1762526251688","endMs":"1762526252756","inputStages":["4","6"],"waitRatioAvg":0.053691275167785234,"waitMsAvg":"232","waitRatioMax":0.053691275167785234,"waitMsMax":"232","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.4961814394816015,"computeMsAvg":"2144","computeRatioMax":0.5345984725757926,"computeMsMax":"2310","writeRatioAvg":0.0004628558204119417,"writeMsAvg":"2","writeRatioMax":0.0004628558204119417,"writeMsMax":"2","shuffleOutputBytes":"56","shuffleOutputBytesSpilled":"0","recordsRead":"4223277","recordsWritten":"1","parallelInputs":"5","completedParallelInputs":"2","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$13","FROM __stage06_output"]},{"kind":"READ","substeps":["$1, $2, $3","FROM __stage04_output"]},{"kind":"LIMIT","substeps":["1"]},{"kind":"FILTER","substeps":["equal($10, 1)"]},{"kind":"ANALYTIC_FUNCTION","substeps":["$10 := ROW_NUMBER($13) OVER (ORDER BY $21 DESC)"]},{"kind":"SORT","substeps":["$2 DESC"]},{"kind":"WRITE","substeps":["$30, $31","TO __stage07_output"]}],"slotMs":"9036","computeMode":"BIGQUERY"},{"name":"S08: Output","id":"8","startMs":"1762526251688","endMs":"1762526252917","inputStages":["7"],"waitRatioAvg":0.05137699606572552,"waitMsAvg":"222","waitRatioMax":0.05137699606572552,"waitMsMax":"222","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.003008562832677621,"computeMsAvg":"13","computeRatioMax":0.003008562832677621,"computeMsMax":"13","writeRatioAvg":0.0009257116408238834,"writeMsAvg":"4","writeRatioMax":0.0009257116408238834,"writeMsMax":"4","shuffleOutputBytes":"55","shuffleOutputBytesSpilled":"0","recordsRead":"1","recordsWritten":"1","parallelInputs":"1","completedParallelInputs":"1","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$30, $31","FROM __stage07_output"]},{"kind":"LIMIT","substeps":["1"]},{"kind":"WRITE","substeps":["$30, $31","TO __stage08_output"]}],"slotMs":"2082","computeMode":"BIGQUERY"}],"estimatedBytesProcessed":"792963980","timeline":[{"elapsedMs":"1550","totalSlotMs":"245376","pendingUnits":"0","completedUnits":"0","activeUnits":"0"},{"elapsedMs":"2550","totalSlotMs":"281976","pendingUnits":"827","completedUnits":"1118","activeUnits":"672","estimatedRunnableUnits":"0"},{"elapsedMs":"3550","totalSlotMs":"293096","pendingUnits":"1","completedUnits":"1944","activeUnits":"1","estimatedRunnableUnits":"1000"},{"elapsedMs":"4550","totalSlotMs":"293096","pendingUnits":"75","completedUnits":"2077","activeUnits":"74","estimatedRunnableUnits":"0"},{"elapsedMs":"6484","totalSlotMs":"293096","pendingUnits":"4","completedUnits":"2154","activeUnits":"6","estimatedRunnableUnits":"6"}],"totalPartitionsProcessed":"1944","totalBytesProcessed":"792963980","totalBytesBilled":"793772032","billingTier":1,"totalSlotMs":"293096","cacheHit":false,"referencedTables":[{"projectId":"bigquery-public-data","datasetId":"crypto_ethereum_classic","tableId":"blocks"}],"statementType":"SELECT","searchStatistics":{"indexUsageMode":"UNUSED","indexUnusedReasons":[{"code":"INDEX_CONFIG_NOT_AVAILABLE","message":"There is no index configuration for the base table `bigquery-public-data:crypto_ethereum_classic.blocks`.","baseTable":{"projectId":"bigquery-public-data","datasetId":"crypto_ethereum_classic","tableId":"blocks"}}]},"performanceInsights":{"avgPreviousExecutionMs":"3310"},"transferredBytes":"0","metadataCacheStatistics":{"tableMetadataCacheUsage":[{"tableReference":{"projectId":"bigquery-public-data","datasetId":"crypto_ethereum_classic","tableId":"blocks"},"unusedReason":"OTHER_REASON"}]}},"totalSlotMs":"293096","finalExecutionDurationMs":"4387"},"status":{"state":"DONE"},"principal_subject":"user:admin@bentrollope.altostrat.com","jobCreationReason":{"code":"REQUESTED"}}'
++ jq -r .statistics.totalBytesProcessed
+ total_bytes_processed=792963980
++ jq -r .statistics.totalSlotMs
++ echo '{"kind":"bigquery#job","etag":"CAWPP1ok/PoA8rukby3fBw==","id":"tony-allen:US.bqjob_rf81d48568d0a1d4_0000019a5ec0344b_1","selfLink":"https://bigquery.googleapis.com/bigquery/v2/projects/tony-allen/jobs/bqjob_rf81d48568d0a1d4_0000019a5ec0344b_1?location=US","user_email":"admin@bentrollope.altostrat.com","configuration":{"query":{"query":"SELECT\n    t1.miner,\n    t1.gas_limit\nFROM\n    (\n        SELECT\n            miner,\n            gas_limit,\n            ROW_NUMBER() OVER (ORDER BY total_difficulty DESC) AS rank_by_difficulty\n        FROM\n            `bigquery-public-data.crypto_ethereum_classic.blocks`\n    ) AS t1\nWHERE\n    t1.rank_by_difficulty = 1\nLIMIT 1","destinationTable":{"projectId":"tony-allen","datasetId":"_e34c49c766e4fd3f5d404c3949b9e19fa7acb372","tableId":"anonb38b1c6c_559e_4237_9633_af3ff78ec4a4"},"writeDisposition":"WRITE_TRUNCATE","priority":"INTERACTIVE","useQueryCache":false,"useLegacySql":false},"jobType":"QUERY"},"jobReference":{"projectId":"tony-allen","jobId":"bqjob_rf81d48568d0a1d4_0000019a5ec0344b_1","location":"US"},"statistics":{"creationTime":"1762526246301","startTime":"1762526246450","endTime":"1762526253132","totalBytesProcessed":"792963980","query":{"queryPlan":[{"name":"S00: Input","id":"0","startMs":"1762526248729","endMs":"1762526249198","waitRatioAvg":0.050219856514695675,"waitMsAvg":"217","waitRatioMax":0.07336264753529276,"waitMsMax":"317","readRatioAvg":0.0037028465632955336,"readMsAvg":"16","readRatioMax":0.10113399676000925,"readMsMax":"437","computeRatioAvg":0.003934274473501504,"computeMsAvg":"17","computeRatioMax":0.009025688498032862,"computeMsMax":"39","writeRatioAvg":0.0016199953714417959,"writeMsAvg":"7","writeRatioMax":0.011802823420504514,"writeMsMax":"51","shuffleOutputBytes":"851270155","shuffleOutputBytesSpilled":"0","recordsRead":"11661235","recordsWritten":"11661235","parallelInputs":"1944","completedParallelInputs":"1944","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$1:miner, $2:total_difficulty, $3:gas_limit","FROM bigquery-public-data.crypto_ethereum_classic.blocks"]},{"kind":"WRITE","substeps":["$1, $2, $3","TO __stage00_output"]}],"slotMs":"240253","computeMode":"BIGQUERY"},{"name":"S01: Repartition","id":"1","startMs":"1762526248924","endMs":"1762526250784","inputStages":["0"],"waitRatioAvg":0.0372598935431613,"waitMsAvg":"161","waitRatioMax":0.0372598935431613,"waitMsMax":"161","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":1,"computeMsAvg":"4321","computeRatioMax":1,"computeMsMax":"4321","writeRatioAvg":0.003934274473501504,"writeMsAvg":"17","writeRatioMax":0.003934274473501504,"writeMsMax":"17","shuffleOutputBytes":"270744809","shuffleOutputBytesSpilled":"0","recordsRead":"3708833","recordsWritten":"3708833","parallelInputs":"1","completedParallelInputs":"1","status":"COMPLETE","steps":[{"kind":"READ","substeps":["FROM __stage00_output"]}],"slotMs":"3381","computeMode":"BIGQUERY"},{"name":"S02: Compute","id":"2","startMs":"1762526250786","endMs":"1762526250849","inputStages":["0","1"],"waitRatioAvg":0.00023142791020597085,"waitMsAvg":"1","waitRatioMax":0.0006942837306179125,"waitMsMax":"3","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.00833140476741495,"computeMsAvg":"36","computeRatioMax":0.011802823420504514,"computeMsMax":"51","writeRatioAvg":0.001388567461235825,"writeMsAvg":"6","writeRatioMax":0.003934274473501504,"writeMsMax":"17","shuffleOutputBytes":"5967","shuffleOutputBytesSpilled":"0","recordsRead":"11544627","recordsWritten":"351","parallelInputs":"100","completedParallelInputs":"99","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$1, $2, $3","FROM __stage00_output"]},{"kind":"WRITE","substeps":["$2","TO __stage02_output"]}],"slotMs":"8001","computeMode":"BIGQUERY"},{"name":"S03: Sort+","id":"3","startMs":"1762526250817","endMs":"1762526250849","inputStages":["2"],"waitRatioAvg":0.0071742652163850965,"waitMsAvg":"31","waitRatioMax":0.0071742652163850965,"waitMsMax":"31","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.0009257116408238834,"computeMsAvg":"4","computeRatioMax":0.0009257116408238834,"computeMsMax":"4","writeRatioAvg":0.00023142791020597085,"writeMsAvg":"1","writeRatioMax":0.00023142791020597085,"writeMsMax":"1","shuffleOutputBytes":"111","shuffleOutputBytesSpilled":"0","recordsRead":"352","recordsWritten":"1","parallelInputs":"1","completedParallelInputs":"1","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$2","FROM __stage02_output"]},{"kind":"AGGREGATE","substeps":["$37 := ARRAY_AGG($36)"]},{"kind":"SORT","substeps":["$2 DESC"]},{"kind":"WRITE","substeps":["$37","TO __stage03_output"]}],"slotMs":"53","computeMode":"BIGQUERY"},{"name":"S04: Compute","id":"4","startMs":"1762526250817","endMs":"1762526250984","inputStages":["3","0","1"],"waitRatioAvg":0.010645683869474658,"waitMsAvg":"46","waitRatioMax":0.028002777134922472,"waitMsMax":"121","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.028465632955334413,"computeMsAvg":"123","computeRatioMax":0.043277019208516544,"computeMsMax":"187","writeRatioAvg":0.0025457070122656793,"writeMsAvg":"11","writeRatioMax":0.006942837306179125,"writeMsMax":"30","shuffleOutputBytes":"851270155","shuffleOutputBytesSpilled":"0","recordsRead":"11661335","recordsWritten":"11661235","parallelInputs":"100","completedParallelInputs":"100","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$37","FROM __stage03_output"]},{"kind":"READ","substeps":["$1, $2, $3","FROM __stage00_output"]},{"kind":"WRITE","substeps":["$1, $2, $3","TO __stage04_output"]}],"slotMs":"24514","computeMode":"BIGQUERY"},{"name":"S05: Aggregate+","id":"5","startMs":"1762526250908","endMs":"1762526251453","inputStages":["4"],"waitRatioAvg":0.02823420504512844,"waitMsAvg":"122","waitRatioMax":0.03008562832677621,"waitMsMax":"130","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.1610738255033557,"computeMsAvg":"696","computeRatioMax":0.22749363573246933,"computeMsMax":"983","writeRatioAvg":0.0011571395510298543,"writeMsAvg":"5","writeRatioMax":0.0025457070122656793,"writeMsMax":"11","shuffleOutputBytes":"185","shuffleOutputBytesSpilled":"0","recordsRead":"11661235","recordsWritten":"5","parallelInputs":"5","completedParallelInputs":"5","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$1, $2, $3","FROM __stage04_output"]},{"kind":"AGGREGATE","substeps":["$12 := shard_sink_stats($11)"]},{"kind":"COMPUTE","substeps":["$11 := STRUCT<...>"]},{"kind":"WRITE","substeps":["$12","TO __stage05_output"]}],"slotMs":"3940","computeMode":"BIGQUERY"},{"name":"S06: Aggregate","id":"6","startMs":"1762526250910","endMs":"1762526251451","inputStages":["5"],"waitRatioAvg":0.08701689423744503,"waitMsAvg":"376","waitRatioMax":0.08701689423744503,"waitMsMax":"376","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.0011571395510298543,"computeMsAvg":"5","computeRatioMax":0.0011571395510298543,"computeMsMax":"5","writeRatioAvg":0.00023142791020597085,"writeMsAvg":"1","writeRatioMax":0.00023142791020597085,"writeMsMax":"1","shuffleOutputBytes":"63","shuffleOutputBytesSpilled":"0","recordsRead":"5","recordsWritten":"1","parallelInputs":"1","completedParallelInputs":"1","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$12","FROM __stage05_output"]},{"kind":"AGGREGATE","substeps":["$13 := root_sink_stats($12)"]},{"kind":"WRITE","substeps":["$13","TO __stage06_output"]}],"slotMs":"90","computeMode":"BIGQUERY"},{"name":"S07: Sort+","id":"7","startMs":"1762526251688","endMs":"1762526252756","inputStages":["4","6"],"waitRatioAvg":0.053691275167785234,"waitMsAvg":"232","waitRatioMax":0.053691275167785234,"waitMsMax":"232","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.4961814394816015,"computeMsAvg":"2144","computeRatioMax":0.5345984725757926,"computeMsMax":"2310","writeRatioAvg":0.0004628558204119417,"writeMsAvg":"2","writeRatioMax":0.0004628558204119417,"writeMsMax":"2","shuffleOutputBytes":"56","shuffleOutputBytesSpilled":"0","recordsRead":"4223277","recordsWritten":"1","parallelInputs":"5","completedParallelInputs":"2","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$13","FROM __stage06_output"]},{"kind":"READ","substeps":["$1, $2, $3","FROM __stage04_output"]},{"kind":"LIMIT","substeps":["1"]},{"kind":"FILTER","substeps":["equal($10, 1)"]},{"kind":"ANALYTIC_FUNCTION","substeps":["$10 := ROW_NUMBER($13) OVER (ORDER BY $21 DESC)"]},{"kind":"SORT","substeps":["$2 DESC"]},{"kind":"WRITE","substeps":["$30, $31","TO __stage07_output"]}],"slotMs":"9036","computeMode":"BIGQUERY"},{"name":"S08: Output","id":"8","startMs":"1762526251688","endMs":"1762526252917","inputStages":["7"],"waitRatioAvg":0.05137699606572552,"waitMsAvg":"222","waitRatioMax":0.05137699606572552,"waitMsMax":"222","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.003008562832677621,"computeMsAvg":"13","computeRatioMax":0.003008562832677621,"computeMsMax":"13","writeRatioAvg":0.0009257116408238834,"writeMsAvg":"4","writeRatioMax":0.0009257116408238834,"writeMsMax":"4","shuffleOutputBytes":"55","shuffleOutputBytesSpilled":"0","recordsRead":"1","recordsWritten":"1","parallelInputs":"1","completedParallelInputs":"1","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$30, $31","FROM __stage07_output"]},{"kind":"LIMIT","substeps":["1"]},{"kind":"WRITE","substeps":["$30, $31","TO __stage08_output"]}],"slotMs":"2082","computeMode":"BIGQUERY"}],"estimatedBytesProcessed":"792963980","timeline":[{"elapsedMs":"1550","totalSlotMs":"245376","pendingUnits":"0","completedUnits":"0","activeUnits":"0"},{"elapsedMs":"2550","totalSlotMs":"281976","pendingUnits":"827","completedUnits":"1118","activeUnits":"672","estimatedRunnableUnits":"0"},{"elapsedMs":"3550","totalSlotMs":"293096","pendingUnits":"1","completedUnits":"1944","activeUnits":"1","estimatedRunnableUnits":"1000"},{"elapsedMs":"4550","totalSlotMs":"293096","pendingUnits":"75","completedUnits":"2077","activeUnits":"74","estimatedRunnableUnits":"0"},{"elapsedMs":"6484","totalSlotMs":"293096","pendingUnits":"4","completedUnits":"2154","activeUnits":"6","estimatedRunnableUnits":"6"}],"totalPartitionsProcessed":"1944","totalBytesProcessed":"792963980","totalBytesBilled":"793772032","billingTier":1,"totalSlotMs":"293096","cacheHit":false,"referencedTables":[{"projectId":"bigquery-public-data","datasetId":"crypto_ethereum_classic","tableId":"blocks"}],"statementType":"SELECT","searchStatistics":{"indexUsageMode":"UNUSED","indexUnusedReasons":[{"code":"INDEX_CONFIG_NOT_AVAILABLE","message":"There is no index configuration for the base table `bigquery-public-data:crypto_ethereum_classic.blocks`.","baseTable":{"projectId":"bigquery-public-data","datasetId":"crypto_ethereum_classic","tableId":"blocks"}}]},"performanceInsights":{"avgPreviousExecutionMs":"3310"},"transferredBytes":"0","metadataCacheStatistics":{"tableMetadataCacheUsage":[{"tableReference":{"projectId":"bigquery-public-data","datasetId":"crypto_ethereum_classic","tableId":"blocks"},"unusedReason":"OTHER_REASON"}]}},"totalSlotMs":"293096","finalExecutionDurationMs":"4387"},"status":{"state":"DONE"},"principal_subject":"user:admin@bentrollope.altostrat.com","jobCreationReason":{"code":"REQUESTED"}}'
+ total_slot_ms=293096
++ echo '{"kind":"bigquery#job","etag":"CAWPP1ok/PoA8rukby3fBw==","id":"tony-allen:US.bqjob_rf81d48568d0a1d4_0000019a5ec0344b_1","selfLink":"https://bigquery.googleapis.com/bigquery/v2/projects/tony-allen/jobs/bqjob_rf81d48568d0a1d4_0000019a5ec0344b_1?location=US","user_email":"admin@bentrollope.altostrat.com","configuration":{"query":{"query":"SELECT\n    t1.miner,\n    t1.gas_limit\nFROM\n    (\n        SELECT\n            miner,\n            gas_limit,\n            ROW_NUMBER() OVER (ORDER BY total_difficulty DESC) AS rank_by_difficulty\n        FROM\n            `bigquery-public-data.crypto_ethereum_classic.blocks`\n    ) AS t1\nWHERE\n    t1.rank_by_difficulty = 1\nLIMIT 1","destinationTable":{"projectId":"tony-allen","datasetId":"_e34c49c766e4fd3f5d404c3949b9e19fa7acb372","tableId":"anonb38b1c6c_559e_4237_9633_af3ff78ec4a4"},"writeDisposition":"WRITE_TRUNCATE","priority":"INTERACTIVE","useQueryCache":false,"useLegacySql":false},"jobType":"QUERY"},"jobReference":{"projectId":"tony-allen","jobId":"bqjob_rf81d48568d0a1d4_0000019a5ec0344b_1","location":"US"},"statistics":{"creationTime":"1762526246301","startTime":"1762526246450","endTime":"1762526253132","totalBytesProcessed":"792963980","query":{"queryPlan":[{"name":"S00: Input","id":"0","startMs":"1762526248729","endMs":"1762526249198","waitRatioAvg":0.050219856514695675,"waitMsAvg":"217","waitRatioMax":0.07336264753529276,"waitMsMax":"317","readRatioAvg":0.0037028465632955336,"readMsAvg":"16","readRatioMax":0.10113399676000925,"readMsMax":"437","computeRatioAvg":0.003934274473501504,"computeMsAvg":"17","computeRatioMax":0.009025688498032862,"computeMsMax":"39","writeRatioAvg":0.0016199953714417959,"writeMsAvg":"7","writeRatioMax":0.011802823420504514,"writeMsMax":"51","shuffleOutputBytes":"851270155","shuffleOutputBytesSpilled":"0","recordsRead":"11661235","recordsWritten":"11661235","parallelInputs":"1944","completedParallelInputs":"1944","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$1:miner, $2:total_difficulty, $3:gas_limit","FROM bigquery-public-data.crypto_ethereum_classic.blocks"]},{"kind":"WRITE","substeps":["$1, $2, $3","TO __stage00_output"]}],"slotMs":"240253","computeMode":"BIGQUERY"},{"name":"S01: Repartition","id":"1","startMs":"1762526248924","endMs":"1762526250784","inputStages":["0"],"waitRatioAvg":0.0372598935431613,"waitMsAvg":"161","waitRatioMax":0.0372598935431613,"waitMsMax":"161","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":1,"computeMsAvg":"4321","computeRatioMax":1,"computeMsMax":"4321","writeRatioAvg":0.003934274473501504,"writeMsAvg":"17","writeRatioMax":0.003934274473501504,"writeMsMax":"17","shuffleOutputBytes":"270744809","shuffleOutputBytesSpilled":"0","recordsRead":"3708833","recordsWritten":"3708833","parallelInputs":"1","completedParallelInputs":"1","status":"COMPLETE","steps":[{"kind":"READ","substeps":["FROM __stage00_output"]}],"slotMs":"3381","computeMode":"BIGQUERY"},{"name":"S02: Compute","id":"2","startMs":"1762526250786","endMs":"1762526250849","inputStages":["0","1"],"waitRatioAvg":0.00023142791020597085,"waitMsAvg":"1","waitRatioMax":0.0006942837306179125,"waitMsMax":"3","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.00833140476741495,"computeMsAvg":"36","computeRatioMax":0.011802823420504514,"computeMsMax":"51","writeRatioAvg":0.001388567461235825,"writeMsAvg":"6","writeRatioMax":0.003934274473501504,"writeMsMax":"17","shuffleOutputBytes":"5967","shuffleOutputBytesSpilled":"0","recordsRead":"11544627","recordsWritten":"351","parallelInputs":"100","completedParallelInputs":"99","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$1, $2, $3","FROM __stage00_output"]},{"kind":"WRITE","substeps":["$2","TO __stage02_output"]}],"slotMs":"8001","computeMode":"BIGQUERY"},{"name":"S03: Sort+","id":"3","startMs":"1762526250817","endMs":"1762526250849","inputStages":["2"],"waitRatioAvg":0.0071742652163850965,"waitMsAvg":"31","waitRatioMax":0.0071742652163850965,"waitMsMax":"31","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.0009257116408238834,"computeMsAvg":"4","computeRatioMax":0.0009257116408238834,"computeMsMax":"4","writeRatioAvg":0.00023142791020597085,"writeMsAvg":"1","writeRatioMax":0.00023142791020597085,"writeMsMax":"1","shuffleOutputBytes":"111","shuffleOutputBytesSpilled":"0","recordsRead":"352","recordsWritten":"1","parallelInputs":"1","completedParallelInputs":"1","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$2","FROM __stage02_output"]},{"kind":"AGGREGATE","substeps":["$37 := ARRAY_AGG($36)"]},{"kind":"SORT","substeps":["$2 DESC"]},{"kind":"WRITE","substeps":["$37","TO __stage03_output"]}],"slotMs":"53","computeMode":"BIGQUERY"},{"name":"S04: Compute","id":"4","startMs":"1762526250817","endMs":"1762526250984","inputStages":["3","0","1"],"waitRatioAvg":0.010645683869474658,"waitMsAvg":"46","waitRatioMax":0.028002777134922472,"waitMsMax":"121","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.028465632955334413,"computeMsAvg":"123","computeRatioMax":0.043277019208516544,"computeMsMax":"187","writeRatioAvg":0.0025457070122656793,"writeMsAvg":"11","writeRatioMax":0.006942837306179125,"writeMsMax":"30","shuffleOutputBytes":"851270155","shuffleOutputBytesSpilled":"0","recordsRead":"11661335","recordsWritten":"11661235","parallelInputs":"100","completedParallelInputs":"100","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$37","FROM __stage03_output"]},{"kind":"READ","substeps":["$1, $2, $3","FROM __stage00_output"]},{"kind":"WRITE","substeps":["$1, $2, $3","TO __stage04_output"]}],"slotMs":"24514","computeMode":"BIGQUERY"},{"name":"S05: Aggregate+","id":"5","startMs":"1762526250908","endMs":"1762526251453","inputStages":["4"],"waitRatioAvg":0.02823420504512844,"waitMsAvg":"122","waitRatioMax":0.03008562832677621,"waitMsMax":"130","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.1610738255033557,"computeMsAvg":"696","computeRatioMax":0.22749363573246933,"computeMsMax":"983","writeRatioAvg":0.0011571395510298543,"writeMsAvg":"5","writeRatioMax":0.0025457070122656793,"writeMsMax":"11","shuffleOutputBytes":"185","shuffleOutputBytesSpilled":"0","recordsRead":"11661235","recordsWritten":"5","parallelInputs":"5","completedParallelInputs":"5","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$1, $2, $3","FROM __stage04_output"]},{"kind":"AGGREGATE","substeps":["$12 := shard_sink_stats($11)"]},{"kind":"COMPUTE","substeps":["$11 := STRUCT<...>"]},{"kind":"WRITE","substeps":["$12","TO __stage05_output"]}],"slotMs":"3940","computeMode":"BIGQUERY"},{"name":"S06: Aggregate","id":"6","startMs":"1762526250910","endMs":"1762526251451","inputStages":["5"],"waitRatioAvg":0.08701689423744503,"waitMsAvg":"376","waitRatioMax":0.08701689423744503,"waitMsMax":"376","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.0011571395510298543,"computeMsAvg":"5","computeRatioMax":0.0011571395510298543,"computeMsMax":"5","writeRatioAvg":0.00023142791020597085,"writeMsAvg":"1","writeRatioMax":0.00023142791020597085,"writeMsMax":"1","shuffleOutputBytes":"63","shuffleOutputBytesSpilled":"0","recordsRead":"5","recordsWritten":"1","parallelInputs":"1","completedParallelInputs":"1","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$12","FROM __stage05_output"]},{"kind":"AGGREGATE","substeps":["$13 := root_sink_stats($12)"]},{"kind":"WRITE","substeps":["$13","TO __stage06_output"]}],"slotMs":"90","computeMode":"BIGQUERY"},{"name":"S07: Sort+","id":"7","startMs":"1762526251688","endMs":"1762526252756","inputStages":["4","6"],"waitRatioAvg":0.053691275167785234,"waitMsAvg":"232","waitRatioMax":0.053691275167785234,"waitMsMax":"232","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.4961814394816015,"computeMsAvg":"2144","computeRatioMax":0.5345984725757926,"computeMsMax":"2310","writeRatioAvg":0.0004628558204119417,"writeMsAvg":"2","writeRatioMax":0.0004628558204119417,"writeMsMax":"2","shuffleOutputBytes":"56","shuffleOutputBytesSpilled":"0","recordsRead":"4223277","recordsWritten":"1","parallelInputs":"5","completedParallelInputs":"2","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$13","FROM __stage06_output"]},{"kind":"READ","substeps":["$1, $2, $3","FROM __stage04_output"]},{"kind":"LIMIT","substeps":["1"]},{"kind":"FILTER","substeps":["equal($10, 1)"]},{"kind":"ANALYTIC_FUNCTION","substeps":["$10 := ROW_NUMBER($13) OVER (ORDER BY $21 DESC)"]},{"kind":"SORT","substeps":["$2 DESC"]},{"kind":"WRITE","substeps":["$30, $31","TO __stage07_output"]}],"slotMs":"9036","computeMode":"BIGQUERY"},{"name":"S08: Output","id":"8","startMs":"1762526251688","endMs":"1762526252917","inputStages":["7"],"waitRatioAvg":0.05137699606572552,"waitMsAvg":"222","waitRatioMax":0.05137699606572552,"waitMsMax":"222","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.003008562832677621,"computeMsAvg":"13","computeRatioMax":0.003008562832677621,"computeMsMax":"13","writeRatioAvg":0.0009257116408238834,"writeMsAvg":"4","writeRatioMax":0.0009257116408238834,"writeMsMax":"4","shuffleOutputBytes":"55","shuffleOutputBytesSpilled":"0","recordsRead":"1","recordsWritten":"1","parallelInputs":"1","completedParallelInputs":"1","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$30, $31","FROM __stage07_output"]},{"kind":"LIMIT","substeps":["1"]},{"kind":"WRITE","substeps":["$30, $31","TO __stage08_output"]}],"slotMs":"2082","computeMode":"BIGQUERY"}],"estimatedBytesProcessed":"792963980","timeline":[{"elapsedMs":"1550","totalSlotMs":"245376","pendingUnits":"0","completedUnits":"0","activeUnits":"0"},{"elapsedMs":"2550","totalSlotMs":"281976","pendingUnits":"827","completedUnits":"1118","activeUnits":"672","estimatedRunnableUnits":"0"},{"elapsedMs":"3550","totalSlotMs":"293096","pendingUnits":"1","completedUnits":"1944","activeUnits":"1","estimatedRunnableUnits":"1000"},{"elapsedMs":"4550","totalSlotMs":"293096","pendingUnits":"75","completedUnits":"2077","activeUnits":"74","estimatedRunnableUnits":"0"},{"elapsedMs":"6484","totalSlotMs":"293096","pendingUnits":"4","completedUnits":"2154","activeUnits":"6","estimatedRunnableUnits":"6"}],"totalPartitionsProcessed":"1944","totalBytesProcessed":"792963980","totalBytesBilled":"793772032","billingTier":1,"totalSlotMs":"293096","cacheHit":false,"referencedTables":[{"projectId":"bigquery-public-data","datasetId":"crypto_ethereum_classic","tableId":"blocks"}],"statementType":"SELECT","searchStatistics":{"indexUsageMode":"UNUSED","indexUnusedReasons":[{"code":"INDEX_CONFIG_NOT_AVAILABLE","message":"There is no index configuration for the base table `bigquery-public-data:crypto_ethereum_classic.blocks`.","baseTable":{"projectId":"bigquery-public-data","datasetId":"crypto_ethereum_classic","tableId":"blocks"}}]},"performanceInsights":{"avgPreviousExecutionMs":"3310"},"transferredBytes":"0","metadataCacheStatistics":{"tableMetadataCacheUsage":[{"tableReference":{"projectId":"bigquery-public-data","datasetId":"crypto_ethereum_classic","tableId":"blocks"},"unusedReason":"OTHER_REASON"}]}},"totalSlotMs":"293096","finalExecutionDurationMs":"4387"},"status":{"state":"DONE"},"principal_subject":"user:admin@bentrollope.altostrat.com","jobCreationReason":{"code":"REQUESTED"}}'
++ jq -r .statistics.startTime
+ start_time=1762526246450
++ jq -r .statistics.endTime
++ echo '{"kind":"bigquery#job","etag":"CAWPP1ok/PoA8rukby3fBw==","id":"tony-allen:US.bqjob_rf81d48568d0a1d4_0000019a5ec0344b_1","selfLink":"https://bigquery.googleapis.com/bigquery/v2/projects/tony-allen/jobs/bqjob_rf81d48568d0a1d4_0000019a5ec0344b_1?location=US","user_email":"admin@bentrollope.altostrat.com","configuration":{"query":{"query":"SELECT\n    t1.miner,\n    t1.gas_limit\nFROM\n    (\n        SELECT\n            miner,\n            gas_limit,\n            ROW_NUMBER() OVER (ORDER BY total_difficulty DESC) AS rank_by_difficulty\n        FROM\n            `bigquery-public-data.crypto_ethereum_classic.blocks`\n    ) AS t1\nWHERE\n    t1.rank_by_difficulty = 1\nLIMIT 1","destinationTable":{"projectId":"tony-allen","datasetId":"_e34c49c766e4fd3f5d404c3949b9e19fa7acb372","tableId":"anonb38b1c6c_559e_4237_9633_af3ff78ec4a4"},"writeDisposition":"WRITE_TRUNCATE","priority":"INTERACTIVE","useQueryCache":false,"useLegacySql":false},"jobType":"QUERY"},"jobReference":{"projectId":"tony-allen","jobId":"bqjob_rf81d48568d0a1d4_0000019a5ec0344b_1","location":"US"},"statistics":{"creationTime":"1762526246301","startTime":"1762526246450","endTime":"1762526253132","totalBytesProcessed":"792963980","query":{"queryPlan":[{"name":"S00: Input","id":"0","startMs":"1762526248729","endMs":"1762526249198","waitRatioAvg":0.050219856514695675,"waitMsAvg":"217","waitRatioMax":0.07336264753529276,"waitMsMax":"317","readRatioAvg":0.0037028465632955336,"readMsAvg":"16","readRatioMax":0.10113399676000925,"readMsMax":"437","computeRatioAvg":0.003934274473501504,"computeMsAvg":"17","computeRatioMax":0.009025688498032862,"computeMsMax":"39","writeRatioAvg":0.0016199953714417959,"writeMsAvg":"7","writeRatioMax":0.011802823420504514,"writeMsMax":"51","shuffleOutputBytes":"851270155","shuffleOutputBytesSpilled":"0","recordsRead":"11661235","recordsWritten":"11661235","parallelInputs":"1944","completedParallelInputs":"1944","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$1:miner, $2:total_difficulty, $3:gas_limit","FROM bigquery-public-data.crypto_ethereum_classic.blocks"]},{"kind":"WRITE","substeps":["$1, $2, $3","TO __stage00_output"]}],"slotMs":"240253","computeMode":"BIGQUERY"},{"name":"S01: Repartition","id":"1","startMs":"1762526248924","endMs":"1762526250784","inputStages":["0"],"waitRatioAvg":0.0372598935431613,"waitMsAvg":"161","waitRatioMax":0.0372598935431613,"waitMsMax":"161","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":1,"computeMsAvg":"4321","computeRatioMax":1,"computeMsMax":"4321","writeRatioAvg":0.003934274473501504,"writeMsAvg":"17","writeRatioMax":0.003934274473501504,"writeMsMax":"17","shuffleOutputBytes":"270744809","shuffleOutputBytesSpilled":"0","recordsRead":"3708833","recordsWritten":"3708833","parallelInputs":"1","completedParallelInputs":"1","status":"COMPLETE","steps":[{"kind":"READ","substeps":["FROM __stage00_output"]}],"slotMs":"3381","computeMode":"BIGQUERY"},{"name":"S02: Compute","id":"2","startMs":"1762526250786","endMs":"1762526250849","inputStages":["0","1"],"waitRatioAvg":0.00023142791020597085,"waitMsAvg":"1","waitRatioMax":0.0006942837306179125,"waitMsMax":"3","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.00833140476741495,"computeMsAvg":"36","computeRatioMax":0.011802823420504514,"computeMsMax":"51","writeRatioAvg":0.001388567461235825,"writeMsAvg":"6","writeRatioMax":0.003934274473501504,"writeMsMax":"17","shuffleOutputBytes":"5967","shuffleOutputBytesSpilled":"0","recordsRead":"11544627","recordsWritten":"351","parallelInputs":"100","completedParallelInputs":"99","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$1, $2, $3","FROM __stage00_output"]},{"kind":"WRITE","substeps":["$2","TO __stage02_output"]}],"slotMs":"8001","computeMode":"BIGQUERY"},{"name":"S03: Sort+","id":"3","startMs":"1762526250817","endMs":"1762526250849","inputStages":["2"],"waitRatioAvg":0.0071742652163850965,"waitMsAvg":"31","waitRatioMax":0.0071742652163850965,"waitMsMax":"31","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.0009257116408238834,"computeMsAvg":"4","computeRatioMax":0.0009257116408238834,"computeMsMax":"4","writeRatioAvg":0.00023142791020597085,"writeMsAvg":"1","writeRatioMax":0.00023142791020597085,"writeMsMax":"1","shuffleOutputBytes":"111","shuffleOutputBytesSpilled":"0","recordsRead":"352","recordsWritten":"1","parallelInputs":"1","completedParallelInputs":"1","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$2","FROM __stage02_output"]},{"kind":"AGGREGATE","substeps":["$37 := ARRAY_AGG($36)"]},{"kind":"SORT","substeps":["$2 DESC"]},{"kind":"WRITE","substeps":["$37","TO __stage03_output"]}],"slotMs":"53","computeMode":"BIGQUERY"},{"name":"S04: Compute","id":"4","startMs":"1762526250817","endMs":"1762526250984","inputStages":["3","0","1"],"waitRatioAvg":0.010645683869474658,"waitMsAvg":"46","waitRatioMax":0.028002777134922472,"waitMsMax":"121","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.028465632955334413,"computeMsAvg":"123","computeRatioMax":0.043277019208516544,"computeMsMax":"187","writeRatioAvg":0.0025457070122656793,"writeMsAvg":"11","writeRatioMax":0.006942837306179125,"writeMsMax":"30","shuffleOutputBytes":"851270155","shuffleOutputBytesSpilled":"0","recordsRead":"11661335","recordsWritten":"11661235","parallelInputs":"100","completedParallelInputs":"100","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$37","FROM __stage03_output"]},{"kind":"READ","substeps":["$1, $2, $3","FROM __stage00_output"]},{"kind":"WRITE","substeps":["$1, $2, $3","TO __stage04_output"]}],"slotMs":"24514","computeMode":"BIGQUERY"},{"name":"S05: Aggregate+","id":"5","startMs":"1762526250908","endMs":"1762526251453","inputStages":["4"],"waitRatioAvg":0.02823420504512844,"waitMsAvg":"122","waitRatioMax":0.03008562832677621,"waitMsMax":"130","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.1610738255033557,"computeMsAvg":"696","computeRatioMax":0.22749363573246933,"computeMsMax":"983","writeRatioAvg":0.0011571395510298543,"writeMsAvg":"5","writeRatioMax":0.0025457070122656793,"writeMsMax":"11","shuffleOutputBytes":"185","shuffleOutputBytesSpilled":"0","recordsRead":"11661235","recordsWritten":"5","parallelInputs":"5","completedParallelInputs":"5","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$1, $2, $3","FROM __stage04_output"]},{"kind":"AGGREGATE","substeps":["$12 := shard_sink_stats($11)"]},{"kind":"COMPUTE","substeps":["$11 := STRUCT<...>"]},{"kind":"WRITE","substeps":["$12","TO __stage05_output"]}],"slotMs":"3940","computeMode":"BIGQUERY"},{"name":"S06: Aggregate","id":"6","startMs":"1762526250910","endMs":"1762526251451","inputStages":["5"],"waitRatioAvg":0.08701689423744503,"waitMsAvg":"376","waitRatioMax":0.08701689423744503,"waitMsMax":"376","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.0011571395510298543,"computeMsAvg":"5","computeRatioMax":0.0011571395510298543,"computeMsMax":"5","writeRatioAvg":0.00023142791020597085,"writeMsAvg":"1","writeRatioMax":0.00023142791020597085,"writeMsMax":"1","shuffleOutputBytes":"63","shuffleOutputBytesSpilled":"0","recordsRead":"5","recordsWritten":"1","parallelInputs":"1","completedParallelInputs":"1","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$12","FROM __stage05_output"]},{"kind":"AGGREGATE","substeps":["$13 := root_sink_stats($12)"]},{"kind":"WRITE","substeps":["$13","TO __stage06_output"]}],"slotMs":"90","computeMode":"BIGQUERY"},{"name":"S07: Sort+","id":"7","startMs":"1762526251688","endMs":"1762526252756","inputStages":["4","6"],"waitRatioAvg":0.053691275167785234,"waitMsAvg":"232","waitRatioMax":0.053691275167785234,"waitMsMax":"232","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.4961814394816015,"computeMsAvg":"2144","computeRatioMax":0.5345984725757926,"computeMsMax":"2310","writeRatioAvg":0.0004628558204119417,"writeMsAvg":"2","writeRatioMax":0.0004628558204119417,"writeMsMax":"2","shuffleOutputBytes":"56","shuffleOutputBytesSpilled":"0","recordsRead":"4223277","recordsWritten":"1","parallelInputs":"5","completedParallelInputs":"2","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$13","FROM __stage06_output"]},{"kind":"READ","substeps":["$1, $2, $3","FROM __stage04_output"]},{"kind":"LIMIT","substeps":["1"]},{"kind":"FILTER","substeps":["equal($10, 1)"]},{"kind":"ANALYTIC_FUNCTION","substeps":["$10 := ROW_NUMBER($13) OVER (ORDER BY $21 DESC)"]},{"kind":"SORT","substeps":["$2 DESC"]},{"kind":"WRITE","substeps":["$30, $31","TO __stage07_output"]}],"slotMs":"9036","computeMode":"BIGQUERY"},{"name":"S08: Output","id":"8","startMs":"1762526251688","endMs":"1762526252917","inputStages":["7"],"waitRatioAvg":0.05137699606572552,"waitMsAvg":"222","waitRatioMax":0.05137699606572552,"waitMsMax":"222","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.003008562832677621,"computeMsAvg":"13","computeRatioMax":0.003008562832677621,"computeMsMax":"13","writeRatioAvg":0.0009257116408238834,"writeMsAvg":"4","writeRatioMax":0.0009257116408238834,"writeMsMax":"4","shuffleOutputBytes":"55","shuffleOutputBytesSpilled":"0","recordsRead":"1","recordsWritten":"1","parallelInputs":"1","completedParallelInputs":"1","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$30, $31","FROM __stage07_output"]},{"kind":"LIMIT","substeps":["1"]},{"kind":"WRITE","substeps":["$30, $31","TO __stage08_output"]}],"slotMs":"2082","computeMode":"BIGQUERY"}],"estimatedBytesProcessed":"792963980","timeline":[{"elapsedMs":"1550","totalSlotMs":"245376","pendingUnits":"0","completedUnits":"0","activeUnits":"0"},{"elapsedMs":"2550","totalSlotMs":"281976","pendingUnits":"827","completedUnits":"1118","activeUnits":"672","estimatedRunnableUnits":"0"},{"elapsedMs":"3550","totalSlotMs":"293096","pendingUnits":"1","completedUnits":"1944","activeUnits":"1","estimatedRunnableUnits":"1000"},{"elapsedMs":"4550","totalSlotMs":"293096","pendingUnits":"75","completedUnits":"2077","activeUnits":"74","estimatedRunnableUnits":"0"},{"elapsedMs":"6484","totalSlotMs":"293096","pendingUnits":"4","completedUnits":"2154","activeUnits":"6","estimatedRunnableUnits":"6"}],"totalPartitionsProcessed":"1944","totalBytesProcessed":"792963980","totalBytesBilled":"793772032","billingTier":1,"totalSlotMs":"293096","cacheHit":false,"referencedTables":[{"projectId":"bigquery-public-data","datasetId":"crypto_ethereum_classic","tableId":"blocks"}],"statementType":"SELECT","searchStatistics":{"indexUsageMode":"UNUSED","indexUnusedReasons":[{"code":"INDEX_CONFIG_NOT_AVAILABLE","message":"There is no index configuration for the base table `bigquery-public-data:crypto_ethereum_classic.blocks`.","baseTable":{"projectId":"bigquery-public-data","datasetId":"crypto_ethereum_classic","tableId":"blocks"}}]},"performanceInsights":{"avgPreviousExecutionMs":"3310"},"transferredBytes":"0","metadataCacheStatistics":{"tableMetadataCacheUsage":[{"tableReference":{"projectId":"bigquery-public-data","datasetId":"crypto_ethereum_classic","tableId":"blocks"},"unusedReason":"OTHER_REASON"}]}},"totalSlotMs":"293096","finalExecutionDurationMs":"4387"},"status":{"state":"DONE"},"principal_subject":"user:admin@bentrollope.altostrat.com","jobCreationReason":{"code":"REQUESTED"}}'
+ end_time=1762526253132
++ echo 1762526246450
++ awk '{print int($1)}'
+ start_ms=1762526246450
++ echo 1762526253132
++ awk '{print int($1)}'
+ end_ms=1762526253132
+ duration_ms=6682
+ echo '  --- Execution Statistics ---'
  --- Execution Statistics ---
+ echo '  Duration: 6682 ms'
  Duration: 6682 ms
+ echo '  Bytes Processed: 792963980 bytes'
  Bytes Processed: 792963980 bytes
+ echo '  Slot Milliseconds: 293096'
  Slot Milliseconds: 293096
+ echo '  ----------------------------'
  ----------------------------
+ echo -e 'Peak Security Optimized\tbqjob_rf81d48568d0a1d4_0000019a5ec0344b_1\t6682\t792963980\t293096'
+ echo ''

+ echo '--- Running queries from top_internal_value_recipients_eval.sql ---'
--- Running queries from top_internal_value_recipients_eval.sql ---
+ run_query 'Top Internal Unoptimized' 'SELECT
    t.to_address,
    SUM(t.value) AS total_value_received_wei
FROM
    `bigquery-public-data.crypto_ethereum_classic.traces` AS t
WHERE
    t.trace_type = '\''call'\''
    AND t.status = 1
    AND (t.call_type NOT IN ('\''delegatecall'\'', '\''callcode'\'', '\''staticcall'\'') OR t.call_type IS NULL)
    AND t.block_timestamp >= '\''2020-01-01 00:00:00 UTC'\''
    AND t.block_timestamp < '\''2020-01-08 00:00:00 UTC'\''
    AND t.to_address IS NOT NULL
GROUP BY
    t.to_address
ORDER BY
    total_value_received_wei DESC
LIMIT 10'
+ local 'query_name=Top Internal Unoptimized'
+ local 'query=SELECT
    t.to_address,
    SUM(t.value) AS total_value_received_wei
FROM
    `bigquery-public-data.crypto_ethereum_classic.traces` AS t
WHERE
    t.trace_type = '\''call'\''
    AND t.status = 1
    AND (t.call_type NOT IN ('\''delegatecall'\'', '\''callcode'\'', '\''staticcall'\'') OR t.call_type IS NULL)
    AND t.block_timestamp >= '\''2020-01-01 00:00:00 UTC'\''
    AND t.block_timestamp < '\''2020-01-08 00:00:00 UTC'\''
    AND t.to_address IS NOT NULL
GROUP BY
    t.to_address
ORDER BY
    total_value_received_wei DESC
LIMIT 10'
+ echo ==================================================
==================================================
+ echo 'Executing Top Internal Unoptimized'
Executing Top Internal Unoptimized
+ echo ==================================================
==================================================
+ echo Query:
Query:
+ echo 'SELECT
    t.to_address,
    SUM(t.value) AS total_value_received_wei
FROM
    `bigquery-public-data.crypto_ethereum_classic.traces` AS t
WHERE
    t.trace_type = '\''call'\''
    AND t.status = 1
    AND (t.call_type NOT IN ('\''delegatecall'\'', '\''callcode'\'', '\''staticcall'\'') OR t.call_type IS NULL)
    AND t.block_timestamp >= '\''2020-01-01 00:00:00 UTC'\''
    AND t.block_timestamp < '\''2020-01-08 00:00:00 UTC'\''
    AND t.to_address IS NOT NULL
GROUP BY
    t.to_address
ORDER BY
    total_value_received_wei DESC
LIMIT 10'
SELECT
    t.to_address,
    SUM(t.value) AS total_value_received_wei
FROM
    `bigquery-public-data.crypto_ethereum_classic.traces` AS t
WHERE
    t.trace_type = 'call'
    AND t.status = 1
    AND (t.call_type NOT IN ('delegatecall', 'callcode', 'staticcall') OR t.call_type IS NULL)
    AND t.block_timestamp >= '2020-01-01 00:00:00 UTC'
    AND t.block_timestamp < '2020-01-08 00:00:00 UTC'
    AND t.to_address IS NOT NULL
GROUP BY
    t.to_address
ORDER BY
    total_value_received_wei DESC
LIMIT 10
+ echo --------------------------------------------------
--------------------------------------------------
++ bq query --nouse_cache --nosync --use_legacy_sql=false --format=json --location=US 'SELECT
    t.to_address,
    SUM(t.value) AS total_value_received_wei
FROM
    `bigquery-public-data.crypto_ethereum_classic.traces` AS t
WHERE
    t.trace_type = '\''call'\''
    AND t.status = 1
    AND (t.call_type NOT IN ('\''delegatecall'\'', '\''callcode'\'', '\''staticcall'\'') OR t.call_type IS NULL)
    AND t.block_timestamp >= '\''2020-01-01 00:00:00 UTC'\''
    AND t.block_timestamp < '\''2020-01-08 00:00:00 UTC'\''
    AND t.to_address IS NOT NULL
GROUP BY
    t.to_address
ORDER BY
    total_value_received_wei DESC
LIMIT 10'
+ job_submission_output='{"kind":"bigquery#job","etag":"bWiW/YFacbVcPjzJzKfR6A==","id":"tony-allen:US.bqjob_r49e8fb47e13aa1f6_0000019a5ec06301_1","selfLink":"https://bigquery.googleapis.com/bigquery/v2/projects/tony-allen/jobs/bqjob_r49e8fb47e13aa1f6_0000019a5ec06301_1?location=US","user_email":"admin@bentrollope.altostrat.com","configuration":{"query":{"query":"SELECT\n    t.to_address,\n    SUM(t.value) AS total_value_received_wei\nFROM\n    `bigquery-public-data.crypto_ethereum_classic.traces` AS t\nWHERE\n    t.trace_type = '\''call'\''\n    AND t.status = 1\n    AND (t.call_type NOT IN ('\''delegatecall'\'', '\''callcode'\'', '\''staticcall'\'') OR t.call_type IS NULL)\n    AND t.block_timestamp >= '\''2020-01-01 00:00:00 UTC'\''\n    AND t.block_timestamp < '\''2020-01-08 00:00:00 UTC'\''\n    AND t.to_address IS NOT NULL\nGROUP BY\n    t.to_address\nORDER BY\n    total_value_received_wei DESC\nLIMIT 10","destinationTable":{"projectId":"tony-allen","datasetId":"_e34c49c766e4fd3f5d404c3949b9e19fa7acb372","tableId":"anon27d6a870_0a7c_4144_abd8_90f92e2d1482"},"writeDisposition":"WRITE_TRUNCATE","priority":"INTERACTIVE","useQueryCache":false,"useLegacySql":false},"jobType":"QUERY"},"jobReference":{"projectId":"tony-allen","jobId":"bqjob_r49e8fb47e13aa1f6_0000019a5ec06301_1","location":"US"},"statistics":{"creationTime":"1762526258250","startTime":"1762526258369","endTime":"1762526258716","totalBytesProcessed":"86748430","query":{"queryPlan":[{"name":"S00: Output","id":"0","startMs":"1762526258474","endMs":"1762526258609","waitRatioAvg":0.00468384074941452,"waitMsAvg":"2","waitRatioMax":0.00468384074941452,"waitMsMax":"2","readRatioAvg":0.6346604215456675,"readMsAvg":"271","readRatioMax":0.6346604215456675,"readMsMax":"271","computeRatioAvg":1,"computeMsAvg":"427","computeRatioMax":1,"computeMsMax":"427","writeRatioAvg":0.00936768149882904,"writeMsAvg":"4","writeRatioMax":0.00936768149882904,"writeMsMax":"4","shuffleOutputBytes":"640","shuffleOutputBytesSpilled":"0","recordsRead":"1016755","recordsWritten":"10","parallelInputs":"7","completedParallelInputs":"7","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$1:to_address, $2:value, $3:trace_type, $4:call_type, $5:status, $6:block_timestamp","FROM bigquery-public-data.crypto_ethereum_classic.traces","WHERE and(equal($3, '\''call'\''), equal($5, 1), or(not(in($4, '\''delegatecall'\'', '\''callcode'\'', '\''staticcall'\'')), is_null($4)), ...)"]},{"kind":"SORT","substeps":["$61 DESC","LIMIT 10"]},{"kind":"SORT","substeps":["$10 DESC","LIMIT 10"]},{"kind":"AGGREGATE","substeps":["GROUP BY $50 := $40","$10 := SUM($20)"]},{"kind":"AGGREGATE","substeps":["GROUP BY $40 := $1","$20 := SUM($2)"]},{"kind":"WRITE","substeps":["$70, $71","TO __stage00_output"]}],"slotMs":"495","computeMode":"BIGQUERY"}],"estimatedBytesProcessed":"86748430","timeline":[{"elapsedMs":"248","totalSlotMs":"495","pendingUnits":"0","completedUnits":"7","estimatedRunnableUnits":"0"}],"totalPartitionsProcessed":"7","totalBytesProcessed":"86748430","totalBytesBilled":"87031808","billingTier":1,"totalSlotMs":"495","cacheHit":false,"referencedTables":[{"projectId":"bigquery-public-data","datasetId":"crypto_ethereum_classic","tableId":"traces"}],"statementType":"SELECT","searchStatistics":{"indexUsageMode":"UNUSED","indexUnusedReasons":[{"code":"INDEX_CONFIG_NOT_AVAILABLE","message":"There is no index configuration for the base table `bigquery-public-data:crypto_ethereum_classic.traces`.","baseTable":{"projectId":"bigquery-public-data","datasetId":"crypto_ethereum_classic","tableId":"traces"}}]},"transferredBytes":"0","metadataCacheStatistics":{"tableMetadataCacheUsage":[{"tableReference":{"projectId":"bigquery-public-data","datasetId":"crypto_ethereum_classic","tableId":"traces"},"unusedReason":"OTHER_REASON"}]}},"totalSlotMs":"495","finalExecutionDurationMs":"149"},"status":{"state":"DONE"},"principal_subject":"user:admin@bentrollope.altostrat.com","jobCreationReason":{"code":"REQUESTED"}}'
++ echo '{"kind":"bigquery#job","etag":"bWiW/YFacbVcPjzJzKfR6A==","id":"tony-allen:US.bqjob_r49e8fb47e13aa1f6_0000019a5ec06301_1","selfLink":"https://bigquery.googleapis.com/bigquery/v2/projects/tony-allen/jobs/bqjob_r49e8fb47e13aa1f6_0000019a5ec06301_1?location=US","user_email":"admin@bentrollope.altostrat.com","configuration":{"query":{"query":"SELECT\n    t.to_address,\n    SUM(t.value) AS total_value_received_wei\nFROM\n    `bigquery-public-data.crypto_ethereum_classic.traces` AS t\nWHERE\n    t.trace_type = '\''call'\''\n    AND t.status = 1\n    AND (t.call_type NOT IN ('\''delegatecall'\'', '\''callcode'\'', '\''staticcall'\'') OR t.call_type IS NULL)\n    AND t.block_timestamp >= '\''2020-01-01 00:00:00 UTC'\''\n    AND t.block_timestamp < '\''2020-01-08 00:00:00 UTC'\''\n    AND t.to_address IS NOT NULL\nGROUP BY\n    t.to_address\nORDER BY\n    total_value_received_wei DESC\nLIMIT 10","destinationTable":{"projectId":"tony-allen","datasetId":"_e34c49c766e4fd3f5d404c3949b9e19fa7acb372","tableId":"anon27d6a870_0a7c_4144_abd8_90f92e2d1482"},"writeDisposition":"WRITE_TRUNCATE","priority":"INTERACTIVE","useQueryCache":false,"useLegacySql":false},"jobType":"QUERY"},"jobReference":{"projectId":"tony-allen","jobId":"bqjob_r49e8fb47e13aa1f6_0000019a5ec06301_1","location":"US"},"statistics":{"creationTime":"1762526258250","startTime":"1762526258369","endTime":"1762526258716","totalBytesProcessed":"86748430","query":{"queryPlan":[{"name":"S00: Output","id":"0","startMs":"1762526258474","endMs":"1762526258609","waitRatioAvg":0.00468384074941452,"waitMsAvg":"2","waitRatioMax":0.00468384074941452,"waitMsMax":"2","readRatioAvg":0.6346604215456675,"readMsAvg":"271","readRatioMax":0.6346604215456675,"readMsMax":"271","computeRatioAvg":1,"computeMsAvg":"427","computeRatioMax":1,"computeMsMax":"427","writeRatioAvg":0.00936768149882904,"writeMsAvg":"4","writeRatioMax":0.00936768149882904,"writeMsMax":"4","shuffleOutputBytes":"640","shuffleOutputBytesSpilled":"0","recordsRead":"1016755","recordsWritten":"10","parallelInputs":"7","completedParallelInputs":"7","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$1:to_address, $2:value, $3:trace_type, $4:call_type, $5:status, $6:block_timestamp","FROM bigquery-public-data.crypto_ethereum_classic.traces","WHERE and(equal($3, '\''call'\''), equal($5, 1), or(not(in($4, '\''delegatecall'\'', '\''callcode'\'', '\''staticcall'\'')), is_null($4)), ...)"]},{"kind":"SORT","substeps":["$61 DESC","LIMIT 10"]},{"kind":"SORT","substeps":["$10 DESC","LIMIT 10"]},{"kind":"AGGREGATE","substeps":["GROUP BY $50 := $40","$10 := SUM($20)"]},{"kind":"AGGREGATE","substeps":["GROUP BY $40 := $1","$20 := SUM($2)"]},{"kind":"WRITE","substeps":["$70, $71","TO __stage00_output"]}],"slotMs":"495","computeMode":"BIGQUERY"}],"estimatedBytesProcessed":"86748430","timeline":[{"elapsedMs":"248","totalSlotMs":"495","pendingUnits":"0","completedUnits":"7","estimatedRunnableUnits":"0"}],"totalPartitionsProcessed":"7","totalBytesProcessed":"86748430","totalBytesBilled":"87031808","billingTier":1,"totalSlotMs":"495","cacheHit":false,"referencedTables":[{"projectId":"bigquery-public-data","datasetId":"crypto_ethereum_classic","tableId":"traces"}],"statementType":"SELECT","searchStatistics":{"indexUsageMode":"UNUSED","indexUnusedReasons":[{"code":"INDEX_CONFIG_NOT_AVAILABLE","message":"There is no index configuration for the base table `bigquery-public-data:crypto_ethereum_classic.traces`.","baseTable":{"projectId":"bigquery-public-data","datasetId":"crypto_ethereum_classic","tableId":"traces"}}]},"transferredBytes":"0","metadataCacheStatistics":{"tableMetadataCacheUsage":[{"tableReference":{"projectId":"bigquery-public-data","datasetId":"crypto_ethereum_classic","tableId":"traces"},"unusedReason":"OTHER_REASON"}]}},"totalSlotMs":"495","finalExecutionDurationMs":"149"},"status":{"state":"DONE"},"principal_subject":"user:admin@bentrollope.altostrat.com","jobCreationReason":{"code":"REQUESTED"}}'
++ jq -r .jobReference.jobId
+ job_id=bqjob_r49e8fb47e13aa1f6_0000019a5ec06301_1
+ '[' -n bqjob_r49e8fb47e13aa1f6_0000019a5ec06301_1 ']'
+ echo '  [SUCCESS] Query submitted.'
  [SUCCESS] Query submitted.
+ echo '  *** JOB ID FOR Top Internal Unoptimized: bqjob_r49e8fb47e13aa1f6_0000019a5ec06301_1 ***'
  *** JOB ID FOR Top Internal Unoptimized: bqjob_r49e8fb47e13aa1f6_0000019a5ec06301_1 ***
+ echo '  Waiting for job to complete...'
  Waiting for job to complete...
++ bq wait bqjob_r49e8fb47e13aa1f6_0000019a5ec06301_1
+ wait_output='Waiting on bqjob_r49e8fb47e13aa1f6_0000019a5ec06301_1 ... (0s) Current status: DONE   
Job tony-allen:bqjob_r49e8fb47e13aa1f6_0000019a5ec06301_1

  Job Type    State      Start Time         Duration                User Email              Bytes Processed   Bytes Billed   Billing Tier   Labels  
 ---------- --------- ----------------- ---------------- --------------------------------- ----------------- -------------- -------------- -------- 
  query      SUCCESS   07 Nov 14:37:38   0:00:00.347000   admin@bentrollope.altostrat.com   86748430          87031808       1                      '
+ '[' 0 -ne 0 ']'
+ echo '  Job completed. Fetching statistics...'
  Job completed. Fetching statistics...
++ bq show --format=json -j bqjob_r49e8fb47e13aa1f6_0000019a5ec06301_1
+ job_stats_json='{"kind":"bigquery#job","etag":"BVAbsojFrjcbK50nVClLTw==","id":"tony-allen:US.bqjob_r49e8fb47e13aa1f6_0000019a5ec06301_1","selfLink":"https://bigquery.googleapis.com/bigquery/v2/projects/tony-allen/jobs/bqjob_r49e8fb47e13aa1f6_0000019a5ec06301_1?location=US","user_email":"admin@bentrollope.altostrat.com","configuration":{"query":{"query":"SELECT\n    t.to_address,\n    SUM(t.value) AS total_value_received_wei\nFROM\n    `bigquery-public-data.crypto_ethereum_classic.traces` AS t\nWHERE\n    t.trace_type = '\''call'\''\n    AND t.status = 1\n    AND (t.call_type NOT IN ('\''delegatecall'\'', '\''callcode'\'', '\''staticcall'\'') OR t.call_type IS NULL)\n    AND t.block_timestamp >= '\''2020-01-01 00:00:00 UTC'\''\n    AND t.block_timestamp < '\''2020-01-08 00:00:00 UTC'\''\n    AND t.to_address IS NOT NULL\nGROUP BY\n    t.to_address\nORDER BY\n    total_value_received_wei DESC\nLIMIT 10","destinationTable":{"projectId":"tony-allen","datasetId":"_e34c49c766e4fd3f5d404c3949b9e19fa7acb372","tableId":"anon27d6a870_0a7c_4144_abd8_90f92e2d1482"},"writeDisposition":"WRITE_TRUNCATE","priority":"INTERACTIVE","useQueryCache":false,"useLegacySql":false},"jobType":"QUERY"},"jobReference":{"projectId":"tony-allen","jobId":"bqjob_r49e8fb47e13aa1f6_0000019a5ec06301_1","location":"US"},"statistics":{"creationTime":"1762526258250","startTime":"1762526258369","endTime":"1762526258716","totalBytesProcessed":"86748430","query":{"queryPlan":[{"name":"S00: Output","id":"0","startMs":"1762526258474","endMs":"1762526258609","waitRatioAvg":0.00468384074941452,"waitMsAvg":"2","waitRatioMax":0.00468384074941452,"waitMsMax":"2","readRatioAvg":0.6346604215456675,"readMsAvg":"271","readRatioMax":0.6346604215456675,"readMsMax":"271","computeRatioAvg":1,"computeMsAvg":"427","computeRatioMax":1,"computeMsMax":"427","writeRatioAvg":0.00936768149882904,"writeMsAvg":"4","writeRatioMax":0.00936768149882904,"writeMsMax":"4","shuffleOutputBytes":"640","shuffleOutputBytesSpilled":"0","recordsRead":"1016755","recordsWritten":"10","parallelInputs":"7","completedParallelInputs":"7","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$1:to_address, $2:value, $3:trace_type, $4:call_type, $5:status, $6:block_timestamp","FROM bigquery-public-data.crypto_ethereum_classic.traces","WHERE and(equal($3, '\''call'\''), equal($5, 1), or(not(in($4, '\''delegatecall'\'', '\''callcode'\'', '\''staticcall'\'')), is_null($4)), ...)"]},{"kind":"SORT","substeps":["$61 DESC","LIMIT 10"]},{"kind":"SORT","substeps":["$10 DESC","LIMIT 10"]},{"kind":"AGGREGATE","substeps":["GROUP BY $50 := $40","$10 := SUM($20)"]},{"kind":"AGGREGATE","substeps":["GROUP BY $40 := $1","$20 := SUM($2)"]},{"kind":"WRITE","substeps":["$70, $71","TO __stage00_output"]}],"slotMs":"495","computeMode":"BIGQUERY"}],"estimatedBytesProcessed":"86748430","timeline":[{"elapsedMs":"248","totalSlotMs":"495","pendingUnits":"0","completedUnits":"7","estimatedRunnableUnits":"0"}],"totalPartitionsProcessed":"7","totalBytesProcessed":"86748430","totalBytesBilled":"87031808","billingTier":1,"totalSlotMs":"495","cacheHit":false,"referencedTables":[{"projectId":"bigquery-public-data","datasetId":"crypto_ethereum_classic","tableId":"traces"}],"statementType":"SELECT","searchStatistics":{"indexUsageMode":"UNUSED","indexUnusedReasons":[{"code":"INDEX_CONFIG_NOT_AVAILABLE","message":"There is no index configuration for the base table `bigquery-public-data:crypto_ethereum_classic.traces`.","baseTable":{"projectId":"bigquery-public-data","datasetId":"crypto_ethereum_classic","tableId":"traces"}}]},"performanceInsights":{"avgPreviousExecutionMs":"310"},"transferredBytes":"0","metadataCacheStatistics":{"tableMetadataCacheUsage":[{"tableReference":{"projectId":"bigquery-public-data","datasetId":"crypto_ethereum_classic","tableId":"traces"},"unusedReason":"OTHER_REASON"}]}},"totalSlotMs":"495","finalExecutionDurationMs":"149"},"status":{"state":"DONE"},"principal_subject":"user:admin@bentrollope.altostrat.com","jobCreationReason":{"code":"REQUESTED"}}'
++ echo '{"kind":"bigquery#job","etag":"BVAbsojFrjcbK50nVClLTw==","id":"tony-allen:US.bqjob_r49e8fb47e13aa1f6_0000019a5ec06301_1","selfLink":"https://bigquery.googleapis.com/bigquery/v2/projects/tony-allen/jobs/bqjob_r49e8fb47e13aa1f6_0000019a5ec06301_1?location=US","user_email":"admin@bentrollope.altostrat.com","configuration":{"query":{"query":"SELECT\n    t.to_address,\n    SUM(t.value) AS total_value_received_wei\nFROM\n    `bigquery-public-data.crypto_ethereum_classic.traces` AS t\nWHERE\n    t.trace_type = '\''call'\''\n    AND t.status = 1\n    AND (t.call_type NOT IN ('\''delegatecall'\'', '\''callcode'\'', '\''staticcall'\'') OR t.call_type IS NULL)\n    AND t.block_timestamp >= '\''2020-01-01 00:00:00 UTC'\''\n    AND t.block_timestamp < '\''2020-01-08 00:00:00 UTC'\''\n    AND t.to_address IS NOT NULL\nGROUP BY\n    t.to_address\nORDER BY\n    total_value_received_wei DESC\nLIMIT 10","destinationTable":{"projectId":"tony-allen","datasetId":"_e34c49c766e4fd3f5d404c3949b9e19fa7acb372","tableId":"anon27d6a870_0a7c_4144_abd8_90f92e2d1482"},"writeDisposition":"WRITE_TRUNCATE","priority":"INTERACTIVE","useQueryCache":false,"useLegacySql":false},"jobType":"QUERY"},"jobReference":{"projectId":"tony-allen","jobId":"bqjob_r49e8fb47e13aa1f6_0000019a5ec06301_1","location":"US"},"statistics":{"creationTime":"1762526258250","startTime":"1762526258369","endTime":"1762526258716","totalBytesProcessed":"86748430","query":{"queryPlan":[{"name":"S00: Output","id":"0","startMs":"1762526258474","endMs":"1762526258609","waitRatioAvg":0.00468384074941452,"waitMsAvg":"2","waitRatioMax":0.00468384074941452,"waitMsMax":"2","readRatioAvg":0.6346604215456675,"readMsAvg":"271","readRatioMax":0.6346604215456675,"readMsMax":"271","computeRatioAvg":1,"computeMsAvg":"427","computeRatioMax":1,"computeMsMax":"427","writeRatioAvg":0.00936768149882904,"writeMsAvg":"4","writeRatioMax":0.00936768149882904,"writeMsMax":"4","shuffleOutputBytes":"640","shuffleOutputBytesSpilled":"0","recordsRead":"1016755","recordsWritten":"10","parallelInputs":"7","completedParallelInputs":"7","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$1:to_address, $2:value, $3:trace_type, $4:call_type, $5:status, $6:block_timestamp","FROM bigquery-public-data.crypto_ethereum_classic.traces","WHERE and(equal($3, '\''call'\''), equal($5, 1), or(not(in($4, '\''delegatecall'\'', '\''callcode'\'', '\''staticcall'\'')), is_null($4)), ...)"]},{"kind":"SORT","substeps":["$61 DESC","LIMIT 10"]},{"kind":"SORT","substeps":["$10 DESC","LIMIT 10"]},{"kind":"AGGREGATE","substeps":["GROUP BY $50 := $40","$10 := SUM($20)"]},{"kind":"AGGREGATE","substeps":["GROUP BY $40 := $1","$20 := SUM($2)"]},{"kind":"WRITE","substeps":["$70, $71","TO __stage00_output"]}],"slotMs":"495","computeMode":"BIGQUERY"}],"estimatedBytesProcessed":"86748430","timeline":[{"elapsedMs":"248","totalSlotMs":"495","pendingUnits":"0","completedUnits":"7","estimatedRunnableUnits":"0"}],"totalPartitionsProcessed":"7","totalBytesProcessed":"86748430","totalBytesBilled":"87031808","billingTier":1,"totalSlotMs":"495","cacheHit":false,"referencedTables":[{"projectId":"bigquery-public-data","datasetId":"crypto_ethereum_classic","tableId":"traces"}],"statementType":"SELECT","searchStatistics":{"indexUsageMode":"UNUSED","indexUnusedReasons":[{"code":"INDEX_CONFIG_NOT_AVAILABLE","message":"There is no index configuration for the base table `bigquery-public-data:crypto_ethereum_classic.traces`.","baseTable":{"projectId":"bigquery-public-data","datasetId":"crypto_ethereum_classic","tableId":"traces"}}]},"performanceInsights":{"avgPreviousExecutionMs":"310"},"transferredBytes":"0","metadataCacheStatistics":{"tableMetadataCacheUsage":[{"tableReference":{"projectId":"bigquery-public-data","datasetId":"crypto_ethereum_classic","tableId":"traces"},"unusedReason":"OTHER_REASON"}]}},"totalSlotMs":"495","finalExecutionDurationMs":"149"},"status":{"state":"DONE"},"principal_subject":"user:admin@bentrollope.altostrat.com","jobCreationReason":{"code":"REQUESTED"}}'
++ jq -r .statistics.totalBytesProcessed
+ total_bytes_processed=86748430
++ jq -r .statistics.totalSlotMs
++ echo '{"kind":"bigquery#job","etag":"BVAbsojFrjcbK50nVClLTw==","id":"tony-allen:US.bqjob_r49e8fb47e13aa1f6_0000019a5ec06301_1","selfLink":"https://bigquery.googleapis.com/bigquery/v2/projects/tony-allen/jobs/bqjob_r49e8fb47e13aa1f6_0000019a5ec06301_1?location=US","user_email":"admin@bentrollope.altostrat.com","configuration":{"query":{"query":"SELECT\n    t.to_address,\n    SUM(t.value) AS total_value_received_wei\nFROM\n    `bigquery-public-data.crypto_ethereum_classic.traces` AS t\nWHERE\n    t.trace_type = '\''call'\''\n    AND t.status = 1\n    AND (t.call_type NOT IN ('\''delegatecall'\'', '\''callcode'\'', '\''staticcall'\'') OR t.call_type IS NULL)\n    AND t.block_timestamp >= '\''2020-01-01 00:00:00 UTC'\''\n    AND t.block_timestamp < '\''2020-01-08 00:00:00 UTC'\''\n    AND t.to_address IS NOT NULL\nGROUP BY\n    t.to_address\nORDER BY\n    total_value_received_wei DESC\nLIMIT 10","destinationTable":{"projectId":"tony-allen","datasetId":"_e34c49c766e4fd3f5d404c3949b9e19fa7acb372","tableId":"anon27d6a870_0a7c_4144_abd8_90f92e2d1482"},"writeDisposition":"WRITE_TRUNCATE","priority":"INTERACTIVE","useQueryCache":false,"useLegacySql":false},"jobType":"QUERY"},"jobReference":{"projectId":"tony-allen","jobId":"bqjob_r49e8fb47e13aa1f6_0000019a5ec06301_1","location":"US"},"statistics":{"creationTime":"1762526258250","startTime":"1762526258369","endTime":"1762526258716","totalBytesProcessed":"86748430","query":{"queryPlan":[{"name":"S00: Output","id":"0","startMs":"1762526258474","endMs":"1762526258609","waitRatioAvg":0.00468384074941452,"waitMsAvg":"2","waitRatioMax":0.00468384074941452,"waitMsMax":"2","readRatioAvg":0.6346604215456675,"readMsAvg":"271","readRatioMax":0.6346604215456675,"readMsMax":"271","computeRatioAvg":1,"computeMsAvg":"427","computeRatioMax":1,"computeMsMax":"427","writeRatioAvg":0.00936768149882904,"writeMsAvg":"4","writeRatioMax":0.00936768149882904,"writeMsMax":"4","shuffleOutputBytes":"640","shuffleOutputBytesSpilled":"0","recordsRead":"1016755","recordsWritten":"10","parallelInputs":"7","completedParallelInputs":"7","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$1:to_address, $2:value, $3:trace_type, $4:call_type, $5:status, $6:block_timestamp","FROM bigquery-public-data.crypto_ethereum_classic.traces","WHERE and(equal($3, '\''call'\''), equal($5, 1), or(not(in($4, '\''delegatecall'\'', '\''callcode'\'', '\''staticcall'\'')), is_null($4)), ...)"]},{"kind":"SORT","substeps":["$61 DESC","LIMIT 10"]},{"kind":"SORT","substeps":["$10 DESC","LIMIT 10"]},{"kind":"AGGREGATE","substeps":["GROUP BY $50 := $40","$10 := SUM($20)"]},{"kind":"AGGREGATE","substeps":["GROUP BY $40 := $1","$20 := SUM($2)"]},{"kind":"WRITE","substeps":["$70, $71","TO __stage00_output"]}],"slotMs":"495","computeMode":"BIGQUERY"}],"estimatedBytesProcessed":"86748430","timeline":[{"elapsedMs":"248","totalSlotMs":"495","pendingUnits":"0","completedUnits":"7","estimatedRunnableUnits":"0"}],"totalPartitionsProcessed":"7","totalBytesProcessed":"86748430","totalBytesBilled":"87031808","billingTier":1,"totalSlotMs":"495","cacheHit":false,"referencedTables":[{"projectId":"bigquery-public-data","datasetId":"crypto_ethereum_classic","tableId":"traces"}],"statementType":"SELECT","searchStatistics":{"indexUsageMode":"UNUSED","indexUnusedReasons":[{"code":"INDEX_CONFIG_NOT_AVAILABLE","message":"There is no index configuration for the base table `bigquery-public-data:crypto_ethereum_classic.traces`.","baseTable":{"projectId":"bigquery-public-data","datasetId":"crypto_ethereum_classic","tableId":"traces"}}]},"performanceInsights":{"avgPreviousExecutionMs":"310"},"transferredBytes":"0","metadataCacheStatistics":{"tableMetadataCacheUsage":[{"tableReference":{"projectId":"bigquery-public-data","datasetId":"crypto_ethereum_classic","tableId":"traces"},"unusedReason":"OTHER_REASON"}]}},"totalSlotMs":"495","finalExecutionDurationMs":"149"},"status":{"state":"DONE"},"principal_subject":"user:admin@bentrollope.altostrat.com","jobCreationReason":{"code":"REQUESTED"}}'
+ total_slot_ms=495
++ echo '{"kind":"bigquery#job","etag":"BVAbsojFrjcbK50nVClLTw==","id":"tony-allen:US.bqjob_r49e8fb47e13aa1f6_0000019a5ec06301_1","selfLink":"https://bigquery.googleapis.com/bigquery/v2/projects/tony-allen/jobs/bqjob_r49e8fb47e13aa1f6_0000019a5ec06301_1?location=US","user_email":"admin@bentrollope.altostrat.com","configuration":{"query":{"query":"SELECT\n    t.to_address,\n    SUM(t.value) AS total_value_received_wei\nFROM\n    `bigquery-public-data.crypto_ethereum_classic.traces` AS t\nWHERE\n    t.trace_type = '\''call'\''\n    AND t.status = 1\n    AND (t.call_type NOT IN ('\''delegatecall'\'', '\''callcode'\'', '\''staticcall'\'') OR t.call_type IS NULL)\n    AND t.block_timestamp >= '\''2020-01-01 00:00:00 UTC'\''\n    AND t.block_timestamp < '\''2020-01-08 00:00:00 UTC'\''\n    AND t.to_address IS NOT NULL\nGROUP BY\n    t.to_address\nORDER BY\n    total_value_received_wei DESC\nLIMIT 10","destinationTable":{"projectId":"tony-allen","datasetId":"_e34c49c766e4fd3f5d404c3949b9e19fa7acb372","tableId":"anon27d6a870_0a7c_4144_abd8_90f92e2d1482"},"writeDisposition":"WRITE_TRUNCATE","priority":"INTERACTIVE","useQueryCache":false,"useLegacySql":false},"jobType":"QUERY"},"jobReference":{"projectId":"tony-allen","jobId":"bqjob_r49e8fb47e13aa1f6_0000019a5ec06301_1","location":"US"},"statistics":{"creationTime":"1762526258250","startTime":"1762526258369","endTime":"1762526258716","totalBytesProcessed":"86748430","query":{"queryPlan":[{"name":"S00: Output","id":"0","startMs":"1762526258474","endMs":"1762526258609","waitRatioAvg":0.00468384074941452,"waitMsAvg":"2","waitRatioMax":0.00468384074941452,"waitMsMax":"2","readRatioAvg":0.6346604215456675,"readMsAvg":"271","readRatioMax":0.6346604215456675,"readMsMax":"271","computeRatioAvg":1,"computeMsAvg":"427","computeRatioMax":1,"computeMsMax":"427","writeRatioAvg":0.00936768149882904,"writeMsAvg":"4","writeRatioMax":0.00936768149882904,"writeMsMax":"4","shuffleOutputBytes":"640","shuffleOutputBytesSpilled":"0","recordsRead":"1016755","recordsWritten":"10","parallelInputs":"7","completedParallelInputs":"7","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$1:to_address, $2:value, $3:trace_type, $4:call_type, $5:status, $6:block_timestamp","FROM bigquery-public-data.crypto_ethereum_classic.traces","WHERE and(equal($3, '\''call'\''), equal($5, 1), or(not(in($4, '\''delegatecall'\'', '\''callcode'\'', '\''staticcall'\'')), is_null($4)), ...)"]},{"kind":"SORT","substeps":["$61 DESC","LIMIT 10"]},{"kind":"SORT","substeps":["$10 DESC","LIMIT 10"]},{"kind":"AGGREGATE","substeps":["GROUP BY $50 := $40","$10 := SUM($20)"]},{"kind":"AGGREGATE","substeps":["GROUP BY $40 := $1","$20 := SUM($2)"]},{"kind":"WRITE","substeps":["$70, $71","TO __stage00_output"]}],"slotMs":"495","computeMode":"BIGQUERY"}],"estimatedBytesProcessed":"86748430","timeline":[{"elapsedMs":"248","totalSlotMs":"495","pendingUnits":"0","completedUnits":"7","estimatedRunnableUnits":"0"}],"totalPartitionsProcessed":"7","totalBytesProcessed":"86748430","totalBytesBilled":"87031808","billingTier":1,"totalSlotMs":"495","cacheHit":false,"referencedTables":[{"projectId":"bigquery-public-data","datasetId":"crypto_ethereum_classic","tableId":"traces"}],"statementType":"SELECT","searchStatistics":{"indexUsageMode":"UNUSED","indexUnusedReasons":[{"code":"INDEX_CONFIG_NOT_AVAILABLE","message":"There is no index configuration for the base table `bigquery-public-data:crypto_ethereum_classic.traces`.","baseTable":{"projectId":"bigquery-public-data","datasetId":"crypto_ethereum_classic","tableId":"traces"}}]},"performanceInsights":{"avgPreviousExecutionMs":"310"},"transferredBytes":"0","metadataCacheStatistics":{"tableMetadataCacheUsage":[{"tableReference":{"projectId":"bigquery-public-data","datasetId":"crypto_ethereum_classic","tableId":"traces"},"unusedReason":"OTHER_REASON"}]}},"totalSlotMs":"495","finalExecutionDurationMs":"149"},"status":{"state":"DONE"},"principal_subject":"user:admin@bentrollope.altostrat.com","jobCreationReason":{"code":"REQUESTED"}}'
++ jq -r .statistics.startTime
+ start_time=1762526258369
++ jq -r .statistics.endTime
++ echo '{"kind":"bigquery#job","etag":"BVAbsojFrjcbK50nVClLTw==","id":"tony-allen:US.bqjob_r49e8fb47e13aa1f6_0000019a5ec06301_1","selfLink":"https://bigquery.googleapis.com/bigquery/v2/projects/tony-allen/jobs/bqjob_r49e8fb47e13aa1f6_0000019a5ec06301_1?location=US","user_email":"admin@bentrollope.altostrat.com","configuration":{"query":{"query":"SELECT\n    t.to_address,\n    SUM(t.value) AS total_value_received_wei\nFROM\n    `bigquery-public-data.crypto_ethereum_classic.traces` AS t\nWHERE\n    t.trace_type = '\''call'\''\n    AND t.status = 1\n    AND (t.call_type NOT IN ('\''delegatecall'\'', '\''callcode'\'', '\''staticcall'\'') OR t.call_type IS NULL)\n    AND t.block_timestamp >= '\''2020-01-01 00:00:00 UTC'\''\n    AND t.block_timestamp < '\''2020-01-08 00:00:00 UTC'\''\n    AND t.to_address IS NOT NULL\nGROUP BY\n    t.to_address\nORDER BY\n    total_value_received_wei DESC\nLIMIT 10","destinationTable":{"projectId":"tony-allen","datasetId":"_e34c49c766e4fd3f5d404c3949b9e19fa7acb372","tableId":"anon27d6a870_0a7c_4144_abd8_90f92e2d1482"},"writeDisposition":"WRITE_TRUNCATE","priority":"INTERACTIVE","useQueryCache":false,"useLegacySql":false},"jobType":"QUERY"},"jobReference":{"projectId":"tony-allen","jobId":"bqjob_r49e8fb47e13aa1f6_0000019a5ec06301_1","location":"US"},"statistics":{"creationTime":"1762526258250","startTime":"1762526258369","endTime":"1762526258716","totalBytesProcessed":"86748430","query":{"queryPlan":[{"name":"S00: Output","id":"0","startMs":"1762526258474","endMs":"1762526258609","waitRatioAvg":0.00468384074941452,"waitMsAvg":"2","waitRatioMax":0.00468384074941452,"waitMsMax":"2","readRatioAvg":0.6346604215456675,"readMsAvg":"271","readRatioMax":0.6346604215456675,"readMsMax":"271","computeRatioAvg":1,"computeMsAvg":"427","computeRatioMax":1,"computeMsMax":"427","writeRatioAvg":0.00936768149882904,"writeMsAvg":"4","writeRatioMax":0.00936768149882904,"writeMsMax":"4","shuffleOutputBytes":"640","shuffleOutputBytesSpilled":"0","recordsRead":"1016755","recordsWritten":"10","parallelInputs":"7","completedParallelInputs":"7","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$1:to_address, $2:value, $3:trace_type, $4:call_type, $5:status, $6:block_timestamp","FROM bigquery-public-data.crypto_ethereum_classic.traces","WHERE and(equal($3, '\''call'\''), equal($5, 1), or(not(in($4, '\''delegatecall'\'', '\''callcode'\'', '\''staticcall'\'')), is_null($4)), ...)"]},{"kind":"SORT","substeps":["$61 DESC","LIMIT 10"]},{"kind":"SORT","substeps":["$10 DESC","LIMIT 10"]},{"kind":"AGGREGATE","substeps":["GROUP BY $50 := $40","$10 := SUM($20)"]},{"kind":"AGGREGATE","substeps":["GROUP BY $40 := $1","$20 := SUM($2)"]},{"kind":"WRITE","substeps":["$70, $71","TO __stage00_output"]}],"slotMs":"495","computeMode":"BIGQUERY"}],"estimatedBytesProcessed":"86748430","timeline":[{"elapsedMs":"248","totalSlotMs":"495","pendingUnits":"0","completedUnits":"7","estimatedRunnableUnits":"0"}],"totalPartitionsProcessed":"7","totalBytesProcessed":"86748430","totalBytesBilled":"87031808","billingTier":1,"totalSlotMs":"495","cacheHit":false,"referencedTables":[{"projectId":"bigquery-public-data","datasetId":"crypto_ethereum_classic","tableId":"traces"}],"statementType":"SELECT","searchStatistics":{"indexUsageMode":"UNUSED","indexUnusedReasons":[{"code":"INDEX_CONFIG_NOT_AVAILABLE","message":"There is no index configuration for the base table `bigquery-public-data:crypto_ethereum_classic.traces`.","baseTable":{"projectId":"bigquery-public-data","datasetId":"crypto_ethereum_classic","tableId":"traces"}}]},"performanceInsights":{"avgPreviousExecutionMs":"310"},"transferredBytes":"0","metadataCacheStatistics":{"tableMetadataCacheUsage":[{"tableReference":{"projectId":"bigquery-public-data","datasetId":"crypto_ethereum_classic","tableId":"traces"},"unusedReason":"OTHER_REASON"}]}},"totalSlotMs":"495","finalExecutionDurationMs":"149"},"status":{"state":"DONE"},"principal_subject":"user:admin@bentrollope.altostrat.com","jobCreationReason":{"code":"REQUESTED"}}'
+ end_time=1762526258716
++ echo 1762526258369
++ awk '{print int($1)}'
+ start_ms=1762526258369
++ echo 1762526258716
++ awk '{print int($1)}'
+ end_ms=1762526258716
+ duration_ms=347
+ echo '  --- Execution Statistics ---'
  --- Execution Statistics ---
+ echo '  Duration: 347 ms'
  Duration: 347 ms
+ echo '  Bytes Processed: 86748430 bytes'
  Bytes Processed: 86748430 bytes
+ echo '  Slot Milliseconds: 495'
  Slot Milliseconds: 495
+ echo '  ----------------------------'
  ----------------------------
+ echo -e 'Top Internal Unoptimized\tbqjob_r49e8fb47e13aa1f6_0000019a5ec06301_1\t347\t86748430\t495'
+ echo ''

+ run_query 'Top Internal Optimized' 'SELECT
    to_address,
    SUM(value) AS total_value_received_wei
FROM
    `bigquery-public-data.crypto_ethereum_classic.traces`
WHERE
    trace_type = '\''call'\''
    AND status = 1
    AND (call_type NOT IN ('\''delegatecall'\'', '\''callcode'\'', '\''staticcall'\'') OR call_type IS NULL)
    AND block_timestamp >= '\''2020-01-01 00:00:00 UTC'\''
    AND block_timestamp < '\''2020-01-08 00:00:00 UTC'\''
    AND to_address IS NOT NULL
GROUP BY
    to_address
QUALIFY
    ROW_NUMBER() OVER (ORDER BY total_value_received_wei DESC) <= 10'
+ local 'query_name=Top Internal Optimized'
+ local 'query=SELECT
    to_address,
    SUM(value) AS total_value_received_wei
FROM
    `bigquery-public-data.crypto_ethereum_classic.traces`
WHERE
    trace_type = '\''call'\''
    AND status = 1
    AND (call_type NOT IN ('\''delegatecall'\'', '\''callcode'\'', '\''staticcall'\'') OR call_type IS NULL)
    AND block_timestamp >= '\''2020-01-01 00:00:00 UTC'\''
    AND block_timestamp < '\''2020-01-08 00:00:00 UTC'\''
    AND to_address IS NOT NULL
GROUP BY
    to_address
QUALIFY
    ROW_NUMBER() OVER (ORDER BY total_value_received_wei DESC) <= 10'
+ echo ==================================================
==================================================
+ echo 'Executing Top Internal Optimized'
Executing Top Internal Optimized
+ echo ==================================================
==================================================
+ echo Query:
Query:
+ echo 'SELECT
    to_address,
    SUM(value) AS total_value_received_wei
FROM
    `bigquery-public-data.crypto_ethereum_classic.traces`
WHERE
    trace_type = '\''call'\''
    AND status = 1
    AND (call_type NOT IN ('\''delegatecall'\'', '\''callcode'\'', '\''staticcall'\'') OR call_type IS NULL)
    AND block_timestamp >= '\''2020-01-01 00:00:00 UTC'\''
    AND block_timestamp < '\''2020-01-08 00:00:00 UTC'\''
    AND to_address IS NOT NULL
GROUP BY
    to_address
QUALIFY
    ROW_NUMBER() OVER (ORDER BY total_value_received_wei DESC) <= 10'
SELECT
    to_address,
    SUM(value) AS total_value_received_wei
FROM
    `bigquery-public-data.crypto_ethereum_classic.traces`
WHERE
    trace_type = 'call'
    AND status = 1
    AND (call_type NOT IN ('delegatecall', 'callcode', 'staticcall') OR call_type IS NULL)
    AND block_timestamp >= '2020-01-01 00:00:00 UTC'
    AND block_timestamp < '2020-01-08 00:00:00 UTC'
    AND to_address IS NOT NULL
GROUP BY
    to_address
QUALIFY
    ROW_NUMBER() OVER (ORDER BY total_value_received_wei DESC) <= 10
+ echo --------------------------------------------------
--------------------------------------------------
++ bq query --nouse_cache --nosync --use_legacy_sql=false --format=json --location=US 'SELECT
    to_address,
    SUM(value) AS total_value_received_wei
FROM
    `bigquery-public-data.crypto_ethereum_classic.traces`
WHERE
    trace_type = '\''call'\''
    AND status = 1
    AND (call_type NOT IN ('\''delegatecall'\'', '\''callcode'\'', '\''staticcall'\'') OR call_type IS NULL)
    AND block_timestamp >= '\''2020-01-01 00:00:00 UTC'\''
    AND block_timestamp < '\''2020-01-08 00:00:00 UTC'\''
    AND to_address IS NOT NULL
GROUP BY
    to_address
QUALIFY
    ROW_NUMBER() OVER (ORDER BY total_value_received_wei DESC) <= 10'
+ job_submission_output='{"kind":"bigquery#job","etag":"aJWPkxFTD+IXHgfhPaUt9Q==","id":"tony-allen:US.bqjob_r15ddfd7013b78fe5_0000019a5ec0817d_1","selfLink":"https://bigquery.googleapis.com/bigquery/v2/projects/tony-allen/jobs/bqjob_r15ddfd7013b78fe5_0000019a5ec0817d_1?location=US","user_email":"admin@bentrollope.altostrat.com","configuration":{"query":{"query":"SELECT\n    to_address,\n    SUM(value) AS total_value_received_wei\nFROM\n    `bigquery-public-data.crypto_ethereum_classic.traces`\nWHERE\n    trace_type = '\''call'\''\n    AND status = 1\n    AND (call_type NOT IN ('\''delegatecall'\'', '\''callcode'\'', '\''staticcall'\'') OR call_type IS NULL)\n    AND block_timestamp >= '\''2020-01-01 00:00:00 UTC'\''\n    AND block_timestamp < '\''2020-01-08 00:00:00 UTC'\''\n    AND to_address IS NOT NULL\nGROUP BY\n    to_address\nQUALIFY\n    ROW_NUMBER() OVER (ORDER BY total_value_received_wei DESC) <= 10","destinationTable":{"projectId":"tony-allen","datasetId":"_e34c49c766e4fd3f5d404c3949b9e19fa7acb372","tableId":"anon9fd2d26f_cbe5_4ed5_8902_cfc971a61b35"},"writeDisposition":"WRITE_TRUNCATE","priority":"INTERACTIVE","useQueryCache":false,"useLegacySql":false},"jobType":"QUERY"},"jobReference":{"projectId":"tony-allen","jobId":"bqjob_r15ddfd7013b78fe5_0000019a5ec0817d_1","location":"US"},"statistics":{"creationTime":"1762526266040","startTime":"1762526266220","endTime":"1762526266603","totalBytesProcessed":"86748430","query":{"queryPlan":[{"name":"S00: Output","id":"0","startMs":"1762526266334","endMs":"1762526266512","waitRatioAvg":0.0027624309392265192,"waitMsAvg":"1","waitRatioMax":0.0027624309392265192,"waitMsMax":"1","readRatioAvg":0.6740331491712708,"readMsAvg":"244","readRatioMax":0.6740331491712708,"readMsMax":"244","computeRatioAvg":1,"computeMsAvg":"362","computeRatioMax":1,"computeMsMax":"362","writeRatioAvg":0.008287292817679558,"writeMsAvg":"3","writeRatioMax":0.008287292817679558,"writeMsMax":"3","shuffleOutputBytes":"630","shuffleOutputBytesSpilled":"0","recordsRead":"1016755","recordsWritten":"10","parallelInputs":"7","completedParallelInputs":"7","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$1:to_address, $2:value, $3:trace_type, $4:call_type, $5:status, $6:block_timestamp","FROM bigquery-public-data.crypto_ethereum_classic.traces","WHERE and(equal($3, '\''call'\''), equal($5, 1), or(not(in($4, '\''delegatecall'\'', '\''callcode'\'', '\''staticcall'\'')), is_null($4)), ...)"]},{"kind":"FILTER","substeps":["less_or_equal($10, 10)"]},{"kind":"ANALYTIC_FUNCTION","substeps":["$10 := ROW_NUMBER() OVER (ORDER BY $101 DESC)"]},{"kind":"SORT","substeps":["$91 DESC"]},{"kind":"FILTER","substeps":["less_or_equal($20, 10)"]},{"kind":"ANALYTIC_FUNCTION","substeps":["$20 := ROW_NUMBER() OVER (ORDER BY $81 DESC)"]},{"kind":"SORT","substeps":["$30 DESC"]},{"kind":"AGGREGATE","substeps":["GROUP BY $70 := $60","$30 := SUM($40)"]},{"kind":"AGGREGATE","substeps":["GROUP BY $60 := $1","$40 := SUM($2)"]},{"kind":"WRITE","substeps":["$110, $111","TO __stage00_output"]}],"slotMs":"432","computeMode":"BIGQUERY"}],"estimatedBytesProcessed":"86748430","timeline":[{"elapsedMs":"298","totalSlotMs":"432","pendingUnits":"0","completedUnits":"7","estimatedRunnableUnits":"0"}],"totalPartitionsProcessed":"7","totalBytesProcessed":"86748430","totalBytesBilled":"87031808","billingTier":1,"totalSlotMs":"432","cacheHit":false,"referencedTables":[{"projectId":"bigquery-public-data","datasetId":"crypto_ethereum_classic","tableId":"traces"}],"statementType":"SELECT","searchStatistics":{"indexUsageMode":"UNUSED","indexUnusedReasons":[{"code":"INDEX_CONFIG_NOT_AVAILABLE","message":"There is no index configuration for the base table `bigquery-public-data:crypto_ethereum_classic.traces`.","baseTable":{"projectId":"bigquery-public-data","datasetId":"crypto_ethereum_classic","tableId":"traces"}}]},"transferredBytes":"0","metadataCacheStatistics":{"tableMetadataCacheUsage":[{"tableReference":{"projectId":"bigquery-public-data","datasetId":"crypto_ethereum_classic","tableId":"traces"},"unusedReason":"OTHER_REASON"}]}},"totalSlotMs":"432","finalExecutionDurationMs":"188"},"status":{"state":"DONE"},"principal_subject":"user:admin@bentrollope.altostrat.com","jobCreationReason":{"code":"REQUESTED"}}'
++ jq -r .jobReference.jobId
++ echo '{"kind":"bigquery#job","etag":"aJWPkxFTD+IXHgfhPaUt9Q==","id":"tony-allen:US.bqjob_r15ddfd7013b78fe5_0000019a5ec0817d_1","selfLink":"https://bigquery.googleapis.com/bigquery/v2/projects/tony-allen/jobs/bqjob_r15ddfd7013b78fe5_0000019a5ec0817d_1?location=US","user_email":"admin@bentrollope.altostrat.com","configuration":{"query":{"query":"SELECT\n    to_address,\n    SUM(value) AS total_value_received_wei\nFROM\n    `bigquery-public-data.crypto_ethereum_classic.traces`\nWHERE\n    trace_type = '\''call'\''\n    AND status = 1\n    AND (call_type NOT IN ('\''delegatecall'\'', '\''callcode'\'', '\''staticcall'\'') OR call_type IS NULL)\n    AND block_timestamp >= '\''2020-01-01 00:00:00 UTC'\''\n    AND block_timestamp < '\''2020-01-08 00:00:00 UTC'\''\n    AND to_address IS NOT NULL\nGROUP BY\n    to_address\nQUALIFY\n    ROW_NUMBER() OVER (ORDER BY total_value_received_wei DESC) <= 10","destinationTable":{"projectId":"tony-allen","datasetId":"_e34c49c766e4fd3f5d404c3949b9e19fa7acb372","tableId":"anon9fd2d26f_cbe5_4ed5_8902_cfc971a61b35"},"writeDisposition":"WRITE_TRUNCATE","priority":"INTERACTIVE","useQueryCache":false,"useLegacySql":false},"jobType":"QUERY"},"jobReference":{"projectId":"tony-allen","jobId":"bqjob_r15ddfd7013b78fe5_0000019a5ec0817d_1","location":"US"},"statistics":{"creationTime":"1762526266040","startTime":"1762526266220","endTime":"1762526266603","totalBytesProcessed":"86748430","query":{"queryPlan":[{"name":"S00: Output","id":"0","startMs":"1762526266334","endMs":"1762526266512","waitRatioAvg":0.0027624309392265192,"waitMsAvg":"1","waitRatioMax":0.0027624309392265192,"waitMsMax":"1","readRatioAvg":0.6740331491712708,"readMsAvg":"244","readRatioMax":0.6740331491712708,"readMsMax":"244","computeRatioAvg":1,"computeMsAvg":"362","computeRatioMax":1,"computeMsMax":"362","writeRatioAvg":0.008287292817679558,"writeMsAvg":"3","writeRatioMax":0.008287292817679558,"writeMsMax":"3","shuffleOutputBytes":"630","shuffleOutputBytesSpilled":"0","recordsRead":"1016755","recordsWritten":"10","parallelInputs":"7","completedParallelInputs":"7","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$1:to_address, $2:value, $3:trace_type, $4:call_type, $5:status, $6:block_timestamp","FROM bigquery-public-data.crypto_ethereum_classic.traces","WHERE and(equal($3, '\''call'\''), equal($5, 1), or(not(in($4, '\''delegatecall'\'', '\''callcode'\'', '\''staticcall'\'')), is_null($4)), ...)"]},{"kind":"FILTER","substeps":["less_or_equal($10, 10)"]},{"kind":"ANALYTIC_FUNCTION","substeps":["$10 := ROW_NUMBER() OVER (ORDER BY $101 DESC)"]},{"kind":"SORT","substeps":["$91 DESC"]},{"kind":"FILTER","substeps":["less_or_equal($20, 10)"]},{"kind":"ANALYTIC_FUNCTION","substeps":["$20 := ROW_NUMBER() OVER (ORDER BY $81 DESC)"]},{"kind":"SORT","substeps":["$30 DESC"]},{"kind":"AGGREGATE","substeps":["GROUP BY $70 := $60","$30 := SUM($40)"]},{"kind":"AGGREGATE","substeps":["GROUP BY $60 := $1","$40 := SUM($2)"]},{"kind":"WRITE","substeps":["$110, $111","TO __stage00_output"]}],"slotMs":"432","computeMode":"BIGQUERY"}],"estimatedBytesProcessed":"86748430","timeline":[{"elapsedMs":"298","totalSlotMs":"432","pendingUnits":"0","completedUnits":"7","estimatedRunnableUnits":"0"}],"totalPartitionsProcessed":"7","totalBytesProcessed":"86748430","totalBytesBilled":"87031808","billingTier":1,"totalSlotMs":"432","cacheHit":false,"referencedTables":[{"projectId":"bigquery-public-data","datasetId":"crypto_ethereum_classic","tableId":"traces"}],"statementType":"SELECT","searchStatistics":{"indexUsageMode":"UNUSED","indexUnusedReasons":[{"code":"INDEX_CONFIG_NOT_AVAILABLE","message":"There is no index configuration for the base table `bigquery-public-data:crypto_ethereum_classic.traces`.","baseTable":{"projectId":"bigquery-public-data","datasetId":"crypto_ethereum_classic","tableId":"traces"}}]},"transferredBytes":"0","metadataCacheStatistics":{"tableMetadataCacheUsage":[{"tableReference":{"projectId":"bigquery-public-data","datasetId":"crypto_ethereum_classic","tableId":"traces"},"unusedReason":"OTHER_REASON"}]}},"totalSlotMs":"432","finalExecutionDurationMs":"188"},"status":{"state":"DONE"},"principal_subject":"user:admin@bentrollope.altostrat.com","jobCreationReason":{"code":"REQUESTED"}}'
+ job_id=bqjob_r15ddfd7013b78fe5_0000019a5ec0817d_1
+ '[' -n bqjob_r15ddfd7013b78fe5_0000019a5ec0817d_1 ']'
+ echo '  [SUCCESS] Query submitted.'
  [SUCCESS] Query submitted.
+ echo '  *** JOB ID FOR Top Internal Optimized: bqjob_r15ddfd7013b78fe5_0000019a5ec0817d_1 ***'
  *** JOB ID FOR Top Internal Optimized: bqjob_r15ddfd7013b78fe5_0000019a5ec0817d_1 ***
+ echo '  Waiting for job to complete...'
  Waiting for job to complete...
++ bq wait bqjob_r15ddfd7013b78fe5_0000019a5ec0817d_1
+ wait_output='Waiting on bqjob_r15ddfd7013b78fe5_0000019a5ec0817d_1 ... (0s) Current status: DONE   
Job tony-allen:bqjob_r15ddfd7013b78fe5_0000019a5ec0817d_1

  Job Type    State      Start Time         Duration                User Email              Bytes Processed   Bytes Billed   Billing Tier   Labels  
 ---------- --------- ----------------- ---------------- --------------------------------- ----------------- -------------- -------------- -------- 
  query      SUCCESS   07 Nov 14:37:46   0:00:00.383000   admin@bentrollope.altostrat.com   86748430          87031808       1                      '
+ '[' 0 -ne 0 ']'
+ echo '  Job completed. Fetching statistics...'
  Job completed. Fetching statistics...
++ bq show --format=json -j bqjob_r15ddfd7013b78fe5_0000019a5ec0817d_1
+ job_stats_json='{"kind":"bigquery#job","etag":"lNGmmBMSOTuxk8+RzQV4rg==","id":"tony-allen:US.bqjob_r15ddfd7013b78fe5_0000019a5ec0817d_1","selfLink":"https://bigquery.googleapis.com/bigquery/v2/projects/tony-allen/jobs/bqjob_r15ddfd7013b78fe5_0000019a5ec0817d_1?location=US","user_email":"admin@bentrollope.altostrat.com","configuration":{"query":{"query":"SELECT\n    to_address,\n    SUM(value) AS total_value_received_wei\nFROM\n    `bigquery-public-data.crypto_ethereum_classic.traces`\nWHERE\n    trace_type = '\''call'\''\n    AND status = 1\n    AND (call_type NOT IN ('\''delegatecall'\'', '\''callcode'\'', '\''staticcall'\'') OR call_type IS NULL)\n    AND block_timestamp >= '\''2020-01-01 00:00:00 UTC'\''\n    AND block_timestamp < '\''2020-01-08 00:00:00 UTC'\''\n    AND to_address IS NOT NULL\nGROUP BY\n    to_address\nQUALIFY\n    ROW_NUMBER() OVER (ORDER BY total_value_received_wei DESC) <= 10","destinationTable":{"projectId":"tony-allen","datasetId":"_e34c49c766e4fd3f5d404c3949b9e19fa7acb372","tableId":"anon9fd2d26f_cbe5_4ed5_8902_cfc971a61b35"},"writeDisposition":"WRITE_TRUNCATE","priority":"INTERACTIVE","useQueryCache":false,"useLegacySql":false},"jobType":"QUERY"},"jobReference":{"projectId":"tony-allen","jobId":"bqjob_r15ddfd7013b78fe5_0000019a5ec0817d_1","location":"US"},"statistics":{"creationTime":"1762526266040","startTime":"1762526266220","endTime":"1762526266603","totalBytesProcessed":"86748430","query":{"queryPlan":[{"name":"S00: Output","id":"0","startMs":"1762526266334","endMs":"1762526266512","waitRatioAvg":0.0027624309392265192,"waitMsAvg":"1","waitRatioMax":0.0027624309392265192,"waitMsMax":"1","readRatioAvg":0.6740331491712708,"readMsAvg":"244","readRatioMax":0.6740331491712708,"readMsMax":"244","computeRatioAvg":1,"computeMsAvg":"362","computeRatioMax":1,"computeMsMax":"362","writeRatioAvg":0.008287292817679558,"writeMsAvg":"3","writeRatioMax":0.008287292817679558,"writeMsMax":"3","shuffleOutputBytes":"630","shuffleOutputBytesSpilled":"0","recordsRead":"1016755","recordsWritten":"10","parallelInputs":"7","completedParallelInputs":"7","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$1:to_address, $2:value, $3:trace_type, $4:call_type, $5:status, $6:block_timestamp","FROM bigquery-public-data.crypto_ethereum_classic.traces","WHERE and(equal($3, '\''call'\''), equal($5, 1), or(not(in($4, '\''delegatecall'\'', '\''callcode'\'', '\''staticcall'\'')), is_null($4)), ...)"]},{"kind":"FILTER","substeps":["less_or_equal($10, 10)"]},{"kind":"ANALYTIC_FUNCTION","substeps":["$10 := ROW_NUMBER() OVER (ORDER BY $101 DESC)"]},{"kind":"SORT","substeps":["$91 DESC"]},{"kind":"FILTER","substeps":["less_or_equal($20, 10)"]},{"kind":"ANALYTIC_FUNCTION","substeps":["$20 := ROW_NUMBER() OVER (ORDER BY $81 DESC)"]},{"kind":"SORT","substeps":["$30 DESC"]},{"kind":"AGGREGATE","substeps":["GROUP BY $70 := $60","$30 := SUM($40)"]},{"kind":"AGGREGATE","substeps":["GROUP BY $60 := $1","$40 := SUM($2)"]},{"kind":"WRITE","substeps":["$110, $111","TO __stage00_output"]}],"slotMs":"432","computeMode":"BIGQUERY"}],"estimatedBytesProcessed":"86748430","timeline":[{"elapsedMs":"298","totalSlotMs":"432","pendingUnits":"0","completedUnits":"7","estimatedRunnableUnits":"0"}],"totalPartitionsProcessed":"7","totalBytesProcessed":"86748430","totalBytesBilled":"87031808","billingTier":1,"totalSlotMs":"432","cacheHit":false,"referencedTables":[{"projectId":"bigquery-public-data","datasetId":"crypto_ethereum_classic","tableId":"traces"}],"statementType":"SELECT","searchStatistics":{"indexUsageMode":"UNUSED","indexUnusedReasons":[{"code":"INDEX_CONFIG_NOT_AVAILABLE","message":"There is no index configuration for the base table `bigquery-public-data:crypto_ethereum_classic.traces`.","baseTable":{"projectId":"bigquery-public-data","datasetId":"crypto_ethereum_classic","tableId":"traces"}}]},"performanceInsights":{"avgPreviousExecutionMs":"154"},"transferredBytes":"0","metadataCacheStatistics":{"tableMetadataCacheUsage":[{"tableReference":{"projectId":"bigquery-public-data","datasetId":"crypto_ethereum_classic","tableId":"traces"},"unusedReason":"OTHER_REASON"}]}},"totalSlotMs":"432","finalExecutionDurationMs":"188"},"status":{"state":"DONE"},"principal_subject":"user:admin@bentrollope.altostrat.com","jobCreationReason":{"code":"REQUESTED"}}'
++ echo '{"kind":"bigquery#job","etag":"lNGmmBMSOTuxk8+RzQV4rg==","id":"tony-allen:US.bqjob_r15ddfd7013b78fe5_0000019a5ec0817d_1","selfLink":"https://bigquery.googleapis.com/bigquery/v2/projects/tony-allen/jobs/bqjob_r15ddfd7013b78fe5_0000019a5ec0817d_1?location=US","user_email":"admin@bentrollope.altostrat.com","configuration":{"query":{"query":"SELECT\n    to_address,\n    SUM(value) AS total_value_received_wei\nFROM\n    `bigquery-public-data.crypto_ethereum_classic.traces`\nWHERE\n    trace_type = '\''call'\''\n    AND status = 1\n    AND (call_type NOT IN ('\''delegatecall'\'', '\''callcode'\'', '\''staticcall'\'') OR call_type IS NULL)\n    AND block_timestamp >= '\''2020-01-01 00:00:00 UTC'\''\n    AND block_timestamp < '\''2020-01-08 00:00:00 UTC'\''\n    AND to_address IS NOT NULL\nGROUP BY\n    to_address\nQUALIFY\n    ROW_NUMBER() OVER (ORDER BY total_value_received_wei DESC) <= 10","destinationTable":{"projectId":"tony-allen","datasetId":"_e34c49c766e4fd3f5d404c3949b9e19fa7acb372","tableId":"anon9fd2d26f_cbe5_4ed5_8902_cfc971a61b35"},"writeDisposition":"WRITE_TRUNCATE","priority":"INTERACTIVE","useQueryCache":false,"useLegacySql":false},"jobType":"QUERY"},"jobReference":{"projectId":"tony-allen","jobId":"bqjob_r15ddfd7013b78fe5_0000019a5ec0817d_1","location":"US"},"statistics":{"creationTime":"1762526266040","startTime":"1762526266220","endTime":"1762526266603","totalBytesProcessed":"86748430","query":{"queryPlan":[{"name":"S00: Output","id":"0","startMs":"1762526266334","endMs":"1762526266512","waitRatioAvg":0.0027624309392265192,"waitMsAvg":"1","waitRatioMax":0.0027624309392265192,"waitMsMax":"1","readRatioAvg":0.6740331491712708,"readMsAvg":"244","readRatioMax":0.6740331491712708,"readMsMax":"244","computeRatioAvg":1,"computeMsAvg":"362","computeRatioMax":1,"computeMsMax":"362","writeRatioAvg":0.008287292817679558,"writeMsAvg":"3","writeRatioMax":0.008287292817679558,"writeMsMax":"3","shuffleOutputBytes":"630","shuffleOutputBytesSpilled":"0","recordsRead":"1016755","recordsWritten":"10","parallelInputs":"7","completedParallelInputs":"7","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$1:to_address, $2:value, $3:trace_type, $4:call_type, $5:status, $6:block_timestamp","FROM bigquery-public-data.crypto_ethereum_classic.traces","WHERE and(equal($3, '\''call'\''), equal($5, 1), or(not(in($4, '\''delegatecall'\'', '\''callcode'\'', '\''staticcall'\'')), is_null($4)), ...)"]},{"kind":"FILTER","substeps":["less_or_equal($10, 10)"]},{"kind":"ANALYTIC_FUNCTION","substeps":["$10 := ROW_NUMBER() OVER (ORDER BY $101 DESC)"]},{"kind":"SORT","substeps":["$91 DESC"]},{"kind":"FILTER","substeps":["less_or_equal($20, 10)"]},{"kind":"ANALYTIC_FUNCTION","substeps":["$20 := ROW_NUMBER() OVER (ORDER BY $81 DESC)"]},{"kind":"SORT","substeps":["$30 DESC"]},{"kind":"AGGREGATE","substeps":["GROUP BY $70 := $60","$30 := SUM($40)"]},{"kind":"AGGREGATE","substeps":["GROUP BY $60 := $1","$40 := SUM($2)"]},{"kind":"WRITE","substeps":["$110, $111","TO __stage00_output"]}],"slotMs":"432","computeMode":"BIGQUERY"}],"estimatedBytesProcessed":"86748430","timeline":[{"elapsedMs":"298","totalSlotMs":"432","pendingUnits":"0","completedUnits":"7","estimatedRunnableUnits":"0"}],"totalPartitionsProcessed":"7","totalBytesProcessed":"86748430","totalBytesBilled":"87031808","billingTier":1,"totalSlotMs":"432","cacheHit":false,"referencedTables":[{"projectId":"bigquery-public-data","datasetId":"crypto_ethereum_classic","tableId":"traces"}],"statementType":"SELECT","searchStatistics":{"indexUsageMode":"UNUSED","indexUnusedReasons":[{"code":"INDEX_CONFIG_NOT_AVAILABLE","message":"There is no index configuration for the base table `bigquery-public-data:crypto_ethereum_classic.traces`.","baseTable":{"projectId":"bigquery-public-data","datasetId":"crypto_ethereum_classic","tableId":"traces"}}]},"performanceInsights":{"avgPreviousExecutionMs":"154"},"transferredBytes":"0","metadataCacheStatistics":{"tableMetadataCacheUsage":[{"tableReference":{"projectId":"bigquery-public-data","datasetId":"crypto_ethereum_classic","tableId":"traces"},"unusedReason":"OTHER_REASON"}]}},"totalSlotMs":"432","finalExecutionDurationMs":"188"},"status":{"state":"DONE"},"principal_subject":"user:admin@bentrollope.altostrat.com","jobCreationReason":{"code":"REQUESTED"}}'
++ jq -r .statistics.totalBytesProcessed
+ total_bytes_processed=86748430
++ echo '{"kind":"bigquery#job","etag":"lNGmmBMSOTuxk8+RzQV4rg==","id":"tony-allen:US.bqjob_r15ddfd7013b78fe5_0000019a5ec0817d_1","selfLink":"https://bigquery.googleapis.com/bigquery/v2/projects/tony-allen/jobs/bqjob_r15ddfd7013b78fe5_0000019a5ec0817d_1?location=US","user_email":"admin@bentrollope.altostrat.com","configuration":{"query":{"query":"SELECT\n    to_address,\n    SUM(value) AS total_value_received_wei\nFROM\n    `bigquery-public-data.crypto_ethereum_classic.traces`\nWHERE\n    trace_type = '\''call'\''\n    AND status = 1\n    AND (call_type NOT IN ('\''delegatecall'\'', '\''callcode'\'', '\''staticcall'\'') OR call_type IS NULL)\n    AND block_timestamp >= '\''2020-01-01 00:00:00 UTC'\''\n    AND block_timestamp < '\''2020-01-08 00:00:00 UTC'\''\n    AND to_address IS NOT NULL\nGROUP BY\n    to_address\nQUALIFY\n    ROW_NUMBER() OVER (ORDER BY total_value_received_wei DESC) <= 10","destinationTable":{"projectId":"tony-allen","datasetId":"_e34c49c766e4fd3f5d404c3949b9e19fa7acb372","tableId":"anon9fd2d26f_cbe5_4ed5_8902_cfc971a61b35"},"writeDisposition":"WRITE_TRUNCATE","priority":"INTERACTIVE","useQueryCache":false,"useLegacySql":false},"jobType":"QUERY"},"jobReference":{"projectId":"tony-allen","jobId":"bqjob_r15ddfd7013b78fe5_0000019a5ec0817d_1","location":"US"},"statistics":{"creationTime":"1762526266040","startTime":"1762526266220","endTime":"1762526266603","totalBytesProcessed":"86748430","query":{"queryPlan":[{"name":"S00: Output","id":"0","startMs":"1762526266334","endMs":"1762526266512","waitRatioAvg":0.0027624309392265192,"waitMsAvg":"1","waitRatioMax":0.0027624309392265192,"waitMsMax":"1","readRatioAvg":0.6740331491712708,"readMsAvg":"244","readRatioMax":0.6740331491712708,"readMsMax":"244","computeRatioAvg":1,"computeMsAvg":"362","computeRatioMax":1,"computeMsMax":"362","writeRatioAvg":0.008287292817679558,"writeMsAvg":"3","writeRatioMax":0.008287292817679558,"writeMsMax":"3","shuffleOutputBytes":"630","shuffleOutputBytesSpilled":"0","recordsRead":"1016755","recordsWritten":"10","parallelInputs":"7","completedParallelInputs":"7","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$1:to_address, $2:value, $3:trace_type, $4:call_type, $5:status, $6:block_timestamp","FROM bigquery-public-data.crypto_ethereum_classic.traces","WHERE and(equal($3, '\''call'\''), equal($5, 1), or(not(in($4, '\''delegatecall'\'', '\''callcode'\'', '\''staticcall'\'')), is_null($4)), ...)"]},{"kind":"FILTER","substeps":["less_or_equal($10, 10)"]},{"kind":"ANALYTIC_FUNCTION","substeps":["$10 := ROW_NUMBER() OVER (ORDER BY $101 DESC)"]},{"kind":"SORT","substeps":["$91 DESC"]},{"kind":"FILTER","substeps":["less_or_equal($20, 10)"]},{"kind":"ANALYTIC_FUNCTION","substeps":["$20 := ROW_NUMBER() OVER (ORDER BY $81 DESC)"]},{"kind":"SORT","substeps":["$30 DESC"]},{"kind":"AGGREGATE","substeps":["GROUP BY $70 := $60","$30 := SUM($40)"]},{"kind":"AGGREGATE","substeps":["GROUP BY $60 := $1","$40 := SUM($2)"]},{"kind":"WRITE","substeps":["$110, $111","TO __stage00_output"]}],"slotMs":"432","computeMode":"BIGQUERY"}],"estimatedBytesProcessed":"86748430","timeline":[{"elapsedMs":"298","totalSlotMs":"432","pendingUnits":"0","completedUnits":"7","estimatedRunnableUnits":"0"}],"totalPartitionsProcessed":"7","totalBytesProcessed":"86748430","totalBytesBilled":"87031808","billingTier":1,"totalSlotMs":"432","cacheHit":false,"referencedTables":[{"projectId":"bigquery-public-data","datasetId":"crypto_ethereum_classic","tableId":"traces"}],"statementType":"SELECT","searchStatistics":{"indexUsageMode":"UNUSED","indexUnusedReasons":[{"code":"INDEX_CONFIG_NOT_AVAILABLE","message":"There is no index configuration for the base table `bigquery-public-data:crypto_ethereum_classic.traces`.","baseTable":{"projectId":"bigquery-public-data","datasetId":"crypto_ethereum_classic","tableId":"traces"}}]},"performanceInsights":{"avgPreviousExecutionMs":"154"},"transferredBytes":"0","metadataCacheStatistics":{"tableMetadataCacheUsage":[{"tableReference":{"projectId":"bigquery-public-data","datasetId":"crypto_ethereum_classic","tableId":"traces"},"unusedReason":"OTHER_REASON"}]}},"totalSlotMs":"432","finalExecutionDurationMs":"188"},"status":{"state":"DONE"},"principal_subject":"user:admin@bentrollope.altostrat.com","jobCreationReason":{"code":"REQUESTED"}}'
++ jq -r .statistics.totalSlotMs
+ total_slot_ms=432
++ echo '{"kind":"bigquery#job","etag":"lNGmmBMSOTuxk8+RzQV4rg==","id":"tony-allen:US.bqjob_r15ddfd7013b78fe5_0000019a5ec0817d_1","selfLink":"https://bigquery.googleapis.com/bigquery/v2/projects/tony-allen/jobs/bqjob_r15ddfd7013b78fe5_0000019a5ec0817d_1?location=US","user_email":"admin@bentrollope.altostrat.com","configuration":{"query":{"query":"SELECT\n    to_address,\n    SUM(value) AS total_value_received_wei\nFROM\n    `bigquery-public-data.crypto_ethereum_classic.traces`\nWHERE\n    trace_type = '\''call'\''\n    AND status = 1\n    AND (call_type NOT IN ('\''delegatecall'\'', '\''callcode'\'', '\''staticcall'\'') OR call_type IS NULL)\n    AND block_timestamp >= '\''2020-01-01 00:00:00 UTC'\''\n    AND block_timestamp < '\''2020-01-08 00:00:00 UTC'\''\n    AND to_address IS NOT NULL\nGROUP BY\n    to_address\nQUALIFY\n    ROW_NUMBER() OVER (ORDER BY total_value_received_wei DESC) <= 10","destinationTable":{"projectId":"tony-allen","datasetId":"_e34c49c766e4fd3f5d404c3949b9e19fa7acb372","tableId":"anon9fd2d26f_cbe5_4ed5_8902_cfc971a61b35"},"writeDisposition":"WRITE_TRUNCATE","priority":"INTERACTIVE","useQueryCache":false,"useLegacySql":false},"jobType":"QUERY"},"jobReference":{"projectId":"tony-allen","jobId":"bqjob_r15ddfd7013b78fe5_0000019a5ec0817d_1","location":"US"},"statistics":{"creationTime":"1762526266040","startTime":"1762526266220","endTime":"1762526266603","totalBytesProcessed":"86748430","query":{"queryPlan":[{"name":"S00: Output","id":"0","startMs":"1762526266334","endMs":"1762526266512","waitRatioAvg":0.0027624309392265192,"waitMsAvg":"1","waitRatioMax":0.0027624309392265192,"waitMsMax":"1","readRatioAvg":0.6740331491712708,"readMsAvg":"244","readRatioMax":0.6740331491712708,"readMsMax":"244","computeRatioAvg":1,"computeMsAvg":"362","computeRatioMax":1,"computeMsMax":"362","writeRatioAvg":0.008287292817679558,"writeMsAvg":"3","writeRatioMax":0.008287292817679558,"writeMsMax":"3","shuffleOutputBytes":"630","shuffleOutputBytesSpilled":"0","recordsRead":"1016755","recordsWritten":"10","parallelInputs":"7","completedParallelInputs":"7","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$1:to_address, $2:value, $3:trace_type, $4:call_type, $5:status, $6:block_timestamp","FROM bigquery-public-data.crypto_ethereum_classic.traces","WHERE and(equal($3, '\''call'\''), equal($5, 1), or(not(in($4, '\''delegatecall'\'', '\''callcode'\'', '\''staticcall'\'')), is_null($4)), ...)"]},{"kind":"FILTER","substeps":["less_or_equal($10, 10)"]},{"kind":"ANALYTIC_FUNCTION","substeps":["$10 := ROW_NUMBER() OVER (ORDER BY $101 DESC)"]},{"kind":"SORT","substeps":["$91 DESC"]},{"kind":"FILTER","substeps":["less_or_equal($20, 10)"]},{"kind":"ANALYTIC_FUNCTION","substeps":["$20 := ROW_NUMBER() OVER (ORDER BY $81 DESC)"]},{"kind":"SORT","substeps":["$30 DESC"]},{"kind":"AGGREGATE","substeps":["GROUP BY $70 := $60","$30 := SUM($40)"]},{"kind":"AGGREGATE","substeps":["GROUP BY $60 := $1","$40 := SUM($2)"]},{"kind":"WRITE","substeps":["$110, $111","TO __stage00_output"]}],"slotMs":"432","computeMode":"BIGQUERY"}],"estimatedBytesProcessed":"86748430","timeline":[{"elapsedMs":"298","totalSlotMs":"432","pendingUnits":"0","completedUnits":"7","estimatedRunnableUnits":"0"}],"totalPartitionsProcessed":"7","totalBytesProcessed":"86748430","totalBytesBilled":"87031808","billingTier":1,"totalSlotMs":"432","cacheHit":false,"referencedTables":[{"projectId":"bigquery-public-data","datasetId":"crypto_ethereum_classic","tableId":"traces"}],"statementType":"SELECT","searchStatistics":{"indexUsageMode":"UNUSED","indexUnusedReasons":[{"code":"INDEX_CONFIG_NOT_AVAILABLE","message":"There is no index configuration for the base table `bigquery-public-data:crypto_ethereum_classic.traces`.","baseTable":{"projectId":"bigquery-public-data","datasetId":"crypto_ethereum_classic","tableId":"traces"}}]},"performanceInsights":{"avgPreviousExecutionMs":"154"},"transferredBytes":"0","metadataCacheStatistics":{"tableMetadataCacheUsage":[{"tableReference":{"projectId":"bigquery-public-data","datasetId":"crypto_ethereum_classic","tableId":"traces"},"unusedReason":"OTHER_REASON"}]}},"totalSlotMs":"432","finalExecutionDurationMs":"188"},"status":{"state":"DONE"},"principal_subject":"user:admin@bentrollope.altostrat.com","jobCreationReason":{"code":"REQUESTED"}}'
++ jq -r .statistics.startTime
+ start_time=1762526266220
++ jq -r .statistics.endTime
++ echo '{"kind":"bigquery#job","etag":"lNGmmBMSOTuxk8+RzQV4rg==","id":"tony-allen:US.bqjob_r15ddfd7013b78fe5_0000019a5ec0817d_1","selfLink":"https://bigquery.googleapis.com/bigquery/v2/projects/tony-allen/jobs/bqjob_r15ddfd7013b78fe5_0000019a5ec0817d_1?location=US","user_email":"admin@bentrollope.altostrat.com","configuration":{"query":{"query":"SELECT\n    to_address,\n    SUM(value) AS total_value_received_wei\nFROM\n    `bigquery-public-data.crypto_ethereum_classic.traces`\nWHERE\n    trace_type = '\''call'\''\n    AND status = 1\n    AND (call_type NOT IN ('\''delegatecall'\'', '\''callcode'\'', '\''staticcall'\'') OR call_type IS NULL)\n    AND block_timestamp >= '\''2020-01-01 00:00:00 UTC'\''\n    AND block_timestamp < '\''2020-01-08 00:00:00 UTC'\''\n    AND to_address IS NOT NULL\nGROUP BY\n    to_address\nQUALIFY\n    ROW_NUMBER() OVER (ORDER BY total_value_received_wei DESC) <= 10","destinationTable":{"projectId":"tony-allen","datasetId":"_e34c49c766e4fd3f5d404c3949b9e19fa7acb372","tableId":"anon9fd2d26f_cbe5_4ed5_8902_cfc971a61b35"},"writeDisposition":"WRITE_TRUNCATE","priority":"INTERACTIVE","useQueryCache":false,"useLegacySql":false},"jobType":"QUERY"},"jobReference":{"projectId":"tony-allen","jobId":"bqjob_r15ddfd7013b78fe5_0000019a5ec0817d_1","location":"US"},"statistics":{"creationTime":"1762526266040","startTime":"1762526266220","endTime":"1762526266603","totalBytesProcessed":"86748430","query":{"queryPlan":[{"name":"S00: Output","id":"0","startMs":"1762526266334","endMs":"1762526266512","waitRatioAvg":0.0027624309392265192,"waitMsAvg":"1","waitRatioMax":0.0027624309392265192,"waitMsMax":"1","readRatioAvg":0.6740331491712708,"readMsAvg":"244","readRatioMax":0.6740331491712708,"readMsMax":"244","computeRatioAvg":1,"computeMsAvg":"362","computeRatioMax":1,"computeMsMax":"362","writeRatioAvg":0.008287292817679558,"writeMsAvg":"3","writeRatioMax":0.008287292817679558,"writeMsMax":"3","shuffleOutputBytes":"630","shuffleOutputBytesSpilled":"0","recordsRead":"1016755","recordsWritten":"10","parallelInputs":"7","completedParallelInputs":"7","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$1:to_address, $2:value, $3:trace_type, $4:call_type, $5:status, $6:block_timestamp","FROM bigquery-public-data.crypto_ethereum_classic.traces","WHERE and(equal($3, '\''call'\''), equal($5, 1), or(not(in($4, '\''delegatecall'\'', '\''callcode'\'', '\''staticcall'\'')), is_null($4)), ...)"]},{"kind":"FILTER","substeps":["less_or_equal($10, 10)"]},{"kind":"ANALYTIC_FUNCTION","substeps":["$10 := ROW_NUMBER() OVER (ORDER BY $101 DESC)"]},{"kind":"SORT","substeps":["$91 DESC"]},{"kind":"FILTER","substeps":["less_or_equal($20, 10)"]},{"kind":"ANALYTIC_FUNCTION","substeps":["$20 := ROW_NUMBER() OVER (ORDER BY $81 DESC)"]},{"kind":"SORT","substeps":["$30 DESC"]},{"kind":"AGGREGATE","substeps":["GROUP BY $70 := $60","$30 := SUM($40)"]},{"kind":"AGGREGATE","substeps":["GROUP BY $60 := $1","$40 := SUM($2)"]},{"kind":"WRITE","substeps":["$110, $111","TO __stage00_output"]}],"slotMs":"432","computeMode":"BIGQUERY"}],"estimatedBytesProcessed":"86748430","timeline":[{"elapsedMs":"298","totalSlotMs":"432","pendingUnits":"0","completedUnits":"7","estimatedRunnableUnits":"0"}],"totalPartitionsProcessed":"7","totalBytesProcessed":"86748430","totalBytesBilled":"87031808","billingTier":1,"totalSlotMs":"432","cacheHit":false,"referencedTables":[{"projectId":"bigquery-public-data","datasetId":"crypto_ethereum_classic","tableId":"traces"}],"statementType":"SELECT","searchStatistics":{"indexUsageMode":"UNUSED","indexUnusedReasons":[{"code":"INDEX_CONFIG_NOT_AVAILABLE","message":"There is no index configuration for the base table `bigquery-public-data:crypto_ethereum_classic.traces`.","baseTable":{"projectId":"bigquery-public-data","datasetId":"crypto_ethereum_classic","tableId":"traces"}}]},"performanceInsights":{"avgPreviousExecutionMs":"154"},"transferredBytes":"0","metadataCacheStatistics":{"tableMetadataCacheUsage":[{"tableReference":{"projectId":"bigquery-public-data","datasetId":"crypto_ethereum_classic","tableId":"traces"},"unusedReason":"OTHER_REASON"}]}},"totalSlotMs":"432","finalExecutionDurationMs":"188"},"status":{"state":"DONE"},"principal_subject":"user:admin@bentrollope.altostrat.com","jobCreationReason":{"code":"REQUESTED"}}'
+ end_time=1762526266603
++ echo 1762526266220
++ awk '{print int($1)}'
+ start_ms=1762526266220
++ echo 1762526266603
++ awk '{print int($1)}'
+ end_ms=1762526266603
+ duration_ms=383
+ echo '  --- Execution Statistics ---'
  --- Execution Statistics ---
+ echo '  Duration: 383 ms'
  Duration: 383 ms
+ echo '  Bytes Processed: 86748430 bytes'
  Bytes Processed: 86748430 bytes
+ echo '  Slot Milliseconds: 432'
  Slot Milliseconds: 432
+ echo '  ----------------------------'
  ----------------------------
+ echo -e 'Top Internal Optimized\tbqjob_r15ddfd7013b78fe5_0000019a5ec0817d_1\t383\t86748430\t432'
+ echo ''

+ echo '--- Running queries from top_sender_net_flow_analysis_eval.sql ---'
--- Running queries from top_sender_net_flow_analysis_eval.sql ---
+ run_query 'Top Sender Unoptimized' 'WITH TopSenders AS (
    -- CTE 1: Identify the top 5 addresses based on the count of successful transactions
    SELECT
        t.from_address AS address,
        COUNT(t.hash) AS transaction_count
    FROM
        `bigquery-public-data.crypto_ethereum_classic.transactions` AS t
    WHERE
        t.receipt_status = 1 
        AND t.block_timestamp >= '\''2020-01-01 00:00:00 UTC'\'' 
        AND t.block_timestamp < '\''2020-04-01 00:00:00 UTC'\''  
    GROUP BY
        1
    ORDER BY
        transaction_count DESC
    LIMIT 5
),

TotalFees AS (
    -- CTE 2: Requires a second scan of the '\''transactions'\'' table unnecessarily
    SELECT
        t.from_address AS address,
        SUM(CAST(t.gas_price AS NUMERIC) * CAST(t.receipt_gas_used AS NUMERIC)) AS total_fees_paid
    FROM
        `bigquery-public-data.crypto_ethereum_classic.transactions` AS t
    INNER JOIN
        TopSenders AS s ON t.from_address = s.address
    WHERE
        t.block_timestamp >= '\''2020-01-01 00:00:00 UTC'\''
        AND t.block_timestamp < '\''2020-04-01 00:00:00 UTC'\''
        AND t.receipt_status = 1
    GROUP BY
        1
),

TotalValueSent AS (
    -- CTE 3: Scans the '\''traces'\'' table
    SELECT
        tr.from_address AS address,
        SUM(tr.value) AS total_value_sent
    FROM
        `bigquery-public-data.crypto_ethereum_classic.traces` AS tr
    INNER JOIN
        TopSenders AS s ON tr.from_address = s.address
    WHERE
        tr.block_timestamp >= '\''2020-01-01 00:00:00 UTC'\''  
        AND tr.block_timestamp < '\''2020-04-01 00:00:00 UTC'\'' 
    GROUP BY
        1
)

-- Final SELECT: Joins the calculated fees and values to find the net ether flow
SELECT
    f.address,
    v.total_value_sent,
    f.total_fees_paid,
    v.total_value_sent - f.total_fees_paid AS net_ether_flow_wei
FROM
    TotalFees AS f
INNER JOIN
    TotalValueSent AS v ON f.address = v.address
ORDER BY
    net_ether_flow_wei DESC
LIMIT 100'
+ local 'query_name=Top Sender Unoptimized'
+ local 'query=WITH TopSenders AS (
    -- CTE 1: Identify the top 5 addresses based on the count of successful transactions
    SELECT
        t.from_address AS address,
        COUNT(t.hash) AS transaction_count
    FROM
        `bigquery-public-data.crypto_ethereum_classic.transactions` AS t
    WHERE
        t.receipt_status = 1 
        AND t.block_timestamp >= '\''2020-01-01 00:00:00 UTC'\'' 
        AND t.block_timestamp < '\''2020-04-01 00:00:00 UTC'\''  
    GROUP BY
        1
    ORDER BY
        transaction_count DESC
    LIMIT 5
),

TotalFees AS (
    -- CTE 2: Requires a second scan of the '\''transactions'\'' table unnecessarily
    SELECT
        t.from_address AS address,
        SUM(CAST(t.gas_price AS NUMERIC) * CAST(t.receipt_gas_used AS NUMERIC)) AS total_fees_paid
    FROM
        `bigquery-public-data.crypto_ethereum_classic.transactions` AS t
    INNER JOIN
        TopSenders AS s ON t.from_address = s.address
    WHERE
        t.block_timestamp >= '\''2020-01-01 00:00:00 UTC'\''
        AND t.block_timestamp < '\''2020-04-01 00:00:00 UTC'\''
        AND t.receipt_status = 1
    GROUP BY
        1
),

TotalValueSent AS (
    -- CTE 3: Scans the '\''traces'\'' table
    SELECT
        tr.from_address AS address,
        SUM(tr.value) AS total_value_sent
    FROM
        `bigquery-public-data.crypto_ethereum_classic.traces` AS tr
    INNER JOIN
        TopSenders AS s ON tr.from_address = s.address
    WHERE
        tr.block_timestamp >= '\''2020-01-01 00:00:00 UTC'\''  
        AND tr.block_timestamp < '\''2020-04-01 00:00:00 UTC'\'' 
    GROUP BY
        1
)

-- Final SELECT: Joins the calculated fees and values to find the net ether flow
SELECT
    f.address,
    v.total_value_sent,
    f.total_fees_paid,
    v.total_value_sent - f.total_fees_paid AS net_ether_flow_wei
FROM
    TotalFees AS f
INNER JOIN
    TotalValueSent AS v ON f.address = v.address
ORDER BY
    net_ether_flow_wei DESC
LIMIT 100'
+ echo ==================================================
==================================================
+ echo 'Executing Top Sender Unoptimized'
Executing Top Sender Unoptimized
+ echo ==================================================
==================================================
+ echo Query:
Query:
+ echo 'WITH TopSenders AS (
    -- CTE 1: Identify the top 5 addresses based on the count of successful transactions
    SELECT
        t.from_address AS address,
        COUNT(t.hash) AS transaction_count
    FROM
        `bigquery-public-data.crypto_ethereum_classic.transactions` AS t
    WHERE
        t.receipt_status = 1 
        AND t.block_timestamp >= '\''2020-01-01 00:00:00 UTC'\'' 
        AND t.block_timestamp < '\''2020-04-01 00:00:00 UTC'\''  
    GROUP BY
        1
    ORDER BY
        transaction_count DESC
    LIMIT 5
),

TotalFees AS (
    -- CTE 2: Requires a second scan of the '\''transactions'\'' table unnecessarily
    SELECT
        t.from_address AS address,
        SUM(CAST(t.gas_price AS NUMERIC) * CAST(t.receipt_gas_used AS NUMERIC)) AS total_fees_paid
    FROM
        `bigquery-public-data.crypto_ethereum_classic.transactions` AS t
    INNER JOIN
        TopSenders AS s ON t.from_address = s.address
    WHERE
        t.block_timestamp >= '\''2020-01-01 00:00:00 UTC'\''
        AND t.block_timestamp < '\''2020-04-01 00:00:00 UTC'\''
        AND t.receipt_status = 1
    GROUP BY
        1
),

TotalValueSent AS (
    -- CTE 3: Scans the '\''traces'\'' table
    SELECT
        tr.from_address AS address,
        SUM(tr.value) AS total_value_sent
    FROM
        `bigquery-public-data.crypto_ethereum_classic.traces` AS tr
    INNER JOIN
        TopSenders AS s ON tr.from_address = s.address
    WHERE
        tr.block_timestamp >= '\''2020-01-01 00:00:00 UTC'\''  
        AND tr.block_timestamp < '\''2020-04-01 00:00:00 UTC'\'' 
    GROUP BY
        1
)

-- Final SELECT: Joins the calculated fees and values to find the net ether flow
SELECT
    f.address,
    v.total_value_sent,
    f.total_fees_paid,
    v.total_value_sent - f.total_fees_paid AS net_ether_flow_wei
FROM
    TotalFees AS f
INNER JOIN
    TotalValueSent AS v ON f.address = v.address
ORDER BY
    net_ether_flow_wei DESC
LIMIT 100'
WITH TopSenders AS (
    -- CTE 1: Identify the top 5 addresses based on the count of successful transactions
    SELECT
        t.from_address AS address,
        COUNT(t.hash) AS transaction_count
    FROM
        `bigquery-public-data.crypto_ethereum_classic.transactions` AS t
    WHERE
        t.receipt_status = 1 
        AND t.block_timestamp >= '2020-01-01 00:00:00 UTC' 
        AND t.block_timestamp < '2020-04-01 00:00:00 UTC'  
    GROUP BY
        1
    ORDER BY
        transaction_count DESC
    LIMIT 5
),

TotalFees AS (
    -- CTE 2: Requires a second scan of the 'transactions' table unnecessarily
    SELECT
        t.from_address AS address,
        SUM(CAST(t.gas_price AS NUMERIC) * CAST(t.receipt_gas_used AS NUMERIC)) AS total_fees_paid
    FROM
        `bigquery-public-data.crypto_ethereum_classic.transactions` AS t
    INNER JOIN
        TopSenders AS s ON t.from_address = s.address
    WHERE
        t.block_timestamp >= '2020-01-01 00:00:00 UTC'
        AND t.block_timestamp < '2020-04-01 00:00:00 UTC'
        AND t.receipt_status = 1
    GROUP BY
        1
),

TotalValueSent AS (
    -- CTE 3: Scans the 'traces' table
    SELECT
        tr.from_address AS address,
        SUM(tr.value) AS total_value_sent
    FROM
        `bigquery-public-data.crypto_ethereum_classic.traces` AS tr
    INNER JOIN
        TopSenders AS s ON tr.from_address = s.address
    WHERE
        tr.block_timestamp >= '2020-01-01 00:00:00 UTC'  
        AND tr.block_timestamp < '2020-04-01 00:00:00 UTC' 
    GROUP BY
        1
)

-- Final SELECT: Joins the calculated fees and values to find the net ether flow
SELECT
    f.address,
    v.total_value_sent,
    f.total_fees_paid,
    v.total_value_sent - f.total_fees_paid AS net_ether_flow_wei
FROM
    TotalFees AS f
INNER JOIN
    TotalValueSent AS v ON f.address = v.address
ORDER BY
    net_ether_flow_wei DESC
LIMIT 100
+ echo --------------------------------------------------
--------------------------------------------------
++ bq query --nouse_cache --nosync --use_legacy_sql=false --format=json --location=US 'WITH TopSenders AS (
    -- CTE 1: Identify the top 5 addresses based on the count of successful transactions
    SELECT
        t.from_address AS address,
        COUNT(t.hash) AS transaction_count
    FROM
        `bigquery-public-data.crypto_ethereum_classic.transactions` AS t
    WHERE
        t.receipt_status = 1 
        AND t.block_timestamp >= '\''2020-01-01 00:00:00 UTC'\'' 
        AND t.block_timestamp < '\''2020-04-01 00:00:00 UTC'\''  
    GROUP BY
        1
    ORDER BY
        transaction_count DESC
    LIMIT 5
),

TotalFees AS (
    -- CTE 2: Requires a second scan of the '\''transactions'\'' table unnecessarily
    SELECT
        t.from_address AS address,
        SUM(CAST(t.gas_price AS NUMERIC) * CAST(t.receipt_gas_used AS NUMERIC)) AS total_fees_paid
    FROM
        `bigquery-public-data.crypto_ethereum_classic.transactions` AS t
    INNER JOIN
        TopSenders AS s ON t.from_address = s.address
    WHERE
        t.block_timestamp >= '\''2020-01-01 00:00:00 UTC'\''
        AND t.block_timestamp < '\''2020-04-01 00:00:00 UTC'\''
        AND t.receipt_status = 1
    GROUP BY
        1
),

TotalValueSent AS (
    -- CTE 3: Scans the '\''traces'\'' table
    SELECT
        tr.from_address AS address,
        SUM(tr.value) AS total_value_sent
    FROM
        `bigquery-public-data.crypto_ethereum_classic.traces` AS tr
    INNER JOIN
        TopSenders AS s ON tr.from_address = s.address
    WHERE
        tr.block_timestamp >= '\''2020-01-01 00:00:00 UTC'\''  
        AND tr.block_timestamp < '\''2020-04-01 00:00:00 UTC'\'' 
    GROUP BY
        1
)

-- Final SELECT: Joins the calculated fees and values to find the net ether flow
SELECT
    f.address,
    v.total_value_sent,
    f.total_fees_paid,
    v.total_value_sent - f.total_fees_paid AS net_ether_flow_wei
FROM
    TotalFees AS f
INNER JOIN
    TotalValueSent AS v ON f.address = v.address
ORDER BY
    net_ether_flow_wei DESC
LIMIT 100'
+ job_submission_output='{"kind":"bigquery#job","etag":"lHAcpsk46IDNuBeY0R2i1A==","id":"tony-allen:US.bqjob_r7af22a93cb588faa_0000019a5ec0a0bd_1","selfLink":"https://bigquery.googleapis.com/bigquery/v2/projects/tony-allen/jobs/bqjob_r7af22a93cb588faa_0000019a5ec0a0bd_1?location=US","user_email":"admin@bentrollope.altostrat.com","configuration":{"query":{"query":"WITH TopSenders AS (\n    -- CTE 1: Identify the top 5 addresses based on the count of successful transactions\n    SELECT\n        t.from_address AS address,\n        COUNT(t.hash) AS transaction_count\n    FROM\n        `bigquery-public-data.crypto_ethereum_classic.transactions` AS t\n    WHERE\n        t.receipt_status = 1 \n        AND t.block_timestamp >= '\''2020-01-01 00:00:00 UTC'\'' \n        AND t.block_timestamp < '\''2020-04-01 00:00:00 UTC'\''  \n    GROUP BY\n        1\n    ORDER BY\n        transaction_count DESC\n    LIMIT 5\n),\n\nTotalFees AS (\n    -- CTE 2: Requires a second scan of the '\''transactions'\'' table unnecessarily\n    SELECT\n        t.from_address AS address,\n        SUM(CAST(t.gas_price AS NUMERIC) * CAST(t.receipt_gas_used AS NUMERIC)) AS total_fees_paid\n    FROM\n        `bigquery-public-data.crypto_ethereum_classic.transactions` AS t\n    INNER JOIN\n        TopSenders AS s ON t.from_address = s.address\n    WHERE\n        t.block_timestamp >= '\''2020-01-01 00:00:00 UTC'\''\n        AND t.block_timestamp < '\''2020-04-01 00:00:00 UTC'\''\n        AND t.receipt_status = 1\n    GROUP BY\n        1\n),\n\nTotalValueSent AS (\n    -- CTE 3: Scans the '\''traces'\'' table\n    SELECT\n        tr.from_address AS address,\n        SUM(tr.value) AS total_value_sent\n    FROM\n        `bigquery-public-data.crypto_ethereum_classic.traces` AS tr\n    INNER JOIN\n        TopSenders AS s ON tr.from_address = s.address\n    WHERE\n        tr.block_timestamp >= '\''2020-01-01 00:00:00 UTC'\''  \n        AND tr.block_timestamp < '\''2020-04-01 00:00:00 UTC'\'' \n    GROUP BY\n        1\n)\n\n-- Final SELECT: Joins the calculated fees and values to find the net ether flow\nSELECT\n    f.address,\n    v.total_value_sent,\n    f.total_fees_paid,\n    v.total_value_sent - f.total_fees_paid AS net_ether_flow_wei\nFROM\n    TotalFees AS f\nINNER JOIN\n    TotalValueSent AS v ON f.address = v.address\nORDER BY\n    net_ether_flow_wei DESC\nLIMIT 100","destinationTable":{"projectId":"tony-allen","datasetId":"_e34c49c766e4fd3f5d404c3949b9e19fa7acb372","tableId":"anonc5ee9f31_131e_4177_b506_9f08344248e5"},"writeDisposition":"WRITE_TRUNCATE","priority":"INTERACTIVE","useQueryCache":false,"useLegacySql":false},"jobType":"QUERY"},"jobReference":{"projectId":"tony-allen","jobId":"bqjob_r7af22a93cb588faa_0000019a5ec0a0bd_1","location":"US"},"statistics":{"creationTime":"1762526273968","startTime":"1762526274066","endTime":"1762526275330","totalBytesProcessed":"1594954856","query":{"queryPlan":[{"name":"S00: Input","id":"0","startMs":"1762526274393","endMs":"1762526274625","waitRatioAvg":0.04205607476635514,"waitMsAvg":"9","waitRatioMax":0.06542056074766354,"waitMsMax":"14","readRatioAvg":0.4205607476635514,"readMsAvg":"90","readRatioMax":1,"readMsMax":"214","computeRatioAvg":0.13551401869158877,"computeMsAvg":"29","computeRatioMax":0.3411214953271028,"computeMsMax":"73","writeRatioAvg":0.018691588785046728,"writeMsAvg":"4","writeRatioMax":0.102803738317757,"writeMsMax":"22","shuffleOutputBytes":"32617984","shuffleOutputBytesSpilled":"0","recordsRead":"3714129","recordsWritten":"582464","parallelInputs":"91","completedParallelInputs":"91","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$30:hash, $31:from_address, $32:receipt_status, $33:block_timestamp","FROM bigquery-public-data.crypto_ethereum_classic.transactions","WHERE and(equal($32, 1), greater_or_equal($33, 1577836800.000000000), less($33, 1585699200.000000000))"]},{"kind":"AGGREGATE","substeps":["GROUP BY $150 := $31","$130 := COUNT($30)"]},{"kind":"WRITE","substeps":["$150, $130","TO __stage00_output","BY HASH($150)"]}],"slotMs":"17711","computeMode":"BIGQUERY"},{"name":"S01: Sort+","id":"1","startMs":"1762526274628","endMs":"1762526274668","inputStages":["0"],"waitRatioAvg":0.004672897196261682,"waitMsAvg":"1","waitRatioMax":0.004672897196261682,"waitMsMax":"1","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.13551401869158877,"computeMsAvg":"29","computeRatioMax":0.16822429906542055,"computeMsMax":"36","writeRatioAvg":0.004672897196261682,"writeMsAvg":"1","writeRatioMax":0.014018691588785047,"writeMsMax":"3","shuffleOutputBytes":"2520","shuffleOutputBytesSpilled":"0","recordsRead":"582464","recordsWritten":"45","parallelInputs":"9","completedParallelInputs":"9","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$150, $130","FROM __stage00_output"]},{"kind":"SORT","substeps":["$110 DESC","LIMIT 5"]},{"kind":"AGGREGATE","substeps":["GROUP BY $160 := $150","$110 := SUM_OF_COUNTS($130)"]},{"kind":"WRITE","substeps":["$170, $171","TO __stage01_output"]}],"slotMs":"411","computeMode":"BIGQUERY"},{"name":"S02: Sort","id":"2","startMs":"1762526274639","endMs":"1762526274673","inputStages":["1"],"waitRatioAvg":0.06542056074766354,"waitMsAvg":"14","waitRatioMax":0.06542056074766354,"waitMsMax":"14","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.06542056074766354,"computeMsAvg":"14","computeRatioMax":0.06542056074766354,"computeMsMax":"14","writeRatioAvg":0.014018691588785047,"writeMsAvg":"3","writeRatioMax":0.014018691588785047,"writeMsMax":"3","shuffleOutputBytes":"235","shuffleOutputBytesSpilled":"0","recordsRead":"45","recordsWritten":"5","parallelInputs":"1","completedParallelInputs":"1","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$170, $171","FROM __stage01_output"]},{"kind":"SORT","substeps":["$100 DESC","LIMIT 5"]},{"kind":"WRITE","substeps":["$220","TO __stage02_output"]}],"slotMs":"41","computeMode":"BIGQUERY"},{"name":"S04: Sort","id":"4","startMs":"1762526274664","endMs":"1762526274700","inputStages":["1"],"waitRatioAvg":0.028037383177570093,"waitMsAvg":"6","waitRatioMax":0.028037383177570093,"waitMsMax":"6","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.0514018691588785,"computeMsAvg":"11","computeRatioMax":0.0514018691588785,"computeMsMax":"11","writeRatioAvg":0.0794392523364486,"writeMsAvg":"17","writeRatioMax":0.0794392523364486,"writeMsMax":"17","shuffleOutputBytes":"235","shuffleOutputBytesSpilled":"0","recordsRead":"45","recordsWritten":"5","parallelInputs":"1","completedParallelInputs":"1","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$170, $171","FROM __stage01_output"]},{"kind":"SORT","substeps":["$171 DESC","LIMIT 5"]},{"kind":"WRITE","substeps":["$180","TO __stage04_output"]}],"slotMs":"73","computeMode":"BIGQUERY"},{"name":"S06: Coalesce","id":"6","startMs":"1762526274682","endMs":"1762526274742","inputStages":["2"],"waitRatioAvg":0.02336448598130841,"waitMsAvg":"5","waitRatioMax":0.028037383177570093,"waitMsMax":"6","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.04205607476635514,"computeMsAvg":"9","computeRatioMax":0.07476635514018691,"computeMsMax":"16","writeRatioAvg":0.056074766355140186,"writeMsAvg":"12","writeRatioMax":0.14018691588785046,"writeMsMax":"30","shuffleOutputBytes":"235","shuffleOutputBytesSpilled":"0","recordsRead":"5","recordsWritten":"5","parallelInputs":"100","completedParallelInputs":"100","status":"COMPLETE","steps":[{"kind":"READ","substeps":["FROM __stage02_output"]}],"slotMs":"6298","computeMode":"BIGQUERY"},{"name":"S07: Output","id":"7","startMs":"1762526274682","endMs":"1762526274731","inputStages":["2"],"waitRatioAvg":0.02336448598130841,"waitMsAvg":"5","waitRatioMax":0.028037383177570093,"waitMsMax":"6","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.04205607476635514,"computeMsAvg":"9","computeRatioMax":0.06542056074766354,"computeMsMax":"14","writeRatioAvg":0.02336448598130841,"writeMsAvg":"5","writeRatioMax":0.08878504672897196,"writeMsMax":"19","shuffleOutputBytes":"2075","shuffleOutputBytesSpilled":"0","recordsRead":"5","recordsWritten":"100","parallelInputs":"100","completedParallelInputs":"100","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$220","FROM __stage02_output"]},{"kind":"COMPUTE","substeps":["$291 := if(less_or_equal(array_length($287), 1000), $287, NULL)","$286 := if(greater(array_length($287), 1000), 1, 0)"]},{"kind":"AGGREGATE","substeps":["$284 := MIN($220)","$285 := MAX($220)","$287 := DISTINCT_ARRAY_AGG($288 LIMIT 1001)","$289 := MAX($290)"]},{"kind":"COMPUTE","substeps":["$288 := if(less_or_equal(length($220), 1024), $220, NULL)","$290 := length($220)"]},{"kind":"WRITE","substeps":["$284, $285, $286, $291, $289","TO __stage07_output"]}],"slotMs":"4935","computeMode":"BIGQUERY"},{"name":"S08: Coalesce","id":"8","startMs":"1762526274716","endMs":"1762526274778","inputStages":["4"],"waitRatioAvg":0.004672897196261682,"waitMsAvg":"1","waitRatioMax":0.009345794392523364,"waitMsMax":"2","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.04205607476635514,"computeMsAvg":"9","computeRatioMax":0.07476635514018691,"computeMsMax":"16","writeRatioAvg":0.06542056074766354,"writeMsAvg":"14","writeRatioMax":0.14018691588785046,"writeMsMax":"30","shuffleOutputBytes":"235","shuffleOutputBytesSpilled":"0","recordsRead":"5","recordsWritten":"5","parallelInputs":"100","completedParallelInputs":"100","status":"COMPLETE","steps":[{"kind":"READ","substeps":["FROM __stage04_output"]}],"slotMs":"6374","computeMode":"BIGQUERY"},{"name":"S09: Join+","id":"9","startMs":"1762526274731","endMs":"1762526274827","inputStages":["8"],"waitRatioAvg":0.028037383177570093,"waitMsAvg":"6","waitRatioMax":0.056074766355140186,"waitMsMax":"12","readRatioAvg":0.04205607476635514,"readMsAvg":"9","readRatioMax":0.08878504672897196,"readMsMax":"19","computeRatioAvg":0.102803738317757,"computeMsAvg":"22","computeRatioMax":0.16822429906542055,"computeMsMax":"36","writeRatioAvg":0.018691588785046728,"writeMsAvg":"4","writeRatioMax":0.06542056074766354,"writeMsMax":"14","shuffleOutputBytes":"27328","shuffleOutputBytesSpilled":"0","recordsRead":"3714584","recordsWritten":"427","parallelInputs":"91","completedParallelInputs":"91","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$10:from_address, $11:gas_price, $12:receipt_gas_used, $13:receipt_status, $14:block_timestamp","FROM bigquery-public-data.crypto_ethereum_classic.transactions","WHERE and(greater_or_equal($14, 1577836800.000000000), less($14, 1585699200.000000000), equal($13, 1))"]},{"kind":"READ","substeps":["$180","FROM __stage08_output"]},{"kind":"AGGREGATE","substeps":["GROUP BY $200 := $190","$70 := SUM($90)"]},{"kind":"COMPUTE","substeps":["$90 := multiply(CAST($191 AS NUMERIC), CAST($192 AS NUMERIC))"]},{"kind":"JOIN","substeps":["$190 := $10, $191 := $11, $192 := $12","INNER HASH JOIN EACH  WITH ALL  ON $10 = $180"]},{"kind":"WRITE","substeps":["$200, $70","TO __stage09_output","BY HASH($200)"]}],"slotMs":"8513","computeMode":"BIGQUERY"},{"name":"S0A: Join+","id":"10","startMs":"1762526274753","endMs":"1762526274948","inputStages":["6"],"waitRatioAvg":0.004672897196261682,"waitMsAvg":"1","waitRatioMax":0.009345794392523364,"waitMsMax":"2","readRatioAvg":0.2102803738317757,"readMsAvg":"45","readRatioMax":0.6495327102803738,"readMsMax":"139","computeRatioAvg":0.14953271028037382,"computeMsAvg":"32","computeRatioMax":0.35514018691588783,"computeMsMax":"76","writeRatioAvg":0.018691588785046728,"writeMsAvg":"4","writeRatioMax":0.06542056074766354,"writeMsMax":"14","shuffleOutputBytes":"27328","shuffleOutputBytesSpilled":"0","recordsRead":"15994372","recordsWritten":"427","parallelInputs":"91","completedParallelInputs":"91","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$1:from_address, $2:value, $3:block_timestamp","FROM bigquery-public-data.crypto_ethereum_classic.traces","WHERE and(greater_or_equal($3, 1577836800.000000000), less($3, 1585699200.000000000), ...)"]},{"kind":"READ","substeps":["$220","FROM __stage06_output"]},{"kind":"AGGREGATE","substeps":["GROUP BY $240 := $230","$80 := SUM($231)"]},{"kind":"JOIN","substeps":["$230 := $1, $231 := $2","INNER HASH JOIN EACH  WITH ALL  ON $1 = $220"]},{"kind":"WRITE","substeps":["$240, $80","TO __stage0A_output","BY HASH($240)"]}],"slotMs":"9600","computeMode":"BIGQUERY"},{"name":"S0B: Aggregate","id":"11","startMs":"1762526274969","endMs":"1762526275002","inputStages":["10"],"waitRatioAvg":0.004672897196261682,"waitMsAvg":"1","waitRatioMax":0.004672897196261682,"waitMsMax":"1","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.0514018691588785,"computeMsAvg":"11","computeRatioMax":0.0794392523364486,"computeMsMax":"17","writeRatioAvg":0.08878504672897196,"writeMsAvg":"19","writeRatioMax":0.11214953271028037,"writeMsMax":"24","shuffleOutputBytes":"320","shuffleOutputBytesSpilled":"0","recordsRead":"427","recordsWritten":"5","parallelInputs":"9","completedParallelInputs":"9","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$240, $80","FROM __stage0A_output"]},{"kind":"AGGREGATE","substeps":["GROUP BY $250 := $240","$60 := SUM($80)"]},{"kind":"WRITE","substeps":["$60, $250","TO __stage0B_output"]}],"slotMs":"438","computeMode":"BIGQUERY"},{"name":"S0D: Coalesce","id":"13","startMs":"1762526275014","endMs":"1762526275070","inputStages":["11"],"waitRatioAvg":0.02336448598130841,"waitMsAvg":"5","waitRatioMax":0.028037383177570093,"waitMsMax":"6","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.04672897196261682,"computeMsAvg":"10","computeRatioMax":0.07009345794392523,"computeMsMax":"15","writeRatioAvg":0.07009345794392523,"writeMsAvg":"15","writeRatioMax":0.1542056074766355,"writeMsMax":"33","shuffleOutputBytes":"320","shuffleOutputBytesSpilled":"0","recordsRead":"5","recordsWritten":"5","parallelInputs":"100","completedParallelInputs":"100","status":"COMPLETE","steps":[{"kind":"READ","substeps":["FROM __stage0B_output"]}],"slotMs":"6541","computeMode":"BIGQUERY"},{"name":"S0E: Join+","id":"14","startMs":"1762526275017","endMs":"1762526275086","inputStages":["13","9"],"waitRatioAvg":0.02336448598130841,"waitMsAvg":"5","waitRatioMax":0.02336448598130841,"waitMsMax":"5","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.056074766355140186,"computeMsAvg":"12","computeRatioMax":0.08878504672897196,"computeMsMax":"19","writeRatioAvg":0.037383177570093455,"writeMsAvg":"8","writeRatioMax":0.0794392523364486,"writeMsMax":"17","shuffleOutputBytes":"490","shuffleOutputBytesSpilled":"0","recordsRead":"447","recordsWritten":"5","parallelInputs":"9","completedParallelInputs":"9","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$200, $70","FROM __stage09_output"]},{"kind":"READ","substeps":["$60, $250","FROM __stage0D_output"]},{"kind":"SORT","substeps":["$40 DESC","LIMIT 100"]},{"kind":"COMPUTE","substeps":["$40 := subtract($262, $261)"]},{"kind":"JOIN","substeps":["$260 := $210, $261 := $50, $262 := $60","INNER HASH JOIN EACH  WITH ALL  ON $210 = $250"]},{"kind":"AGGREGATE","substeps":["GROUP BY $210 := $200","$50 := SUM($70)"]},{"kind":"WRITE","substeps":["$270, $271, $272, $273","TO __stage0E_output"]}],"slotMs":"686","computeMode":"BIGQUERY"},{"name":"S0F: Output","id":"15","startMs":"1762526275022","endMs":"1762526275099","inputStages":["14"],"waitRatioAvg":0.06074766355140187,"waitMsAvg":"13","waitRatioMax":0.06074766355140187,"waitMsMax":"13","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.03271028037383177,"computeMsAvg":"7","computeRatioMax":0.03271028037383177,"computeMsMax":"7","writeRatioAvg":0.02336448598130841,"writeMsAvg":"5","writeRatioMax":0.02336448598130841,"writeMsMax":"5","shuffleOutputBytes":"490","shuffleOutputBytesSpilled":"0","recordsRead":"5","recordsWritten":"5","parallelInputs":"1","completedParallelInputs":"1","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$270, $271, $272, $273","FROM __stage0E_output"]},{"kind":"SORT","substeps":["$271 DESC","LIMIT 100"]},{"kind":"WRITE","substeps":["$280, $281, $282, $283","TO __stage0F_output"]}],"slotMs":"20","computeMode":"BIGQUERY"}],"estimatedBytesProcessed":"1594954856","timeline":[{"elapsedMs":"934","totalSlotMs":"62325","pendingUnits":"1","completedUnits":"583","activeUnits":"3","estimatedRunnableUnits":"0"},{"elapsedMs":"1041","totalSlotMs":"62325","pendingUnits":"0","completedUnits":"703","estimatedRunnableUnits":"0"}],"totalPartitionsProcessed":"182","totalBytesProcessed":"1594954856","totalBytesBilled":"1595932672","billingTier":1,"totalSlotMs":"62325","cacheHit":false,"referencedTables":[{"projectId":"bigquery-public-data","datasetId":"crypto_ethereum_classic","tableId":"transactions"},{"projectId":"bigquery-public-data","datasetId":"crypto_ethereum_classic","tableId":"traces"}],"statementType":"SELECT","searchStatistics":{"indexUsageMode":"UNUSED","indexUnusedReasons":[{"code":"INDEX_CONFIG_NOT_AVAILABLE","message":"There is no index configuration for the base table `bigquery-public-data:crypto_ethereum_classic.traces`.","baseTable":{"projectId":"bigquery-public-data","datasetId":"crypto_ethereum_classic","tableId":"traces"}},{"code":"INDEX_CONFIG_NOT_AVAILABLE","message":"There is no index configuration for the base table `bigquery-public-data:crypto_ethereum_classic.transactions`.","baseTable":{"projectId":"bigquery-public-data","datasetId":"crypto_ethereum_classic","tableId":"transactions"}}]},"transferredBytes":"0","metadataCacheStatistics":{"tableMetadataCacheUsage":[{"tableReference":{"projectId":"bigquery-public-data","datasetId":"crypto_ethereum_classic","tableId":"transactions"},"unusedReason":"OTHER_REASON"},{"tableReference":{"projectId":"bigquery-public-data","datasetId":"crypto_ethereum_classic","tableId":"traces"},"unusedReason":"OTHER_REASON"}]}},"totalSlotMs":"62325","finalExecutionDurationMs":"750"},"status":{"state":"DONE"},"principal_subject":"user:admin@bentrollope.altostrat.com","jobCreationReason":{"code":"REQUESTED"}}'
++ jq -r .jobReference.jobId
++ echo '{"kind":"bigquery#job","etag":"lHAcpsk46IDNuBeY0R2i1A==","id":"tony-allen:US.bqjob_r7af22a93cb588faa_0000019a5ec0a0bd_1","selfLink":"https://bigquery.googleapis.com/bigquery/v2/projects/tony-allen/jobs/bqjob_r7af22a93cb588faa_0000019a5ec0a0bd_1?location=US","user_email":"admin@bentrollope.altostrat.com","configuration":{"query":{"query":"WITH TopSenders AS (\n    -- CTE 1: Identify the top 5 addresses based on the count of successful transactions\n    SELECT\n        t.from_address AS address,\n        COUNT(t.hash) AS transaction_count\n    FROM\n        `bigquery-public-data.crypto_ethereum_classic.transactions` AS t\n    WHERE\n        t.receipt_status = 1 \n        AND t.block_timestamp >= '\''2020-01-01 00:00:00 UTC'\'' \n        AND t.block_timestamp < '\''2020-04-01 00:00:00 UTC'\''  \n    GROUP BY\n        1\n    ORDER BY\n        transaction_count DESC\n    LIMIT 5\n),\n\nTotalFees AS (\n    -- CTE 2: Requires a second scan of the '\''transactions'\'' table unnecessarily\n    SELECT\n        t.from_address AS address,\n        SUM(CAST(t.gas_price AS NUMERIC) * CAST(t.receipt_gas_used AS NUMERIC)) AS total_fees_paid\n    FROM\n        `bigquery-public-data.crypto_ethereum_classic.transactions` AS t\n    INNER JOIN\n        TopSenders AS s ON t.from_address = s.address\n    WHERE\n        t.block_timestamp >= '\''2020-01-01 00:00:00 UTC'\''\n        AND t.block_timestamp < '\''2020-04-01 00:00:00 UTC'\''\n        AND t.receipt_status = 1\n    GROUP BY\n        1\n),\n\nTotalValueSent AS (\n    -- CTE 3: Scans the '\''traces'\'' table\n    SELECT\n        tr.from_address AS address,\n        SUM(tr.value) AS total_value_sent\n    FROM\n        `bigquery-public-data.crypto_ethereum_classic.traces` AS tr\n    INNER JOIN\n        TopSenders AS s ON tr.from_address = s.address\n    WHERE\n        tr.block_timestamp >= '\''2020-01-01 00:00:00 UTC'\''  \n        AND tr.block_timestamp < '\''2020-04-01 00:00:00 UTC'\'' \n    GROUP BY\n        1\n)\n\n-- Final SELECT: Joins the calculated fees and values to find the net ether flow\nSELECT\n    f.address,\n    v.total_value_sent,\n    f.total_fees_paid,\n    v.total_value_sent - f.total_fees_paid AS net_ether_flow_wei\nFROM\n    TotalFees AS f\nINNER JOIN\n    TotalValueSent AS v ON f.address = v.address\nORDER BY\n    net_ether_flow_wei DESC\nLIMIT 100","destinationTable":{"projectId":"tony-allen","datasetId":"_e34c49c766e4fd3f5d404c3949b9e19fa7acb372","tableId":"anonc5ee9f31_131e_4177_b506_9f08344248e5"},"writeDisposition":"WRITE_TRUNCATE","priority":"INTERACTIVE","useQueryCache":false,"useLegacySql":false},"jobType":"QUERY"},"jobReference":{"projectId":"tony-allen","jobId":"bqjob_r7af22a93cb588faa_0000019a5ec0a0bd_1","location":"US"},"statistics":{"creationTime":"1762526273968","startTime":"1762526274066","endTime":"1762526275330","totalBytesProcessed":"1594954856","query":{"queryPlan":[{"name":"S00: Input","id":"0","startMs":"1762526274393","endMs":"1762526274625","waitRatioAvg":0.04205607476635514,"waitMsAvg":"9","waitRatioMax":0.06542056074766354,"waitMsMax":"14","readRatioAvg":0.4205607476635514,"readMsAvg":"90","readRatioMax":1,"readMsMax":"214","computeRatioAvg":0.13551401869158877,"computeMsAvg":"29","computeRatioMax":0.3411214953271028,"computeMsMax":"73","writeRatioAvg":0.018691588785046728,"writeMsAvg":"4","writeRatioMax":0.102803738317757,"writeMsMax":"22","shuffleOutputBytes":"32617984","shuffleOutputBytesSpilled":"0","recordsRead":"3714129","recordsWritten":"582464","parallelInputs":"91","completedParallelInputs":"91","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$30:hash, $31:from_address, $32:receipt_status, $33:block_timestamp","FROM bigquery-public-data.crypto_ethereum_classic.transactions","WHERE and(equal($32, 1), greater_or_equal($33, 1577836800.000000000), less($33, 1585699200.000000000))"]},{"kind":"AGGREGATE","substeps":["GROUP BY $150 := $31","$130 := COUNT($30)"]},{"kind":"WRITE","substeps":["$150, $130","TO __stage00_output","BY HASH($150)"]}],"slotMs":"17711","computeMode":"BIGQUERY"},{"name":"S01: Sort+","id":"1","startMs":"1762526274628","endMs":"1762526274668","inputStages":["0"],"waitRatioAvg":0.004672897196261682,"waitMsAvg":"1","waitRatioMax":0.004672897196261682,"waitMsMax":"1","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.13551401869158877,"computeMsAvg":"29","computeRatioMax":0.16822429906542055,"computeMsMax":"36","writeRatioAvg":0.004672897196261682,"writeMsAvg":"1","writeRatioMax":0.014018691588785047,"writeMsMax":"3","shuffleOutputBytes":"2520","shuffleOutputBytesSpilled":"0","recordsRead":"582464","recordsWritten":"45","parallelInputs":"9","completedParallelInputs":"9","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$150, $130","FROM __stage00_output"]},{"kind":"SORT","substeps":["$110 DESC","LIMIT 5"]},{"kind":"AGGREGATE","substeps":["GROUP BY $160 := $150","$110 := SUM_OF_COUNTS($130)"]},{"kind":"WRITE","substeps":["$170, $171","TO __stage01_output"]}],"slotMs":"411","computeMode":"BIGQUERY"},{"name":"S02: Sort","id":"2","startMs":"1762526274639","endMs":"1762526274673","inputStages":["1"],"waitRatioAvg":0.06542056074766354,"waitMsAvg":"14","waitRatioMax":0.06542056074766354,"waitMsMax":"14","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.06542056074766354,"computeMsAvg":"14","computeRatioMax":0.06542056074766354,"computeMsMax":"14","writeRatioAvg":0.014018691588785047,"writeMsAvg":"3","writeRatioMax":0.014018691588785047,"writeMsMax":"3","shuffleOutputBytes":"235","shuffleOutputBytesSpilled":"0","recordsRead":"45","recordsWritten":"5","parallelInputs":"1","completedParallelInputs":"1","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$170, $171","FROM __stage01_output"]},{"kind":"SORT","substeps":["$100 DESC","LIMIT 5"]},{"kind":"WRITE","substeps":["$220","TO __stage02_output"]}],"slotMs":"41","computeMode":"BIGQUERY"},{"name":"S04: Sort","id":"4","startMs":"1762526274664","endMs":"1762526274700","inputStages":["1"],"waitRatioAvg":0.028037383177570093,"waitMsAvg":"6","waitRatioMax":0.028037383177570093,"waitMsMax":"6","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.0514018691588785,"computeMsAvg":"11","computeRatioMax":0.0514018691588785,"computeMsMax":"11","writeRatioAvg":0.0794392523364486,"writeMsAvg":"17","writeRatioMax":0.0794392523364486,"writeMsMax":"17","shuffleOutputBytes":"235","shuffleOutputBytesSpilled":"0","recordsRead":"45","recordsWritten":"5","parallelInputs":"1","completedParallelInputs":"1","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$170, $171","FROM __stage01_output"]},{"kind":"SORT","substeps":["$171 DESC","LIMIT 5"]},{"kind":"WRITE","substeps":["$180","TO __stage04_output"]}],"slotMs":"73","computeMode":"BIGQUERY"},{"name":"S06: Coalesce","id":"6","startMs":"1762526274682","endMs":"1762526274742","inputStages":["2"],"waitRatioAvg":0.02336448598130841,"waitMsAvg":"5","waitRatioMax":0.028037383177570093,"waitMsMax":"6","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.04205607476635514,"computeMsAvg":"9","computeRatioMax":0.07476635514018691,"computeMsMax":"16","writeRatioAvg":0.056074766355140186,"writeMsAvg":"12","writeRatioMax":0.14018691588785046,"writeMsMax":"30","shuffleOutputBytes":"235","shuffleOutputBytesSpilled":"0","recordsRead":"5","recordsWritten":"5","parallelInputs":"100","completedParallelInputs":"100","status":"COMPLETE","steps":[{"kind":"READ","substeps":["FROM __stage02_output"]}],"slotMs":"6298","computeMode":"BIGQUERY"},{"name":"S07: Output","id":"7","startMs":"1762526274682","endMs":"1762526274731","inputStages":["2"],"waitRatioAvg":0.02336448598130841,"waitMsAvg":"5","waitRatioMax":0.028037383177570093,"waitMsMax":"6","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.04205607476635514,"computeMsAvg":"9","computeRatioMax":0.06542056074766354,"computeMsMax":"14","writeRatioAvg":0.02336448598130841,"writeMsAvg":"5","writeRatioMax":0.08878504672897196,"writeMsMax":"19","shuffleOutputBytes":"2075","shuffleOutputBytesSpilled":"0","recordsRead":"5","recordsWritten":"100","parallelInputs":"100","completedParallelInputs":"100","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$220","FROM __stage02_output"]},{"kind":"COMPUTE","substeps":["$291 := if(less_or_equal(array_length($287), 1000), $287, NULL)","$286 := if(greater(array_length($287), 1000), 1, 0)"]},{"kind":"AGGREGATE","substeps":["$284 := MIN($220)","$285 := MAX($220)","$287 := DISTINCT_ARRAY_AGG($288 LIMIT 1001)","$289 := MAX($290)"]},{"kind":"COMPUTE","substeps":["$288 := if(less_or_equal(length($220), 1024), $220, NULL)","$290 := length($220)"]},{"kind":"WRITE","substeps":["$284, $285, $286, $291, $289","TO __stage07_output"]}],"slotMs":"4935","computeMode":"BIGQUERY"},{"name":"S08: Coalesce","id":"8","startMs":"1762526274716","endMs":"1762526274778","inputStages":["4"],"waitRatioAvg":0.004672897196261682,"waitMsAvg":"1","waitRatioMax":0.009345794392523364,"waitMsMax":"2","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.04205607476635514,"computeMsAvg":"9","computeRatioMax":0.07476635514018691,"computeMsMax":"16","writeRatioAvg":0.06542056074766354,"writeMsAvg":"14","writeRatioMax":0.14018691588785046,"writeMsMax":"30","shuffleOutputBytes":"235","shuffleOutputBytesSpilled":"0","recordsRead":"5","recordsWritten":"5","parallelInputs":"100","completedParallelInputs":"100","status":"COMPLETE","steps":[{"kind":"READ","substeps":["FROM __stage04_output"]}],"slotMs":"6374","computeMode":"BIGQUERY"},{"name":"S09: Join+","id":"9","startMs":"1762526274731","endMs":"1762526274827","inputStages":["8"],"waitRatioAvg":0.028037383177570093,"waitMsAvg":"6","waitRatioMax":0.056074766355140186,"waitMsMax":"12","readRatioAvg":0.04205607476635514,"readMsAvg":"9","readRatioMax":0.08878504672897196,"readMsMax":"19","computeRatioAvg":0.102803738317757,"computeMsAvg":"22","computeRatioMax":0.16822429906542055,"computeMsMax":"36","writeRatioAvg":0.018691588785046728,"writeMsAvg":"4","writeRatioMax":0.06542056074766354,"writeMsMax":"14","shuffleOutputBytes":"27328","shuffleOutputBytesSpilled":"0","recordsRead":"3714584","recordsWritten":"427","parallelInputs":"91","completedParallelInputs":"91","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$10:from_address, $11:gas_price, $12:receipt_gas_used, $13:receipt_status, $14:block_timestamp","FROM bigquery-public-data.crypto_ethereum_classic.transactions","WHERE and(greater_or_equal($14, 1577836800.000000000), less($14, 1585699200.000000000), equal($13, 1))"]},{"kind":"READ","substeps":["$180","FROM __stage08_output"]},{"kind":"AGGREGATE","substeps":["GROUP BY $200 := $190","$70 := SUM($90)"]},{"kind":"COMPUTE","substeps":["$90 := multiply(CAST($191 AS NUMERIC), CAST($192 AS NUMERIC))"]},{"kind":"JOIN","substeps":["$190 := $10, $191 := $11, $192 := $12","INNER HASH JOIN EACH  WITH ALL  ON $10 = $180"]},{"kind":"WRITE","substeps":["$200, $70","TO __stage09_output","BY HASH($200)"]}],"slotMs":"8513","computeMode":"BIGQUERY"},{"name":"S0A: Join+","id":"10","startMs":"1762526274753","endMs":"1762526274948","inputStages":["6"],"waitRatioAvg":0.004672897196261682,"waitMsAvg":"1","waitRatioMax":0.009345794392523364,"waitMsMax":"2","readRatioAvg":0.2102803738317757,"readMsAvg":"45","readRatioMax":0.6495327102803738,"readMsMax":"139","computeRatioAvg":0.14953271028037382,"computeMsAvg":"32","computeRatioMax":0.35514018691588783,"computeMsMax":"76","writeRatioAvg":0.018691588785046728,"writeMsAvg":"4","writeRatioMax":0.06542056074766354,"writeMsMax":"14","shuffleOutputBytes":"27328","shuffleOutputBytesSpilled":"0","recordsRead":"15994372","recordsWritten":"427","parallelInputs":"91","completedParallelInputs":"91","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$1:from_address, $2:value, $3:block_timestamp","FROM bigquery-public-data.crypto_ethereum_classic.traces","WHERE and(greater_or_equal($3, 1577836800.000000000), less($3, 1585699200.000000000), ...)"]},{"kind":"READ","substeps":["$220","FROM __stage06_output"]},{"kind":"AGGREGATE","substeps":["GROUP BY $240 := $230","$80 := SUM($231)"]},{"kind":"JOIN","substeps":["$230 := $1, $231 := $2","INNER HASH JOIN EACH  WITH ALL  ON $1 = $220"]},{"kind":"WRITE","substeps":["$240, $80","TO __stage0A_output","BY HASH($240)"]}],"slotMs":"9600","computeMode":"BIGQUERY"},{"name":"S0B: Aggregate","id":"11","startMs":"1762526274969","endMs":"1762526275002","inputStages":["10"],"waitRatioAvg":0.004672897196261682,"waitMsAvg":"1","waitRatioMax":0.004672897196261682,"waitMsMax":"1","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.0514018691588785,"computeMsAvg":"11","computeRatioMax":0.0794392523364486,"computeMsMax":"17","writeRatioAvg":0.08878504672897196,"writeMsAvg":"19","writeRatioMax":0.11214953271028037,"writeMsMax":"24","shuffleOutputBytes":"320","shuffleOutputBytesSpilled":"0","recordsRead":"427","recordsWritten":"5","parallelInputs":"9","completedParallelInputs":"9","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$240, $80","FROM __stage0A_output"]},{"kind":"AGGREGATE","substeps":["GROUP BY $250 := $240","$60 := SUM($80)"]},{"kind":"WRITE","substeps":["$60, $250","TO __stage0B_output"]}],"slotMs":"438","computeMode":"BIGQUERY"},{"name":"S0D: Coalesce","id":"13","startMs":"1762526275014","endMs":"1762526275070","inputStages":["11"],"waitRatioAvg":0.02336448598130841,"waitMsAvg":"5","waitRatioMax":0.028037383177570093,"waitMsMax":"6","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.04672897196261682,"computeMsAvg":"10","computeRatioMax":0.07009345794392523,"computeMsMax":"15","writeRatioAvg":0.07009345794392523,"writeMsAvg":"15","writeRatioMax":0.1542056074766355,"writeMsMax":"33","shuffleOutputBytes":"320","shuffleOutputBytesSpilled":"0","recordsRead":"5","recordsWritten":"5","parallelInputs":"100","completedParallelInputs":"100","status":"COMPLETE","steps":[{"kind":"READ","substeps":["FROM __stage0B_output"]}],"slotMs":"6541","computeMode":"BIGQUERY"},{"name":"S0E: Join+","id":"14","startMs":"1762526275017","endMs":"1762526275086","inputStages":["13","9"],"waitRatioAvg":0.02336448598130841,"waitMsAvg":"5","waitRatioMax":0.02336448598130841,"waitMsMax":"5","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.056074766355140186,"computeMsAvg":"12","computeRatioMax":0.08878504672897196,"computeMsMax":"19","writeRatioAvg":0.037383177570093455,"writeMsAvg":"8","writeRatioMax":0.0794392523364486,"writeMsMax":"17","shuffleOutputBytes":"490","shuffleOutputBytesSpilled":"0","recordsRead":"447","recordsWritten":"5","parallelInputs":"9","completedParallelInputs":"9","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$200, $70","FROM __stage09_output"]},{"kind":"READ","substeps":["$60, $250","FROM __stage0D_output"]},{"kind":"SORT","substeps":["$40 DESC","LIMIT 100"]},{"kind":"COMPUTE","substeps":["$40 := subtract($262, $261)"]},{"kind":"JOIN","substeps":["$260 := $210, $261 := $50, $262 := $60","INNER HASH JOIN EACH  WITH ALL  ON $210 = $250"]},{"kind":"AGGREGATE","substeps":["GROUP BY $210 := $200","$50 := SUM($70)"]},{"kind":"WRITE","substeps":["$270, $271, $272, $273","TO __stage0E_output"]}],"slotMs":"686","computeMode":"BIGQUERY"},{"name":"S0F: Output","id":"15","startMs":"1762526275022","endMs":"1762526275099","inputStages":["14"],"waitRatioAvg":0.06074766355140187,"waitMsAvg":"13","waitRatioMax":0.06074766355140187,"waitMsMax":"13","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.03271028037383177,"computeMsAvg":"7","computeRatioMax":0.03271028037383177,"computeMsMax":"7","writeRatioAvg":0.02336448598130841,"writeMsAvg":"5","writeRatioMax":0.02336448598130841,"writeMsMax":"5","shuffleOutputBytes":"490","shuffleOutputBytesSpilled":"0","recordsRead":"5","recordsWritten":"5","parallelInputs":"1","completedParallelInputs":"1","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$270, $271, $272, $273","FROM __stage0E_output"]},{"kind":"SORT","substeps":["$271 DESC","LIMIT 100"]},{"kind":"WRITE","substeps":["$280, $281, $282, $283","TO __stage0F_output"]}],"slotMs":"20","computeMode":"BIGQUERY"}],"estimatedBytesProcessed":"1594954856","timeline":[{"elapsedMs":"934","totalSlotMs":"62325","pendingUnits":"1","completedUnits":"583","activeUnits":"3","estimatedRunnableUnits":"0"},{"elapsedMs":"1041","totalSlotMs":"62325","pendingUnits":"0","completedUnits":"703","estimatedRunnableUnits":"0"}],"totalPartitionsProcessed":"182","totalBytesProcessed":"1594954856","totalBytesBilled":"1595932672","billingTier":1,"totalSlotMs":"62325","cacheHit":false,"referencedTables":[{"projectId":"bigquery-public-data","datasetId":"crypto_ethereum_classic","tableId":"transactions"},{"projectId":"bigquery-public-data","datasetId":"crypto_ethereum_classic","tableId":"traces"}],"statementType":"SELECT","searchStatistics":{"indexUsageMode":"UNUSED","indexUnusedReasons":[{"code":"INDEX_CONFIG_NOT_AVAILABLE","message":"There is no index configuration for the base table `bigquery-public-data:crypto_ethereum_classic.traces`.","baseTable":{"projectId":"bigquery-public-data","datasetId":"crypto_ethereum_classic","tableId":"traces"}},{"code":"INDEX_CONFIG_NOT_AVAILABLE","message":"There is no index configuration for the base table `bigquery-public-data:crypto_ethereum_classic.transactions`.","baseTable":{"projectId":"bigquery-public-data","datasetId":"crypto_ethereum_classic","tableId":"transactions"}}]},"transferredBytes":"0","metadataCacheStatistics":{"tableMetadataCacheUsage":[{"tableReference":{"projectId":"bigquery-public-data","datasetId":"crypto_ethereum_classic","tableId":"transactions"},"unusedReason":"OTHER_REASON"},{"tableReference":{"projectId":"bigquery-public-data","datasetId":"crypto_ethereum_classic","tableId":"traces"},"unusedReason":"OTHER_REASON"}]}},"totalSlotMs":"62325","finalExecutionDurationMs":"750"},"status":{"state":"DONE"},"principal_subject":"user:admin@bentrollope.altostrat.com","jobCreationReason":{"code":"REQUESTED"}}'
+ job_id=bqjob_r7af22a93cb588faa_0000019a5ec0a0bd_1
+ '[' -n bqjob_r7af22a93cb588faa_0000019a5ec0a0bd_1 ']'
+ echo '  [SUCCESS] Query submitted.'
  [SUCCESS] Query submitted.
+ echo '  *** JOB ID FOR Top Sender Unoptimized: bqjob_r7af22a93cb588faa_0000019a5ec0a0bd_1 ***'
  *** JOB ID FOR Top Sender Unoptimized: bqjob_r7af22a93cb588faa_0000019a5ec0a0bd_1 ***
+ echo '  Waiting for job to complete...'
  Waiting for job to complete...
++ bq wait bqjob_r7af22a93cb588faa_0000019a5ec0a0bd_1
+ wait_output='Waiting on bqjob_r7af22a93cb588faa_0000019a5ec0a0bd_1 ... (0s) Current status: DONE   
Job tony-allen:bqjob_r7af22a93cb588faa_0000019a5ec0a0bd_1

  Job Type    State      Start Time         Duration                User Email              Bytes Processed   Bytes Billed   Billing Tier   Labels  
 ---------- --------- ----------------- ---------------- --------------------------------- ----------------- -------------- -------------- -------- 
  query      SUCCESS   07 Nov 14:37:54   0:00:01.264000   admin@bentrollope.altostrat.com   1594954856        1595932672     1                      '
+ '[' 0 -ne 0 ']'
+ echo '  Job completed. Fetching statistics...'
  Job completed. Fetching statistics...
++ bq show --format=json -j bqjob_r7af22a93cb588faa_0000019a5ec0a0bd_1
+ job_stats_json='{"kind":"bigquery#job","etag":"FmaAPsb+BGvS0Vv40DeGOg==","id":"tony-allen:US.bqjob_r7af22a93cb588faa_0000019a5ec0a0bd_1","selfLink":"https://bigquery.googleapis.com/bigquery/v2/projects/tony-allen/jobs/bqjob_r7af22a93cb588faa_0000019a5ec0a0bd_1?location=US","user_email":"admin@bentrollope.altostrat.com","configuration":{"query":{"query":"WITH TopSenders AS (\n    -- CTE 1: Identify the top 5 addresses based on the count of successful transactions\n    SELECT\n        t.from_address AS address,\n        COUNT(t.hash) AS transaction_count\n    FROM\n        `bigquery-public-data.crypto_ethereum_classic.transactions` AS t\n    WHERE\n        t.receipt_status = 1 \n        AND t.block_timestamp >= '\''2020-01-01 00:00:00 UTC'\'' \n        AND t.block_timestamp < '\''2020-04-01 00:00:00 UTC'\''  \n    GROUP BY\n        1\n    ORDER BY\n        transaction_count DESC\n    LIMIT 5\n),\n\nTotalFees AS (\n    -- CTE 2: Requires a second scan of the '\''transactions'\'' table unnecessarily\n    SELECT\n        t.from_address AS address,\n        SUM(CAST(t.gas_price AS NUMERIC) * CAST(t.receipt_gas_used AS NUMERIC)) AS total_fees_paid\n    FROM\n        `bigquery-public-data.crypto_ethereum_classic.transactions` AS t\n    INNER JOIN\n        TopSenders AS s ON t.from_address = s.address\n    WHERE\n        t.block_timestamp >= '\''2020-01-01 00:00:00 UTC'\''\n        AND t.block_timestamp < '\''2020-04-01 00:00:00 UTC'\''\n        AND t.receipt_status = 1\n    GROUP BY\n        1\n),\n\nTotalValueSent AS (\n    -- CTE 3: Scans the '\''traces'\'' table\n    SELECT\n        tr.from_address AS address,\n        SUM(tr.value) AS total_value_sent\n    FROM\n        `bigquery-public-data.crypto_ethereum_classic.traces` AS tr\n    INNER JOIN\n        TopSenders AS s ON tr.from_address = s.address\n    WHERE\n        tr.block_timestamp >= '\''2020-01-01 00:00:00 UTC'\''  \n        AND tr.block_timestamp < '\''2020-04-01 00:00:00 UTC'\'' \n    GROUP BY\n        1\n)\n\n-- Final SELECT: Joins the calculated fees and values to find the net ether flow\nSELECT\n    f.address,\n    v.total_value_sent,\n    f.total_fees_paid,\n    v.total_value_sent - f.total_fees_paid AS net_ether_flow_wei\nFROM\n    TotalFees AS f\nINNER JOIN\n    TotalValueSent AS v ON f.address = v.address\nORDER BY\n    net_ether_flow_wei DESC\nLIMIT 100","destinationTable":{"projectId":"tony-allen","datasetId":"_e34c49c766e4fd3f5d404c3949b9e19fa7acb372","tableId":"anonc5ee9f31_131e_4177_b506_9f08344248e5"},"writeDisposition":"WRITE_TRUNCATE","priority":"INTERACTIVE","useQueryCache":false,"useLegacySql":false},"jobType":"QUERY"},"jobReference":{"projectId":"tony-allen","jobId":"bqjob_r7af22a93cb588faa_0000019a5ec0a0bd_1","location":"US"},"statistics":{"creationTime":"1762526273968","startTime":"1762526274066","endTime":"1762526275330","totalBytesProcessed":"1594954856","query":{"queryPlan":[{"name":"S00: Input","id":"0","startMs":"1762526274393","endMs":"1762526274625","waitRatioAvg":0.04205607476635514,"waitMsAvg":"9","waitRatioMax":0.06542056074766354,"waitMsMax":"14","readRatioAvg":0.4205607476635514,"readMsAvg":"90","readRatioMax":1,"readMsMax":"214","computeRatioAvg":0.13551401869158877,"computeMsAvg":"29","computeRatioMax":0.3411214953271028,"computeMsMax":"73","writeRatioAvg":0.018691588785046728,"writeMsAvg":"4","writeRatioMax":0.102803738317757,"writeMsMax":"22","shuffleOutputBytes":"32617984","shuffleOutputBytesSpilled":"0","recordsRead":"3714129","recordsWritten":"582464","parallelInputs":"91","completedParallelInputs":"91","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$30:hash, $31:from_address, $32:receipt_status, $33:block_timestamp","FROM bigquery-public-data.crypto_ethereum_classic.transactions","WHERE and(equal($32, 1), greater_or_equal($33, 1577836800.000000000), less($33, 1585699200.000000000))"]},{"kind":"AGGREGATE","substeps":["GROUP BY $150 := $31","$130 := COUNT($30)"]},{"kind":"WRITE","substeps":["$150, $130","TO __stage00_output","BY HASH($150)"]}],"slotMs":"17711","computeMode":"BIGQUERY"},{"name":"S01: Sort+","id":"1","startMs":"1762526274628","endMs":"1762526274668","inputStages":["0"],"waitRatioAvg":0.004672897196261682,"waitMsAvg":"1","waitRatioMax":0.004672897196261682,"waitMsMax":"1","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.13551401869158877,"computeMsAvg":"29","computeRatioMax":0.16822429906542055,"computeMsMax":"36","writeRatioAvg":0.004672897196261682,"writeMsAvg":"1","writeRatioMax":0.014018691588785047,"writeMsMax":"3","shuffleOutputBytes":"2520","shuffleOutputBytesSpilled":"0","recordsRead":"582464","recordsWritten":"45","parallelInputs":"9","completedParallelInputs":"9","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$150, $130","FROM __stage00_output"]},{"kind":"SORT","substeps":["$110 DESC","LIMIT 5"]},{"kind":"AGGREGATE","substeps":["GROUP BY $160 := $150","$110 := SUM_OF_COUNTS($130)"]},{"kind":"WRITE","substeps":["$170, $171","TO __stage01_output"]}],"slotMs":"411","computeMode":"BIGQUERY"},{"name":"S02: Sort","id":"2","startMs":"1762526274639","endMs":"1762526274673","inputStages":["1"],"waitRatioAvg":0.06542056074766354,"waitMsAvg":"14","waitRatioMax":0.06542056074766354,"waitMsMax":"14","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.06542056074766354,"computeMsAvg":"14","computeRatioMax":0.06542056074766354,"computeMsMax":"14","writeRatioAvg":0.014018691588785047,"writeMsAvg":"3","writeRatioMax":0.014018691588785047,"writeMsMax":"3","shuffleOutputBytes":"235","shuffleOutputBytesSpilled":"0","recordsRead":"45","recordsWritten":"5","parallelInputs":"1","completedParallelInputs":"1","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$170, $171","FROM __stage01_output"]},{"kind":"SORT","substeps":["$100 DESC","LIMIT 5"]},{"kind":"WRITE","substeps":["$220","TO __stage02_output"]}],"slotMs":"41","computeMode":"BIGQUERY"},{"name":"S04: Sort","id":"4","startMs":"1762526274664","endMs":"1762526274700","inputStages":["1"],"waitRatioAvg":0.028037383177570093,"waitMsAvg":"6","waitRatioMax":0.028037383177570093,"waitMsMax":"6","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.0514018691588785,"computeMsAvg":"11","computeRatioMax":0.0514018691588785,"computeMsMax":"11","writeRatioAvg":0.0794392523364486,"writeMsAvg":"17","writeRatioMax":0.0794392523364486,"writeMsMax":"17","shuffleOutputBytes":"235","shuffleOutputBytesSpilled":"0","recordsRead":"45","recordsWritten":"5","parallelInputs":"1","completedParallelInputs":"1","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$170, $171","FROM __stage01_output"]},{"kind":"SORT","substeps":["$171 DESC","LIMIT 5"]},{"kind":"WRITE","substeps":["$180","TO __stage04_output"]}],"slotMs":"73","computeMode":"BIGQUERY"},{"name":"S06: Coalesce","id":"6","startMs":"1762526274682","endMs":"1762526274742","inputStages":["2"],"waitRatioAvg":0.02336448598130841,"waitMsAvg":"5","waitRatioMax":0.028037383177570093,"waitMsMax":"6","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.04205607476635514,"computeMsAvg":"9","computeRatioMax":0.07476635514018691,"computeMsMax":"16","writeRatioAvg":0.056074766355140186,"writeMsAvg":"12","writeRatioMax":0.14018691588785046,"writeMsMax":"30","shuffleOutputBytes":"235","shuffleOutputBytesSpilled":"0","recordsRead":"5","recordsWritten":"5","parallelInputs":"100","completedParallelInputs":"100","status":"COMPLETE","steps":[{"kind":"READ","substeps":["FROM __stage02_output"]}],"slotMs":"6298","computeMode":"BIGQUERY"},{"name":"S07: Output","id":"7","startMs":"1762526274682","endMs":"1762526274731","inputStages":["2"],"waitRatioAvg":0.02336448598130841,"waitMsAvg":"5","waitRatioMax":0.028037383177570093,"waitMsMax":"6","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.04205607476635514,"computeMsAvg":"9","computeRatioMax":0.06542056074766354,"computeMsMax":"14","writeRatioAvg":0.02336448598130841,"writeMsAvg":"5","writeRatioMax":0.08878504672897196,"writeMsMax":"19","shuffleOutputBytes":"2075","shuffleOutputBytesSpilled":"0","recordsRead":"5","recordsWritten":"100","parallelInputs":"100","completedParallelInputs":"100","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$220","FROM __stage02_output"]},{"kind":"COMPUTE","substeps":["$291 := if(less_or_equal(array_length($287), 1000), $287, NULL)","$286 := if(greater(array_length($287), 1000), 1, 0)"]},{"kind":"AGGREGATE","substeps":["$284 := MIN($220)","$285 := MAX($220)","$287 := DISTINCT_ARRAY_AGG($288 LIMIT 1001)","$289 := MAX($290)"]},{"kind":"COMPUTE","substeps":["$288 := if(less_or_equal(length($220), 1024), $220, NULL)","$290 := length($220)"]},{"kind":"WRITE","substeps":["$284, $285, $286, $291, $289","TO __stage07_output"]}],"slotMs":"4935","computeMode":"BIGQUERY"},{"name":"S08: Coalesce","id":"8","startMs":"1762526274716","endMs":"1762526274778","inputStages":["4"],"waitRatioAvg":0.004672897196261682,"waitMsAvg":"1","waitRatioMax":0.009345794392523364,"waitMsMax":"2","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.04205607476635514,"computeMsAvg":"9","computeRatioMax":0.07476635514018691,"computeMsMax":"16","writeRatioAvg":0.06542056074766354,"writeMsAvg":"14","writeRatioMax":0.14018691588785046,"writeMsMax":"30","shuffleOutputBytes":"235","shuffleOutputBytesSpilled":"0","recordsRead":"5","recordsWritten":"5","parallelInputs":"100","completedParallelInputs":"100","status":"COMPLETE","steps":[{"kind":"READ","substeps":["FROM __stage04_output"]}],"slotMs":"6374","computeMode":"BIGQUERY"},{"name":"S09: Join+","id":"9","startMs":"1762526274731","endMs":"1762526274827","inputStages":["8"],"waitRatioAvg":0.028037383177570093,"waitMsAvg":"6","waitRatioMax":0.056074766355140186,"waitMsMax":"12","readRatioAvg":0.04205607476635514,"readMsAvg":"9","readRatioMax":0.08878504672897196,"readMsMax":"19","computeRatioAvg":0.102803738317757,"computeMsAvg":"22","computeRatioMax":0.16822429906542055,"computeMsMax":"36","writeRatioAvg":0.018691588785046728,"writeMsAvg":"4","writeRatioMax":0.06542056074766354,"writeMsMax":"14","shuffleOutputBytes":"27328","shuffleOutputBytesSpilled":"0","recordsRead":"3714584","recordsWritten":"427","parallelInputs":"91","completedParallelInputs":"91","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$10:from_address, $11:gas_price, $12:receipt_gas_used, $13:receipt_status, $14:block_timestamp","FROM bigquery-public-data.crypto_ethereum_classic.transactions","WHERE and(greater_or_equal($14, 1577836800.000000000), less($14, 1585699200.000000000), equal($13, 1))"]},{"kind":"READ","substeps":["$180","FROM __stage08_output"]},{"kind":"AGGREGATE","substeps":["GROUP BY $200 := $190","$70 := SUM($90)"]},{"kind":"COMPUTE","substeps":["$90 := multiply(CAST($191 AS NUMERIC), CAST($192 AS NUMERIC))"]},{"kind":"JOIN","substeps":["$190 := $10, $191 := $11, $192 := $12","INNER HASH JOIN EACH  WITH ALL  ON $10 = $180"]},{"kind":"WRITE","substeps":["$200, $70","TO __stage09_output","BY HASH($200)"]}],"slotMs":"8513","computeMode":"BIGQUERY"},{"name":"S0A: Join+","id":"10","startMs":"1762526274753","endMs":"1762526274948","inputStages":["6"],"waitRatioAvg":0.004672897196261682,"waitMsAvg":"1","waitRatioMax":0.009345794392523364,"waitMsMax":"2","readRatioAvg":0.2102803738317757,"readMsAvg":"45","readRatioMax":0.6495327102803738,"readMsMax":"139","computeRatioAvg":0.14953271028037382,"computeMsAvg":"32","computeRatioMax":0.35514018691588783,"computeMsMax":"76","writeRatioAvg":0.018691588785046728,"writeMsAvg":"4","writeRatioMax":0.06542056074766354,"writeMsMax":"14","shuffleOutputBytes":"27328","shuffleOutputBytesSpilled":"0","recordsRead":"15994372","recordsWritten":"427","parallelInputs":"91","completedParallelInputs":"91","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$1:from_address, $2:value, $3:block_timestamp","FROM bigquery-public-data.crypto_ethereum_classic.traces","WHERE and(greater_or_equal($3, 1577836800.000000000), less($3, 1585699200.000000000), ...)"]},{"kind":"READ","substeps":["$220","FROM __stage06_output"]},{"kind":"AGGREGATE","substeps":["GROUP BY $240 := $230","$80 := SUM($231)"]},{"kind":"JOIN","substeps":["$230 := $1, $231 := $2","INNER HASH JOIN EACH  WITH ALL  ON $1 = $220"]},{"kind":"WRITE","substeps":["$240, $80","TO __stage0A_output","BY HASH($240)"]}],"slotMs":"9600","computeMode":"BIGQUERY"},{"name":"S0B: Aggregate","id":"11","startMs":"1762526274969","endMs":"1762526275002","inputStages":["10"],"waitRatioAvg":0.004672897196261682,"waitMsAvg":"1","waitRatioMax":0.004672897196261682,"waitMsMax":"1","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.0514018691588785,"computeMsAvg":"11","computeRatioMax":0.0794392523364486,"computeMsMax":"17","writeRatioAvg":0.08878504672897196,"writeMsAvg":"19","writeRatioMax":0.11214953271028037,"writeMsMax":"24","shuffleOutputBytes":"320","shuffleOutputBytesSpilled":"0","recordsRead":"427","recordsWritten":"5","parallelInputs":"9","completedParallelInputs":"9","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$240, $80","FROM __stage0A_output"]},{"kind":"AGGREGATE","substeps":["GROUP BY $250 := $240","$60 := SUM($80)"]},{"kind":"WRITE","substeps":["$60, $250","TO __stage0B_output"]}],"slotMs":"438","computeMode":"BIGQUERY"},{"name":"S0D: Coalesce","id":"13","startMs":"1762526275014","endMs":"1762526275070","inputStages":["11"],"waitRatioAvg":0.02336448598130841,"waitMsAvg":"5","waitRatioMax":0.028037383177570093,"waitMsMax":"6","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.04672897196261682,"computeMsAvg":"10","computeRatioMax":0.07009345794392523,"computeMsMax":"15","writeRatioAvg":0.07009345794392523,"writeMsAvg":"15","writeRatioMax":0.1542056074766355,"writeMsMax":"33","shuffleOutputBytes":"320","shuffleOutputBytesSpilled":"0","recordsRead":"5","recordsWritten":"5","parallelInputs":"100","completedParallelInputs":"100","status":"COMPLETE","steps":[{"kind":"READ","substeps":["FROM __stage0B_output"]}],"slotMs":"6541","computeMode":"BIGQUERY"},{"name":"S0E: Join+","id":"14","startMs":"1762526275017","endMs":"1762526275086","inputStages":["13","9"],"waitRatioAvg":0.02336448598130841,"waitMsAvg":"5","waitRatioMax":0.02336448598130841,"waitMsMax":"5","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.056074766355140186,"computeMsAvg":"12","computeRatioMax":0.08878504672897196,"computeMsMax":"19","writeRatioAvg":0.037383177570093455,"writeMsAvg":"8","writeRatioMax":0.0794392523364486,"writeMsMax":"17","shuffleOutputBytes":"490","shuffleOutputBytesSpilled":"0","recordsRead":"447","recordsWritten":"5","parallelInputs":"9","completedParallelInputs":"9","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$200, $70","FROM __stage09_output"]},{"kind":"READ","substeps":["$60, $250","FROM __stage0D_output"]},{"kind":"SORT","substeps":["$40 DESC","LIMIT 100"]},{"kind":"COMPUTE","substeps":["$40 := subtract($262, $261)"]},{"kind":"JOIN","substeps":["$260 := $210, $261 := $50, $262 := $60","INNER HASH JOIN EACH  WITH ALL  ON $210 = $250"]},{"kind":"AGGREGATE","substeps":["GROUP BY $210 := $200","$50 := SUM($70)"]},{"kind":"WRITE","substeps":["$270, $271, $272, $273","TO __stage0E_output"]}],"slotMs":"686","computeMode":"BIGQUERY"},{"name":"S0F: Output","id":"15","startMs":"1762526275022","endMs":"1762526275099","inputStages":["14"],"waitRatioAvg":0.06074766355140187,"waitMsAvg":"13","waitRatioMax":0.06074766355140187,"waitMsMax":"13","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.03271028037383177,"computeMsAvg":"7","computeRatioMax":0.03271028037383177,"computeMsMax":"7","writeRatioAvg":0.02336448598130841,"writeMsAvg":"5","writeRatioMax":0.02336448598130841,"writeMsMax":"5","shuffleOutputBytes":"490","shuffleOutputBytesSpilled":"0","recordsRead":"5","recordsWritten":"5","parallelInputs":"1","completedParallelInputs":"1","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$270, $271, $272, $273","FROM __stage0E_output"]},{"kind":"SORT","substeps":["$271 DESC","LIMIT 100"]},{"kind":"WRITE","substeps":["$280, $281, $282, $283","TO __stage0F_output"]}],"slotMs":"20","computeMode":"BIGQUERY"}],"estimatedBytesProcessed":"1594954856","timeline":[{"elapsedMs":"934","totalSlotMs":"62325","pendingUnits":"1","completedUnits":"583","activeUnits":"3","estimatedRunnableUnits":"0"},{"elapsedMs":"1041","totalSlotMs":"62325","pendingUnits":"0","completedUnits":"703","estimatedRunnableUnits":"0"}],"totalPartitionsProcessed":"182","totalBytesProcessed":"1594954856","totalBytesBilled":"1595932672","billingTier":1,"totalSlotMs":"62325","cacheHit":false,"referencedTables":[{"projectId":"bigquery-public-data","datasetId":"crypto_ethereum_classic","tableId":"transactions"},{"projectId":"bigquery-public-data","datasetId":"crypto_ethereum_classic","tableId":"traces"}],"statementType":"SELECT","searchStatistics":{"indexUsageMode":"UNUSED","indexUnusedReasons":[{"code":"INDEX_CONFIG_NOT_AVAILABLE","message":"There is no index configuration for the base table `bigquery-public-data:crypto_ethereum_classic.traces`.","baseTable":{"projectId":"bigquery-public-data","datasetId":"crypto_ethereum_classic","tableId":"traces"}},{"code":"INDEX_CONFIG_NOT_AVAILABLE","message":"There is no index configuration for the base table `bigquery-public-data:crypto_ethereum_classic.transactions`.","baseTable":{"projectId":"bigquery-public-data","datasetId":"crypto_ethereum_classic","tableId":"transactions"}}]},"performanceInsights":{"avgPreviousExecutionMs":"1318"},"transferredBytes":"0","metadataCacheStatistics":{"tableMetadataCacheUsage":[{"tableReference":{"projectId":"bigquery-public-data","datasetId":"crypto_ethereum_classic","tableId":"transactions"},"unusedReason":"OTHER_REASON"},{"tableReference":{"projectId":"bigquery-public-data","datasetId":"crypto_ethereum_classic","tableId":"traces"},"unusedReason":"OTHER_REASON"}]}},"totalSlotMs":"62325","finalExecutionDurationMs":"750"},"status":{"state":"DONE"},"principal_subject":"user:admin@bentrollope.altostrat.com","jobCreationReason":{"code":"REQUESTED"}}'
++ echo '{"kind":"bigquery#job","etag":"FmaAPsb+BGvS0Vv40DeGOg==","id":"tony-allen:US.bqjob_r7af22a93cb588faa_0000019a5ec0a0bd_1","selfLink":"https://bigquery.googleapis.com/bigquery/v2/projects/tony-allen/jobs/bqjob_r7af22a93cb588faa_0000019a5ec0a0bd_1?location=US","user_email":"admin@bentrollope.altostrat.com","configuration":{"query":{"query":"WITH TopSenders AS (\n    -- CTE 1: Identify the top 5 addresses based on the count of successful transactions\n    SELECT\n        t.from_address AS address,\n        COUNT(t.hash) AS transaction_count\n    FROM\n        `bigquery-public-data.crypto_ethereum_classic.transactions` AS t\n    WHERE\n        t.receipt_status = 1 \n        AND t.block_timestamp >= '\''2020-01-01 00:00:00 UTC'\'' \n        AND t.block_timestamp < '\''2020-04-01 00:00:00 UTC'\''  \n    GROUP BY\n        1\n    ORDER BY\n        transaction_count DESC\n    LIMIT 5\n),\n\nTotalFees AS (\n    -- CTE 2: Requires a second scan of the '\''transactions'\'' table unnecessarily\n    SELECT\n        t.from_address AS address,\n        SUM(CAST(t.gas_price AS NUMERIC) * CAST(t.receipt_gas_used AS NUMERIC)) AS total_fees_paid\n    FROM\n        `bigquery-public-data.crypto_ethereum_classic.transactions` AS t\n    INNER JOIN\n        TopSenders AS s ON t.from_address = s.address\n    WHERE\n        t.block_timestamp >= '\''2020-01-01 00:00:00 UTC'\''\n        AND t.block_timestamp < '\''2020-04-01 00:00:00 UTC'\''\n        AND t.receipt_status = 1\n    GROUP BY\n        1\n),\n\nTotalValueSent AS (\n    -- CTE 3: Scans the '\''traces'\'' table\n    SELECT\n        tr.from_address AS address,\n        SUM(tr.value) AS total_value_sent\n    FROM\n        `bigquery-public-data.crypto_ethereum_classic.traces` AS tr\n    INNER JOIN\n        TopSenders AS s ON tr.from_address = s.address\n    WHERE\n        tr.block_timestamp >= '\''2020-01-01 00:00:00 UTC'\''  \n        AND tr.block_timestamp < '\''2020-04-01 00:00:00 UTC'\'' \n    GROUP BY\n        1\n)\n\n-- Final SELECT: Joins the calculated fees and values to find the net ether flow\nSELECT\n    f.address,\n    v.total_value_sent,\n    f.total_fees_paid,\n    v.total_value_sent - f.total_fees_paid AS net_ether_flow_wei\nFROM\n    TotalFees AS f\nINNER JOIN\n    TotalValueSent AS v ON f.address = v.address\nORDER BY\n    net_ether_flow_wei DESC\nLIMIT 100","destinationTable":{"projectId":"tony-allen","datasetId":"_e34c49c766e4fd3f5d404c3949b9e19fa7acb372","tableId":"anonc5ee9f31_131e_4177_b506_9f08344248e5"},"writeDisposition":"WRITE_TRUNCATE","priority":"INTERACTIVE","useQueryCache":false,"useLegacySql":false},"jobType":"QUERY"},"jobReference":{"projectId":"tony-allen","jobId":"bqjob_r7af22a93cb588faa_0000019a5ec0a0bd_1","location":"US"},"statistics":{"creationTime":"1762526273968","startTime":"1762526274066","endTime":"1762526275330","totalBytesProcessed":"1594954856","query":{"queryPlan":[{"name":"S00: Input","id":"0","startMs":"1762526274393","endMs":"1762526274625","waitRatioAvg":0.04205607476635514,"waitMsAvg":"9","waitRatioMax":0.06542056074766354,"waitMsMax":"14","readRatioAvg":0.4205607476635514,"readMsAvg":"90","readRatioMax":1,"readMsMax":"214","computeRatioAvg":0.13551401869158877,"computeMsAvg":"29","computeRatioMax":0.3411214953271028,"computeMsMax":"73","writeRatioAvg":0.018691588785046728,"writeMsAvg":"4","writeRatioMax":0.102803738317757,"writeMsMax":"22","shuffleOutputBytes":"32617984","shuffleOutputBytesSpilled":"0","recordsRead":"3714129","recordsWritten":"582464","parallelInputs":"91","completedParallelInputs":"91","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$30:hash, $31:from_address, $32:receipt_status, $33:block_timestamp","FROM bigquery-public-data.crypto_ethereum_classic.transactions","WHERE and(equal($32, 1), greater_or_equal($33, 1577836800.000000000), less($33, 1585699200.000000000))"]},{"kind":"AGGREGATE","substeps":["GROUP BY $150 := $31","$130 := COUNT($30)"]},{"kind":"WRITE","substeps":["$150, $130","TO __stage00_output","BY HASH($150)"]}],"slotMs":"17711","computeMode":"BIGQUERY"},{"name":"S01: Sort+","id":"1","startMs":"1762526274628","endMs":"1762526274668","inputStages":["0"],"waitRatioAvg":0.004672897196261682,"waitMsAvg":"1","waitRatioMax":0.004672897196261682,"waitMsMax":"1","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.13551401869158877,"computeMsAvg":"29","computeRatioMax":0.16822429906542055,"computeMsMax":"36","writeRatioAvg":0.004672897196261682,"writeMsAvg":"1","writeRatioMax":0.014018691588785047,"writeMsMax":"3","shuffleOutputBytes":"2520","shuffleOutputBytesSpilled":"0","recordsRead":"582464","recordsWritten":"45","parallelInputs":"9","completedParallelInputs":"9","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$150, $130","FROM __stage00_output"]},{"kind":"SORT","substeps":["$110 DESC","LIMIT 5"]},{"kind":"AGGREGATE","substeps":["GROUP BY $160 := $150","$110 := SUM_OF_COUNTS($130)"]},{"kind":"WRITE","substeps":["$170, $171","TO __stage01_output"]}],"slotMs":"411","computeMode":"BIGQUERY"},{"name":"S02: Sort","id":"2","startMs":"1762526274639","endMs":"1762526274673","inputStages":["1"],"waitRatioAvg":0.06542056074766354,"waitMsAvg":"14","waitRatioMax":0.06542056074766354,"waitMsMax":"14","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.06542056074766354,"computeMsAvg":"14","computeRatioMax":0.06542056074766354,"computeMsMax":"14","writeRatioAvg":0.014018691588785047,"writeMsAvg":"3","writeRatioMax":0.014018691588785047,"writeMsMax":"3","shuffleOutputBytes":"235","shuffleOutputBytesSpilled":"0","recordsRead":"45","recordsWritten":"5","parallelInputs":"1","completedParallelInputs":"1","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$170, $171","FROM __stage01_output"]},{"kind":"SORT","substeps":["$100 DESC","LIMIT 5"]},{"kind":"WRITE","substeps":["$220","TO __stage02_output"]}],"slotMs":"41","computeMode":"BIGQUERY"},{"name":"S04: Sort","id":"4","startMs":"1762526274664","endMs":"1762526274700","inputStages":["1"],"waitRatioAvg":0.028037383177570093,"waitMsAvg":"6","waitRatioMax":0.028037383177570093,"waitMsMax":"6","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.0514018691588785,"computeMsAvg":"11","computeRatioMax":0.0514018691588785,"computeMsMax":"11","writeRatioAvg":0.0794392523364486,"writeMsAvg":"17","writeRatioMax":0.0794392523364486,"writeMsMax":"17","shuffleOutputBytes":"235","shuffleOutputBytesSpilled":"0","recordsRead":"45","recordsWritten":"5","parallelInputs":"1","completedParallelInputs":"1","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$170, $171","FROM __stage01_output"]},{"kind":"SORT","substeps":["$171 DESC","LIMIT 5"]},{"kind":"WRITE","substeps":["$180","TO __stage04_output"]}],"slotMs":"73","computeMode":"BIGQUERY"},{"name":"S06: Coalesce","id":"6","startMs":"1762526274682","endMs":"1762526274742","inputStages":["2"],"waitRatioAvg":0.02336448598130841,"waitMsAvg":"5","waitRatioMax":0.028037383177570093,"waitMsMax":"6","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.04205607476635514,"computeMsAvg":"9","computeRatioMax":0.07476635514018691,"computeMsMax":"16","writeRatioAvg":0.056074766355140186,"writeMsAvg":"12","writeRatioMax":0.14018691588785046,"writeMsMax":"30","shuffleOutputBytes":"235","shuffleOutputBytesSpilled":"0","recordsRead":"5","recordsWritten":"5","parallelInputs":"100","completedParallelInputs":"100","status":"COMPLETE","steps":[{"kind":"READ","substeps":["FROM __stage02_output"]}],"slotMs":"6298","computeMode":"BIGQUERY"},{"name":"S07: Output","id":"7","startMs":"1762526274682","endMs":"1762526274731","inputStages":["2"],"waitRatioAvg":0.02336448598130841,"waitMsAvg":"5","waitRatioMax":0.028037383177570093,"waitMsMax":"6","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.04205607476635514,"computeMsAvg":"9","computeRatioMax":0.06542056074766354,"computeMsMax":"14","writeRatioAvg":0.02336448598130841,"writeMsAvg":"5","writeRatioMax":0.08878504672897196,"writeMsMax":"19","shuffleOutputBytes":"2075","shuffleOutputBytesSpilled":"0","recordsRead":"5","recordsWritten":"100","parallelInputs":"100","completedParallelInputs":"100","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$220","FROM __stage02_output"]},{"kind":"COMPUTE","substeps":["$291 := if(less_or_equal(array_length($287), 1000), $287, NULL)","$286 := if(greater(array_length($287), 1000), 1, 0)"]},{"kind":"AGGREGATE","substeps":["$284 := MIN($220)","$285 := MAX($220)","$287 := DISTINCT_ARRAY_AGG($288 LIMIT 1001)","$289 := MAX($290)"]},{"kind":"COMPUTE","substeps":["$288 := if(less_or_equal(length($220), 1024), $220, NULL)","$290 := length($220)"]},{"kind":"WRITE","substeps":["$284, $285, $286, $291, $289","TO __stage07_output"]}],"slotMs":"4935","computeMode":"BIGQUERY"},{"name":"S08: Coalesce","id":"8","startMs":"1762526274716","endMs":"1762526274778","inputStages":["4"],"waitRatioAvg":0.004672897196261682,"waitMsAvg":"1","waitRatioMax":0.009345794392523364,"waitMsMax":"2","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.04205607476635514,"computeMsAvg":"9","computeRatioMax":0.07476635514018691,"computeMsMax":"16","writeRatioAvg":0.06542056074766354,"writeMsAvg":"14","writeRatioMax":0.14018691588785046,"writeMsMax":"30","shuffleOutputBytes":"235","shuffleOutputBytesSpilled":"0","recordsRead":"5","recordsWritten":"5","parallelInputs":"100","completedParallelInputs":"100","status":"COMPLETE","steps":[{"kind":"READ","substeps":["FROM __stage04_output"]}],"slotMs":"6374","computeMode":"BIGQUERY"},{"name":"S09: Join+","id":"9","startMs":"1762526274731","endMs":"1762526274827","inputStages":["8"],"waitRatioAvg":0.028037383177570093,"waitMsAvg":"6","waitRatioMax":0.056074766355140186,"waitMsMax":"12","readRatioAvg":0.04205607476635514,"readMsAvg":"9","readRatioMax":0.08878504672897196,"readMsMax":"19","computeRatioAvg":0.102803738317757,"computeMsAvg":"22","computeRatioMax":0.16822429906542055,"computeMsMax":"36","writeRatioAvg":0.018691588785046728,"writeMsAvg":"4","writeRatioMax":0.06542056074766354,"writeMsMax":"14","shuffleOutputBytes":"27328","shuffleOutputBytesSpilled":"0","recordsRead":"3714584","recordsWritten":"427","parallelInputs":"91","completedParallelInputs":"91","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$10:from_address, $11:gas_price, $12:receipt_gas_used, $13:receipt_status, $14:block_timestamp","FROM bigquery-public-data.crypto_ethereum_classic.transactions","WHERE and(greater_or_equal($14, 1577836800.000000000), less($14, 1585699200.000000000), equal($13, 1))"]},{"kind":"READ","substeps":["$180","FROM __stage08_output"]},{"kind":"AGGREGATE","substeps":["GROUP BY $200 := $190","$70 := SUM($90)"]},{"kind":"COMPUTE","substeps":["$90 := multiply(CAST($191 AS NUMERIC), CAST($192 AS NUMERIC))"]},{"kind":"JOIN","substeps":["$190 := $10, $191 := $11, $192 := $12","INNER HASH JOIN EACH  WITH ALL  ON $10 = $180"]},{"kind":"WRITE","substeps":["$200, $70","TO __stage09_output","BY HASH($200)"]}],"slotMs":"8513","computeMode":"BIGQUERY"},{"name":"S0A: Join+","id":"10","startMs":"1762526274753","endMs":"1762526274948","inputStages":["6"],"waitRatioAvg":0.004672897196261682,"waitMsAvg":"1","waitRatioMax":0.009345794392523364,"waitMsMax":"2","readRatioAvg":0.2102803738317757,"readMsAvg":"45","readRatioMax":0.6495327102803738,"readMsMax":"139","computeRatioAvg":0.14953271028037382,"computeMsAvg":"32","computeRatioMax":0.35514018691588783,"computeMsMax":"76","writeRatioAvg":0.018691588785046728,"writeMsAvg":"4","writeRatioMax":0.06542056074766354,"writeMsMax":"14","shuffleOutputBytes":"27328","shuffleOutputBytesSpilled":"0","recordsRead":"15994372","recordsWritten":"427","parallelInputs":"91","completedParallelInputs":"91","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$1:from_address, $2:value, $3:block_timestamp","FROM bigquery-public-data.crypto_ethereum_classic.traces","WHERE and(greater_or_equal($3, 1577836800.000000000), less($3, 1585699200.000000000), ...)"]},{"kind":"READ","substeps":["$220","FROM __stage06_output"]},{"kind":"AGGREGATE","substeps":["GROUP BY $240 := $230","$80 := SUM($231)"]},{"kind":"JOIN","substeps":["$230 := $1, $231 := $2","INNER HASH JOIN EACH  WITH ALL  ON $1 = $220"]},{"kind":"WRITE","substeps":["$240, $80","TO __stage0A_output","BY HASH($240)"]}],"slotMs":"9600","computeMode":"BIGQUERY"},{"name":"S0B: Aggregate","id":"11","startMs":"1762526274969","endMs":"1762526275002","inputStages":["10"],"waitRatioAvg":0.004672897196261682,"waitMsAvg":"1","waitRatioMax":0.004672897196261682,"waitMsMax":"1","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.0514018691588785,"computeMsAvg":"11","computeRatioMax":0.0794392523364486,"computeMsMax":"17","writeRatioAvg":0.08878504672897196,"writeMsAvg":"19","writeRatioMax":0.11214953271028037,"writeMsMax":"24","shuffleOutputBytes":"320","shuffleOutputBytesSpilled":"0","recordsRead":"427","recordsWritten":"5","parallelInputs":"9","completedParallelInputs":"9","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$240, $80","FROM __stage0A_output"]},{"kind":"AGGREGATE","substeps":["GROUP BY $250 := $240","$60 := SUM($80)"]},{"kind":"WRITE","substeps":["$60, $250","TO __stage0B_output"]}],"slotMs":"438","computeMode":"BIGQUERY"},{"name":"S0D: Coalesce","id":"13","startMs":"1762526275014","endMs":"1762526275070","inputStages":["11"],"waitRatioAvg":0.02336448598130841,"waitMsAvg":"5","waitRatioMax":0.028037383177570093,"waitMsMax":"6","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.04672897196261682,"computeMsAvg":"10","computeRatioMax":0.07009345794392523,"computeMsMax":"15","writeRatioAvg":0.07009345794392523,"writeMsAvg":"15","writeRatioMax":0.1542056074766355,"writeMsMax":"33","shuffleOutputBytes":"320","shuffleOutputBytesSpilled":"0","recordsRead":"5","recordsWritten":"5","parallelInputs":"100","completedParallelInputs":"100","status":"COMPLETE","steps":[{"kind":"READ","substeps":["FROM __stage0B_output"]}],"slotMs":"6541","computeMode":"BIGQUERY"},{"name":"S0E: Join+","id":"14","startMs":"1762526275017","endMs":"1762526275086","inputStages":["13","9"],"waitRatioAvg":0.02336448598130841,"waitMsAvg":"5","waitRatioMax":0.02336448598130841,"waitMsMax":"5","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.056074766355140186,"computeMsAvg":"12","computeRatioMax":0.08878504672897196,"computeMsMax":"19","writeRatioAvg":0.037383177570093455,"writeMsAvg":"8","writeRatioMax":0.0794392523364486,"writeMsMax":"17","shuffleOutputBytes":"490","shuffleOutputBytesSpilled":"0","recordsRead":"447","recordsWritten":"5","parallelInputs":"9","completedParallelInputs":"9","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$200, $70","FROM __stage09_output"]},{"kind":"READ","substeps":["$60, $250","FROM __stage0D_output"]},{"kind":"SORT","substeps":["$40 DESC","LIMIT 100"]},{"kind":"COMPUTE","substeps":["$40 := subtract($262, $261)"]},{"kind":"JOIN","substeps":["$260 := $210, $261 := $50, $262 := $60","INNER HASH JOIN EACH  WITH ALL  ON $210 = $250"]},{"kind":"AGGREGATE","substeps":["GROUP BY $210 := $200","$50 := SUM($70)"]},{"kind":"WRITE","substeps":["$270, $271, $272, $273","TO __stage0E_output"]}],"slotMs":"686","computeMode":"BIGQUERY"},{"name":"S0F: Output","id":"15","startMs":"1762526275022","endMs":"1762526275099","inputStages":["14"],"waitRatioAvg":0.06074766355140187,"waitMsAvg":"13","waitRatioMax":0.06074766355140187,"waitMsMax":"13","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.03271028037383177,"computeMsAvg":"7","computeRatioMax":0.03271028037383177,"computeMsMax":"7","writeRatioAvg":0.02336448598130841,"writeMsAvg":"5","writeRatioMax":0.02336448598130841,"writeMsMax":"5","shuffleOutputBytes":"490","shuffleOutputBytesSpilled":"0","recordsRead":"5","recordsWritten":"5","parallelInputs":"1","completedParallelInputs":"1","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$270, $271, $272, $273","FROM __stage0E_output"]},{"kind":"SORT","substeps":["$271 DESC","LIMIT 100"]},{"kind":"WRITE","substeps":["$280, $281, $282, $283","TO __stage0F_output"]}],"slotMs":"20","computeMode":"BIGQUERY"}],"estimatedBytesProcessed":"1594954856","timeline":[{"elapsedMs":"934","totalSlotMs":"62325","pendingUnits":"1","completedUnits":"583","activeUnits":"3","estimatedRunnableUnits":"0"},{"elapsedMs":"1041","totalSlotMs":"62325","pendingUnits":"0","completedUnits":"703","estimatedRunnableUnits":"0"}],"totalPartitionsProcessed":"182","totalBytesProcessed":"1594954856","totalBytesBilled":"1595932672","billingTier":1,"totalSlotMs":"62325","cacheHit":false,"referencedTables":[{"projectId":"bigquery-public-data","datasetId":"crypto_ethereum_classic","tableId":"transactions"},{"projectId":"bigquery-public-data","datasetId":"crypto_ethereum_classic","tableId":"traces"}],"statementType":"SELECT","searchStatistics":{"indexUsageMode":"UNUSED","indexUnusedReasons":[{"code":"INDEX_CONFIG_NOT_AVAILABLE","message":"There is no index configuration for the base table `bigquery-public-data:crypto_ethereum_classic.traces`.","baseTable":{"projectId":"bigquery-public-data","datasetId":"crypto_ethereum_classic","tableId":"traces"}},{"code":"INDEX_CONFIG_NOT_AVAILABLE","message":"There is no index configuration for the base table `bigquery-public-data:crypto_ethereum_classic.transactions`.","baseTable":{"projectId":"bigquery-public-data","datasetId":"crypto_ethereum_classic","tableId":"transactions"}}]},"performanceInsights":{"avgPreviousExecutionMs":"1318"},"transferredBytes":"0","metadataCacheStatistics":{"tableMetadataCacheUsage":[{"tableReference":{"projectId":"bigquery-public-data","datasetId":"crypto_ethereum_classic","tableId":"transactions"},"unusedReason":"OTHER_REASON"},{"tableReference":{"projectId":"bigquery-public-data","datasetId":"crypto_ethereum_classic","tableId":"traces"},"unusedReason":"OTHER_REASON"}]}},"totalSlotMs":"62325","finalExecutionDurationMs":"750"},"status":{"state":"DONE"},"principal_subject":"user:admin@bentrollope.altostrat.com","jobCreationReason":{"code":"REQUESTED"}}'
++ jq -r .statistics.totalBytesProcessed
+ total_bytes_processed=1594954856
++ jq -r .statistics.totalSlotMs
++ echo '{"kind":"bigquery#job","etag":"FmaAPsb+BGvS0Vv40DeGOg==","id":"tony-allen:US.bqjob_r7af22a93cb588faa_0000019a5ec0a0bd_1","selfLink":"https://bigquery.googleapis.com/bigquery/v2/projects/tony-allen/jobs/bqjob_r7af22a93cb588faa_0000019a5ec0a0bd_1?location=US","user_email":"admin@bentrollope.altostrat.com","configuration":{"query":{"query":"WITH TopSenders AS (\n    -- CTE 1: Identify the top 5 addresses based on the count of successful transactions\n    SELECT\n        t.from_address AS address,\n        COUNT(t.hash) AS transaction_count\n    FROM\n        `bigquery-public-data.crypto_ethereum_classic.transactions` AS t\n    WHERE\n        t.receipt_status = 1 \n        AND t.block_timestamp >= '\''2020-01-01 00:00:00 UTC'\'' \n        AND t.block_timestamp < '\''2020-04-01 00:00:00 UTC'\''  \n    GROUP BY\n        1\n    ORDER BY\n        transaction_count DESC\n    LIMIT 5\n),\n\nTotalFees AS (\n    -- CTE 2: Requires a second scan of the '\''transactions'\'' table unnecessarily\n    SELECT\n        t.from_address AS address,\n        SUM(CAST(t.gas_price AS NUMERIC) * CAST(t.receipt_gas_used AS NUMERIC)) AS total_fees_paid\n    FROM\n        `bigquery-public-data.crypto_ethereum_classic.transactions` AS t\n    INNER JOIN\n        TopSenders AS s ON t.from_address = s.address\n    WHERE\n        t.block_timestamp >= '\''2020-01-01 00:00:00 UTC'\''\n        AND t.block_timestamp < '\''2020-04-01 00:00:00 UTC'\''\n        AND t.receipt_status = 1\n    GROUP BY\n        1\n),\n\nTotalValueSent AS (\n    -- CTE 3: Scans the '\''traces'\'' table\n    SELECT\n        tr.from_address AS address,\n        SUM(tr.value) AS total_value_sent\n    FROM\n        `bigquery-public-data.crypto_ethereum_classic.traces` AS tr\n    INNER JOIN\n        TopSenders AS s ON tr.from_address = s.address\n    WHERE\n        tr.block_timestamp >= '\''2020-01-01 00:00:00 UTC'\''  \n        AND tr.block_timestamp < '\''2020-04-01 00:00:00 UTC'\'' \n    GROUP BY\n        1\n)\n\n-- Final SELECT: Joins the calculated fees and values to find the net ether flow\nSELECT\n    f.address,\n    v.total_value_sent,\n    f.total_fees_paid,\n    v.total_value_sent - f.total_fees_paid AS net_ether_flow_wei\nFROM\n    TotalFees AS f\nINNER JOIN\n    TotalValueSent AS v ON f.address = v.address\nORDER BY\n    net_ether_flow_wei DESC\nLIMIT 100","destinationTable":{"projectId":"tony-allen","datasetId":"_e34c49c766e4fd3f5d404c3949b9e19fa7acb372","tableId":"anonc5ee9f31_131e_4177_b506_9f08344248e5"},"writeDisposition":"WRITE_TRUNCATE","priority":"INTERACTIVE","useQueryCache":false,"useLegacySql":false},"jobType":"QUERY"},"jobReference":{"projectId":"tony-allen","jobId":"bqjob_r7af22a93cb588faa_0000019a5ec0a0bd_1","location":"US"},"statistics":{"creationTime":"1762526273968","startTime":"1762526274066","endTime":"1762526275330","totalBytesProcessed":"1594954856","query":{"queryPlan":[{"name":"S00: Input","id":"0","startMs":"1762526274393","endMs":"1762526274625","waitRatioAvg":0.04205607476635514,"waitMsAvg":"9","waitRatioMax":0.06542056074766354,"waitMsMax":"14","readRatioAvg":0.4205607476635514,"readMsAvg":"90","readRatioMax":1,"readMsMax":"214","computeRatioAvg":0.13551401869158877,"computeMsAvg":"29","computeRatioMax":0.3411214953271028,"computeMsMax":"73","writeRatioAvg":0.018691588785046728,"writeMsAvg":"4","writeRatioMax":0.102803738317757,"writeMsMax":"22","shuffleOutputBytes":"32617984","shuffleOutputBytesSpilled":"0","recordsRead":"3714129","recordsWritten":"582464","parallelInputs":"91","completedParallelInputs":"91","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$30:hash, $31:from_address, $32:receipt_status, $33:block_timestamp","FROM bigquery-public-data.crypto_ethereum_classic.transactions","WHERE and(equal($32, 1), greater_or_equal($33, 1577836800.000000000), less($33, 1585699200.000000000))"]},{"kind":"AGGREGATE","substeps":["GROUP BY $150 := $31","$130 := COUNT($30)"]},{"kind":"WRITE","substeps":["$150, $130","TO __stage00_output","BY HASH($150)"]}],"slotMs":"17711","computeMode":"BIGQUERY"},{"name":"S01: Sort+","id":"1","startMs":"1762526274628","endMs":"1762526274668","inputStages":["0"],"waitRatioAvg":0.004672897196261682,"waitMsAvg":"1","waitRatioMax":0.004672897196261682,"waitMsMax":"1","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.13551401869158877,"computeMsAvg":"29","computeRatioMax":0.16822429906542055,"computeMsMax":"36","writeRatioAvg":0.004672897196261682,"writeMsAvg":"1","writeRatioMax":0.014018691588785047,"writeMsMax":"3","shuffleOutputBytes":"2520","shuffleOutputBytesSpilled":"0","recordsRead":"582464","recordsWritten":"45","parallelInputs":"9","completedParallelInputs":"9","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$150, $130","FROM __stage00_output"]},{"kind":"SORT","substeps":["$110 DESC","LIMIT 5"]},{"kind":"AGGREGATE","substeps":["GROUP BY $160 := $150","$110 := SUM_OF_COUNTS($130)"]},{"kind":"WRITE","substeps":["$170, $171","TO __stage01_output"]}],"slotMs":"411","computeMode":"BIGQUERY"},{"name":"S02: Sort","id":"2","startMs":"1762526274639","endMs":"1762526274673","inputStages":["1"],"waitRatioAvg":0.06542056074766354,"waitMsAvg":"14","waitRatioMax":0.06542056074766354,"waitMsMax":"14","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.06542056074766354,"computeMsAvg":"14","computeRatioMax":0.06542056074766354,"computeMsMax":"14","writeRatioAvg":0.014018691588785047,"writeMsAvg":"3","writeRatioMax":0.014018691588785047,"writeMsMax":"3","shuffleOutputBytes":"235","shuffleOutputBytesSpilled":"0","recordsRead":"45","recordsWritten":"5","parallelInputs":"1","completedParallelInputs":"1","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$170, $171","FROM __stage01_output"]},{"kind":"SORT","substeps":["$100 DESC","LIMIT 5"]},{"kind":"WRITE","substeps":["$220","TO __stage02_output"]}],"slotMs":"41","computeMode":"BIGQUERY"},{"name":"S04: Sort","id":"4","startMs":"1762526274664","endMs":"1762526274700","inputStages":["1"],"waitRatioAvg":0.028037383177570093,"waitMsAvg":"6","waitRatioMax":0.028037383177570093,"waitMsMax":"6","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.0514018691588785,"computeMsAvg":"11","computeRatioMax":0.0514018691588785,"computeMsMax":"11","writeRatioAvg":0.0794392523364486,"writeMsAvg":"17","writeRatioMax":0.0794392523364486,"writeMsMax":"17","shuffleOutputBytes":"235","shuffleOutputBytesSpilled":"0","recordsRead":"45","recordsWritten":"5","parallelInputs":"1","completedParallelInputs":"1","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$170, $171","FROM __stage01_output"]},{"kind":"SORT","substeps":["$171 DESC","LIMIT 5"]},{"kind":"WRITE","substeps":["$180","TO __stage04_output"]}],"slotMs":"73","computeMode":"BIGQUERY"},{"name":"S06: Coalesce","id":"6","startMs":"1762526274682","endMs":"1762526274742","inputStages":["2"],"waitRatioAvg":0.02336448598130841,"waitMsAvg":"5","waitRatioMax":0.028037383177570093,"waitMsMax":"6","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.04205607476635514,"computeMsAvg":"9","computeRatioMax":0.07476635514018691,"computeMsMax":"16","writeRatioAvg":0.056074766355140186,"writeMsAvg":"12","writeRatioMax":0.14018691588785046,"writeMsMax":"30","shuffleOutputBytes":"235","shuffleOutputBytesSpilled":"0","recordsRead":"5","recordsWritten":"5","parallelInputs":"100","completedParallelInputs":"100","status":"COMPLETE","steps":[{"kind":"READ","substeps":["FROM __stage02_output"]}],"slotMs":"6298","computeMode":"BIGQUERY"},{"name":"S07: Output","id":"7","startMs":"1762526274682","endMs":"1762526274731","inputStages":["2"],"waitRatioAvg":0.02336448598130841,"waitMsAvg":"5","waitRatioMax":0.028037383177570093,"waitMsMax":"6","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.04205607476635514,"computeMsAvg":"9","computeRatioMax":0.06542056074766354,"computeMsMax":"14","writeRatioAvg":0.02336448598130841,"writeMsAvg":"5","writeRatioMax":0.08878504672897196,"writeMsMax":"19","shuffleOutputBytes":"2075","shuffleOutputBytesSpilled":"0","recordsRead":"5","recordsWritten":"100","parallelInputs":"100","completedParallelInputs":"100","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$220","FROM __stage02_output"]},{"kind":"COMPUTE","substeps":["$291 := if(less_or_equal(array_length($287), 1000), $287, NULL)","$286 := if(greater(array_length($287), 1000), 1, 0)"]},{"kind":"AGGREGATE","substeps":["$284 := MIN($220)","$285 := MAX($220)","$287 := DISTINCT_ARRAY_AGG($288 LIMIT 1001)","$289 := MAX($290)"]},{"kind":"COMPUTE","substeps":["$288 := if(less_or_equal(length($220), 1024), $220, NULL)","$290 := length($220)"]},{"kind":"WRITE","substeps":["$284, $285, $286, $291, $289","TO __stage07_output"]}],"slotMs":"4935","computeMode":"BIGQUERY"},{"name":"S08: Coalesce","id":"8","startMs":"1762526274716","endMs":"1762526274778","inputStages":["4"],"waitRatioAvg":0.004672897196261682,"waitMsAvg":"1","waitRatioMax":0.009345794392523364,"waitMsMax":"2","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.04205607476635514,"computeMsAvg":"9","computeRatioMax":0.07476635514018691,"computeMsMax":"16","writeRatioAvg":0.06542056074766354,"writeMsAvg":"14","writeRatioMax":0.14018691588785046,"writeMsMax":"30","shuffleOutputBytes":"235","shuffleOutputBytesSpilled":"0","recordsRead":"5","recordsWritten":"5","parallelInputs":"100","completedParallelInputs":"100","status":"COMPLETE","steps":[{"kind":"READ","substeps":["FROM __stage04_output"]}],"slotMs":"6374","computeMode":"BIGQUERY"},{"name":"S09: Join+","id":"9","startMs":"1762526274731","endMs":"1762526274827","inputStages":["8"],"waitRatioAvg":0.028037383177570093,"waitMsAvg":"6","waitRatioMax":0.056074766355140186,"waitMsMax":"12","readRatioAvg":0.04205607476635514,"readMsAvg":"9","readRatioMax":0.08878504672897196,"readMsMax":"19","computeRatioAvg":0.102803738317757,"computeMsAvg":"22","computeRatioMax":0.16822429906542055,"computeMsMax":"36","writeRatioAvg":0.018691588785046728,"writeMsAvg":"4","writeRatioMax":0.06542056074766354,"writeMsMax":"14","shuffleOutputBytes":"27328","shuffleOutputBytesSpilled":"0","recordsRead":"3714584","recordsWritten":"427","parallelInputs":"91","completedParallelInputs":"91","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$10:from_address, $11:gas_price, $12:receipt_gas_used, $13:receipt_status, $14:block_timestamp","FROM bigquery-public-data.crypto_ethereum_classic.transactions","WHERE and(greater_or_equal($14, 1577836800.000000000), less($14, 1585699200.000000000), equal($13, 1))"]},{"kind":"READ","substeps":["$180","FROM __stage08_output"]},{"kind":"AGGREGATE","substeps":["GROUP BY $200 := $190","$70 := SUM($90)"]},{"kind":"COMPUTE","substeps":["$90 := multiply(CAST($191 AS NUMERIC), CAST($192 AS NUMERIC))"]},{"kind":"JOIN","substeps":["$190 := $10, $191 := $11, $192 := $12","INNER HASH JOIN EACH  WITH ALL  ON $10 = $180"]},{"kind":"WRITE","substeps":["$200, $70","TO __stage09_output","BY HASH($200)"]}],"slotMs":"8513","computeMode":"BIGQUERY"},{"name":"S0A: Join+","id":"10","startMs":"1762526274753","endMs":"1762526274948","inputStages":["6"],"waitRatioAvg":0.004672897196261682,"waitMsAvg":"1","waitRatioMax":0.009345794392523364,"waitMsMax":"2","readRatioAvg":0.2102803738317757,"readMsAvg":"45","readRatioMax":0.6495327102803738,"readMsMax":"139","computeRatioAvg":0.14953271028037382,"computeMsAvg":"32","computeRatioMax":0.35514018691588783,"computeMsMax":"76","writeRatioAvg":0.018691588785046728,"writeMsAvg":"4","writeRatioMax":0.06542056074766354,"writeMsMax":"14","shuffleOutputBytes":"27328","shuffleOutputBytesSpilled":"0","recordsRead":"15994372","recordsWritten":"427","parallelInputs":"91","completedParallelInputs":"91","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$1:from_address, $2:value, $3:block_timestamp","FROM bigquery-public-data.crypto_ethereum_classic.traces","WHERE and(greater_or_equal($3, 1577836800.000000000), less($3, 1585699200.000000000), ...)"]},{"kind":"READ","substeps":["$220","FROM __stage06_output"]},{"kind":"AGGREGATE","substeps":["GROUP BY $240 := $230","$80 := SUM($231)"]},{"kind":"JOIN","substeps":["$230 := $1, $231 := $2","INNER HASH JOIN EACH  WITH ALL  ON $1 = $220"]},{"kind":"WRITE","substeps":["$240, $80","TO __stage0A_output","BY HASH($240)"]}],"slotMs":"9600","computeMode":"BIGQUERY"},{"name":"S0B: Aggregate","id":"11","startMs":"1762526274969","endMs":"1762526275002","inputStages":["10"],"waitRatioAvg":0.004672897196261682,"waitMsAvg":"1","waitRatioMax":0.004672897196261682,"waitMsMax":"1","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.0514018691588785,"computeMsAvg":"11","computeRatioMax":0.0794392523364486,"computeMsMax":"17","writeRatioAvg":0.08878504672897196,"writeMsAvg":"19","writeRatioMax":0.11214953271028037,"writeMsMax":"24","shuffleOutputBytes":"320","shuffleOutputBytesSpilled":"0","recordsRead":"427","recordsWritten":"5","parallelInputs":"9","completedParallelInputs":"9","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$240, $80","FROM __stage0A_output"]},{"kind":"AGGREGATE","substeps":["GROUP BY $250 := $240","$60 := SUM($80)"]},{"kind":"WRITE","substeps":["$60, $250","TO __stage0B_output"]}],"slotMs":"438","computeMode":"BIGQUERY"},{"name":"S0D: Coalesce","id":"13","startMs":"1762526275014","endMs":"1762526275070","inputStages":["11"],"waitRatioAvg":0.02336448598130841,"waitMsAvg":"5","waitRatioMax":0.028037383177570093,"waitMsMax":"6","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.04672897196261682,"computeMsAvg":"10","computeRatioMax":0.07009345794392523,"computeMsMax":"15","writeRatioAvg":0.07009345794392523,"writeMsAvg":"15","writeRatioMax":0.1542056074766355,"writeMsMax":"33","shuffleOutputBytes":"320","shuffleOutputBytesSpilled":"0","recordsRead":"5","recordsWritten":"5","parallelInputs":"100","completedParallelInputs":"100","status":"COMPLETE","steps":[{"kind":"READ","substeps":["FROM __stage0B_output"]}],"slotMs":"6541","computeMode":"BIGQUERY"},{"name":"S0E: Join+","id":"14","startMs":"1762526275017","endMs":"1762526275086","inputStages":["13","9"],"waitRatioAvg":0.02336448598130841,"waitMsAvg":"5","waitRatioMax":0.02336448598130841,"waitMsMax":"5","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.056074766355140186,"computeMsAvg":"12","computeRatioMax":0.08878504672897196,"computeMsMax":"19","writeRatioAvg":0.037383177570093455,"writeMsAvg":"8","writeRatioMax":0.0794392523364486,"writeMsMax":"17","shuffleOutputBytes":"490","shuffleOutputBytesSpilled":"0","recordsRead":"447","recordsWritten":"5","parallelInputs":"9","completedParallelInputs":"9","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$200, $70","FROM __stage09_output"]},{"kind":"READ","substeps":["$60, $250","FROM __stage0D_output"]},{"kind":"SORT","substeps":["$40 DESC","LIMIT 100"]},{"kind":"COMPUTE","substeps":["$40 := subtract($262, $261)"]},{"kind":"JOIN","substeps":["$260 := $210, $261 := $50, $262 := $60","INNER HASH JOIN EACH  WITH ALL  ON $210 = $250"]},{"kind":"AGGREGATE","substeps":["GROUP BY $210 := $200","$50 := SUM($70)"]},{"kind":"WRITE","substeps":["$270, $271, $272, $273","TO __stage0E_output"]}],"slotMs":"686","computeMode":"BIGQUERY"},{"name":"S0F: Output","id":"15","startMs":"1762526275022","endMs":"1762526275099","inputStages":["14"],"waitRatioAvg":0.06074766355140187,"waitMsAvg":"13","waitRatioMax":0.06074766355140187,"waitMsMax":"13","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.03271028037383177,"computeMsAvg":"7","computeRatioMax":0.03271028037383177,"computeMsMax":"7","writeRatioAvg":0.02336448598130841,"writeMsAvg":"5","writeRatioMax":0.02336448598130841,"writeMsMax":"5","shuffleOutputBytes":"490","shuffleOutputBytesSpilled":"0","recordsRead":"5","recordsWritten":"5","parallelInputs":"1","completedParallelInputs":"1","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$270, $271, $272, $273","FROM __stage0E_output"]},{"kind":"SORT","substeps":["$271 DESC","LIMIT 100"]},{"kind":"WRITE","substeps":["$280, $281, $282, $283","TO __stage0F_output"]}],"slotMs":"20","computeMode":"BIGQUERY"}],"estimatedBytesProcessed":"1594954856","timeline":[{"elapsedMs":"934","totalSlotMs":"62325","pendingUnits":"1","completedUnits":"583","activeUnits":"3","estimatedRunnableUnits":"0"},{"elapsedMs":"1041","totalSlotMs":"62325","pendingUnits":"0","completedUnits":"703","estimatedRunnableUnits":"0"}],"totalPartitionsProcessed":"182","totalBytesProcessed":"1594954856","totalBytesBilled":"1595932672","billingTier":1,"totalSlotMs":"62325","cacheHit":false,"referencedTables":[{"projectId":"bigquery-public-data","datasetId":"crypto_ethereum_classic","tableId":"transactions"},{"projectId":"bigquery-public-data","datasetId":"crypto_ethereum_classic","tableId":"traces"}],"statementType":"SELECT","searchStatistics":{"indexUsageMode":"UNUSED","indexUnusedReasons":[{"code":"INDEX_CONFIG_NOT_AVAILABLE","message":"There is no index configuration for the base table `bigquery-public-data:crypto_ethereum_classic.traces`.","baseTable":{"projectId":"bigquery-public-data","datasetId":"crypto_ethereum_classic","tableId":"traces"}},{"code":"INDEX_CONFIG_NOT_AVAILABLE","message":"There is no index configuration for the base table `bigquery-public-data:crypto_ethereum_classic.transactions`.","baseTable":{"projectId":"bigquery-public-data","datasetId":"crypto_ethereum_classic","tableId":"transactions"}}]},"performanceInsights":{"avgPreviousExecutionMs":"1318"},"transferredBytes":"0","metadataCacheStatistics":{"tableMetadataCacheUsage":[{"tableReference":{"projectId":"bigquery-public-data","datasetId":"crypto_ethereum_classic","tableId":"transactions"},"unusedReason":"OTHER_REASON"},{"tableReference":{"projectId":"bigquery-public-data","datasetId":"crypto_ethereum_classic","tableId":"traces"},"unusedReason":"OTHER_REASON"}]}},"totalSlotMs":"62325","finalExecutionDurationMs":"750"},"status":{"state":"DONE"},"principal_subject":"user:admin@bentrollope.altostrat.com","jobCreationReason":{"code":"REQUESTED"}}'
+ total_slot_ms=62325
++ echo '{"kind":"bigquery#job","etag":"FmaAPsb+BGvS0Vv40DeGOg==","id":"tony-allen:US.bqjob_r7af22a93cb588faa_0000019a5ec0a0bd_1","selfLink":"https://bigquery.googleapis.com/bigquery/v2/projects/tony-allen/jobs/bqjob_r7af22a93cb588faa_0000019a5ec0a0bd_1?location=US","user_email":"admin@bentrollope.altostrat.com","configuration":{"query":{"query":"WITH TopSenders AS (\n    -- CTE 1: Identify the top 5 addresses based on the count of successful transactions\n    SELECT\n        t.from_address AS address,\n        COUNT(t.hash) AS transaction_count\n    FROM\n        `bigquery-public-data.crypto_ethereum_classic.transactions` AS t\n    WHERE\n        t.receipt_status = 1 \n        AND t.block_timestamp >= '\''2020-01-01 00:00:00 UTC'\'' \n        AND t.block_timestamp < '\''2020-04-01 00:00:00 UTC'\''  \n    GROUP BY\n        1\n    ORDER BY\n        transaction_count DESC\n    LIMIT 5\n),\n\nTotalFees AS (\n    -- CTE 2: Requires a second scan of the '\''transactions'\'' table unnecessarily\n    SELECT\n        t.from_address AS address,\n        SUM(CAST(t.gas_price AS NUMERIC) * CAST(t.receipt_gas_used AS NUMERIC)) AS total_fees_paid\n    FROM\n        `bigquery-public-data.crypto_ethereum_classic.transactions` AS t\n    INNER JOIN\n        TopSenders AS s ON t.from_address = s.address\n    WHERE\n        t.block_timestamp >= '\''2020-01-01 00:00:00 UTC'\''\n        AND t.block_timestamp < '\''2020-04-01 00:00:00 UTC'\''\n        AND t.receipt_status = 1\n    GROUP BY\n        1\n),\n\nTotalValueSent AS (\n    -- CTE 3: Scans the '\''traces'\'' table\n    SELECT\n        tr.from_address AS address,\n        SUM(tr.value) AS total_value_sent\n    FROM\n        `bigquery-public-data.crypto_ethereum_classic.traces` AS tr\n    INNER JOIN\n        TopSenders AS s ON tr.from_address = s.address\n    WHERE\n        tr.block_timestamp >= '\''2020-01-01 00:00:00 UTC'\''  \n        AND tr.block_timestamp < '\''2020-04-01 00:00:00 UTC'\'' \n    GROUP BY\n        1\n)\n\n-- Final SELECT: Joins the calculated fees and values to find the net ether flow\nSELECT\n    f.address,\n    v.total_value_sent,\n    f.total_fees_paid,\n    v.total_value_sent - f.total_fees_paid AS net_ether_flow_wei\nFROM\n    TotalFees AS f\nINNER JOIN\n    TotalValueSent AS v ON f.address = v.address\nORDER BY\n    net_ether_flow_wei DESC\nLIMIT 100","destinationTable":{"projectId":"tony-allen","datasetId":"_e34c49c766e4fd3f5d404c3949b9e19fa7acb372","tableId":"anonc5ee9f31_131e_4177_b506_9f08344248e5"},"writeDisposition":"WRITE_TRUNCATE","priority":"INTERACTIVE","useQueryCache":false,"useLegacySql":false},"jobType":"QUERY"},"jobReference":{"projectId":"tony-allen","jobId":"bqjob_r7af22a93cb588faa_0000019a5ec0a0bd_1","location":"US"},"statistics":{"creationTime":"1762526273968","startTime":"1762526274066","endTime":"1762526275330","totalBytesProcessed":"1594954856","query":{"queryPlan":[{"name":"S00: Input","id":"0","startMs":"1762526274393","endMs":"1762526274625","waitRatioAvg":0.04205607476635514,"waitMsAvg":"9","waitRatioMax":0.06542056074766354,"waitMsMax":"14","readRatioAvg":0.4205607476635514,"readMsAvg":"90","readRatioMax":1,"readMsMax":"214","computeRatioAvg":0.13551401869158877,"computeMsAvg":"29","computeRatioMax":0.3411214953271028,"computeMsMax":"73","writeRatioAvg":0.018691588785046728,"writeMsAvg":"4","writeRatioMax":0.102803738317757,"writeMsMax":"22","shuffleOutputBytes":"32617984","shuffleOutputBytesSpilled":"0","recordsRead":"3714129","recordsWritten":"582464","parallelInputs":"91","completedParallelInputs":"91","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$30:hash, $31:from_address, $32:receipt_status, $33:block_timestamp","FROM bigquery-public-data.crypto_ethereum_classic.transactions","WHERE and(equal($32, 1), greater_or_equal($33, 1577836800.000000000), less($33, 1585699200.000000000))"]},{"kind":"AGGREGATE","substeps":["GROUP BY $150 := $31","$130 := COUNT($30)"]},{"kind":"WRITE","substeps":["$150, $130","TO __stage00_output","BY HASH($150)"]}],"slotMs":"17711","computeMode":"BIGQUERY"},{"name":"S01: Sort+","id":"1","startMs":"1762526274628","endMs":"1762526274668","inputStages":["0"],"waitRatioAvg":0.004672897196261682,"waitMsAvg":"1","waitRatioMax":0.004672897196261682,"waitMsMax":"1","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.13551401869158877,"computeMsAvg":"29","computeRatioMax":0.16822429906542055,"computeMsMax":"36","writeRatioAvg":0.004672897196261682,"writeMsAvg":"1","writeRatioMax":0.014018691588785047,"writeMsMax":"3","shuffleOutputBytes":"2520","shuffleOutputBytesSpilled":"0","recordsRead":"582464","recordsWritten":"45","parallelInputs":"9","completedParallelInputs":"9","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$150, $130","FROM __stage00_output"]},{"kind":"SORT","substeps":["$110 DESC","LIMIT 5"]},{"kind":"AGGREGATE","substeps":["GROUP BY $160 := $150","$110 := SUM_OF_COUNTS($130)"]},{"kind":"WRITE","substeps":["$170, $171","TO __stage01_output"]}],"slotMs":"411","computeMode":"BIGQUERY"},{"name":"S02: Sort","id":"2","startMs":"1762526274639","endMs":"1762526274673","inputStages":["1"],"waitRatioAvg":0.06542056074766354,"waitMsAvg":"14","waitRatioMax":0.06542056074766354,"waitMsMax":"14","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.06542056074766354,"computeMsAvg":"14","computeRatioMax":0.06542056074766354,"computeMsMax":"14","writeRatioAvg":0.014018691588785047,"writeMsAvg":"3","writeRatioMax":0.014018691588785047,"writeMsMax":"3","shuffleOutputBytes":"235","shuffleOutputBytesSpilled":"0","recordsRead":"45","recordsWritten":"5","parallelInputs":"1","completedParallelInputs":"1","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$170, $171","FROM __stage01_output"]},{"kind":"SORT","substeps":["$100 DESC","LIMIT 5"]},{"kind":"WRITE","substeps":["$220","TO __stage02_output"]}],"slotMs":"41","computeMode":"BIGQUERY"},{"name":"S04: Sort","id":"4","startMs":"1762526274664","endMs":"1762526274700","inputStages":["1"],"waitRatioAvg":0.028037383177570093,"waitMsAvg":"6","waitRatioMax":0.028037383177570093,"waitMsMax":"6","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.0514018691588785,"computeMsAvg":"11","computeRatioMax":0.0514018691588785,"computeMsMax":"11","writeRatioAvg":0.0794392523364486,"writeMsAvg":"17","writeRatioMax":0.0794392523364486,"writeMsMax":"17","shuffleOutputBytes":"235","shuffleOutputBytesSpilled":"0","recordsRead":"45","recordsWritten":"5","parallelInputs":"1","completedParallelInputs":"1","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$170, $171","FROM __stage01_output"]},{"kind":"SORT","substeps":["$171 DESC","LIMIT 5"]},{"kind":"WRITE","substeps":["$180","TO __stage04_output"]}],"slotMs":"73","computeMode":"BIGQUERY"},{"name":"S06: Coalesce","id":"6","startMs":"1762526274682","endMs":"1762526274742","inputStages":["2"],"waitRatioAvg":0.02336448598130841,"waitMsAvg":"5","waitRatioMax":0.028037383177570093,"waitMsMax":"6","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.04205607476635514,"computeMsAvg":"9","computeRatioMax":0.07476635514018691,"computeMsMax":"16","writeRatioAvg":0.056074766355140186,"writeMsAvg":"12","writeRatioMax":0.14018691588785046,"writeMsMax":"30","shuffleOutputBytes":"235","shuffleOutputBytesSpilled":"0","recordsRead":"5","recordsWritten":"5","parallelInputs":"100","completedParallelInputs":"100","status":"COMPLETE","steps":[{"kind":"READ","substeps":["FROM __stage02_output"]}],"slotMs":"6298","computeMode":"BIGQUERY"},{"name":"S07: Output","id":"7","startMs":"1762526274682","endMs":"1762526274731","inputStages":["2"],"waitRatioAvg":0.02336448598130841,"waitMsAvg":"5","waitRatioMax":0.028037383177570093,"waitMsMax":"6","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.04205607476635514,"computeMsAvg":"9","computeRatioMax":0.06542056074766354,"computeMsMax":"14","writeRatioAvg":0.02336448598130841,"writeMsAvg":"5","writeRatioMax":0.08878504672897196,"writeMsMax":"19","shuffleOutputBytes":"2075","shuffleOutputBytesSpilled":"0","recordsRead":"5","recordsWritten":"100","parallelInputs":"100","completedParallelInputs":"100","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$220","FROM __stage02_output"]},{"kind":"COMPUTE","substeps":["$291 := if(less_or_equal(array_length($287), 1000), $287, NULL)","$286 := if(greater(array_length($287), 1000), 1, 0)"]},{"kind":"AGGREGATE","substeps":["$284 := MIN($220)","$285 := MAX($220)","$287 := DISTINCT_ARRAY_AGG($288 LIMIT 1001)","$289 := MAX($290)"]},{"kind":"COMPUTE","substeps":["$288 := if(less_or_equal(length($220), 1024), $220, NULL)","$290 := length($220)"]},{"kind":"WRITE","substeps":["$284, $285, $286, $291, $289","TO __stage07_output"]}],"slotMs":"4935","computeMode":"BIGQUERY"},{"name":"S08: Coalesce","id":"8","startMs":"1762526274716","endMs":"1762526274778","inputStages":["4"],"waitRatioAvg":0.004672897196261682,"waitMsAvg":"1","waitRatioMax":0.009345794392523364,"waitMsMax":"2","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.04205607476635514,"computeMsAvg":"9","computeRatioMax":0.07476635514018691,"computeMsMax":"16","writeRatioAvg":0.06542056074766354,"writeMsAvg":"14","writeRatioMax":0.14018691588785046,"writeMsMax":"30","shuffleOutputBytes":"235","shuffleOutputBytesSpilled":"0","recordsRead":"5","recordsWritten":"5","parallelInputs":"100","completedParallelInputs":"100","status":"COMPLETE","steps":[{"kind":"READ","substeps":["FROM __stage04_output"]}],"slotMs":"6374","computeMode":"BIGQUERY"},{"name":"S09: Join+","id":"9","startMs":"1762526274731","endMs":"1762526274827","inputStages":["8"],"waitRatioAvg":0.028037383177570093,"waitMsAvg":"6","waitRatioMax":0.056074766355140186,"waitMsMax":"12","readRatioAvg":0.04205607476635514,"readMsAvg":"9","readRatioMax":0.08878504672897196,"readMsMax":"19","computeRatioAvg":0.102803738317757,"computeMsAvg":"22","computeRatioMax":0.16822429906542055,"computeMsMax":"36","writeRatioAvg":0.018691588785046728,"writeMsAvg":"4","writeRatioMax":0.06542056074766354,"writeMsMax":"14","shuffleOutputBytes":"27328","shuffleOutputBytesSpilled":"0","recordsRead":"3714584","recordsWritten":"427","parallelInputs":"91","completedParallelInputs":"91","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$10:from_address, $11:gas_price, $12:receipt_gas_used, $13:receipt_status, $14:block_timestamp","FROM bigquery-public-data.crypto_ethereum_classic.transactions","WHERE and(greater_or_equal($14, 1577836800.000000000), less($14, 1585699200.000000000), equal($13, 1))"]},{"kind":"READ","substeps":["$180","FROM __stage08_output"]},{"kind":"AGGREGATE","substeps":["GROUP BY $200 := $190","$70 := SUM($90)"]},{"kind":"COMPUTE","substeps":["$90 := multiply(CAST($191 AS NUMERIC), CAST($192 AS NUMERIC))"]},{"kind":"JOIN","substeps":["$190 := $10, $191 := $11, $192 := $12","INNER HASH JOIN EACH  WITH ALL  ON $10 = $180"]},{"kind":"WRITE","substeps":["$200, $70","TO __stage09_output","BY HASH($200)"]}],"slotMs":"8513","computeMode":"BIGQUERY"},{"name":"S0A: Join+","id":"10","startMs":"1762526274753","endMs":"1762526274948","inputStages":["6"],"waitRatioAvg":0.004672897196261682,"waitMsAvg":"1","waitRatioMax":0.009345794392523364,"waitMsMax":"2","readRatioAvg":0.2102803738317757,"readMsAvg":"45","readRatioMax":0.6495327102803738,"readMsMax":"139","computeRatioAvg":0.14953271028037382,"computeMsAvg":"32","computeRatioMax":0.35514018691588783,"computeMsMax":"76","writeRatioAvg":0.018691588785046728,"writeMsAvg":"4","writeRatioMax":0.06542056074766354,"writeMsMax":"14","shuffleOutputBytes":"27328","shuffleOutputBytesSpilled":"0","recordsRead":"15994372","recordsWritten":"427","parallelInputs":"91","completedParallelInputs":"91","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$1:from_address, $2:value, $3:block_timestamp","FROM bigquery-public-data.crypto_ethereum_classic.traces","WHERE and(greater_or_equal($3, 1577836800.000000000), less($3, 1585699200.000000000), ...)"]},{"kind":"READ","substeps":["$220","FROM __stage06_output"]},{"kind":"AGGREGATE","substeps":["GROUP BY $240 := $230","$80 := SUM($231)"]},{"kind":"JOIN","substeps":["$230 := $1, $231 := $2","INNER HASH JOIN EACH  WITH ALL  ON $1 = $220"]},{"kind":"WRITE","substeps":["$240, $80","TO __stage0A_output","BY HASH($240)"]}],"slotMs":"9600","computeMode":"BIGQUERY"},{"name":"S0B: Aggregate","id":"11","startMs":"1762526274969","endMs":"1762526275002","inputStages":["10"],"waitRatioAvg":0.004672897196261682,"waitMsAvg":"1","waitRatioMax":0.004672897196261682,"waitMsMax":"1","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.0514018691588785,"computeMsAvg":"11","computeRatioMax":0.0794392523364486,"computeMsMax":"17","writeRatioAvg":0.08878504672897196,"writeMsAvg":"19","writeRatioMax":0.11214953271028037,"writeMsMax":"24","shuffleOutputBytes":"320","shuffleOutputBytesSpilled":"0","recordsRead":"427","recordsWritten":"5","parallelInputs":"9","completedParallelInputs":"9","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$240, $80","FROM __stage0A_output"]},{"kind":"AGGREGATE","substeps":["GROUP BY $250 := $240","$60 := SUM($80)"]},{"kind":"WRITE","substeps":["$60, $250","TO __stage0B_output"]}],"slotMs":"438","computeMode":"BIGQUERY"},{"name":"S0D: Coalesce","id":"13","startMs":"1762526275014","endMs":"1762526275070","inputStages":["11"],"waitRatioAvg":0.02336448598130841,"waitMsAvg":"5","waitRatioMax":0.028037383177570093,"waitMsMax":"6","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.04672897196261682,"computeMsAvg":"10","computeRatioMax":0.07009345794392523,"computeMsMax":"15","writeRatioAvg":0.07009345794392523,"writeMsAvg":"15","writeRatioMax":0.1542056074766355,"writeMsMax":"33","shuffleOutputBytes":"320","shuffleOutputBytesSpilled":"0","recordsRead":"5","recordsWritten":"5","parallelInputs":"100","completedParallelInputs":"100","status":"COMPLETE","steps":[{"kind":"READ","substeps":["FROM __stage0B_output"]}],"slotMs":"6541","computeMode":"BIGQUERY"},{"name":"S0E: Join+","id":"14","startMs":"1762526275017","endMs":"1762526275086","inputStages":["13","9"],"waitRatioAvg":0.02336448598130841,"waitMsAvg":"5","waitRatioMax":0.02336448598130841,"waitMsMax":"5","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.056074766355140186,"computeMsAvg":"12","computeRatioMax":0.08878504672897196,"computeMsMax":"19","writeRatioAvg":0.037383177570093455,"writeMsAvg":"8","writeRatioMax":0.0794392523364486,"writeMsMax":"17","shuffleOutputBytes":"490","shuffleOutputBytesSpilled":"0","recordsRead":"447","recordsWritten":"5","parallelInputs":"9","completedParallelInputs":"9","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$200, $70","FROM __stage09_output"]},{"kind":"READ","substeps":["$60, $250","FROM __stage0D_output"]},{"kind":"SORT","substeps":["$40 DESC","LIMIT 100"]},{"kind":"COMPUTE","substeps":["$40 := subtract($262, $261)"]},{"kind":"JOIN","substeps":["$260 := $210, $261 := $50, $262 := $60","INNER HASH JOIN EACH  WITH ALL  ON $210 = $250"]},{"kind":"AGGREGATE","substeps":["GROUP BY $210 := $200","$50 := SUM($70)"]},{"kind":"WRITE","substeps":["$270, $271, $272, $273","TO __stage0E_output"]}],"slotMs":"686","computeMode":"BIGQUERY"},{"name":"S0F: Output","id":"15","startMs":"1762526275022","endMs":"1762526275099","inputStages":["14"],"waitRatioAvg":0.06074766355140187,"waitMsAvg":"13","waitRatioMax":0.06074766355140187,"waitMsMax":"13","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.03271028037383177,"computeMsAvg":"7","computeRatioMax":0.03271028037383177,"computeMsMax":"7","writeRatioAvg":0.02336448598130841,"writeMsAvg":"5","writeRatioMax":0.02336448598130841,"writeMsMax":"5","shuffleOutputBytes":"490","shuffleOutputBytesSpilled":"0","recordsRead":"5","recordsWritten":"5","parallelInputs":"1","completedParallelInputs":"1","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$270, $271, $272, $273","FROM __stage0E_output"]},{"kind":"SORT","substeps":["$271 DESC","LIMIT 100"]},{"kind":"WRITE","substeps":["$280, $281, $282, $283","TO __stage0F_output"]}],"slotMs":"20","computeMode":"BIGQUERY"}],"estimatedBytesProcessed":"1594954856","timeline":[{"elapsedMs":"934","totalSlotMs":"62325","pendingUnits":"1","completedUnits":"583","activeUnits":"3","estimatedRunnableUnits":"0"},{"elapsedMs":"1041","totalSlotMs":"62325","pendingUnits":"0","completedUnits":"703","estimatedRunnableUnits":"0"}],"totalPartitionsProcessed":"182","totalBytesProcessed":"1594954856","totalBytesBilled":"1595932672","billingTier":1,"totalSlotMs":"62325","cacheHit":false,"referencedTables":[{"projectId":"bigquery-public-data","datasetId":"crypto_ethereum_classic","tableId":"transactions"},{"projectId":"bigquery-public-data","datasetId":"crypto_ethereum_classic","tableId":"traces"}],"statementType":"SELECT","searchStatistics":{"indexUsageMode":"UNUSED","indexUnusedReasons":[{"code":"INDEX_CONFIG_NOT_AVAILABLE","message":"There is no index configuration for the base table `bigquery-public-data:crypto_ethereum_classic.traces`.","baseTable":{"projectId":"bigquery-public-data","datasetId":"crypto_ethereum_classic","tableId":"traces"}},{"code":"INDEX_CONFIG_NOT_AVAILABLE","message":"There is no index configuration for the base table `bigquery-public-data:crypto_ethereum_classic.transactions`.","baseTable":{"projectId":"bigquery-public-data","datasetId":"crypto_ethereum_classic","tableId":"transactions"}}]},"performanceInsights":{"avgPreviousExecutionMs":"1318"},"transferredBytes":"0","metadataCacheStatistics":{"tableMetadataCacheUsage":[{"tableReference":{"projectId":"bigquery-public-data","datasetId":"crypto_ethereum_classic","tableId":"transactions"},"unusedReason":"OTHER_REASON"},{"tableReference":{"projectId":"bigquery-public-data","datasetId":"crypto_ethereum_classic","tableId":"traces"},"unusedReason":"OTHER_REASON"}]}},"totalSlotMs":"62325","finalExecutionDurationMs":"750"},"status":{"state":"DONE"},"principal_subject":"user:admin@bentrollope.altostrat.com","jobCreationReason":{"code":"REQUESTED"}}'
++ jq -r .statistics.startTime
+ start_time=1762526274066
++ echo '{"kind":"bigquery#job","etag":"FmaAPsb+BGvS0Vv40DeGOg==","id":"tony-allen:US.bqjob_r7af22a93cb588faa_0000019a5ec0a0bd_1","selfLink":"https://bigquery.googleapis.com/bigquery/v2/projects/tony-allen/jobs/bqjob_r7af22a93cb588faa_0000019a5ec0a0bd_1?location=US","user_email":"admin@bentrollope.altostrat.com","configuration":{"query":{"query":"WITH TopSenders AS (\n    -- CTE 1: Identify the top 5 addresses based on the count of successful transactions\n    SELECT\n        t.from_address AS address,\n        COUNT(t.hash) AS transaction_count\n    FROM\n        `bigquery-public-data.crypto_ethereum_classic.transactions` AS t\n    WHERE\n        t.receipt_status = 1 \n        AND t.block_timestamp >= '\''2020-01-01 00:00:00 UTC'\'' \n        AND t.block_timestamp < '\''2020-04-01 00:00:00 UTC'\''  \n    GROUP BY\n        1\n    ORDER BY\n        transaction_count DESC\n    LIMIT 5\n),\n\nTotalFees AS (\n    -- CTE 2: Requires a second scan of the '\''transactions'\'' table unnecessarily\n    SELECT\n        t.from_address AS address,\n        SUM(CAST(t.gas_price AS NUMERIC) * CAST(t.receipt_gas_used AS NUMERIC)) AS total_fees_paid\n    FROM\n        `bigquery-public-data.crypto_ethereum_classic.transactions` AS t\n    INNER JOIN\n        TopSenders AS s ON t.from_address = s.address\n    WHERE\n        t.block_timestamp >= '\''2020-01-01 00:00:00 UTC'\''\n        AND t.block_timestamp < '\''2020-04-01 00:00:00 UTC'\''\n        AND t.receipt_status = 1\n    GROUP BY\n        1\n),\n\nTotalValueSent AS (\n    -- CTE 3: Scans the '\''traces'\'' table\n    SELECT\n        tr.from_address AS address,\n        SUM(tr.value) AS total_value_sent\n    FROM\n        `bigquery-public-data.crypto_ethereum_classic.traces` AS tr\n    INNER JOIN\n        TopSenders AS s ON tr.from_address = s.address\n    WHERE\n        tr.block_timestamp >= '\''2020-01-01 00:00:00 UTC'\''  \n        AND tr.block_timestamp < '\''2020-04-01 00:00:00 UTC'\'' \n    GROUP BY\n        1\n)\n\n-- Final SELECT: Joins the calculated fees and values to find the net ether flow\nSELECT\n    f.address,\n    v.total_value_sent,\n    f.total_fees_paid,\n    v.total_value_sent - f.total_fees_paid AS net_ether_flow_wei\nFROM\n    TotalFees AS f\nINNER JOIN\n    TotalValueSent AS v ON f.address = v.address\nORDER BY\n    net_ether_flow_wei DESC\nLIMIT 100","destinationTable":{"projectId":"tony-allen","datasetId":"_e34c49c766e4fd3f5d404c3949b9e19fa7acb372","tableId":"anonc5ee9f31_131e_4177_b506_9f08344248e5"},"writeDisposition":"WRITE_TRUNCATE","priority":"INTERACTIVE","useQueryCache":false,"useLegacySql":false},"jobType":"QUERY"},"jobReference":{"projectId":"tony-allen","jobId":"bqjob_r7af22a93cb588faa_0000019a5ec0a0bd_1","location":"US"},"statistics":{"creationTime":"1762526273968","startTime":"1762526274066","endTime":"1762526275330","totalBytesProcessed":"1594954856","query":{"queryPlan":[{"name":"S00: Input","id":"0","startMs":"1762526274393","endMs":"1762526274625","waitRatioAvg":0.04205607476635514,"waitMsAvg":"9","waitRatioMax":0.06542056074766354,"waitMsMax":"14","readRatioAvg":0.4205607476635514,"readMsAvg":"90","readRatioMax":1,"readMsMax":"214","computeRatioAvg":0.13551401869158877,"computeMsAvg":"29","computeRatioMax":0.3411214953271028,"computeMsMax":"73","writeRatioAvg":0.018691588785046728,"writeMsAvg":"4","writeRatioMax":0.102803738317757,"writeMsMax":"22","shuffleOutputBytes":"32617984","shuffleOutputBytesSpilled":"0","recordsRead":"3714129","recordsWritten":"582464","parallelInputs":"91","completedParallelInputs":"91","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$30:hash, $31:from_address, $32:receipt_status, $33:block_timestamp","FROM bigquery-public-data.crypto_ethereum_classic.transactions","WHERE and(equal($32, 1), greater_or_equal($33, 1577836800.000000000), less($33, 1585699200.000000000))"]},{"kind":"AGGREGATE","substeps":["GROUP BY $150 := $31","$130 := COUNT($30)"]},{"kind":"WRITE","substeps":["$150, $130","TO __stage00_output","BY HASH($150)"]}],"slotMs":"17711","computeMode":"BIGQUERY"},{"name":"S01: Sort+","id":"1","startMs":"1762526274628","endMs":"1762526274668","inputStages":["0"],"waitRatioAvg":0.004672897196261682,"waitMsAvg":"1","waitRatioMax":0.004672897196261682,"waitMsMax":"1","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.13551401869158877,"computeMsAvg":"29","computeRatioMax":0.16822429906542055,"computeMsMax":"36","writeRatioAvg":0.004672897196261682,"writeMsAvg":"1","writeRatioMax":0.014018691588785047,"writeMsMax":"3","shuffleOutputBytes":"2520","shuffleOutputBytesSpilled":"0","recordsRead":"582464","recordsWritten":"45","parallelInputs":"9","completedParallelInputs":"9","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$150, $130","FROM __stage00_output"]},{"kind":"SORT","substeps":["$110 DESC","LIMIT 5"]},{"kind":"AGGREGATE","substeps":["GROUP BY $160 := $150","$110 := SUM_OF_COUNTS($130)"]},{"kind":"WRITE","substeps":["$170, $171","TO __stage01_output"]}],"slotMs":"411","computeMode":"BIGQUERY"},{"name":"S02: Sort","id":"2","startMs":"1762526274639","endMs":"1762526274673","inputStages":["1"],"waitRatioAvg":0.06542056074766354,"waitMsAvg":"14","waitRatioMax":0.06542056074766354,"waitMsMax":"14","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.06542056074766354,"computeMsAvg":"14","computeRatioMax":0.06542056074766354,"computeMsMax":"14","writeRatioAvg":0.014018691588785047,"writeMsAvg":"3","writeRatioMax":0.014018691588785047,"writeMsMax":"3","shuffleOutputBytes":"235","shuffleOutputBytesSpilled":"0","recordsRead":"45","recordsWritten":"5","parallelInputs":"1","completedParallelInputs":"1","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$170, $171","FROM __stage01_output"]},{"kind":"SORT","substeps":["$100 DESC","LIMIT 5"]},{"kind":"WRITE","substeps":["$220","TO __stage02_output"]}],"slotMs":"41","computeMode":"BIGQUERY"},{"name":"S04: Sort","id":"4","startMs":"1762526274664","endMs":"1762526274700","inputStages":["1"],"waitRatioAvg":0.028037383177570093,"waitMsAvg":"6","waitRatioMax":0.028037383177570093,"waitMsMax":"6","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.0514018691588785,"computeMsAvg":"11","computeRatioMax":0.0514018691588785,"computeMsMax":"11","writeRatioAvg":0.0794392523364486,"writeMsAvg":"17","writeRatioMax":0.0794392523364486,"writeMsMax":"17","shuffleOutputBytes":"235","shuffleOutputBytesSpilled":"0","recordsRead":"45","recordsWritten":"5","parallelInputs":"1","completedParallelInputs":"1","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$170, $171","FROM __stage01_output"]},{"kind":"SORT","substeps":["$171 DESC","LIMIT 5"]},{"kind":"WRITE","substeps":["$180","TO __stage04_output"]}],"slotMs":"73","computeMode":"BIGQUERY"},{"name":"S06: Coalesce","id":"6","startMs":"1762526274682","endMs":"1762526274742","inputStages":["2"],"waitRatioAvg":0.02336448598130841,"waitMsAvg":"5","waitRatioMax":0.028037383177570093,"waitMsMax":"6","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.04205607476635514,"computeMsAvg":"9","computeRatioMax":0.07476635514018691,"computeMsMax":"16","writeRatioAvg":0.056074766355140186,"writeMsAvg":"12","writeRatioMax":0.14018691588785046,"writeMsMax":"30","shuffleOutputBytes":"235","shuffleOutputBytesSpilled":"0","recordsRead":"5","recordsWritten":"5","parallelInputs":"100","completedParallelInputs":"100","status":"COMPLETE","steps":[{"kind":"READ","substeps":["FROM __stage02_output"]}],"slotMs":"6298","computeMode":"BIGQUERY"},{"name":"S07: Output","id":"7","startMs":"1762526274682","endMs":"1762526274731","inputStages":["2"],"waitRatioAvg":0.02336448598130841,"waitMsAvg":"5","waitRatioMax":0.028037383177570093,"waitMsMax":"6","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.04205607476635514,"computeMsAvg":"9","computeRatioMax":0.06542056074766354,"computeMsMax":"14","writeRatioAvg":0.02336448598130841,"writeMsAvg":"5","writeRatioMax":0.08878504672897196,"writeMsMax":"19","shuffleOutputBytes":"2075","shuffleOutputBytesSpilled":"0","recordsRead":"5","recordsWritten":"100","parallelInputs":"100","completedParallelInputs":"100","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$220","FROM __stage02_output"]},{"kind":"COMPUTE","substeps":["$291 := if(less_or_equal(array_length($287), 1000), $287, NULL)","$286 := if(greater(array_length($287), 1000), 1, 0)"]},{"kind":"AGGREGATE","substeps":["$284 := MIN($220)","$285 := MAX($220)","$287 := DISTINCT_ARRAY_AGG($288 LIMIT 1001)","$289 := MAX($290)"]},{"kind":"COMPUTE","substeps":["$288 := if(less_or_equal(length($220), 1024), $220, NULL)","$290 := length($220)"]},{"kind":"WRITE","substeps":["$284, $285, $286, $291, $289","TO __stage07_output"]}],"slotMs":"4935","computeMode":"BIGQUERY"},{"name":"S08: Coalesce","id":"8","startMs":"1762526274716","endMs":"1762526274778","inputStages":["4"],"waitRatioAvg":0.004672897196261682,"waitMsAvg":"1","waitRatioMax":0.009345794392523364,"waitMsMax":"2","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.04205607476635514,"computeMsAvg":"9","computeRatioMax":0.07476635514018691,"computeMsMax":"16","writeRatioAvg":0.06542056074766354,"writeMsAvg":"14","writeRatioMax":0.14018691588785046,"writeMsMax":"30","shuffleOutputBytes":"235","shuffleOutputBytesSpilled":"0","recordsRead":"5","recordsWritten":"5","parallelInputs":"100","completedParallelInputs":"100","status":"COMPLETE","steps":[{"kind":"READ","substeps":["FROM __stage04_output"]}],"slotMs":"6374","computeMode":"BIGQUERY"},{"name":"S09: Join+","id":"9","startMs":"1762526274731","endMs":"1762526274827","inputStages":["8"],"waitRatioAvg":0.028037383177570093,"waitMsAvg":"6","waitRatioMax":0.056074766355140186,"waitMsMax":"12","readRatioAvg":0.04205607476635514,"readMsAvg":"9","readRatioMax":0.08878504672897196,"readMsMax":"19","computeRatioAvg":0.102803738317757,"computeMsAvg":"22","computeRatioMax":0.16822429906542055,"computeMsMax":"36","writeRatioAvg":0.018691588785046728,"writeMsAvg":"4","writeRatioMax":0.06542056074766354,"writeMsMax":"14","shuffleOutputBytes":"27328","shuffleOutputBytesSpilled":"0","recordsRead":"3714584","recordsWritten":"427","parallelInputs":"91","completedParallelInputs":"91","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$10:from_address, $11:gas_price, $12:receipt_gas_used, $13:receipt_status, $14:block_timestamp","FROM bigquery-public-data.crypto_ethereum_classic.transactions","WHERE and(greater_or_equal($14, 1577836800.000000000), less($14, 1585699200.000000000), equal($13, 1))"]},{"kind":"READ","substeps":["$180","FROM __stage08_output"]},{"kind":"AGGREGATE","substeps":["GROUP BY $200 := $190","$70 := SUM($90)"]},{"kind":"COMPUTE","substeps":["$90 := multiply(CAST($191 AS NUMERIC), CAST($192 AS NUMERIC))"]},{"kind":"JOIN","substeps":["$190 := $10, $191 := $11, $192 := $12","INNER HASH JOIN EACH  WITH ALL  ON $10 = $180"]},{"kind":"WRITE","substeps":["$200, $70","TO __stage09_output","BY HASH($200)"]}],"slotMs":"8513","computeMode":"BIGQUERY"},{"name":"S0A: Join+","id":"10","startMs":"1762526274753","endMs":"1762526274948","inputStages":["6"],"waitRatioAvg":0.004672897196261682,"waitMsAvg":"1","waitRatioMax":0.009345794392523364,"waitMsMax":"2","readRatioAvg":0.2102803738317757,"readMsAvg":"45","readRatioMax":0.6495327102803738,"readMsMax":"139","computeRatioAvg":0.14953271028037382,"computeMsAvg":"32","computeRatioMax":0.35514018691588783,"computeMsMax":"76","writeRatioAvg":0.018691588785046728,"writeMsAvg":"4","writeRatioMax":0.06542056074766354,"writeMsMax":"14","shuffleOutputBytes":"27328","shuffleOutputBytesSpilled":"0","recordsRead":"15994372","recordsWritten":"427","parallelInputs":"91","completedParallelInputs":"91","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$1:from_address, $2:value, $3:block_timestamp","FROM bigquery-public-data.crypto_ethereum_classic.traces","WHERE and(greater_or_equal($3, 1577836800.000000000), less($3, 1585699200.000000000), ...)"]},{"kind":"READ","substeps":["$220","FROM __stage06_output"]},{"kind":"AGGREGATE","substeps":["GROUP BY $240 := $230","$80 := SUM($231)"]},{"kind":"JOIN","substeps":["$230 := $1, $231 := $2","INNER HASH JOIN EACH  WITH ALL  ON $1 = $220"]},{"kind":"WRITE","substeps":["$240, $80","TO __stage0A_output","BY HASH($240)"]}],"slotMs":"9600","computeMode":"BIGQUERY"},{"name":"S0B: Aggregate","id":"11","startMs":"1762526274969","endMs":"1762526275002","inputStages":["10"],"waitRatioAvg":0.004672897196261682,"waitMsAvg":"1","waitRatioMax":0.004672897196261682,"waitMsMax":"1","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.0514018691588785,"computeMsAvg":"11","computeRatioMax":0.0794392523364486,"computeMsMax":"17","writeRatioAvg":0.08878504672897196,"writeMsAvg":"19","writeRatioMax":0.11214953271028037,"writeMsMax":"24","shuffleOutputBytes":"320","shuffleOutputBytesSpilled":"0","recordsRead":"427","recordsWritten":"5","parallelInputs":"9","completedParallelInputs":"9","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$240, $80","FROM __stage0A_output"]},{"kind":"AGGREGATE","substeps":["GROUP BY $250 := $240","$60 := SUM($80)"]},{"kind":"WRITE","substeps":["$60, $250","TO __stage0B_output"]}],"slotMs":"438","computeMode":"BIGQUERY"},{"name":"S0D: Coalesce","id":"13","startMs":"1762526275014","endMs":"1762526275070","inputStages":["11"],"waitRatioAvg":0.02336448598130841,"waitMsAvg":"5","waitRatioMax":0.028037383177570093,"waitMsMax":"6","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.04672897196261682,"computeMsAvg":"10","computeRatioMax":0.07009345794392523,"computeMsMax":"15","writeRatioAvg":0.07009345794392523,"writeMsAvg":"15","writeRatioMax":0.1542056074766355,"writeMsMax":"33","shuffleOutputBytes":"320","shuffleOutputBytesSpilled":"0","recordsRead":"5","recordsWritten":"5","parallelInputs":"100","completedParallelInputs":"100","status":"COMPLETE","steps":[{"kind":"READ","substeps":["FROM __stage0B_output"]}],"slotMs":"6541","computeMode":"BIGQUERY"},{"name":"S0E: Join+","id":"14","startMs":"1762526275017","endMs":"1762526275086","inputStages":["13","9"],"waitRatioAvg":0.02336448598130841,"waitMsAvg":"5","waitRatioMax":0.02336448598130841,"waitMsMax":"5","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.056074766355140186,"computeMsAvg":"12","computeRatioMax":0.08878504672897196,"computeMsMax":"19","writeRatioAvg":0.037383177570093455,"writeMsAvg":"8","writeRatioMax":0.0794392523364486,"writeMsMax":"17","shuffleOutputBytes":"490","shuffleOutputBytesSpilled":"0","recordsRead":"447","recordsWritten":"5","parallelInputs":"9","completedParallelInputs":"9","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$200, $70","FROM __stage09_output"]},{"kind":"READ","substeps":["$60, $250","FROM __stage0D_output"]},{"kind":"SORT","substeps":["$40 DESC","LIMIT 100"]},{"kind":"COMPUTE","substeps":["$40 := subtract($262, $261)"]},{"kind":"JOIN","substeps":["$260 := $210, $261 := $50, $262 := $60","INNER HASH JOIN EACH  WITH ALL  ON $210 = $250"]},{"kind":"AGGREGATE","substeps":["GROUP BY $210 := $200","$50 := SUM($70)"]},{"kind":"WRITE","substeps":["$270, $271, $272, $273","TO __stage0E_output"]}],"slotMs":"686","computeMode":"BIGQUERY"},{"name":"S0F: Output","id":"15","startMs":"1762526275022","endMs":"1762526275099","inputStages":["14"],"waitRatioAvg":0.06074766355140187,"waitMsAvg":"13","waitRatioMax":0.06074766355140187,"waitMsMax":"13","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.03271028037383177,"computeMsAvg":"7","computeRatioMax":0.03271028037383177,"computeMsMax":"7","writeRatioAvg":0.02336448598130841,"writeMsAvg":"5","writeRatioMax":0.02336448598130841,"writeMsMax":"5","shuffleOutputBytes":"490","shuffleOutputBytesSpilled":"0","recordsRead":"5","recordsWritten":"5","parallelInputs":"1","completedParallelInputs":"1","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$270, $271, $272, $273","FROM __stage0E_output"]},{"kind":"SORT","substeps":["$271 DESC","LIMIT 100"]},{"kind":"WRITE","substeps":["$280, $281, $282, $283","TO __stage0F_output"]}],"slotMs":"20","computeMode":"BIGQUERY"}],"estimatedBytesProcessed":"1594954856","timeline":[{"elapsedMs":"934","totalSlotMs":"62325","pendingUnits":"1","completedUnits":"583","activeUnits":"3","estimatedRunnableUnits":"0"},{"elapsedMs":"1041","totalSlotMs":"62325","pendingUnits":"0","completedUnits":"703","estimatedRunnableUnits":"0"}],"totalPartitionsProcessed":"182","totalBytesProcessed":"1594954856","totalBytesBilled":"1595932672","billingTier":1,"totalSlotMs":"62325","cacheHit":false,"referencedTables":[{"projectId":"bigquery-public-data","datasetId":"crypto_ethereum_classic","tableId":"transactions"},{"projectId":"bigquery-public-data","datasetId":"crypto_ethereum_classic","tableId":"traces"}],"statementType":"SELECT","searchStatistics":{"indexUsageMode":"UNUSED","indexUnusedReasons":[{"code":"INDEX_CONFIG_NOT_AVAILABLE","message":"There is no index configuration for the base table `bigquery-public-data:crypto_ethereum_classic.traces`.","baseTable":{"projectId":"bigquery-public-data","datasetId":"crypto_ethereum_classic","tableId":"traces"}},{"code":"INDEX_CONFIG_NOT_AVAILABLE","message":"There is no index configuration for the base table `bigquery-public-data:crypto_ethereum_classic.transactions`.","baseTable":{"projectId":"bigquery-public-data","datasetId":"crypto_ethereum_classic","tableId":"transactions"}}]},"performanceInsights":{"avgPreviousExecutionMs":"1318"},"transferredBytes":"0","metadataCacheStatistics":{"tableMetadataCacheUsage":[{"tableReference":{"projectId":"bigquery-public-data","datasetId":"crypto_ethereum_classic","tableId":"transactions"},"unusedReason":"OTHER_REASON"},{"tableReference":{"projectId":"bigquery-public-data","datasetId":"crypto_ethereum_classic","tableId":"traces"},"unusedReason":"OTHER_REASON"}]}},"totalSlotMs":"62325","finalExecutionDurationMs":"750"},"status":{"state":"DONE"},"principal_subject":"user:admin@bentrollope.altostrat.com","jobCreationReason":{"code":"REQUESTED"}}'
++ jq -r .statistics.endTime
+ end_time=1762526275330
++ echo 1762526274066
++ awk '{print int($1)}'
+ start_ms=1762526274066
++ echo 1762526275330
++ awk '{print int($1)}'
+ end_ms=1762526275330
+ duration_ms=1264
+ echo '  --- Execution Statistics ---'
  --- Execution Statistics ---
+ echo '  Duration: 1264 ms'
  Duration: 1264 ms
+ echo '  Bytes Processed: 1594954856 bytes'
  Bytes Processed: 1594954856 bytes
+ echo '  Slot Milliseconds: 62325'
  Slot Milliseconds: 62325
+ echo '  ----------------------------'
  ----------------------------
+ echo -e 'Top Sender Unoptimized\tbqjob_r7af22a93cb588faa_0000019a5ec0a0bd_1\t1264\t1594954856\t62325'
+ echo ''

+ run_query 'Top Sender Optimized' 'WITH TransactionSummary AS (
    -- CTE 1 (Optimized): Single scan of the transactions table to calculate fees and rank all relevant senders.
    SELECT
        t.from_address,
        SUM(CAST(t.gas_price AS NUMERIC) * CAST(t.receipt_gas_used AS NUMERIC)) AS total_fees_paid,
        ROW_NUMBER() OVER (
            ORDER BY COUNT(t.hash) DESC
        ) AS rn_transaction_count
    FROM
        `bigquery-public-data.crypto_ethereum_classic.transactions` AS t
    WHERE
        t.receipt_status = 1 
        AND t.block_timestamp >= '\''2020-01-01 00:00:00 UTC'\''
        AND t.block_timestamp < '\''2020-04-01 00:00:00 UTC'\''
    GROUP BY
        1
),

TraceSummary AS (
    -- CTE 2 (Optimized): Single scan of the traces table to calculate the total value sent
    SELECT
        tr.from_address,
        SUM(tr.value) AS total_value_sent
    FROM
        `bigquery-public-data.crypto_ethereum_classic.traces` AS tr
    WHERE
        tr.block_timestamp >= '\''2020-01-01 00:00:00 UTC'\''  
        AND tr.block_timestamp < '\''2020-04-01 00:00:00 UTC'\''
    GROUP BY
        1
)

-- Final SELECT: Filter to the top 5 addresses (using the rank) and join the two pre-aggregated summaries.
SELECT
    ts.from_address,
    ts.total_fees_paid,
    vs.total_value_sent,
    vs.total_value_sent - ts.total_fees_paid AS net_ether_flow_wei
FROM
    TransactionSummary AS ts
INNER JOIN
    TraceSummary AS vs ON ts.from_address = vs.from_address
WHERE
    ts.rn_transaction_count <= 5 -- Filter down to the top 5 addresses
ORDER BY
    net_ether_flow_wei DESC
LIMIT 100'
+ local 'query_name=Top Sender Optimized'
+ local 'query=WITH TransactionSummary AS (
    -- CTE 1 (Optimized): Single scan of the transactions table to calculate fees and rank all relevant senders.
    SELECT
        t.from_address,
        SUM(CAST(t.gas_price AS NUMERIC) * CAST(t.receipt_gas_used AS NUMERIC)) AS total_fees_paid,
        ROW_NUMBER() OVER (
            ORDER BY COUNT(t.hash) DESC
        ) AS rn_transaction_count
    FROM
        `bigquery-public-data.crypto_ethereum_classic.transactions` AS t
    WHERE
        t.receipt_status = 1 
        AND t.block_timestamp >= '\''2020-01-01 00:00:00 UTC'\''
        AND t.block_timestamp < '\''2020-04-01 00:00:00 UTC'\''
    GROUP BY
        1
),

TraceSummary AS (
    -- CTE 2 (Optimized): Single scan of the traces table to calculate the total value sent
    SELECT
        tr.from_address,
        SUM(tr.value) AS total_value_sent
    FROM
        `bigquery-public-data.crypto_ethereum_classic.traces` AS tr
    WHERE
        tr.block_timestamp >= '\''2020-01-01 00:00:00 UTC'\''  
        AND tr.block_timestamp < '\''2020-04-01 00:00:00 UTC'\''
    GROUP BY
        1
)

-- Final SELECT: Filter to the top 5 addresses (using the rank) and join the two pre-aggregated summaries.
SELECT
    ts.from_address,
    ts.total_fees_paid,
    vs.total_value_sent,
    vs.total_value_sent - ts.total_fees_paid AS net_ether_flow_wei
FROM
    TransactionSummary AS ts
INNER JOIN
    TraceSummary AS vs ON ts.from_address = vs.from_address
WHERE
    ts.rn_transaction_count <= 5 -- Filter down to the top 5 addresses
ORDER BY
    net_ether_flow_wei DESC
LIMIT 100'
+ echo ==================================================
==================================================
+ echo 'Executing Top Sender Optimized'
Executing Top Sender Optimized
+ echo ==================================================
==================================================
+ echo Query:
Query:
+ echo 'WITH TransactionSummary AS (
    -- CTE 1 (Optimized): Single scan of the transactions table to calculate fees and rank all relevant senders.
    SELECT
        t.from_address,
        SUM(CAST(t.gas_price AS NUMERIC) * CAST(t.receipt_gas_used AS NUMERIC)) AS total_fees_paid,
        ROW_NUMBER() OVER (
            ORDER BY COUNT(t.hash) DESC
        ) AS rn_transaction_count
    FROM
        `bigquery-public-data.crypto_ethereum_classic.transactions` AS t
    WHERE
        t.receipt_status = 1 
        AND t.block_timestamp >= '\''2020-01-01 00:00:00 UTC'\''
        AND t.block_timestamp < '\''2020-04-01 00:00:00 UTC'\''
    GROUP BY
        1
),

TraceSummary AS (
    -- CTE 2 (Optimized): Single scan of the traces table to calculate the total value sent
    SELECT
        tr.from_address,
        SUM(tr.value) AS total_value_sent
    FROM
        `bigquery-public-data.crypto_ethereum_classic.traces` AS tr
    WHERE
        tr.block_timestamp >= '\''2020-01-01 00:00:00 UTC'\''  
        AND tr.block_timestamp < '\''2020-04-01 00:00:00 UTC'\''
    GROUP BY
        1
)

-- Final SELECT: Filter to the top 5 addresses (using the rank) and join the two pre-aggregated summaries.
SELECT
    ts.from_address,
    ts.total_fees_paid,
    vs.total_value_sent,
    vs.total_value_sent - ts.total_fees_paid AS net_ether_flow_wei
FROM
    TransactionSummary AS ts
INNER JOIN
    TraceSummary AS vs ON ts.from_address = vs.from_address
WHERE
    ts.rn_transaction_count <= 5 -- Filter down to the top 5 addresses
ORDER BY
    net_ether_flow_wei DESC
LIMIT 100'
WITH TransactionSummary AS (
    -- CTE 1 (Optimized): Single scan of the transactions table to calculate fees and rank all relevant senders.
    SELECT
        t.from_address,
        SUM(CAST(t.gas_price AS NUMERIC) * CAST(t.receipt_gas_used AS NUMERIC)) AS total_fees_paid,
        ROW_NUMBER() OVER (
            ORDER BY COUNT(t.hash) DESC
        ) AS rn_transaction_count
    FROM
        `bigquery-public-data.crypto_ethereum_classic.transactions` AS t
    WHERE
        t.receipt_status = 1 
        AND t.block_timestamp >= '2020-01-01 00:00:00 UTC'
        AND t.block_timestamp < '2020-04-01 00:00:00 UTC'
    GROUP BY
        1
),

TraceSummary AS (
    -- CTE 2 (Optimized): Single scan of the traces table to calculate the total value sent
    SELECT
        tr.from_address,
        SUM(tr.value) AS total_value_sent
    FROM
        `bigquery-public-data.crypto_ethereum_classic.traces` AS tr
    WHERE
        tr.block_timestamp >= '2020-01-01 00:00:00 UTC'  
        AND tr.block_timestamp < '2020-04-01 00:00:00 UTC'
    GROUP BY
        1
)

-- Final SELECT: Filter to the top 5 addresses (using the rank) and join the two pre-aggregated summaries.
SELECT
    ts.from_address,
    ts.total_fees_paid,
    vs.total_value_sent,
    vs.total_value_sent - ts.total_fees_paid AS net_ether_flow_wei
FROM
    TransactionSummary AS ts
INNER JOIN
    TraceSummary AS vs ON ts.from_address = vs.from_address
WHERE
    ts.rn_transaction_count <= 5 -- Filter down to the top 5 addresses
ORDER BY
    net_ether_flow_wei DESC
LIMIT 100
+ echo --------------------------------------------------
--------------------------------------------------
++ bq query --nouse_cache --nosync --use_legacy_sql=false --format=json --location=US 'WITH TransactionSummary AS (
    -- CTE 1 (Optimized): Single scan of the transactions table to calculate fees and rank all relevant senders.
    SELECT
        t.from_address,
        SUM(CAST(t.gas_price AS NUMERIC) * CAST(t.receipt_gas_used AS NUMERIC)) AS total_fees_paid,
        ROW_NUMBER() OVER (
            ORDER BY COUNT(t.hash) DESC
        ) AS rn_transaction_count
    FROM
        `bigquery-public-data.crypto_ethereum_classic.transactions` AS t
    WHERE
        t.receipt_status = 1 
        AND t.block_timestamp >= '\''2020-01-01 00:00:00 UTC'\''
        AND t.block_timestamp < '\''2020-04-01 00:00:00 UTC'\''
    GROUP BY
        1
),

TraceSummary AS (
    -- CTE 2 (Optimized): Single scan of the traces table to calculate the total value sent
    SELECT
        tr.from_address,
        SUM(tr.value) AS total_value_sent
    FROM
        `bigquery-public-data.crypto_ethereum_classic.traces` AS tr
    WHERE
        tr.block_timestamp >= '\''2020-01-01 00:00:00 UTC'\''  
        AND tr.block_timestamp < '\''2020-04-01 00:00:00 UTC'\''
    GROUP BY
        1
)

-- Final SELECT: Filter to the top 5 addresses (using the rank) and join the two pre-aggregated summaries.
SELECT
    ts.from_address,
    ts.total_fees_paid,
    vs.total_value_sent,
    vs.total_value_sent - ts.total_fees_paid AS net_ether_flow_wei
FROM
    TransactionSummary AS ts
INNER JOIN
    TraceSummary AS vs ON ts.from_address = vs.from_address
WHERE
    ts.rn_transaction_count <= 5 -- Filter down to the top 5 addresses
ORDER BY
    net_ether_flow_wei DESC
LIMIT 100'
+ job_submission_output='{"kind":"bigquery#job","etag":"p9NOnK5R1q/6fAZXhVHyNA==","id":"tony-allen:US.bqjob_r416f02ee81104807_0000019a5ec0c249_1","selfLink":"https://bigquery.googleapis.com/bigquery/v2/projects/tony-allen/jobs/bqjob_r416f02ee81104807_0000019a5ec0c249_1?location=US","user_email":"admin@bentrollope.altostrat.com","configuration":{"query":{"query":"WITH TransactionSummary AS (\n    -- CTE 1 (Optimized): Single scan of the transactions table to calculate fees and rank all relevant senders.\n    SELECT\n        t.from_address,\n        SUM(CAST(t.gas_price AS NUMERIC) * CAST(t.receipt_gas_used AS NUMERIC)) AS total_fees_paid,\n        ROW_NUMBER() OVER (\n            ORDER BY COUNT(t.hash) DESC\n        ) AS rn_transaction_count\n    FROM\n        `bigquery-public-data.crypto_ethereum_classic.transactions` AS t\n    WHERE\n        t.receipt_status = 1 \n        AND t.block_timestamp >= '\''2020-01-01 00:00:00 UTC'\''\n        AND t.block_timestamp < '\''2020-04-01 00:00:00 UTC'\''\n    GROUP BY\n        1\n),\n\nTraceSummary AS (\n    -- CTE 2 (Optimized): Single scan of the traces table to calculate the total value sent\n    SELECT\n        tr.from_address,\n        SUM(tr.value) AS total_value_sent\n    FROM\n        `bigquery-public-data.crypto_ethereum_classic.traces` AS tr\n    WHERE\n        tr.block_timestamp >= '\''2020-01-01 00:00:00 UTC'\''  \n        AND tr.block_timestamp < '\''2020-04-01 00:00:00 UTC'\''\n    GROUP BY\n        1\n)\n\n-- Final SELECT: Filter to the top 5 addresses (using the rank) and join the two pre-aggregated summaries.\nSELECT\n    ts.from_address,\n    ts.total_fees_paid,\n    vs.total_value_sent,\n    vs.total_value_sent - ts.total_fees_paid AS net_ether_flow_wei\nFROM\n    TransactionSummary AS ts\nINNER JOIN\n    TraceSummary AS vs ON ts.from_address = vs.from_address\nWHERE\n    ts.rn_transaction_count <= 5 -- Filter down to the top 5 addresses\nORDER BY\n    net_ether_flow_wei DESC\nLIMIT 100","destinationTable":{"projectId":"tony-allen","datasetId":"_e34c49c766e4fd3f5d404c3949b9e19fa7acb372","tableId":"anon6489f30f_f891_48fc_a822_3c5c62918fc4"},"writeDisposition":"WRITE_TRUNCATE","priority":"INTERACTIVE","useQueryCache":false,"useLegacySql":false},"jobType":"QUERY"},"jobReference":{"projectId":"tony-allen","jobId":"bqjob_r416f02ee81104807_0000019a5ec0c249_1","location":"US"},"statistics":{"creationTime":"1762526282566","startTime":"1762526282684","endTime":"1762526283560","totalBytesProcessed":"1594954856","query":{"queryPlan":[{"name":"S00: Input","id":"0","startMs":"1762526282942","endMs":"1762526283139","waitRatioAvg":0.4722222222222222,"waitMsAvg":"51","waitRatioMax":0.6018518518518519,"waitMsMax":"65","readRatioAvg":0.2222222222222222,"readMsAvg":"24","readRatioMax":0.7685185185185185,"readMsMax":"83","computeRatioAvg":0.28703703703703703,"computeMsAvg":"31","computeRatioMax":0.4722222222222222,"computeMsMax":"51","writeRatioAvg":0.037037037037037035,"writeMsAvg":"4","writeRatioMax":0.25,"writeMsMax":"27","shuffleOutputBytes":"42519872","shuffleOutputBytesSpilled":"0","recordsRead":"3714129","recordsWritten":"582464","parallelInputs":"91","completedParallelInputs":"91","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$10:hash, $11:from_address, $12:gas_price, $13:receipt_gas_used, $14:receipt_status, $15:block_timestamp","FROM bigquery-public-data.crypto_ethereum_classic.transactions","WHERE and(equal($14, 1), greater_or_equal($15, 1577836800.000000000), less($15, 1585699200.000000000))"]},{"kind":"AGGREGATE","substeps":["GROUP BY $100 := $11","$80 := SUM($90)","$81 := COUNT($10)"]},{"kind":"COMPUTE","substeps":["$90 := multiply(CAST($12 AS NUMERIC), CAST($13 AS NUMERIC))"]},{"kind":"WRITE","substeps":["$100, $80, $81","TO __stage00_output","BY HASH($100)"]}],"slotMs":"7355","computeMode":"BIGQUERY"},{"name":"S01: Input","id":"1","startMs":"1762526282942","endMs":"1762526283081","waitRatioAvg":0.3611111111111111,"waitMsAvg":"39","waitRatioMax":0.49074074074074076,"waitMsMax":"53","readRatioAvg":0.19444444444444445,"readMsAvg":"21","readRatioMax":1,"readMsMax":"108","computeRatioAvg":0.32407407407407407,"computeMsAvg":"35","computeRatioMax":0.6388888888888888,"computeMsMax":"69","writeRatioAvg":0.09259259259259259,"writeMsAvg":"10","writeRatioMax":0.24074074074074073,"writeMsMax":"26","shuffleOutputBytes":"38731942","shuffleOutputBytesSpilled":"0","recordsRead":"15993917","recordsWritten":"605252","parallelInputs":"91","completedParallelInputs":"91","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$1:from_address, $2:value, $3:block_timestamp","FROM bigquery-public-data.crypto_ethereum_classic.traces","WHERE and(greater_or_equal($3, 1577836800.000000000), less($3, 1585699200.000000000))"]},{"kind":"AGGREGATE","substeps":["GROUP BY $160 := $1","$50 := SUM($2)"]},{"kind":"WRITE","substeps":["$160, $50","TO __stage01_output","BY HASH($160)"]}],"slotMs":"8544","computeMode":"BIGQUERY"},{"name":"S02: Sort+","id":"2","startMs":"1762526283162","endMs":"1762526283223","inputStages":["0"],"waitRatioAvg":0.1111111111111111,"waitMsAvg":"12","waitRatioMax":0.1111111111111111,"waitMsMax":"12","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.48148148148148145,"computeMsAvg":"52","computeRatioMax":0.6203703703703703,"computeMsMax":"67","writeRatioAvg":0.037037037037037035,"writeMsAvg":"4","writeRatioMax":0.046296296296296294,"writeMsMax":"5","shuffleOutputBytes":"3285","shuffleOutputBytesSpilled":"0","recordsRead":"582464","recordsWritten":"45","parallelInputs":"9","completedParallelInputs":"9","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$100, $80, $81","FROM __stage00_output"]},{"kind":"FILTER","substeps":["less_or_equal($60, 5)"]},{"kind":"ANALYTIC_FUNCTION","substeps":["$60 := ROW_NUMBER() OVER (ORDER BY $122 DESC)"]},{"kind":"SORT","substeps":["$71 DESC"]},{"kind":"AGGREGATE","substeps":["GROUP BY $110 := $100","$70 := SUM($80)","$71 := SUM_OF_COUNTS($81)"]},{"kind":"WRITE","substeps":["$130, $131, $132","TO __stage02_output"]}],"slotMs":"754","computeMode":"BIGQUERY"},{"name":"S03: Aggregate+","id":"3","startMs":"1762526283227","endMs":"1762526283236","inputStages":["2"],"waitRatioAvg":0.027777777777777776,"waitMsAvg":"3","waitRatioMax":0.027777777777777776,"waitMsMax":"3","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.05555555555555555,"computeMsAvg":"6","computeRatioMax":0.05555555555555555,"computeMsMax":"6","writeRatioAvg":0.009259259259259259,"writeMsAvg":"1","writeRatioMax":0.009259259259259259,"writeMsMax":"1","shuffleOutputBytes":"37","shuffleOutputBytesSpilled":"0","recordsRead":"45","recordsWritten":"1","parallelInputs":"1","completedParallelInputs":"1","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$130, $131, $132","FROM __stage02_output"]},{"kind":"AGGREGATE","substeps":["$134 := shard_sink_stats($133)"]},{"kind":"COMPUTE","substeps":["$133 := STRUCT<...>"]},{"kind":"WRITE","substeps":["$134","TO __stage03_output"]}],"slotMs":"10","computeMode":"BIGQUERY"},{"name":"S04: Aggregate","id":"4","startMs":"1762526283235","endMs":"1762526283283","inputStages":["3"],"waitRatioAvg":0.09259259259259259,"waitMsAvg":"10","waitRatioMax":0.09259259259259259,"waitMsMax":"10","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.12037037037037036,"computeMsAvg":"13","computeRatioMax":0.12037037037037036,"computeMsMax":"13","writeRatioAvg":0.1574074074074074,"writeMsAvg":"17","writeRatioMax":0.1574074074074074,"writeMsMax":"17","shuffleOutputBytes":"27","shuffleOutputBytesSpilled":"0","recordsRead":"1","recordsWritten":"1","parallelInputs":"1","completedParallelInputs":"1","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$134","FROM __stage03_output"]},{"kind":"AGGREGATE","substeps":["$135 := root_sink_stats($134)"]},{"kind":"WRITE","substeps":["$135","TO __stage04_output"]}],"slotMs":"45","computeMode":"BIGQUERY"},{"name":"S06: Sort+","id":"6","startMs":"1762526283303","endMs":"1762526283333","inputStages":["4","2"],"waitRatioAvg":0.027777777777777776,"waitMsAvg":"3","waitRatioMax":0.027777777777777776,"waitMsMax":"3","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.1388888888888889,"computeMsAvg":"15","computeRatioMax":0.1388888888888889,"computeMsMax":"15","writeRatioAvg":0.12037037037037036,"writeMsAvg":"13","writeRatioMax":0.12037037037037036,"writeMsMax":"13","shuffleOutputBytes":"320","shuffleOutputBytesSpilled":"0","recordsRead":"46","recordsWritten":"5","parallelInputs":"1","completedParallelInputs":"1","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$135","FROM __stage04_output"]},{"kind":"READ","substeps":["$130, $131, $132","FROM __stage02_output"]},{"kind":"FILTER","substeps":["less_or_equal($40, 5)"]},{"kind":"ANALYTIC_FUNCTION","substeps":["$40 := ROW_NUMBER($135) OVER (ORDER BY $142 DESC)"]},{"kind":"SORT","substeps":["$132 DESC"]},{"kind":"WRITE","substeps":["$150, $151","TO __stage06_output"]}],"slotMs":"20","computeMode":"BIGQUERY"},{"name":"S07: Coalesce","id":"7","startMs":"1762526283340","endMs":"1762526283405","inputStages":["6"],"waitRatioAvg":0.05555555555555555,"waitMsAvg":"6","waitRatioMax":0.06481481481481481,"waitMsMax":"7","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.09259259259259259,"computeMsAvg":"10","computeRatioMax":0.12962962962962962,"computeMsMax":"14","writeRatioAvg":0.09259259259259259,"writeMsAvg":"10","writeRatioMax":0.18518518518518517,"writeMsMax":"20","shuffleOutputBytes":"320","shuffleOutputBytesSpilled":"0","recordsRead":"5","recordsWritten":"5","parallelInputs":"100","completedParallelInputs":"100","status":"COMPLETE","steps":[{"kind":"READ","substeps":["FROM __stage06_output"]}],"slotMs":"6932","computeMode":"BIGQUERY"},{"name":"S08: Join+","id":"8","startMs":"1762526283345","endMs":"1762526283436","inputStages":["1","7"],"waitRatioAvg":0.09259259259259259,"waitMsAvg":"10","waitRatioMax":0.10185185185185185,"waitMsMax":"11","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.42592592592592593,"computeMsAvg":"46","computeRatioMax":0.5648148148148148,"computeMsMax":"61","writeRatioAvg":0.018518518518518517,"writeMsAvg":"2","writeRatioMax":0.037037037037037035,"writeMsMax":"4","shuffleOutputBytes":"490","shuffleOutputBytesSpilled":"0","recordsRead":"605297","recordsWritten":"5","parallelInputs":"9","completedParallelInputs":"9","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$160, $50","FROM __stage01_output"]},{"kind":"READ","substeps":["$150, $151","FROM __stage07_output"]},{"kind":"SORT","substeps":["$20 DESC","LIMIT 100"]},{"kind":"COMPUTE","substeps":["$20 := subtract($182, $181)"]},{"kind":"JOIN","substeps":["$182 := $30, $180 := $150, $181 := $151","INNER HASH JOIN EACH  WITH ALL  ON $170 = $150"]},{"kind":"AGGREGATE","substeps":["GROUP BY $170 := $160","$30 := SUM($50)"]},{"kind":"WRITE","substeps":["$190, $191, $192, $193","TO __stage08_output"]}],"slotMs":"1200","computeMode":"BIGQUERY"},{"name":"S09: Output","id":"9","startMs":"1762526283356","endMs":"1762526283447","inputStages":["8"],"waitRatioAvg":0.1574074074074074,"waitMsAvg":"17","waitRatioMax":0.1574074074074074,"waitMsMax":"17","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.08333333333333333,"computeMsAvg":"9","computeRatioMax":0.08333333333333333,"computeMsMax":"9","writeRatioAvg":0.10185185185185185,"writeMsAvg":"11","writeRatioMax":0.10185185185185185,"writeMsMax":"11","shuffleOutputBytes":"490","shuffleOutputBytesSpilled":"0","recordsRead":"5","recordsWritten":"5","parallelInputs":"1","completedParallelInputs":"1","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$190, $191, $192, $193","FROM __stage08_output"]},{"kind":"SORT","substeps":["$191 DESC","LIMIT 100"]},{"kind":"WRITE","substeps":["$200, $201, $202, $203","TO __stage09_output"]}],"slotMs":"106","computeMode":"BIGQUERY"}],"estimatedBytesProcessed":"1594954856","timeline":[{"elapsedMs":"316","totalSlotMs":"24968","pendingUnits":"182","completedUnits":"0","activeUnits":"0","estimatedRunnableUnits":"0"},{"elapsedMs":"770","totalSlotMs":"24968","pendingUnits":"0","completedUnits":"304","estimatedRunnableUnits":"0"}],"totalPartitionsProcessed":"182","totalBytesProcessed":"1594954856","totalBytesBilled":"1595932672","billingTier":1,"totalSlotMs":"24968","cacheHit":false,"referencedTables":[{"projectId":"bigquery-public-data","datasetId":"crypto_ethereum_classic","tableId":"transactions"},{"projectId":"bigquery-public-data","datasetId":"crypto_ethereum_classic","tableId":"traces"}],"statementType":"SELECT","searchStatistics":{"indexUsageMode":"UNUSED","indexUnusedReasons":[{"code":"INDEX_CONFIG_NOT_AVAILABLE","message":"There is no index configuration for the base table `bigquery-public-data:crypto_ethereum_classic.traces`.","baseTable":{"projectId":"bigquery-public-data","datasetId":"crypto_ethereum_classic","tableId":"traces"}},{"code":"INDEX_CONFIG_NOT_AVAILABLE","message":"There is no index configuration for the base table `bigquery-public-data:crypto_ethereum_classic.transactions`.","baseTable":{"projectId":"bigquery-public-data","datasetId":"crypto_ethereum_classic","tableId":"transactions"}}]},"transferredBytes":"0","metadataCacheStatistics":{"tableMetadataCacheUsage":[{"tableReference":{"projectId":"bigquery-public-data","datasetId":"crypto_ethereum_classic","tableId":"transactions"},"unusedReason":"OTHER_REASON"},{"tableReference":{"projectId":"bigquery-public-data","datasetId":"crypto_ethereum_classic","tableId":"traces"},"unusedReason":"OTHER_REASON"}]}},"totalSlotMs":"24968","finalExecutionDurationMs":"560"},"status":{"state":"DONE"},"principal_subject":"user:admin@bentrollope.altostrat.com","jobCreationReason":{"code":"REQUESTED"}}'
++ jq -r .jobReference.jobId
++ echo '{"kind":"bigquery#job","etag":"p9NOnK5R1q/6fAZXhVHyNA==","id":"tony-allen:US.bqjob_r416f02ee81104807_0000019a5ec0c249_1","selfLink":"https://bigquery.googleapis.com/bigquery/v2/projects/tony-allen/jobs/bqjob_r416f02ee81104807_0000019a5ec0c249_1?location=US","user_email":"admin@bentrollope.altostrat.com","configuration":{"query":{"query":"WITH TransactionSummary AS (\n    -- CTE 1 (Optimized): Single scan of the transactions table to calculate fees and rank all relevant senders.\n    SELECT\n        t.from_address,\n        SUM(CAST(t.gas_price AS NUMERIC) * CAST(t.receipt_gas_used AS NUMERIC)) AS total_fees_paid,\n        ROW_NUMBER() OVER (\n            ORDER BY COUNT(t.hash) DESC\n        ) AS rn_transaction_count\n    FROM\n        `bigquery-public-data.crypto_ethereum_classic.transactions` AS t\n    WHERE\n        t.receipt_status = 1 \n        AND t.block_timestamp >= '\''2020-01-01 00:00:00 UTC'\''\n        AND t.block_timestamp < '\''2020-04-01 00:00:00 UTC'\''\n    GROUP BY\n        1\n),\n\nTraceSummary AS (\n    -- CTE 2 (Optimized): Single scan of the traces table to calculate the total value sent\n    SELECT\n        tr.from_address,\n        SUM(tr.value) AS total_value_sent\n    FROM\n        `bigquery-public-data.crypto_ethereum_classic.traces` AS tr\n    WHERE\n        tr.block_timestamp >= '\''2020-01-01 00:00:00 UTC'\''  \n        AND tr.block_timestamp < '\''2020-04-01 00:00:00 UTC'\''\n    GROUP BY\n        1\n)\n\n-- Final SELECT: Filter to the top 5 addresses (using the rank) and join the two pre-aggregated summaries.\nSELECT\n    ts.from_address,\n    ts.total_fees_paid,\n    vs.total_value_sent,\n    vs.total_value_sent - ts.total_fees_paid AS net_ether_flow_wei\nFROM\n    TransactionSummary AS ts\nINNER JOIN\n    TraceSummary AS vs ON ts.from_address = vs.from_address\nWHERE\n    ts.rn_transaction_count <= 5 -- Filter down to the top 5 addresses\nORDER BY\n    net_ether_flow_wei DESC\nLIMIT 100","destinationTable":{"projectId":"tony-allen","datasetId":"_e34c49c766e4fd3f5d404c3949b9e19fa7acb372","tableId":"anon6489f30f_f891_48fc_a822_3c5c62918fc4"},"writeDisposition":"WRITE_TRUNCATE","priority":"INTERACTIVE","useQueryCache":false,"useLegacySql":false},"jobType":"QUERY"},"jobReference":{"projectId":"tony-allen","jobId":"bqjob_r416f02ee81104807_0000019a5ec0c249_1","location":"US"},"statistics":{"creationTime":"1762526282566","startTime":"1762526282684","endTime":"1762526283560","totalBytesProcessed":"1594954856","query":{"queryPlan":[{"name":"S00: Input","id":"0","startMs":"1762526282942","endMs":"1762526283139","waitRatioAvg":0.4722222222222222,"waitMsAvg":"51","waitRatioMax":0.6018518518518519,"waitMsMax":"65","readRatioAvg":0.2222222222222222,"readMsAvg":"24","readRatioMax":0.7685185185185185,"readMsMax":"83","computeRatioAvg":0.28703703703703703,"computeMsAvg":"31","computeRatioMax":0.4722222222222222,"computeMsMax":"51","writeRatioAvg":0.037037037037037035,"writeMsAvg":"4","writeRatioMax":0.25,"writeMsMax":"27","shuffleOutputBytes":"42519872","shuffleOutputBytesSpilled":"0","recordsRead":"3714129","recordsWritten":"582464","parallelInputs":"91","completedParallelInputs":"91","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$10:hash, $11:from_address, $12:gas_price, $13:receipt_gas_used, $14:receipt_status, $15:block_timestamp","FROM bigquery-public-data.crypto_ethereum_classic.transactions","WHERE and(equal($14, 1), greater_or_equal($15, 1577836800.000000000), less($15, 1585699200.000000000))"]},{"kind":"AGGREGATE","substeps":["GROUP BY $100 := $11","$80 := SUM($90)","$81 := COUNT($10)"]},{"kind":"COMPUTE","substeps":["$90 := multiply(CAST($12 AS NUMERIC), CAST($13 AS NUMERIC))"]},{"kind":"WRITE","substeps":["$100, $80, $81","TO __stage00_output","BY HASH($100)"]}],"slotMs":"7355","computeMode":"BIGQUERY"},{"name":"S01: Input","id":"1","startMs":"1762526282942","endMs":"1762526283081","waitRatioAvg":0.3611111111111111,"waitMsAvg":"39","waitRatioMax":0.49074074074074076,"waitMsMax":"53","readRatioAvg":0.19444444444444445,"readMsAvg":"21","readRatioMax":1,"readMsMax":"108","computeRatioAvg":0.32407407407407407,"computeMsAvg":"35","computeRatioMax":0.6388888888888888,"computeMsMax":"69","writeRatioAvg":0.09259259259259259,"writeMsAvg":"10","writeRatioMax":0.24074074074074073,"writeMsMax":"26","shuffleOutputBytes":"38731942","shuffleOutputBytesSpilled":"0","recordsRead":"15993917","recordsWritten":"605252","parallelInputs":"91","completedParallelInputs":"91","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$1:from_address, $2:value, $3:block_timestamp","FROM bigquery-public-data.crypto_ethereum_classic.traces","WHERE and(greater_or_equal($3, 1577836800.000000000), less($3, 1585699200.000000000))"]},{"kind":"AGGREGATE","substeps":["GROUP BY $160 := $1","$50 := SUM($2)"]},{"kind":"WRITE","substeps":["$160, $50","TO __stage01_output","BY HASH($160)"]}],"slotMs":"8544","computeMode":"BIGQUERY"},{"name":"S02: Sort+","id":"2","startMs":"1762526283162","endMs":"1762526283223","inputStages":["0"],"waitRatioAvg":0.1111111111111111,"waitMsAvg":"12","waitRatioMax":0.1111111111111111,"waitMsMax":"12","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.48148148148148145,"computeMsAvg":"52","computeRatioMax":0.6203703703703703,"computeMsMax":"67","writeRatioAvg":0.037037037037037035,"writeMsAvg":"4","writeRatioMax":0.046296296296296294,"writeMsMax":"5","shuffleOutputBytes":"3285","shuffleOutputBytesSpilled":"0","recordsRead":"582464","recordsWritten":"45","parallelInputs":"9","completedParallelInputs":"9","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$100, $80, $81","FROM __stage00_output"]},{"kind":"FILTER","substeps":["less_or_equal($60, 5)"]},{"kind":"ANALYTIC_FUNCTION","substeps":["$60 := ROW_NUMBER() OVER (ORDER BY $122 DESC)"]},{"kind":"SORT","substeps":["$71 DESC"]},{"kind":"AGGREGATE","substeps":["GROUP BY $110 := $100","$70 := SUM($80)","$71 := SUM_OF_COUNTS($81)"]},{"kind":"WRITE","substeps":["$130, $131, $132","TO __stage02_output"]}],"slotMs":"754","computeMode":"BIGQUERY"},{"name":"S03: Aggregate+","id":"3","startMs":"1762526283227","endMs":"1762526283236","inputStages":["2"],"waitRatioAvg":0.027777777777777776,"waitMsAvg":"3","waitRatioMax":0.027777777777777776,"waitMsMax":"3","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.05555555555555555,"computeMsAvg":"6","computeRatioMax":0.05555555555555555,"computeMsMax":"6","writeRatioAvg":0.009259259259259259,"writeMsAvg":"1","writeRatioMax":0.009259259259259259,"writeMsMax":"1","shuffleOutputBytes":"37","shuffleOutputBytesSpilled":"0","recordsRead":"45","recordsWritten":"1","parallelInputs":"1","completedParallelInputs":"1","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$130, $131, $132","FROM __stage02_output"]},{"kind":"AGGREGATE","substeps":["$134 := shard_sink_stats($133)"]},{"kind":"COMPUTE","substeps":["$133 := STRUCT<...>"]},{"kind":"WRITE","substeps":["$134","TO __stage03_output"]}],"slotMs":"10","computeMode":"BIGQUERY"},{"name":"S04: Aggregate","id":"4","startMs":"1762526283235","endMs":"1762526283283","inputStages":["3"],"waitRatioAvg":0.09259259259259259,"waitMsAvg":"10","waitRatioMax":0.09259259259259259,"waitMsMax":"10","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.12037037037037036,"computeMsAvg":"13","computeRatioMax":0.12037037037037036,"computeMsMax":"13","writeRatioAvg":0.1574074074074074,"writeMsAvg":"17","writeRatioMax":0.1574074074074074,"writeMsMax":"17","shuffleOutputBytes":"27","shuffleOutputBytesSpilled":"0","recordsRead":"1","recordsWritten":"1","parallelInputs":"1","completedParallelInputs":"1","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$134","FROM __stage03_output"]},{"kind":"AGGREGATE","substeps":["$135 := root_sink_stats($134)"]},{"kind":"WRITE","substeps":["$135","TO __stage04_output"]}],"slotMs":"45","computeMode":"BIGQUERY"},{"name":"S06: Sort+","id":"6","startMs":"1762526283303","endMs":"1762526283333","inputStages":["4","2"],"waitRatioAvg":0.027777777777777776,"waitMsAvg":"3","waitRatioMax":0.027777777777777776,"waitMsMax":"3","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.1388888888888889,"computeMsAvg":"15","computeRatioMax":0.1388888888888889,"computeMsMax":"15","writeRatioAvg":0.12037037037037036,"writeMsAvg":"13","writeRatioMax":0.12037037037037036,"writeMsMax":"13","shuffleOutputBytes":"320","shuffleOutputBytesSpilled":"0","recordsRead":"46","recordsWritten":"5","parallelInputs":"1","completedParallelInputs":"1","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$135","FROM __stage04_output"]},{"kind":"READ","substeps":["$130, $131, $132","FROM __stage02_output"]},{"kind":"FILTER","substeps":["less_or_equal($40, 5)"]},{"kind":"ANALYTIC_FUNCTION","substeps":["$40 := ROW_NUMBER($135) OVER (ORDER BY $142 DESC)"]},{"kind":"SORT","substeps":["$132 DESC"]},{"kind":"WRITE","substeps":["$150, $151","TO __stage06_output"]}],"slotMs":"20","computeMode":"BIGQUERY"},{"name":"S07: Coalesce","id":"7","startMs":"1762526283340","endMs":"1762526283405","inputStages":["6"],"waitRatioAvg":0.05555555555555555,"waitMsAvg":"6","waitRatioMax":0.06481481481481481,"waitMsMax":"7","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.09259259259259259,"computeMsAvg":"10","computeRatioMax":0.12962962962962962,"computeMsMax":"14","writeRatioAvg":0.09259259259259259,"writeMsAvg":"10","writeRatioMax":0.18518518518518517,"writeMsMax":"20","shuffleOutputBytes":"320","shuffleOutputBytesSpilled":"0","recordsRead":"5","recordsWritten":"5","parallelInputs":"100","completedParallelInputs":"100","status":"COMPLETE","steps":[{"kind":"READ","substeps":["FROM __stage06_output"]}],"slotMs":"6932","computeMode":"BIGQUERY"},{"name":"S08: Join+","id":"8","startMs":"1762526283345","endMs":"1762526283436","inputStages":["1","7"],"waitRatioAvg":0.09259259259259259,"waitMsAvg":"10","waitRatioMax":0.10185185185185185,"waitMsMax":"11","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.42592592592592593,"computeMsAvg":"46","computeRatioMax":0.5648148148148148,"computeMsMax":"61","writeRatioAvg":0.018518518518518517,"writeMsAvg":"2","writeRatioMax":0.037037037037037035,"writeMsMax":"4","shuffleOutputBytes":"490","shuffleOutputBytesSpilled":"0","recordsRead":"605297","recordsWritten":"5","parallelInputs":"9","completedParallelInputs":"9","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$160, $50","FROM __stage01_output"]},{"kind":"READ","substeps":["$150, $151","FROM __stage07_output"]},{"kind":"SORT","substeps":["$20 DESC","LIMIT 100"]},{"kind":"COMPUTE","substeps":["$20 := subtract($182, $181)"]},{"kind":"JOIN","substeps":["$182 := $30, $180 := $150, $181 := $151","INNER HASH JOIN EACH  WITH ALL  ON $170 = $150"]},{"kind":"AGGREGATE","substeps":["GROUP BY $170 := $160","$30 := SUM($50)"]},{"kind":"WRITE","substeps":["$190, $191, $192, $193","TO __stage08_output"]}],"slotMs":"1200","computeMode":"BIGQUERY"},{"name":"S09: Output","id":"9","startMs":"1762526283356","endMs":"1762526283447","inputStages":["8"],"waitRatioAvg":0.1574074074074074,"waitMsAvg":"17","waitRatioMax":0.1574074074074074,"waitMsMax":"17","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.08333333333333333,"computeMsAvg":"9","computeRatioMax":0.08333333333333333,"computeMsMax":"9","writeRatioAvg":0.10185185185185185,"writeMsAvg":"11","writeRatioMax":0.10185185185185185,"writeMsMax":"11","shuffleOutputBytes":"490","shuffleOutputBytesSpilled":"0","recordsRead":"5","recordsWritten":"5","parallelInputs":"1","completedParallelInputs":"1","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$190, $191, $192, $193","FROM __stage08_output"]},{"kind":"SORT","substeps":["$191 DESC","LIMIT 100"]},{"kind":"WRITE","substeps":["$200, $201, $202, $203","TO __stage09_output"]}],"slotMs":"106","computeMode":"BIGQUERY"}],"estimatedBytesProcessed":"1594954856","timeline":[{"elapsedMs":"316","totalSlotMs":"24968","pendingUnits":"182","completedUnits":"0","activeUnits":"0","estimatedRunnableUnits":"0"},{"elapsedMs":"770","totalSlotMs":"24968","pendingUnits":"0","completedUnits":"304","estimatedRunnableUnits":"0"}],"totalPartitionsProcessed":"182","totalBytesProcessed":"1594954856","totalBytesBilled":"1595932672","billingTier":1,"totalSlotMs":"24968","cacheHit":false,"referencedTables":[{"projectId":"bigquery-public-data","datasetId":"crypto_ethereum_classic","tableId":"transactions"},{"projectId":"bigquery-public-data","datasetId":"crypto_ethereum_classic","tableId":"traces"}],"statementType":"SELECT","searchStatistics":{"indexUsageMode":"UNUSED","indexUnusedReasons":[{"code":"INDEX_CONFIG_NOT_AVAILABLE","message":"There is no index configuration for the base table `bigquery-public-data:crypto_ethereum_classic.traces`.","baseTable":{"projectId":"bigquery-public-data","datasetId":"crypto_ethereum_classic","tableId":"traces"}},{"code":"INDEX_CONFIG_NOT_AVAILABLE","message":"There is no index configuration for the base table `bigquery-public-data:crypto_ethereum_classic.transactions`.","baseTable":{"projectId":"bigquery-public-data","datasetId":"crypto_ethereum_classic","tableId":"transactions"}}]},"transferredBytes":"0","metadataCacheStatistics":{"tableMetadataCacheUsage":[{"tableReference":{"projectId":"bigquery-public-data","datasetId":"crypto_ethereum_classic","tableId":"transactions"},"unusedReason":"OTHER_REASON"},{"tableReference":{"projectId":"bigquery-public-data","datasetId":"crypto_ethereum_classic","tableId":"traces"},"unusedReason":"OTHER_REASON"}]}},"totalSlotMs":"24968","finalExecutionDurationMs":"560"},"status":{"state":"DONE"},"principal_subject":"user:admin@bentrollope.altostrat.com","jobCreationReason":{"code":"REQUESTED"}}'
+ job_id=bqjob_r416f02ee81104807_0000019a5ec0c249_1
+ '[' -n bqjob_r416f02ee81104807_0000019a5ec0c249_1 ']'
+ echo '  [SUCCESS] Query submitted.'
  [SUCCESS] Query submitted.
+ echo '  *** JOB ID FOR Top Sender Optimized: bqjob_r416f02ee81104807_0000019a5ec0c249_1 ***'
  *** JOB ID FOR Top Sender Optimized: bqjob_r416f02ee81104807_0000019a5ec0c249_1 ***
+ echo '  Waiting for job to complete...'
  Waiting for job to complete...
++ bq wait bqjob_r416f02ee81104807_0000019a5ec0c249_1
+ wait_output='Waiting on bqjob_r416f02ee81104807_0000019a5ec0c249_1 ... (0s) Current status: DONE   
Job tony-allen:bqjob_r416f02ee81104807_0000019a5ec0c249_1

  Job Type    State      Start Time         Duration                User Email              Bytes Processed   Bytes Billed   Billing Tier   Labels  
 ---------- --------- ----------------- ---------------- --------------------------------- ----------------- -------------- -------------- -------- 
  query      SUCCESS   07 Nov 14:38:02   0:00:00.876000   admin@bentrollope.altostrat.com   1594954856        1595932672     1                      '
+ '[' 0 -ne 0 ']'
+ echo '  Job completed. Fetching statistics...'
  Job completed. Fetching statistics...
++ bq show --format=json -j bqjob_r416f02ee81104807_0000019a5ec0c249_1
+ job_stats_json='{"kind":"bigquery#job","etag":"zYoc2eyKQ5AKliv7jYT18A==","id":"tony-allen:US.bqjob_r416f02ee81104807_0000019a5ec0c249_1","selfLink":"https://bigquery.googleapis.com/bigquery/v2/projects/tony-allen/jobs/bqjob_r416f02ee81104807_0000019a5ec0c249_1?location=US","user_email":"admin@bentrollope.altostrat.com","configuration":{"query":{"query":"WITH TransactionSummary AS (\n    -- CTE 1 (Optimized): Single scan of the transactions table to calculate fees and rank all relevant senders.\n    SELECT\n        t.from_address,\n        SUM(CAST(t.gas_price AS NUMERIC) * CAST(t.receipt_gas_used AS NUMERIC)) AS total_fees_paid,\n        ROW_NUMBER() OVER (\n            ORDER BY COUNT(t.hash) DESC\n        ) AS rn_transaction_count\n    FROM\n        `bigquery-public-data.crypto_ethereum_classic.transactions` AS t\n    WHERE\n        t.receipt_status = 1 \n        AND t.block_timestamp >= '\''2020-01-01 00:00:00 UTC'\''\n        AND t.block_timestamp < '\''2020-04-01 00:00:00 UTC'\''\n    GROUP BY\n        1\n),\n\nTraceSummary AS (\n    -- CTE 2 (Optimized): Single scan of the traces table to calculate the total value sent\n    SELECT\n        tr.from_address,\n        SUM(tr.value) AS total_value_sent\n    FROM\n        `bigquery-public-data.crypto_ethereum_classic.traces` AS tr\n    WHERE\n        tr.block_timestamp >= '\''2020-01-01 00:00:00 UTC'\''  \n        AND tr.block_timestamp < '\''2020-04-01 00:00:00 UTC'\''\n    GROUP BY\n        1\n)\n\n-- Final SELECT: Filter to the top 5 addresses (using the rank) and join the two pre-aggregated summaries.\nSELECT\n    ts.from_address,\n    ts.total_fees_paid,\n    vs.total_value_sent,\n    vs.total_value_sent - ts.total_fees_paid AS net_ether_flow_wei\nFROM\n    TransactionSummary AS ts\nINNER JOIN\n    TraceSummary AS vs ON ts.from_address = vs.from_address\nWHERE\n    ts.rn_transaction_count <= 5 -- Filter down to the top 5 addresses\nORDER BY\n    net_ether_flow_wei DESC\nLIMIT 100","destinationTable":{"projectId":"tony-allen","datasetId":"_e34c49c766e4fd3f5d404c3949b9e19fa7acb372","tableId":"anon6489f30f_f891_48fc_a822_3c5c62918fc4"},"writeDisposition":"WRITE_TRUNCATE","priority":"INTERACTIVE","useQueryCache":false,"useLegacySql":false},"jobType":"QUERY"},"jobReference":{"projectId":"tony-allen","jobId":"bqjob_r416f02ee81104807_0000019a5ec0c249_1","location":"US"},"statistics":{"creationTime":"1762526282566","startTime":"1762526282684","endTime":"1762526283560","totalBytesProcessed":"1594954856","query":{"queryPlan":[{"name":"S00: Input","id":"0","startMs":"1762526282942","endMs":"1762526283139","waitRatioAvg":0.4722222222222222,"waitMsAvg":"51","waitRatioMax":0.6018518518518519,"waitMsMax":"65","readRatioAvg":0.2222222222222222,"readMsAvg":"24","readRatioMax":0.7685185185185185,"readMsMax":"83","computeRatioAvg":0.28703703703703703,"computeMsAvg":"31","computeRatioMax":0.4722222222222222,"computeMsMax":"51","writeRatioAvg":0.037037037037037035,"writeMsAvg":"4","writeRatioMax":0.25,"writeMsMax":"27","shuffleOutputBytes":"42519872","shuffleOutputBytesSpilled":"0","recordsRead":"3714129","recordsWritten":"582464","parallelInputs":"91","completedParallelInputs":"91","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$10:hash, $11:from_address, $12:gas_price, $13:receipt_gas_used, $14:receipt_status, $15:block_timestamp","FROM bigquery-public-data.crypto_ethereum_classic.transactions","WHERE and(equal($14, 1), greater_or_equal($15, 1577836800.000000000), less($15, 1585699200.000000000))"]},{"kind":"AGGREGATE","substeps":["GROUP BY $100 := $11","$80 := SUM($90)","$81 := COUNT($10)"]},{"kind":"COMPUTE","substeps":["$90 := multiply(CAST($12 AS NUMERIC), CAST($13 AS NUMERIC))"]},{"kind":"WRITE","substeps":["$100, $80, $81","TO __stage00_output","BY HASH($100)"]}],"slotMs":"7355","computeMode":"BIGQUERY"},{"name":"S01: Input","id":"1","startMs":"1762526282942","endMs":"1762526283081","waitRatioAvg":0.3611111111111111,"waitMsAvg":"39","waitRatioMax":0.49074074074074076,"waitMsMax":"53","readRatioAvg":0.19444444444444445,"readMsAvg":"21","readRatioMax":1,"readMsMax":"108","computeRatioAvg":0.32407407407407407,"computeMsAvg":"35","computeRatioMax":0.6388888888888888,"computeMsMax":"69","writeRatioAvg":0.09259259259259259,"writeMsAvg":"10","writeRatioMax":0.24074074074074073,"writeMsMax":"26","shuffleOutputBytes":"38731942","shuffleOutputBytesSpilled":"0","recordsRead":"15993917","recordsWritten":"605252","parallelInputs":"91","completedParallelInputs":"91","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$1:from_address, $2:value, $3:block_timestamp","FROM bigquery-public-data.crypto_ethereum_classic.traces","WHERE and(greater_or_equal($3, 1577836800.000000000), less($3, 1585699200.000000000))"]},{"kind":"AGGREGATE","substeps":["GROUP BY $160 := $1","$50 := SUM($2)"]},{"kind":"WRITE","substeps":["$160, $50","TO __stage01_output","BY HASH($160)"]}],"slotMs":"8544","computeMode":"BIGQUERY"},{"name":"S02: Sort+","id":"2","startMs":"1762526283162","endMs":"1762526283223","inputStages":["0"],"waitRatioAvg":0.1111111111111111,"waitMsAvg":"12","waitRatioMax":0.1111111111111111,"waitMsMax":"12","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.48148148148148145,"computeMsAvg":"52","computeRatioMax":0.6203703703703703,"computeMsMax":"67","writeRatioAvg":0.037037037037037035,"writeMsAvg":"4","writeRatioMax":0.046296296296296294,"writeMsMax":"5","shuffleOutputBytes":"3285","shuffleOutputBytesSpilled":"0","recordsRead":"582464","recordsWritten":"45","parallelInputs":"9","completedParallelInputs":"9","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$100, $80, $81","FROM __stage00_output"]},{"kind":"FILTER","substeps":["less_or_equal($60, 5)"]},{"kind":"ANALYTIC_FUNCTION","substeps":["$60 := ROW_NUMBER() OVER (ORDER BY $122 DESC)"]},{"kind":"SORT","substeps":["$71 DESC"]},{"kind":"AGGREGATE","substeps":["GROUP BY $110 := $100","$70 := SUM($80)","$71 := SUM_OF_COUNTS($81)"]},{"kind":"WRITE","substeps":["$130, $131, $132","TO __stage02_output"]}],"slotMs":"754","computeMode":"BIGQUERY"},{"name":"S03: Aggregate+","id":"3","startMs":"1762526283227","endMs":"1762526283236","inputStages":["2"],"waitRatioAvg":0.027777777777777776,"waitMsAvg":"3","waitRatioMax":0.027777777777777776,"waitMsMax":"3","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.05555555555555555,"computeMsAvg":"6","computeRatioMax":0.05555555555555555,"computeMsMax":"6","writeRatioAvg":0.009259259259259259,"writeMsAvg":"1","writeRatioMax":0.009259259259259259,"writeMsMax":"1","shuffleOutputBytes":"37","shuffleOutputBytesSpilled":"0","recordsRead":"45","recordsWritten":"1","parallelInputs":"1","completedParallelInputs":"1","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$130, $131, $132","FROM __stage02_output"]},{"kind":"AGGREGATE","substeps":["$134 := shard_sink_stats($133)"]},{"kind":"COMPUTE","substeps":["$133 := STRUCT<...>"]},{"kind":"WRITE","substeps":["$134","TO __stage03_output"]}],"slotMs":"10","computeMode":"BIGQUERY"},{"name":"S04: Aggregate","id":"4","startMs":"1762526283235","endMs":"1762526283283","inputStages":["3"],"waitRatioAvg":0.09259259259259259,"waitMsAvg":"10","waitRatioMax":0.09259259259259259,"waitMsMax":"10","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.12037037037037036,"computeMsAvg":"13","computeRatioMax":0.12037037037037036,"computeMsMax":"13","writeRatioAvg":0.1574074074074074,"writeMsAvg":"17","writeRatioMax":0.1574074074074074,"writeMsMax":"17","shuffleOutputBytes":"27","shuffleOutputBytesSpilled":"0","recordsRead":"1","recordsWritten":"1","parallelInputs":"1","completedParallelInputs":"1","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$134","FROM __stage03_output"]},{"kind":"AGGREGATE","substeps":["$135 := root_sink_stats($134)"]},{"kind":"WRITE","substeps":["$135","TO __stage04_output"]}],"slotMs":"45","computeMode":"BIGQUERY"},{"name":"S06: Sort+","id":"6","startMs":"1762526283303","endMs":"1762526283333","inputStages":["4","2"],"waitRatioAvg":0.027777777777777776,"waitMsAvg":"3","waitRatioMax":0.027777777777777776,"waitMsMax":"3","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.1388888888888889,"computeMsAvg":"15","computeRatioMax":0.1388888888888889,"computeMsMax":"15","writeRatioAvg":0.12037037037037036,"writeMsAvg":"13","writeRatioMax":0.12037037037037036,"writeMsMax":"13","shuffleOutputBytes":"320","shuffleOutputBytesSpilled":"0","recordsRead":"46","recordsWritten":"5","parallelInputs":"1","completedParallelInputs":"1","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$135","FROM __stage04_output"]},{"kind":"READ","substeps":["$130, $131, $132","FROM __stage02_output"]},{"kind":"FILTER","substeps":["less_or_equal($40, 5)"]},{"kind":"ANALYTIC_FUNCTION","substeps":["$40 := ROW_NUMBER($135) OVER (ORDER BY $142 DESC)"]},{"kind":"SORT","substeps":["$132 DESC"]},{"kind":"WRITE","substeps":["$150, $151","TO __stage06_output"]}],"slotMs":"20","computeMode":"BIGQUERY"},{"name":"S07: Coalesce","id":"7","startMs":"1762526283340","endMs":"1762526283405","inputStages":["6"],"waitRatioAvg":0.05555555555555555,"waitMsAvg":"6","waitRatioMax":0.06481481481481481,"waitMsMax":"7","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.09259259259259259,"computeMsAvg":"10","computeRatioMax":0.12962962962962962,"computeMsMax":"14","writeRatioAvg":0.09259259259259259,"writeMsAvg":"10","writeRatioMax":0.18518518518518517,"writeMsMax":"20","shuffleOutputBytes":"320","shuffleOutputBytesSpilled":"0","recordsRead":"5","recordsWritten":"5","parallelInputs":"100","completedParallelInputs":"100","status":"COMPLETE","steps":[{"kind":"READ","substeps":["FROM __stage06_output"]}],"slotMs":"6932","computeMode":"BIGQUERY"},{"name":"S08: Join+","id":"8","startMs":"1762526283345","endMs":"1762526283436","inputStages":["1","7"],"waitRatioAvg":0.09259259259259259,"waitMsAvg":"10","waitRatioMax":0.10185185185185185,"waitMsMax":"11","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.42592592592592593,"computeMsAvg":"46","computeRatioMax":0.5648148148148148,"computeMsMax":"61","writeRatioAvg":0.018518518518518517,"writeMsAvg":"2","writeRatioMax":0.037037037037037035,"writeMsMax":"4","shuffleOutputBytes":"490","shuffleOutputBytesSpilled":"0","recordsRead":"605297","recordsWritten":"5","parallelInputs":"9","completedParallelInputs":"9","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$160, $50","FROM __stage01_output"]},{"kind":"READ","substeps":["$150, $151","FROM __stage07_output"]},{"kind":"SORT","substeps":["$20 DESC","LIMIT 100"]},{"kind":"COMPUTE","substeps":["$20 := subtract($182, $181)"]},{"kind":"JOIN","substeps":["$182 := $30, $180 := $150, $181 := $151","INNER HASH JOIN EACH  WITH ALL  ON $170 = $150"]},{"kind":"AGGREGATE","substeps":["GROUP BY $170 := $160","$30 := SUM($50)"]},{"kind":"WRITE","substeps":["$190, $191, $192, $193","TO __stage08_output"]}],"slotMs":"1200","computeMode":"BIGQUERY"},{"name":"S09: Output","id":"9","startMs":"1762526283356","endMs":"1762526283447","inputStages":["8"],"waitRatioAvg":0.1574074074074074,"waitMsAvg":"17","waitRatioMax":0.1574074074074074,"waitMsMax":"17","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.08333333333333333,"computeMsAvg":"9","computeRatioMax":0.08333333333333333,"computeMsMax":"9","writeRatioAvg":0.10185185185185185,"writeMsAvg":"11","writeRatioMax":0.10185185185185185,"writeMsMax":"11","shuffleOutputBytes":"490","shuffleOutputBytesSpilled":"0","recordsRead":"5","recordsWritten":"5","parallelInputs":"1","completedParallelInputs":"1","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$190, $191, $192, $193","FROM __stage08_output"]},{"kind":"SORT","substeps":["$191 DESC","LIMIT 100"]},{"kind":"WRITE","substeps":["$200, $201, $202, $203","TO __stage09_output"]}],"slotMs":"106","computeMode":"BIGQUERY"}],"estimatedBytesProcessed":"1594954856","timeline":[{"elapsedMs":"316","totalSlotMs":"24968","pendingUnits":"182","completedUnits":"0","activeUnits":"0","estimatedRunnableUnits":"0"},{"elapsedMs":"770","totalSlotMs":"24968","pendingUnits":"0","completedUnits":"304","estimatedRunnableUnits":"0"}],"totalPartitionsProcessed":"182","totalBytesProcessed":"1594954856","totalBytesBilled":"1595932672","billingTier":1,"totalSlotMs":"24968","cacheHit":false,"referencedTables":[{"projectId":"bigquery-public-data","datasetId":"crypto_ethereum_classic","tableId":"transactions"},{"projectId":"bigquery-public-data","datasetId":"crypto_ethereum_classic","tableId":"traces"}],"statementType":"SELECT","searchStatistics":{"indexUsageMode":"UNUSED","indexUnusedReasons":[{"code":"INDEX_CONFIG_NOT_AVAILABLE","message":"There is no index configuration for the base table `bigquery-public-data:crypto_ethereum_classic.traces`.","baseTable":{"projectId":"bigquery-public-data","datasetId":"crypto_ethereum_classic","tableId":"traces"}},{"code":"INDEX_CONFIG_NOT_AVAILABLE","message":"There is no index configuration for the base table `bigquery-public-data:crypto_ethereum_classic.transactions`.","baseTable":{"projectId":"bigquery-public-data","datasetId":"crypto_ethereum_classic","tableId":"transactions"}}]},"performanceInsights":{"avgPreviousExecutionMs":"517"},"transferredBytes":"0","metadataCacheStatistics":{"tableMetadataCacheUsage":[{"tableReference":{"projectId":"bigquery-public-data","datasetId":"crypto_ethereum_classic","tableId":"transactions"},"unusedReason":"OTHER_REASON"},{"tableReference":{"projectId":"bigquery-public-data","datasetId":"crypto_ethereum_classic","tableId":"traces"},"unusedReason":"OTHER_REASON"}]}},"totalSlotMs":"24968","finalExecutionDurationMs":"560"},"status":{"state":"DONE"},"principal_subject":"user:admin@bentrollope.altostrat.com","jobCreationReason":{"code":"REQUESTED"}}'
++ jq -r .statistics.totalBytesProcessed
++ echo '{"kind":"bigquery#job","etag":"zYoc2eyKQ5AKliv7jYT18A==","id":"tony-allen:US.bqjob_r416f02ee81104807_0000019a5ec0c249_1","selfLink":"https://bigquery.googleapis.com/bigquery/v2/projects/tony-allen/jobs/bqjob_r416f02ee81104807_0000019a5ec0c249_1?location=US","user_email":"admin@bentrollope.altostrat.com","configuration":{"query":{"query":"WITH TransactionSummary AS (\n    -- CTE 1 (Optimized): Single scan of the transactions table to calculate fees and rank all relevant senders.\n    SELECT\n        t.from_address,\n        SUM(CAST(t.gas_price AS NUMERIC) * CAST(t.receipt_gas_used AS NUMERIC)) AS total_fees_paid,\n        ROW_NUMBER() OVER (\n            ORDER BY COUNT(t.hash) DESC\n        ) AS rn_transaction_count\n    FROM\n        `bigquery-public-data.crypto_ethereum_classic.transactions` AS t\n    WHERE\n        t.receipt_status = 1 \n        AND t.block_timestamp >= '\''2020-01-01 00:00:00 UTC'\''\n        AND t.block_timestamp < '\''2020-04-01 00:00:00 UTC'\''\n    GROUP BY\n        1\n),\n\nTraceSummary AS (\n    -- CTE 2 (Optimized): Single scan of the traces table to calculate the total value sent\n    SELECT\n        tr.from_address,\n        SUM(tr.value) AS total_value_sent\n    FROM\n        `bigquery-public-data.crypto_ethereum_classic.traces` AS tr\n    WHERE\n        tr.block_timestamp >= '\''2020-01-01 00:00:00 UTC'\''  \n        AND tr.block_timestamp < '\''2020-04-01 00:00:00 UTC'\''\n    GROUP BY\n        1\n)\n\n-- Final SELECT: Filter to the top 5 addresses (using the rank) and join the two pre-aggregated summaries.\nSELECT\n    ts.from_address,\n    ts.total_fees_paid,\n    vs.total_value_sent,\n    vs.total_value_sent - ts.total_fees_paid AS net_ether_flow_wei\nFROM\n    TransactionSummary AS ts\nINNER JOIN\n    TraceSummary AS vs ON ts.from_address = vs.from_address\nWHERE\n    ts.rn_transaction_count <= 5 -- Filter down to the top 5 addresses\nORDER BY\n    net_ether_flow_wei DESC\nLIMIT 100","destinationTable":{"projectId":"tony-allen","datasetId":"_e34c49c766e4fd3f5d404c3949b9e19fa7acb372","tableId":"anon6489f30f_f891_48fc_a822_3c5c62918fc4"},"writeDisposition":"WRITE_TRUNCATE","priority":"INTERACTIVE","useQueryCache":false,"useLegacySql":false},"jobType":"QUERY"},"jobReference":{"projectId":"tony-allen","jobId":"bqjob_r416f02ee81104807_0000019a5ec0c249_1","location":"US"},"statistics":{"creationTime":"1762526282566","startTime":"1762526282684","endTime":"1762526283560","totalBytesProcessed":"1594954856","query":{"queryPlan":[{"name":"S00: Input","id":"0","startMs":"1762526282942","endMs":"1762526283139","waitRatioAvg":0.4722222222222222,"waitMsAvg":"51","waitRatioMax":0.6018518518518519,"waitMsMax":"65","readRatioAvg":0.2222222222222222,"readMsAvg":"24","readRatioMax":0.7685185185185185,"readMsMax":"83","computeRatioAvg":0.28703703703703703,"computeMsAvg":"31","computeRatioMax":0.4722222222222222,"computeMsMax":"51","writeRatioAvg":0.037037037037037035,"writeMsAvg":"4","writeRatioMax":0.25,"writeMsMax":"27","shuffleOutputBytes":"42519872","shuffleOutputBytesSpilled":"0","recordsRead":"3714129","recordsWritten":"582464","parallelInputs":"91","completedParallelInputs":"91","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$10:hash, $11:from_address, $12:gas_price, $13:receipt_gas_used, $14:receipt_status, $15:block_timestamp","FROM bigquery-public-data.crypto_ethereum_classic.transactions","WHERE and(equal($14, 1), greater_or_equal($15, 1577836800.000000000), less($15, 1585699200.000000000))"]},{"kind":"AGGREGATE","substeps":["GROUP BY $100 := $11","$80 := SUM($90)","$81 := COUNT($10)"]},{"kind":"COMPUTE","substeps":["$90 := multiply(CAST($12 AS NUMERIC), CAST($13 AS NUMERIC))"]},{"kind":"WRITE","substeps":["$100, $80, $81","TO __stage00_output","BY HASH($100)"]}],"slotMs":"7355","computeMode":"BIGQUERY"},{"name":"S01: Input","id":"1","startMs":"1762526282942","endMs":"1762526283081","waitRatioAvg":0.3611111111111111,"waitMsAvg":"39","waitRatioMax":0.49074074074074076,"waitMsMax":"53","readRatioAvg":0.19444444444444445,"readMsAvg":"21","readRatioMax":1,"readMsMax":"108","computeRatioAvg":0.32407407407407407,"computeMsAvg":"35","computeRatioMax":0.6388888888888888,"computeMsMax":"69","writeRatioAvg":0.09259259259259259,"writeMsAvg":"10","writeRatioMax":0.24074074074074073,"writeMsMax":"26","shuffleOutputBytes":"38731942","shuffleOutputBytesSpilled":"0","recordsRead":"15993917","recordsWritten":"605252","parallelInputs":"91","completedParallelInputs":"91","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$1:from_address, $2:value, $3:block_timestamp","FROM bigquery-public-data.crypto_ethereum_classic.traces","WHERE and(greater_or_equal($3, 1577836800.000000000), less($3, 1585699200.000000000))"]},{"kind":"AGGREGATE","substeps":["GROUP BY $160 := $1","$50 := SUM($2)"]},{"kind":"WRITE","substeps":["$160, $50","TO __stage01_output","BY HASH($160)"]}],"slotMs":"8544","computeMode":"BIGQUERY"},{"name":"S02: Sort+","id":"2","startMs":"1762526283162","endMs":"1762526283223","inputStages":["0"],"waitRatioAvg":0.1111111111111111,"waitMsAvg":"12","waitRatioMax":0.1111111111111111,"waitMsMax":"12","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.48148148148148145,"computeMsAvg":"52","computeRatioMax":0.6203703703703703,"computeMsMax":"67","writeRatioAvg":0.037037037037037035,"writeMsAvg":"4","writeRatioMax":0.046296296296296294,"writeMsMax":"5","shuffleOutputBytes":"3285","shuffleOutputBytesSpilled":"0","recordsRead":"582464","recordsWritten":"45","parallelInputs":"9","completedParallelInputs":"9","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$100, $80, $81","FROM __stage00_output"]},{"kind":"FILTER","substeps":["less_or_equal($60, 5)"]},{"kind":"ANALYTIC_FUNCTION","substeps":["$60 := ROW_NUMBER() OVER (ORDER BY $122 DESC)"]},{"kind":"SORT","substeps":["$71 DESC"]},{"kind":"AGGREGATE","substeps":["GROUP BY $110 := $100","$70 := SUM($80)","$71 := SUM_OF_COUNTS($81)"]},{"kind":"WRITE","substeps":["$130, $131, $132","TO __stage02_output"]}],"slotMs":"754","computeMode":"BIGQUERY"},{"name":"S03: Aggregate+","id":"3","startMs":"1762526283227","endMs":"1762526283236","inputStages":["2"],"waitRatioAvg":0.027777777777777776,"waitMsAvg":"3","waitRatioMax":0.027777777777777776,"waitMsMax":"3","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.05555555555555555,"computeMsAvg":"6","computeRatioMax":0.05555555555555555,"computeMsMax":"6","writeRatioAvg":0.009259259259259259,"writeMsAvg":"1","writeRatioMax":0.009259259259259259,"writeMsMax":"1","shuffleOutputBytes":"37","shuffleOutputBytesSpilled":"0","recordsRead":"45","recordsWritten":"1","parallelInputs":"1","completedParallelInputs":"1","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$130, $131, $132","FROM __stage02_output"]},{"kind":"AGGREGATE","substeps":["$134 := shard_sink_stats($133)"]},{"kind":"COMPUTE","substeps":["$133 := STRUCT<...>"]},{"kind":"WRITE","substeps":["$134","TO __stage03_output"]}],"slotMs":"10","computeMode":"BIGQUERY"},{"name":"S04: Aggregate","id":"4","startMs":"1762526283235","endMs":"1762526283283","inputStages":["3"],"waitRatioAvg":0.09259259259259259,"waitMsAvg":"10","waitRatioMax":0.09259259259259259,"waitMsMax":"10","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.12037037037037036,"computeMsAvg":"13","computeRatioMax":0.12037037037037036,"computeMsMax":"13","writeRatioAvg":0.1574074074074074,"writeMsAvg":"17","writeRatioMax":0.1574074074074074,"writeMsMax":"17","shuffleOutputBytes":"27","shuffleOutputBytesSpilled":"0","recordsRead":"1","recordsWritten":"1","parallelInputs":"1","completedParallelInputs":"1","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$134","FROM __stage03_output"]},{"kind":"AGGREGATE","substeps":["$135 := root_sink_stats($134)"]},{"kind":"WRITE","substeps":["$135","TO __stage04_output"]}],"slotMs":"45","computeMode":"BIGQUERY"},{"name":"S06: Sort+","id":"6","startMs":"1762526283303","endMs":"1762526283333","inputStages":["4","2"],"waitRatioAvg":0.027777777777777776,"waitMsAvg":"3","waitRatioMax":0.027777777777777776,"waitMsMax":"3","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.1388888888888889,"computeMsAvg":"15","computeRatioMax":0.1388888888888889,"computeMsMax":"15","writeRatioAvg":0.12037037037037036,"writeMsAvg":"13","writeRatioMax":0.12037037037037036,"writeMsMax":"13","shuffleOutputBytes":"320","shuffleOutputBytesSpilled":"0","recordsRead":"46","recordsWritten":"5","parallelInputs":"1","completedParallelInputs":"1","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$135","FROM __stage04_output"]},{"kind":"READ","substeps":["$130, $131, $132","FROM __stage02_output"]},{"kind":"FILTER","substeps":["less_or_equal($40, 5)"]},{"kind":"ANALYTIC_FUNCTION","substeps":["$40 := ROW_NUMBER($135) OVER (ORDER BY $142 DESC)"]},{"kind":"SORT","substeps":["$132 DESC"]},{"kind":"WRITE","substeps":["$150, $151","TO __stage06_output"]}],"slotMs":"20","computeMode":"BIGQUERY"},{"name":"S07: Coalesce","id":"7","startMs":"1762526283340","endMs":"1762526283405","inputStages":["6"],"waitRatioAvg":0.05555555555555555,"waitMsAvg":"6","waitRatioMax":0.06481481481481481,"waitMsMax":"7","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.09259259259259259,"computeMsAvg":"10","computeRatioMax":0.12962962962962962,"computeMsMax":"14","writeRatioAvg":0.09259259259259259,"writeMsAvg":"10","writeRatioMax":0.18518518518518517,"writeMsMax":"20","shuffleOutputBytes":"320","shuffleOutputBytesSpilled":"0","recordsRead":"5","recordsWritten":"5","parallelInputs":"100","completedParallelInputs":"100","status":"COMPLETE","steps":[{"kind":"READ","substeps":["FROM __stage06_output"]}],"slotMs":"6932","computeMode":"BIGQUERY"},{"name":"S08: Join+","id":"8","startMs":"1762526283345","endMs":"1762526283436","inputStages":["1","7"],"waitRatioAvg":0.09259259259259259,"waitMsAvg":"10","waitRatioMax":0.10185185185185185,"waitMsMax":"11","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.42592592592592593,"computeMsAvg":"46","computeRatioMax":0.5648148148148148,"computeMsMax":"61","writeRatioAvg":0.018518518518518517,"writeMsAvg":"2","writeRatioMax":0.037037037037037035,"writeMsMax":"4","shuffleOutputBytes":"490","shuffleOutputBytesSpilled":"0","recordsRead":"605297","recordsWritten":"5","parallelInputs":"9","completedParallelInputs":"9","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$160, $50","FROM __stage01_output"]},{"kind":"READ","substeps":["$150, $151","FROM __stage07_output"]},{"kind":"SORT","substeps":["$20 DESC","LIMIT 100"]},{"kind":"COMPUTE","substeps":["$20 := subtract($182, $181)"]},{"kind":"JOIN","substeps":["$182 := $30, $180 := $150, $181 := $151","INNER HASH JOIN EACH  WITH ALL  ON $170 = $150"]},{"kind":"AGGREGATE","substeps":["GROUP BY $170 := $160","$30 := SUM($50)"]},{"kind":"WRITE","substeps":["$190, $191, $192, $193","TO __stage08_output"]}],"slotMs":"1200","computeMode":"BIGQUERY"},{"name":"S09: Output","id":"9","startMs":"1762526283356","endMs":"1762526283447","inputStages":["8"],"waitRatioAvg":0.1574074074074074,"waitMsAvg":"17","waitRatioMax":0.1574074074074074,"waitMsMax":"17","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.08333333333333333,"computeMsAvg":"9","computeRatioMax":0.08333333333333333,"computeMsMax":"9","writeRatioAvg":0.10185185185185185,"writeMsAvg":"11","writeRatioMax":0.10185185185185185,"writeMsMax":"11","shuffleOutputBytes":"490","shuffleOutputBytesSpilled":"0","recordsRead":"5","recordsWritten":"5","parallelInputs":"1","completedParallelInputs":"1","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$190, $191, $192, $193","FROM __stage08_output"]},{"kind":"SORT","substeps":["$191 DESC","LIMIT 100"]},{"kind":"WRITE","substeps":["$200, $201, $202, $203","TO __stage09_output"]}],"slotMs":"106","computeMode":"BIGQUERY"}],"estimatedBytesProcessed":"1594954856","timeline":[{"elapsedMs":"316","totalSlotMs":"24968","pendingUnits":"182","completedUnits":"0","activeUnits":"0","estimatedRunnableUnits":"0"},{"elapsedMs":"770","totalSlotMs":"24968","pendingUnits":"0","completedUnits":"304","estimatedRunnableUnits":"0"}],"totalPartitionsProcessed":"182","totalBytesProcessed":"1594954856","totalBytesBilled":"1595932672","billingTier":1,"totalSlotMs":"24968","cacheHit":false,"referencedTables":[{"projectId":"bigquery-public-data","datasetId":"crypto_ethereum_classic","tableId":"transactions"},{"projectId":"bigquery-public-data","datasetId":"crypto_ethereum_classic","tableId":"traces"}],"statementType":"SELECT","searchStatistics":{"indexUsageMode":"UNUSED","indexUnusedReasons":[{"code":"INDEX_CONFIG_NOT_AVAILABLE","message":"There is no index configuration for the base table `bigquery-public-data:crypto_ethereum_classic.traces`.","baseTable":{"projectId":"bigquery-public-data","datasetId":"crypto_ethereum_classic","tableId":"traces"}},{"code":"INDEX_CONFIG_NOT_AVAILABLE","message":"There is no index configuration for the base table `bigquery-public-data:crypto_ethereum_classic.transactions`.","baseTable":{"projectId":"bigquery-public-data","datasetId":"crypto_ethereum_classic","tableId":"transactions"}}]},"performanceInsights":{"avgPreviousExecutionMs":"517"},"transferredBytes":"0","metadataCacheStatistics":{"tableMetadataCacheUsage":[{"tableReference":{"projectId":"bigquery-public-data","datasetId":"crypto_ethereum_classic","tableId":"transactions"},"unusedReason":"OTHER_REASON"},{"tableReference":{"projectId":"bigquery-public-data","datasetId":"crypto_ethereum_classic","tableId":"traces"},"unusedReason":"OTHER_REASON"}]}},"totalSlotMs":"24968","finalExecutionDurationMs":"560"},"status":{"state":"DONE"},"principal_subject":"user:admin@bentrollope.altostrat.com","jobCreationReason":{"code":"REQUESTED"}}'
+ total_bytes_processed=1594954856
++ echo '{"kind":"bigquery#job","etag":"zYoc2eyKQ5AKliv7jYT18A==","id":"tony-allen:US.bqjob_r416f02ee81104807_0000019a5ec0c249_1","selfLink":"https://bigquery.googleapis.com/bigquery/v2/projects/tony-allen/jobs/bqjob_r416f02ee81104807_0000019a5ec0c249_1?location=US","user_email":"admin@bentrollope.altostrat.com","configuration":{"query":{"query":"WITH TransactionSummary AS (\n    -- CTE 1 (Optimized): Single scan of the transactions table to calculate fees and rank all relevant senders.\n    SELECT\n        t.from_address,\n        SUM(CAST(t.gas_price AS NUMERIC) * CAST(t.receipt_gas_used AS NUMERIC)) AS total_fees_paid,\n        ROW_NUMBER() OVER (\n            ORDER BY COUNT(t.hash) DESC\n        ) AS rn_transaction_count\n    FROM\n        `bigquery-public-data.crypto_ethereum_classic.transactions` AS t\n    WHERE\n        t.receipt_status = 1 \n        AND t.block_timestamp >= '\''2020-01-01 00:00:00 UTC'\''\n        AND t.block_timestamp < '\''2020-04-01 00:00:00 UTC'\''\n    GROUP BY\n        1\n),\n\nTraceSummary AS (\n    -- CTE 2 (Optimized): Single scan of the traces table to calculate the total value sent\n    SELECT\n        tr.from_address,\n        SUM(tr.value) AS total_value_sent\n    FROM\n        `bigquery-public-data.crypto_ethereum_classic.traces` AS tr\n    WHERE\n        tr.block_timestamp >= '\''2020-01-01 00:00:00 UTC'\''  \n        AND tr.block_timestamp < '\''2020-04-01 00:00:00 UTC'\''\n    GROUP BY\n        1\n)\n\n-- Final SELECT: Filter to the top 5 addresses (using the rank) and join the two pre-aggregated summaries.\nSELECT\n    ts.from_address,\n    ts.total_fees_paid,\n    vs.total_value_sent,\n    vs.total_value_sent - ts.total_fees_paid AS net_ether_flow_wei\nFROM\n    TransactionSummary AS ts\nINNER JOIN\n    TraceSummary AS vs ON ts.from_address = vs.from_address\nWHERE\n    ts.rn_transaction_count <= 5 -- Filter down to the top 5 addresses\nORDER BY\n    net_ether_flow_wei DESC\nLIMIT 100","destinationTable":{"projectId":"tony-allen","datasetId":"_e34c49c766e4fd3f5d404c3949b9e19fa7acb372","tableId":"anon6489f30f_f891_48fc_a822_3c5c62918fc4"},"writeDisposition":"WRITE_TRUNCATE","priority":"INTERACTIVE","useQueryCache":false,"useLegacySql":false},"jobType":"QUERY"},"jobReference":{"projectId":"tony-allen","jobId":"bqjob_r416f02ee81104807_0000019a5ec0c249_1","location":"US"},"statistics":{"creationTime":"1762526282566","startTime":"1762526282684","endTime":"1762526283560","totalBytesProcessed":"1594954856","query":{"queryPlan":[{"name":"S00: Input","id":"0","startMs":"1762526282942","endMs":"1762526283139","waitRatioAvg":0.4722222222222222,"waitMsAvg":"51","waitRatioMax":0.6018518518518519,"waitMsMax":"65","readRatioAvg":0.2222222222222222,"readMsAvg":"24","readRatioMax":0.7685185185185185,"readMsMax":"83","computeRatioAvg":0.28703703703703703,"computeMsAvg":"31","computeRatioMax":0.4722222222222222,"computeMsMax":"51","writeRatioAvg":0.037037037037037035,"writeMsAvg":"4","writeRatioMax":0.25,"writeMsMax":"27","shuffleOutputBytes":"42519872","shuffleOutputBytesSpilled":"0","recordsRead":"3714129","recordsWritten":"582464","parallelInputs":"91","completedParallelInputs":"91","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$10:hash, $11:from_address, $12:gas_price, $13:receipt_gas_used, $14:receipt_status, $15:block_timestamp","FROM bigquery-public-data.crypto_ethereum_classic.transactions","WHERE and(equal($14, 1), greater_or_equal($15, 1577836800.000000000), less($15, 1585699200.000000000))"]},{"kind":"AGGREGATE","substeps":["GROUP BY $100 := $11","$80 := SUM($90)","$81 := COUNT($10)"]},{"kind":"COMPUTE","substeps":["$90 := multiply(CAST($12 AS NUMERIC), CAST($13 AS NUMERIC))"]},{"kind":"WRITE","substeps":["$100, $80, $81","TO __stage00_output","BY HASH($100)"]}],"slotMs":"7355","computeMode":"BIGQUERY"},{"name":"S01: Input","id":"1","startMs":"1762526282942","endMs":"1762526283081","waitRatioAvg":0.3611111111111111,"waitMsAvg":"39","waitRatioMax":0.49074074074074076,"waitMsMax":"53","readRatioAvg":0.19444444444444445,"readMsAvg":"21","readRatioMax":1,"readMsMax":"108","computeRatioAvg":0.32407407407407407,"computeMsAvg":"35","computeRatioMax":0.6388888888888888,"computeMsMax":"69","writeRatioAvg":0.09259259259259259,"writeMsAvg":"10","writeRatioMax":0.24074074074074073,"writeMsMax":"26","shuffleOutputBytes":"38731942","shuffleOutputBytesSpilled":"0","recordsRead":"15993917","recordsWritten":"605252","parallelInputs":"91","completedParallelInputs":"91","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$1:from_address, $2:value, $3:block_timestamp","FROM bigquery-public-data.crypto_ethereum_classic.traces","WHERE and(greater_or_equal($3, 1577836800.000000000), less($3, 1585699200.000000000))"]},{"kind":"AGGREGATE","substeps":["GROUP BY $160 := $1","$50 := SUM($2)"]},{"kind":"WRITE","substeps":["$160, $50","TO __stage01_output","BY HASH($160)"]}],"slotMs":"8544","computeMode":"BIGQUERY"},{"name":"S02: Sort+","id":"2","startMs":"1762526283162","endMs":"1762526283223","inputStages":["0"],"waitRatioAvg":0.1111111111111111,"waitMsAvg":"12","waitRatioMax":0.1111111111111111,"waitMsMax":"12","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.48148148148148145,"computeMsAvg":"52","computeRatioMax":0.6203703703703703,"computeMsMax":"67","writeRatioAvg":0.037037037037037035,"writeMsAvg":"4","writeRatioMax":0.046296296296296294,"writeMsMax":"5","shuffleOutputBytes":"3285","shuffleOutputBytesSpilled":"0","recordsRead":"582464","recordsWritten":"45","parallelInputs":"9","completedParallelInputs":"9","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$100, $80, $81","FROM __stage00_output"]},{"kind":"FILTER","substeps":["less_or_equal($60, 5)"]},{"kind":"ANALYTIC_FUNCTION","substeps":["$60 := ROW_NUMBER() OVER (ORDER BY $122 DESC)"]},{"kind":"SORT","substeps":["$71 DESC"]},{"kind":"AGGREGATE","substeps":["GROUP BY $110 := $100","$70 := SUM($80)","$71 := SUM_OF_COUNTS($81)"]},{"kind":"WRITE","substeps":["$130, $131, $132","TO __stage02_output"]}],"slotMs":"754","computeMode":"BIGQUERY"},{"name":"S03: Aggregate+","id":"3","startMs":"1762526283227","endMs":"1762526283236","inputStages":["2"],"waitRatioAvg":0.027777777777777776,"waitMsAvg":"3","waitRatioMax":0.027777777777777776,"waitMsMax":"3","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.05555555555555555,"computeMsAvg":"6","computeRatioMax":0.05555555555555555,"computeMsMax":"6","writeRatioAvg":0.009259259259259259,"writeMsAvg":"1","writeRatioMax":0.009259259259259259,"writeMsMax":"1","shuffleOutputBytes":"37","shuffleOutputBytesSpilled":"0","recordsRead":"45","recordsWritten":"1","parallelInputs":"1","completedParallelInputs":"1","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$130, $131, $132","FROM __stage02_output"]},{"kind":"AGGREGATE","substeps":["$134 := shard_sink_stats($133)"]},{"kind":"COMPUTE","substeps":["$133 := STRUCT<...>"]},{"kind":"WRITE","substeps":["$134","TO __stage03_output"]}],"slotMs":"10","computeMode":"BIGQUERY"},{"name":"S04: Aggregate","id":"4","startMs":"1762526283235","endMs":"1762526283283","inputStages":["3"],"waitRatioAvg":0.09259259259259259,"waitMsAvg":"10","waitRatioMax":0.09259259259259259,"waitMsMax":"10","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.12037037037037036,"computeMsAvg":"13","computeRatioMax":0.12037037037037036,"computeMsMax":"13","writeRatioAvg":0.1574074074074074,"writeMsAvg":"17","writeRatioMax":0.1574074074074074,"writeMsMax":"17","shuffleOutputBytes":"27","shuffleOutputBytesSpilled":"0","recordsRead":"1","recordsWritten":"1","parallelInputs":"1","completedParallelInputs":"1","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$134","FROM __stage03_output"]},{"kind":"AGGREGATE","substeps":["$135 := root_sink_stats($134)"]},{"kind":"WRITE","substeps":["$135","TO __stage04_output"]}],"slotMs":"45","computeMode":"BIGQUERY"},{"name":"S06: Sort+","id":"6","startMs":"1762526283303","endMs":"1762526283333","inputStages":["4","2"],"waitRatioAvg":0.027777777777777776,"waitMsAvg":"3","waitRatioMax":0.027777777777777776,"waitMsMax":"3","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.1388888888888889,"computeMsAvg":"15","computeRatioMax":0.1388888888888889,"computeMsMax":"15","writeRatioAvg":0.12037037037037036,"writeMsAvg":"13","writeRatioMax":0.12037037037037036,"writeMsMax":"13","shuffleOutputBytes":"320","shuffleOutputBytesSpilled":"0","recordsRead":"46","recordsWritten":"5","parallelInputs":"1","completedParallelInputs":"1","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$135","FROM __stage04_output"]},{"kind":"READ","substeps":["$130, $131, $132","FROM __stage02_output"]},{"kind":"FILTER","substeps":["less_or_equal($40, 5)"]},{"kind":"ANALYTIC_FUNCTION","substeps":["$40 := ROW_NUMBER($135) OVER (ORDER BY $142 DESC)"]},{"kind":"SORT","substeps":["$132 DESC"]},{"kind":"WRITE","substeps":["$150, $151","TO __stage06_output"]}],"slotMs":"20","computeMode":"BIGQUERY"},{"name":"S07: Coalesce","id":"7","startMs":"1762526283340","endMs":"1762526283405","inputStages":["6"],"waitRatioAvg":0.05555555555555555,"waitMsAvg":"6","waitRatioMax":0.06481481481481481,"waitMsMax":"7","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.09259259259259259,"computeMsAvg":"10","computeRatioMax":0.12962962962962962,"computeMsMax":"14","writeRatioAvg":0.09259259259259259,"writeMsAvg":"10","writeRatioMax":0.18518518518518517,"writeMsMax":"20","shuffleOutputBytes":"320","shuffleOutputBytesSpilled":"0","recordsRead":"5","recordsWritten":"5","parallelInputs":"100","completedParallelInputs":"100","status":"COMPLETE","steps":[{"kind":"READ","substeps":["FROM __stage06_output"]}],"slotMs":"6932","computeMode":"BIGQUERY"},{"name":"S08: Join+","id":"8","startMs":"1762526283345","endMs":"1762526283436","inputStages":["1","7"],"waitRatioAvg":0.09259259259259259,"waitMsAvg":"10","waitRatioMax":0.10185185185185185,"waitMsMax":"11","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.42592592592592593,"computeMsAvg":"46","computeRatioMax":0.5648148148148148,"computeMsMax":"61","writeRatioAvg":0.018518518518518517,"writeMsAvg":"2","writeRatioMax":0.037037037037037035,"writeMsMax":"4","shuffleOutputBytes":"490","shuffleOutputBytesSpilled":"0","recordsRead":"605297","recordsWritten":"5","parallelInputs":"9","completedParallelInputs":"9","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$160, $50","FROM __stage01_output"]},{"kind":"READ","substeps":["$150, $151","FROM __stage07_output"]},{"kind":"SORT","substeps":["$20 DESC","LIMIT 100"]},{"kind":"COMPUTE","substeps":["$20 := subtract($182, $181)"]},{"kind":"JOIN","substeps":["$182 := $30, $180 := $150, $181 := $151","INNER HASH JOIN EACH  WITH ALL  ON $170 = $150"]},{"kind":"AGGREGATE","substeps":["GROUP BY $170 := $160","$30 := SUM($50)"]},{"kind":"WRITE","substeps":["$190, $191, $192, $193","TO __stage08_output"]}],"slotMs":"1200","computeMode":"BIGQUERY"},{"name":"S09: Output","id":"9","startMs":"1762526283356","endMs":"1762526283447","inputStages":["8"],"waitRatioAvg":0.1574074074074074,"waitMsAvg":"17","waitRatioMax":0.1574074074074074,"waitMsMax":"17","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.08333333333333333,"computeMsAvg":"9","computeRatioMax":0.08333333333333333,"computeMsMax":"9","writeRatioAvg":0.10185185185185185,"writeMsAvg":"11","writeRatioMax":0.10185185185185185,"writeMsMax":"11","shuffleOutputBytes":"490","shuffleOutputBytesSpilled":"0","recordsRead":"5","recordsWritten":"5","parallelInputs":"1","completedParallelInputs":"1","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$190, $191, $192, $193","FROM __stage08_output"]},{"kind":"SORT","substeps":["$191 DESC","LIMIT 100"]},{"kind":"WRITE","substeps":["$200, $201, $202, $203","TO __stage09_output"]}],"slotMs":"106","computeMode":"BIGQUERY"}],"estimatedBytesProcessed":"1594954856","timeline":[{"elapsedMs":"316","totalSlotMs":"24968","pendingUnits":"182","completedUnits":"0","activeUnits":"0","estimatedRunnableUnits":"0"},{"elapsedMs":"770","totalSlotMs":"24968","pendingUnits":"0","completedUnits":"304","estimatedRunnableUnits":"0"}],"totalPartitionsProcessed":"182","totalBytesProcessed":"1594954856","totalBytesBilled":"1595932672","billingTier":1,"totalSlotMs":"24968","cacheHit":false,"referencedTables":[{"projectId":"bigquery-public-data","datasetId":"crypto_ethereum_classic","tableId":"transactions"},{"projectId":"bigquery-public-data","datasetId":"crypto_ethereum_classic","tableId":"traces"}],"statementType":"SELECT","searchStatistics":{"indexUsageMode":"UNUSED","indexUnusedReasons":[{"code":"INDEX_CONFIG_NOT_AVAILABLE","message":"There is no index configuration for the base table `bigquery-public-data:crypto_ethereum_classic.traces`.","baseTable":{"projectId":"bigquery-public-data","datasetId":"crypto_ethereum_classic","tableId":"traces"}},{"code":"INDEX_CONFIG_NOT_AVAILABLE","message":"There is no index configuration for the base table `bigquery-public-data:crypto_ethereum_classic.transactions`.","baseTable":{"projectId":"bigquery-public-data","datasetId":"crypto_ethereum_classic","tableId":"transactions"}}]},"performanceInsights":{"avgPreviousExecutionMs":"517"},"transferredBytes":"0","metadataCacheStatistics":{"tableMetadataCacheUsage":[{"tableReference":{"projectId":"bigquery-public-data","datasetId":"crypto_ethereum_classic","tableId":"transactions"},"unusedReason":"OTHER_REASON"},{"tableReference":{"projectId":"bigquery-public-data","datasetId":"crypto_ethereum_classic","tableId":"traces"},"unusedReason":"OTHER_REASON"}]}},"totalSlotMs":"24968","finalExecutionDurationMs":"560"},"status":{"state":"DONE"},"principal_subject":"user:admin@bentrollope.altostrat.com","jobCreationReason":{"code":"REQUESTED"}}'
++ jq -r .statistics.totalSlotMs
+ total_slot_ms=24968
++ jq -r .statistics.startTime
++ echo '{"kind":"bigquery#job","etag":"zYoc2eyKQ5AKliv7jYT18A==","id":"tony-allen:US.bqjob_r416f02ee81104807_0000019a5ec0c249_1","selfLink":"https://bigquery.googleapis.com/bigquery/v2/projects/tony-allen/jobs/bqjob_r416f02ee81104807_0000019a5ec0c249_1?location=US","user_email":"admin@bentrollope.altostrat.com","configuration":{"query":{"query":"WITH TransactionSummary AS (\n    -- CTE 1 (Optimized): Single scan of the transactions table to calculate fees and rank all relevant senders.\n    SELECT\n        t.from_address,\n        SUM(CAST(t.gas_price AS NUMERIC) * CAST(t.receipt_gas_used AS NUMERIC)) AS total_fees_paid,\n        ROW_NUMBER() OVER (\n            ORDER BY COUNT(t.hash) DESC\n        ) AS rn_transaction_count\n    FROM\n        `bigquery-public-data.crypto_ethereum_classic.transactions` AS t\n    WHERE\n        t.receipt_status = 1 \n        AND t.block_timestamp >= '\''2020-01-01 00:00:00 UTC'\''\n        AND t.block_timestamp < '\''2020-04-01 00:00:00 UTC'\''\n    GROUP BY\n        1\n),\n\nTraceSummary AS (\n    -- CTE 2 (Optimized): Single scan of the traces table to calculate the total value sent\n    SELECT\n        tr.from_address,\n        SUM(tr.value) AS total_value_sent\n    FROM\n        `bigquery-public-data.crypto_ethereum_classic.traces` AS tr\n    WHERE\n        tr.block_timestamp >= '\''2020-01-01 00:00:00 UTC'\''  \n        AND tr.block_timestamp < '\''2020-04-01 00:00:00 UTC'\''\n    GROUP BY\n        1\n)\n\n-- Final SELECT: Filter to the top 5 addresses (using the rank) and join the two pre-aggregated summaries.\nSELECT\n    ts.from_address,\n    ts.total_fees_paid,\n    vs.total_value_sent,\n    vs.total_value_sent - ts.total_fees_paid AS net_ether_flow_wei\nFROM\n    TransactionSummary AS ts\nINNER JOIN\n    TraceSummary AS vs ON ts.from_address = vs.from_address\nWHERE\n    ts.rn_transaction_count <= 5 -- Filter down to the top 5 addresses\nORDER BY\n    net_ether_flow_wei DESC\nLIMIT 100","destinationTable":{"projectId":"tony-allen","datasetId":"_e34c49c766e4fd3f5d404c3949b9e19fa7acb372","tableId":"anon6489f30f_f891_48fc_a822_3c5c62918fc4"},"writeDisposition":"WRITE_TRUNCATE","priority":"INTERACTIVE","useQueryCache":false,"useLegacySql":false},"jobType":"QUERY"},"jobReference":{"projectId":"tony-allen","jobId":"bqjob_r416f02ee81104807_0000019a5ec0c249_1","location":"US"},"statistics":{"creationTime":"1762526282566","startTime":"1762526282684","endTime":"1762526283560","totalBytesProcessed":"1594954856","query":{"queryPlan":[{"name":"S00: Input","id":"0","startMs":"1762526282942","endMs":"1762526283139","waitRatioAvg":0.4722222222222222,"waitMsAvg":"51","waitRatioMax":0.6018518518518519,"waitMsMax":"65","readRatioAvg":0.2222222222222222,"readMsAvg":"24","readRatioMax":0.7685185185185185,"readMsMax":"83","computeRatioAvg":0.28703703703703703,"computeMsAvg":"31","computeRatioMax":0.4722222222222222,"computeMsMax":"51","writeRatioAvg":0.037037037037037035,"writeMsAvg":"4","writeRatioMax":0.25,"writeMsMax":"27","shuffleOutputBytes":"42519872","shuffleOutputBytesSpilled":"0","recordsRead":"3714129","recordsWritten":"582464","parallelInputs":"91","completedParallelInputs":"91","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$10:hash, $11:from_address, $12:gas_price, $13:receipt_gas_used, $14:receipt_status, $15:block_timestamp","FROM bigquery-public-data.crypto_ethereum_classic.transactions","WHERE and(equal($14, 1), greater_or_equal($15, 1577836800.000000000), less($15, 1585699200.000000000))"]},{"kind":"AGGREGATE","substeps":["GROUP BY $100 := $11","$80 := SUM($90)","$81 := COUNT($10)"]},{"kind":"COMPUTE","substeps":["$90 := multiply(CAST($12 AS NUMERIC), CAST($13 AS NUMERIC))"]},{"kind":"WRITE","substeps":["$100, $80, $81","TO __stage00_output","BY HASH($100)"]}],"slotMs":"7355","computeMode":"BIGQUERY"},{"name":"S01: Input","id":"1","startMs":"1762526282942","endMs":"1762526283081","waitRatioAvg":0.3611111111111111,"waitMsAvg":"39","waitRatioMax":0.49074074074074076,"waitMsMax":"53","readRatioAvg":0.19444444444444445,"readMsAvg":"21","readRatioMax":1,"readMsMax":"108","computeRatioAvg":0.32407407407407407,"computeMsAvg":"35","computeRatioMax":0.6388888888888888,"computeMsMax":"69","writeRatioAvg":0.09259259259259259,"writeMsAvg":"10","writeRatioMax":0.24074074074074073,"writeMsMax":"26","shuffleOutputBytes":"38731942","shuffleOutputBytesSpilled":"0","recordsRead":"15993917","recordsWritten":"605252","parallelInputs":"91","completedParallelInputs":"91","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$1:from_address, $2:value, $3:block_timestamp","FROM bigquery-public-data.crypto_ethereum_classic.traces","WHERE and(greater_or_equal($3, 1577836800.000000000), less($3, 1585699200.000000000))"]},{"kind":"AGGREGATE","substeps":["GROUP BY $160 := $1","$50 := SUM($2)"]},{"kind":"WRITE","substeps":["$160, $50","TO __stage01_output","BY HASH($160)"]}],"slotMs":"8544","computeMode":"BIGQUERY"},{"name":"S02: Sort+","id":"2","startMs":"1762526283162","endMs":"1762526283223","inputStages":["0"],"waitRatioAvg":0.1111111111111111,"waitMsAvg":"12","waitRatioMax":0.1111111111111111,"waitMsMax":"12","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.48148148148148145,"computeMsAvg":"52","computeRatioMax":0.6203703703703703,"computeMsMax":"67","writeRatioAvg":0.037037037037037035,"writeMsAvg":"4","writeRatioMax":0.046296296296296294,"writeMsMax":"5","shuffleOutputBytes":"3285","shuffleOutputBytesSpilled":"0","recordsRead":"582464","recordsWritten":"45","parallelInputs":"9","completedParallelInputs":"9","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$100, $80, $81","FROM __stage00_output"]},{"kind":"FILTER","substeps":["less_or_equal($60, 5)"]},{"kind":"ANALYTIC_FUNCTION","substeps":["$60 := ROW_NUMBER() OVER (ORDER BY $122 DESC)"]},{"kind":"SORT","substeps":["$71 DESC"]},{"kind":"AGGREGATE","substeps":["GROUP BY $110 := $100","$70 := SUM($80)","$71 := SUM_OF_COUNTS($81)"]},{"kind":"WRITE","substeps":["$130, $131, $132","TO __stage02_output"]}],"slotMs":"754","computeMode":"BIGQUERY"},{"name":"S03: Aggregate+","id":"3","startMs":"1762526283227","endMs":"1762526283236","inputStages":["2"],"waitRatioAvg":0.027777777777777776,"waitMsAvg":"3","waitRatioMax":0.027777777777777776,"waitMsMax":"3","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.05555555555555555,"computeMsAvg":"6","computeRatioMax":0.05555555555555555,"computeMsMax":"6","writeRatioAvg":0.009259259259259259,"writeMsAvg":"1","writeRatioMax":0.009259259259259259,"writeMsMax":"1","shuffleOutputBytes":"37","shuffleOutputBytesSpilled":"0","recordsRead":"45","recordsWritten":"1","parallelInputs":"1","completedParallelInputs":"1","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$130, $131, $132","FROM __stage02_output"]},{"kind":"AGGREGATE","substeps":["$134 := shard_sink_stats($133)"]},{"kind":"COMPUTE","substeps":["$133 := STRUCT<...>"]},{"kind":"WRITE","substeps":["$134","TO __stage03_output"]}],"slotMs":"10","computeMode":"BIGQUERY"},{"name":"S04: Aggregate","id":"4","startMs":"1762526283235","endMs":"1762526283283","inputStages":["3"],"waitRatioAvg":0.09259259259259259,"waitMsAvg":"10","waitRatioMax":0.09259259259259259,"waitMsMax":"10","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.12037037037037036,"computeMsAvg":"13","computeRatioMax":0.12037037037037036,"computeMsMax":"13","writeRatioAvg":0.1574074074074074,"writeMsAvg":"17","writeRatioMax":0.1574074074074074,"writeMsMax":"17","shuffleOutputBytes":"27","shuffleOutputBytesSpilled":"0","recordsRead":"1","recordsWritten":"1","parallelInputs":"1","completedParallelInputs":"1","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$134","FROM __stage03_output"]},{"kind":"AGGREGATE","substeps":["$135 := root_sink_stats($134)"]},{"kind":"WRITE","substeps":["$135","TO __stage04_output"]}],"slotMs":"45","computeMode":"BIGQUERY"},{"name":"S06: Sort+","id":"6","startMs":"1762526283303","endMs":"1762526283333","inputStages":["4","2"],"waitRatioAvg":0.027777777777777776,"waitMsAvg":"3","waitRatioMax":0.027777777777777776,"waitMsMax":"3","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.1388888888888889,"computeMsAvg":"15","computeRatioMax":0.1388888888888889,"computeMsMax":"15","writeRatioAvg":0.12037037037037036,"writeMsAvg":"13","writeRatioMax":0.12037037037037036,"writeMsMax":"13","shuffleOutputBytes":"320","shuffleOutputBytesSpilled":"0","recordsRead":"46","recordsWritten":"5","parallelInputs":"1","completedParallelInputs":"1","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$135","FROM __stage04_output"]},{"kind":"READ","substeps":["$130, $131, $132","FROM __stage02_output"]},{"kind":"FILTER","substeps":["less_or_equal($40, 5)"]},{"kind":"ANALYTIC_FUNCTION","substeps":["$40 := ROW_NUMBER($135) OVER (ORDER BY $142 DESC)"]},{"kind":"SORT","substeps":["$132 DESC"]},{"kind":"WRITE","substeps":["$150, $151","TO __stage06_output"]}],"slotMs":"20","computeMode":"BIGQUERY"},{"name":"S07: Coalesce","id":"7","startMs":"1762526283340","endMs":"1762526283405","inputStages":["6"],"waitRatioAvg":0.05555555555555555,"waitMsAvg":"6","waitRatioMax":0.06481481481481481,"waitMsMax":"7","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.09259259259259259,"computeMsAvg":"10","computeRatioMax":0.12962962962962962,"computeMsMax":"14","writeRatioAvg":0.09259259259259259,"writeMsAvg":"10","writeRatioMax":0.18518518518518517,"writeMsMax":"20","shuffleOutputBytes":"320","shuffleOutputBytesSpilled":"0","recordsRead":"5","recordsWritten":"5","parallelInputs":"100","completedParallelInputs":"100","status":"COMPLETE","steps":[{"kind":"READ","substeps":["FROM __stage06_output"]}],"slotMs":"6932","computeMode":"BIGQUERY"},{"name":"S08: Join+","id":"8","startMs":"1762526283345","endMs":"1762526283436","inputStages":["1","7"],"waitRatioAvg":0.09259259259259259,"waitMsAvg":"10","waitRatioMax":0.10185185185185185,"waitMsMax":"11","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.42592592592592593,"computeMsAvg":"46","computeRatioMax":0.5648148148148148,"computeMsMax":"61","writeRatioAvg":0.018518518518518517,"writeMsAvg":"2","writeRatioMax":0.037037037037037035,"writeMsMax":"4","shuffleOutputBytes":"490","shuffleOutputBytesSpilled":"0","recordsRead":"605297","recordsWritten":"5","parallelInputs":"9","completedParallelInputs":"9","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$160, $50","FROM __stage01_output"]},{"kind":"READ","substeps":["$150, $151","FROM __stage07_output"]},{"kind":"SORT","substeps":["$20 DESC","LIMIT 100"]},{"kind":"COMPUTE","substeps":["$20 := subtract($182, $181)"]},{"kind":"JOIN","substeps":["$182 := $30, $180 := $150, $181 := $151","INNER HASH JOIN EACH  WITH ALL  ON $170 = $150"]},{"kind":"AGGREGATE","substeps":["GROUP BY $170 := $160","$30 := SUM($50)"]},{"kind":"WRITE","substeps":["$190, $191, $192, $193","TO __stage08_output"]}],"slotMs":"1200","computeMode":"BIGQUERY"},{"name":"S09: Output","id":"9","startMs":"1762526283356","endMs":"1762526283447","inputStages":["8"],"waitRatioAvg":0.1574074074074074,"waitMsAvg":"17","waitRatioMax":0.1574074074074074,"waitMsMax":"17","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.08333333333333333,"computeMsAvg":"9","computeRatioMax":0.08333333333333333,"computeMsMax":"9","writeRatioAvg":0.10185185185185185,"writeMsAvg":"11","writeRatioMax":0.10185185185185185,"writeMsMax":"11","shuffleOutputBytes":"490","shuffleOutputBytesSpilled":"0","recordsRead":"5","recordsWritten":"5","parallelInputs":"1","completedParallelInputs":"1","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$190, $191, $192, $193","FROM __stage08_output"]},{"kind":"SORT","substeps":["$191 DESC","LIMIT 100"]},{"kind":"WRITE","substeps":["$200, $201, $202, $203","TO __stage09_output"]}],"slotMs":"106","computeMode":"BIGQUERY"}],"estimatedBytesProcessed":"1594954856","timeline":[{"elapsedMs":"316","totalSlotMs":"24968","pendingUnits":"182","completedUnits":"0","activeUnits":"0","estimatedRunnableUnits":"0"},{"elapsedMs":"770","totalSlotMs":"24968","pendingUnits":"0","completedUnits":"304","estimatedRunnableUnits":"0"}],"totalPartitionsProcessed":"182","totalBytesProcessed":"1594954856","totalBytesBilled":"1595932672","billingTier":1,"totalSlotMs":"24968","cacheHit":false,"referencedTables":[{"projectId":"bigquery-public-data","datasetId":"crypto_ethereum_classic","tableId":"transactions"},{"projectId":"bigquery-public-data","datasetId":"crypto_ethereum_classic","tableId":"traces"}],"statementType":"SELECT","searchStatistics":{"indexUsageMode":"UNUSED","indexUnusedReasons":[{"code":"INDEX_CONFIG_NOT_AVAILABLE","message":"There is no index configuration for the base table `bigquery-public-data:crypto_ethereum_classic.traces`.","baseTable":{"projectId":"bigquery-public-data","datasetId":"crypto_ethereum_classic","tableId":"traces"}},{"code":"INDEX_CONFIG_NOT_AVAILABLE","message":"There is no index configuration for the base table `bigquery-public-data:crypto_ethereum_classic.transactions`.","baseTable":{"projectId":"bigquery-public-data","datasetId":"crypto_ethereum_classic","tableId":"transactions"}}]},"performanceInsights":{"avgPreviousExecutionMs":"517"},"transferredBytes":"0","metadataCacheStatistics":{"tableMetadataCacheUsage":[{"tableReference":{"projectId":"bigquery-public-data","datasetId":"crypto_ethereum_classic","tableId":"transactions"},"unusedReason":"OTHER_REASON"},{"tableReference":{"projectId":"bigquery-public-data","datasetId":"crypto_ethereum_classic","tableId":"traces"},"unusedReason":"OTHER_REASON"}]}},"totalSlotMs":"24968","finalExecutionDurationMs":"560"},"status":{"state":"DONE"},"principal_subject":"user:admin@bentrollope.altostrat.com","jobCreationReason":{"code":"REQUESTED"}}'
+ start_time=1762526282684
++ jq -r .statistics.endTime
++ echo '{"kind":"bigquery#job","etag":"zYoc2eyKQ5AKliv7jYT18A==","id":"tony-allen:US.bqjob_r416f02ee81104807_0000019a5ec0c249_1","selfLink":"https://bigquery.googleapis.com/bigquery/v2/projects/tony-allen/jobs/bqjob_r416f02ee81104807_0000019a5ec0c249_1?location=US","user_email":"admin@bentrollope.altostrat.com","configuration":{"query":{"query":"WITH TransactionSummary AS (\n    -- CTE 1 (Optimized): Single scan of the transactions table to calculate fees and rank all relevant senders.\n    SELECT\n        t.from_address,\n        SUM(CAST(t.gas_price AS NUMERIC) * CAST(t.receipt_gas_used AS NUMERIC)) AS total_fees_paid,\n        ROW_NUMBER() OVER (\n            ORDER BY COUNT(t.hash) DESC\n        ) AS rn_transaction_count\n    FROM\n        `bigquery-public-data.crypto_ethereum_classic.transactions` AS t\n    WHERE\n        t.receipt_status = 1 \n        AND t.block_timestamp >= '\''2020-01-01 00:00:00 UTC'\''\n        AND t.block_timestamp < '\''2020-04-01 00:00:00 UTC'\''\n    GROUP BY\n        1\n),\n\nTraceSummary AS (\n    -- CTE 2 (Optimized): Single scan of the traces table to calculate the total value sent\n    SELECT\n        tr.from_address,\n        SUM(tr.value) AS total_value_sent\n    FROM\n        `bigquery-public-data.crypto_ethereum_classic.traces` AS tr\n    WHERE\n        tr.block_timestamp >= '\''2020-01-01 00:00:00 UTC'\''  \n        AND tr.block_timestamp < '\''2020-04-01 00:00:00 UTC'\''\n    GROUP BY\n        1\n)\n\n-- Final SELECT: Filter to the top 5 addresses (using the rank) and join the two pre-aggregated summaries.\nSELECT\n    ts.from_address,\n    ts.total_fees_paid,\n    vs.total_value_sent,\n    vs.total_value_sent - ts.total_fees_paid AS net_ether_flow_wei\nFROM\n    TransactionSummary AS ts\nINNER JOIN\n    TraceSummary AS vs ON ts.from_address = vs.from_address\nWHERE\n    ts.rn_transaction_count <= 5 -- Filter down to the top 5 addresses\nORDER BY\n    net_ether_flow_wei DESC\nLIMIT 100","destinationTable":{"projectId":"tony-allen","datasetId":"_e34c49c766e4fd3f5d404c3949b9e19fa7acb372","tableId":"anon6489f30f_f891_48fc_a822_3c5c62918fc4"},"writeDisposition":"WRITE_TRUNCATE","priority":"INTERACTIVE","useQueryCache":false,"useLegacySql":false},"jobType":"QUERY"},"jobReference":{"projectId":"tony-allen","jobId":"bqjob_r416f02ee81104807_0000019a5ec0c249_1","location":"US"},"statistics":{"creationTime":"1762526282566","startTime":"1762526282684","endTime":"1762526283560","totalBytesProcessed":"1594954856","query":{"queryPlan":[{"name":"S00: Input","id":"0","startMs":"1762526282942","endMs":"1762526283139","waitRatioAvg":0.4722222222222222,"waitMsAvg":"51","waitRatioMax":0.6018518518518519,"waitMsMax":"65","readRatioAvg":0.2222222222222222,"readMsAvg":"24","readRatioMax":0.7685185185185185,"readMsMax":"83","computeRatioAvg":0.28703703703703703,"computeMsAvg":"31","computeRatioMax":0.4722222222222222,"computeMsMax":"51","writeRatioAvg":0.037037037037037035,"writeMsAvg":"4","writeRatioMax":0.25,"writeMsMax":"27","shuffleOutputBytes":"42519872","shuffleOutputBytesSpilled":"0","recordsRead":"3714129","recordsWritten":"582464","parallelInputs":"91","completedParallelInputs":"91","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$10:hash, $11:from_address, $12:gas_price, $13:receipt_gas_used, $14:receipt_status, $15:block_timestamp","FROM bigquery-public-data.crypto_ethereum_classic.transactions","WHERE and(equal($14, 1), greater_or_equal($15, 1577836800.000000000), less($15, 1585699200.000000000))"]},{"kind":"AGGREGATE","substeps":["GROUP BY $100 := $11","$80 := SUM($90)","$81 := COUNT($10)"]},{"kind":"COMPUTE","substeps":["$90 := multiply(CAST($12 AS NUMERIC), CAST($13 AS NUMERIC))"]},{"kind":"WRITE","substeps":["$100, $80, $81","TO __stage00_output","BY HASH($100)"]}],"slotMs":"7355","computeMode":"BIGQUERY"},{"name":"S01: Input","id":"1","startMs":"1762526282942","endMs":"1762526283081","waitRatioAvg":0.3611111111111111,"waitMsAvg":"39","waitRatioMax":0.49074074074074076,"waitMsMax":"53","readRatioAvg":0.19444444444444445,"readMsAvg":"21","readRatioMax":1,"readMsMax":"108","computeRatioAvg":0.32407407407407407,"computeMsAvg":"35","computeRatioMax":0.6388888888888888,"computeMsMax":"69","writeRatioAvg":0.09259259259259259,"writeMsAvg":"10","writeRatioMax":0.24074074074074073,"writeMsMax":"26","shuffleOutputBytes":"38731942","shuffleOutputBytesSpilled":"0","recordsRead":"15993917","recordsWritten":"605252","parallelInputs":"91","completedParallelInputs":"91","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$1:from_address, $2:value, $3:block_timestamp","FROM bigquery-public-data.crypto_ethereum_classic.traces","WHERE and(greater_or_equal($3, 1577836800.000000000), less($3, 1585699200.000000000))"]},{"kind":"AGGREGATE","substeps":["GROUP BY $160 := $1","$50 := SUM($2)"]},{"kind":"WRITE","substeps":["$160, $50","TO __stage01_output","BY HASH($160)"]}],"slotMs":"8544","computeMode":"BIGQUERY"},{"name":"S02: Sort+","id":"2","startMs":"1762526283162","endMs":"1762526283223","inputStages":["0"],"waitRatioAvg":0.1111111111111111,"waitMsAvg":"12","waitRatioMax":0.1111111111111111,"waitMsMax":"12","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.48148148148148145,"computeMsAvg":"52","computeRatioMax":0.6203703703703703,"computeMsMax":"67","writeRatioAvg":0.037037037037037035,"writeMsAvg":"4","writeRatioMax":0.046296296296296294,"writeMsMax":"5","shuffleOutputBytes":"3285","shuffleOutputBytesSpilled":"0","recordsRead":"582464","recordsWritten":"45","parallelInputs":"9","completedParallelInputs":"9","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$100, $80, $81","FROM __stage00_output"]},{"kind":"FILTER","substeps":["less_or_equal($60, 5)"]},{"kind":"ANALYTIC_FUNCTION","substeps":["$60 := ROW_NUMBER() OVER (ORDER BY $122 DESC)"]},{"kind":"SORT","substeps":["$71 DESC"]},{"kind":"AGGREGATE","substeps":["GROUP BY $110 := $100","$70 := SUM($80)","$71 := SUM_OF_COUNTS($81)"]},{"kind":"WRITE","substeps":["$130, $131, $132","TO __stage02_output"]}],"slotMs":"754","computeMode":"BIGQUERY"},{"name":"S03: Aggregate+","id":"3","startMs":"1762526283227","endMs":"1762526283236","inputStages":["2"],"waitRatioAvg":0.027777777777777776,"waitMsAvg":"3","waitRatioMax":0.027777777777777776,"waitMsMax":"3","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.05555555555555555,"computeMsAvg":"6","computeRatioMax":0.05555555555555555,"computeMsMax":"6","writeRatioAvg":0.009259259259259259,"writeMsAvg":"1","writeRatioMax":0.009259259259259259,"writeMsMax":"1","shuffleOutputBytes":"37","shuffleOutputBytesSpilled":"0","recordsRead":"45","recordsWritten":"1","parallelInputs":"1","completedParallelInputs":"1","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$130, $131, $132","FROM __stage02_output"]},{"kind":"AGGREGATE","substeps":["$134 := shard_sink_stats($133)"]},{"kind":"COMPUTE","substeps":["$133 := STRUCT<...>"]},{"kind":"WRITE","substeps":["$134","TO __stage03_output"]}],"slotMs":"10","computeMode":"BIGQUERY"},{"name":"S04: Aggregate","id":"4","startMs":"1762526283235","endMs":"1762526283283","inputStages":["3"],"waitRatioAvg":0.09259259259259259,"waitMsAvg":"10","waitRatioMax":0.09259259259259259,"waitMsMax":"10","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.12037037037037036,"computeMsAvg":"13","computeRatioMax":0.12037037037037036,"computeMsMax":"13","writeRatioAvg":0.1574074074074074,"writeMsAvg":"17","writeRatioMax":0.1574074074074074,"writeMsMax":"17","shuffleOutputBytes":"27","shuffleOutputBytesSpilled":"0","recordsRead":"1","recordsWritten":"1","parallelInputs":"1","completedParallelInputs":"1","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$134","FROM __stage03_output"]},{"kind":"AGGREGATE","substeps":["$135 := root_sink_stats($134)"]},{"kind":"WRITE","substeps":["$135","TO __stage04_output"]}],"slotMs":"45","computeMode":"BIGQUERY"},{"name":"S06: Sort+","id":"6","startMs":"1762526283303","endMs":"1762526283333","inputStages":["4","2"],"waitRatioAvg":0.027777777777777776,"waitMsAvg":"3","waitRatioMax":0.027777777777777776,"waitMsMax":"3","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.1388888888888889,"computeMsAvg":"15","computeRatioMax":0.1388888888888889,"computeMsMax":"15","writeRatioAvg":0.12037037037037036,"writeMsAvg":"13","writeRatioMax":0.12037037037037036,"writeMsMax":"13","shuffleOutputBytes":"320","shuffleOutputBytesSpilled":"0","recordsRead":"46","recordsWritten":"5","parallelInputs":"1","completedParallelInputs":"1","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$135","FROM __stage04_output"]},{"kind":"READ","substeps":["$130, $131, $132","FROM __stage02_output"]},{"kind":"FILTER","substeps":["less_or_equal($40, 5)"]},{"kind":"ANALYTIC_FUNCTION","substeps":["$40 := ROW_NUMBER($135) OVER (ORDER BY $142 DESC)"]},{"kind":"SORT","substeps":["$132 DESC"]},{"kind":"WRITE","substeps":["$150, $151","TO __stage06_output"]}],"slotMs":"20","computeMode":"BIGQUERY"},{"name":"S07: Coalesce","id":"7","startMs":"1762526283340","endMs":"1762526283405","inputStages":["6"],"waitRatioAvg":0.05555555555555555,"waitMsAvg":"6","waitRatioMax":0.06481481481481481,"waitMsMax":"7","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.09259259259259259,"computeMsAvg":"10","computeRatioMax":0.12962962962962962,"computeMsMax":"14","writeRatioAvg":0.09259259259259259,"writeMsAvg":"10","writeRatioMax":0.18518518518518517,"writeMsMax":"20","shuffleOutputBytes":"320","shuffleOutputBytesSpilled":"0","recordsRead":"5","recordsWritten":"5","parallelInputs":"100","completedParallelInputs":"100","status":"COMPLETE","steps":[{"kind":"READ","substeps":["FROM __stage06_output"]}],"slotMs":"6932","computeMode":"BIGQUERY"},{"name":"S08: Join+","id":"8","startMs":"1762526283345","endMs":"1762526283436","inputStages":["1","7"],"waitRatioAvg":0.09259259259259259,"waitMsAvg":"10","waitRatioMax":0.10185185185185185,"waitMsMax":"11","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.42592592592592593,"computeMsAvg":"46","computeRatioMax":0.5648148148148148,"computeMsMax":"61","writeRatioAvg":0.018518518518518517,"writeMsAvg":"2","writeRatioMax":0.037037037037037035,"writeMsMax":"4","shuffleOutputBytes":"490","shuffleOutputBytesSpilled":"0","recordsRead":"605297","recordsWritten":"5","parallelInputs":"9","completedParallelInputs":"9","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$160, $50","FROM __stage01_output"]},{"kind":"READ","substeps":["$150, $151","FROM __stage07_output"]},{"kind":"SORT","substeps":["$20 DESC","LIMIT 100"]},{"kind":"COMPUTE","substeps":["$20 := subtract($182, $181)"]},{"kind":"JOIN","substeps":["$182 := $30, $180 := $150, $181 := $151","INNER HASH JOIN EACH  WITH ALL  ON $170 = $150"]},{"kind":"AGGREGATE","substeps":["GROUP BY $170 := $160","$30 := SUM($50)"]},{"kind":"WRITE","substeps":["$190, $191, $192, $193","TO __stage08_output"]}],"slotMs":"1200","computeMode":"BIGQUERY"},{"name":"S09: Output","id":"9","startMs":"1762526283356","endMs":"1762526283447","inputStages":["8"],"waitRatioAvg":0.1574074074074074,"waitMsAvg":"17","waitRatioMax":0.1574074074074074,"waitMsMax":"17","readRatioAvg":0,"readMsAvg":"0","readRatioMax":0,"readMsMax":"0","computeRatioAvg":0.08333333333333333,"computeMsAvg":"9","computeRatioMax":0.08333333333333333,"computeMsMax":"9","writeRatioAvg":0.10185185185185185,"writeMsAvg":"11","writeRatioMax":0.10185185185185185,"writeMsMax":"11","shuffleOutputBytes":"490","shuffleOutputBytesSpilled":"0","recordsRead":"5","recordsWritten":"5","parallelInputs":"1","completedParallelInputs":"1","status":"COMPLETE","steps":[{"kind":"READ","substeps":["$190, $191, $192, $193","FROM __stage08_output"]},{"kind":"SORT","substeps":["$191 DESC","LIMIT 100"]},{"kind":"WRITE","substeps":["$200, $201, $202, $203","TO __stage09_output"]}],"slotMs":"106","computeMode":"BIGQUERY"}],"estimatedBytesProcessed":"1594954856","timeline":[{"elapsedMs":"316","totalSlotMs":"24968","pendingUnits":"182","completedUnits":"0","activeUnits":"0","estimatedRunnableUnits":"0"},{"elapsedMs":"770","totalSlotMs":"24968","pendingUnits":"0","completedUnits":"304","estimatedRunnableUnits":"0"}],"totalPartitionsProcessed":"182","totalBytesProcessed":"1594954856","totalBytesBilled":"1595932672","billingTier":1,"totalSlotMs":"24968","cacheHit":false,"referencedTables":[{"projectId":"bigquery-public-data","datasetId":"crypto_ethereum_classic","tableId":"transactions"},{"projectId":"bigquery-public-data","datasetId":"crypto_ethereum_classic","tableId":"traces"}],"statementType":"SELECT","searchStatistics":{"indexUsageMode":"UNUSED","indexUnusedReasons":[{"code":"INDEX_CONFIG_NOT_AVAILABLE","message":"There is no index configuration for the base table `bigquery-public-data:crypto_ethereum_classic.traces`.","baseTable":{"projectId":"bigquery-public-data","datasetId":"crypto_ethereum_classic","tableId":"traces"}},{"code":"INDEX_CONFIG_NOT_AVAILABLE","message":"There is no index configuration for the base table `bigquery-public-data:crypto_ethereum_classic.transactions`.","baseTable":{"projectId":"bigquery-public-data","datasetId":"crypto_ethereum_classic","tableId":"transactions"}}]},"performanceInsights":{"avgPreviousExecutionMs":"517"},"transferredBytes":"0","metadataCacheStatistics":{"tableMetadataCacheUsage":[{"tableReference":{"projectId":"bigquery-public-data","datasetId":"crypto_ethereum_classic","tableId":"transactions"},"unusedReason":"OTHER_REASON"},{"tableReference":{"projectId":"bigquery-public-data","datasetId":"crypto_ethereum_classic","tableId":"traces"},"unusedReason":"OTHER_REASON"}]}},"totalSlotMs":"24968","finalExecutionDurationMs":"560"},"status":{"state":"DONE"},"principal_subject":"user:admin@bentrollope.altostrat.com","jobCreationReason":{"code":"REQUESTED"}}'
+ end_time=1762526283560
++ echo 1762526282684
++ awk '{print int($1)}'
+ start_ms=1762526282684
++ echo 1762526283560
++ awk '{print int($1)}'
+ end_ms=1762526283560
+ duration_ms=876
+ echo '  --- Execution Statistics ---'
  --- Execution Statistics ---
+ echo '  Duration: 876 ms'
  Duration: 876 ms
+ echo '  Bytes Processed: 1594954856 bytes'
  Bytes Processed: 1594954856 bytes
+ echo '  Slot Milliseconds: 24968'
  Slot Milliseconds: 24968
+ echo '  ----------------------------'
  ----------------------------
+ echo -e 'Top Sender Optimized\tbqjob_r416f02ee81104807_0000019a5ec0c249_1\t876\t1594954856\t24968'
+ echo ''

+ set +x
===========================================================
Script finished at Fri Nov  7 02:38:09 PM UTC 2025.
